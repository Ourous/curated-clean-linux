<!DOCTYPE html>
<html>
<body style="font-family:Helvetica">
<!-- chapter:Table of Contents-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><div style="background-color:#9999FF;"><h1 style="text-align:right;padding-top:0.6em;margin-bottom:0.6em;">Version 3.0<br>Language Report</h1>
<h1 style="text-align:right;margin-top:0.6em;">Table of Contents</h1></div></div>
<table style="width:100%;text-align:left">
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_P"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Preface </p></a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_1"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 1 Basic Semantics</p></a></td></tr>
<tr><td><a href="#_1.1">1.1</a></td><td colspan="2"><a href="#_1.1">Graph Rewriting</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_1.1.1">1.1.1</a></td><td><a href="#_1.1.1">A Small Example</a></td></tr>
<tr><td><a href="#_1.2">1.2</a></td><td colspan="2"><a href="#_1.2">Global Graphs</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_2"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 2 Modules and Scopes</p></a></td></tr>
<tr><td><a href="#_2.1">2.1</a></td><td colspan="2"><a href="#_2.1">Identifiers, Scopes and Name Spaces</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.1.1">2.1.1</a></td><td><a href="#_2.1.1">Naming Conventions of Identifiers</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.1.2">2.1.2</a></td><td><a href="#_2.1.2">Scopes and Name Spaces</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.1.3">2.1.3</a></td><td><a href="#_2.1.3">Nesting of Scopes</a></td></tr>
<tr><td><a href="#_2.2">2.2</a></td><td colspan="2"><a href="#_2.2">Modular Structure of Clean Programs</a></td></tr>
<tr><td><a href="#_2.3">2.3</a></td><td colspan="2"><a href="#_2.3">Implementation Modules</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.3.1">2.3.1</a></td><td><a href="#_2.3.1">The Main or Start Module</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.3.2">2.3.2</a></td><td><a href="#_2.3.2">Scope of Global Definitions in Implementation Modules</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.3.3">2.3.3</a></td><td><a href="#_2.3.3">Begin and End of a Definition: the Layout Rule</a></td></tr>
<tr><td><a href="#_2.4">2.4</a></td><td colspan="2"><a href="#_2.4">Definition Modules</a></td></tr>
<tr><td><a href="#_2.5">2.5</a></td><td colspan="2"><a href="#_2.5">Importing Definitions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.5.1">2.5.1</a></td><td><a href="#_2.5.1">Explicit Imports of Definitions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_2.5.2">2.5.2</a></td><td><a href="#_2.5.2">Implicit Imports of Definitions</a></td></tr>
<tr><td><a href="#_2.6">2.6</a></td><td colspan="2"><a href="#_2.6">System Definition and Implementation Modules</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_3"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 3 Defining Functions and Constants</p></a></td></tr>
<tr><td><a href="#_3.1">3.1</a></td><td colspan="2"><a href="#_3.1">Functions</a></td></tr>
<tr><td><a href="#_3.2">3.2</a></td><td colspan="2"><a href="#_3.2">Patterns</a></td></tr>
<tr><td><a href="#_3.3">3.3</a></td><td colspan="2"><a href="#_3.3">Guards</a></td></tr>
<tr><td><a href="#_3.4">3.4</a></td><td colspan="2"><a href="#_3.4">Expressions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.4.1">3.4.1</a></td><td><a href="#_3.4.1">Lambda Abstraction</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.4.2">3.4.2</a></td><td><a href="#_3.4.2">Case Expression and Conditional Expression</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.4.3">3.4.3</a></td><td><a href="#_3.4.3">Matches Pattern Expression</a></td></tr>
<tr><td><a href="#_3.5">3.5</a></td><td colspan="2"><a href="#_3.5">Local Definitions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.5.1">3.5.1</a></td><td><a href="#_3.5.1">Let Expression: Local Definitions in Expressions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.5.2">3.5.2</a></td><td><a href="#_3.5.2">Where Block: Local Definitions in a Function Alternative</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.5.3">3.5.3</a></td><td><a href="#_3.5.3">With Block: Local Definitions in a Guarded Alternative</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.5.4">3.5.4</a></td><td><a href="#_3.5.4">Let-Before Expression: Local Constants defined between Guards</a></td></tr>
<tr><td><a href="#_3.6">3.6</a></td><td colspan="2"><a href="#_3.6">Defining Constants</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.6.1">3.6.1</a></td><td><a href="#_3.6.1">Selectors</a></td></tr>
<tr><td><a href="#_3.7">3.7</a></td><td colspan="2"><a href="#_3.7">Typing Functions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.7.1">3.7.1</a></td><td><a href="#_3.7.1">Typing Curried Functions </a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.7.2">3.7.2</a></td><td><a href="#_3.7.2">Typing Operators</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.7.3">3.7.3</a></td><td><a href="#_3.7.3">Typing Partial Functions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.7.4">3.7.4</a></td><td><a href="#_3.7.4">Explicit use of the Universal Quantifier in Function Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_3.7.5">3.7.5</a></td><td><a href="#_3.7.5">Functions with Strict Arguments </a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_4"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 4 Predefined Types</p></a></td></tr>
<tr><td><a href="#_4.1">4.1</a></td><td colspan="2"><a href="#_4.1">Basic Types: Int, Real, Char and Bool</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.1.1">4.1.1</a></td><td><a href="#_4.1.1">Creating Constant Values of Basic Type</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.1.2">4.1.2</a></td><td><a href="#_4.1.2">Patterns of Basic Type</a></td></tr>
<tr><td><a href="#_4.2">4.2</a></td><td colspan="2"><a href="#_4.2">Lists</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.2.1">4.2.1</a></td><td><a href="#_4.2.1">Creating Lists</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.2.2">4.2.2</a></td><td><a href="#_4.2.2">List Patterns</a></td></tr>
<tr><td><a href="#_4.3">4.3</a></td><td colspan="2"><a href="#_4.3">Tuples</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.3.1">4.3.1</a></td><td><a href="#_4.3.1">Creating Tuples</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.3.2">4.3.2</a></td><td><a href="#_4.3.2">Tuple Patterns</a></td></tr>
<tr><td><a href="#_4.4">4.4</a></td><td colspan="2"><a href="#_4.4">Arrays</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.4.1">4.4.1</a></td><td><a href="#_4.4.1">Creating Arrays and Selection of field Elements</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_4.4.2">4.4.2</a></td><td><a href="#_4.4.2">Array Patterns</a></td></tr>
<tr><td><a href="#_4.5">4.5</a></td><td colspan="2"><a href="#_4.5">Predefined Type Constructors</a></td></tr>
<tr><td><a href="#_4.6">4.6</a></td><td colspan="2"><a href="#_4.6">Arrow Types</a></td></tr>
<tr><td><a href="#_4.7">4.7</a></td><td colspan="2"><a href="#_4.7">Predefined Abstract Types</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_5"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 5 Defining New Types</p></a></td></tr>
<tr><td><a href="#_5.1">5.1</a></td><td colspan="2"><a href="#_5.1">Defining Algebraic Data Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.1.1">5.1.1</a></td><td><a href="#_5.1.1">Using Constructors in Patterns</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.1.2">5.1.2</a></td><td><a href="#_5.1.2">Using Higher Order Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.1.3">5.1.3</a></td><td><a href="#_5.1.3">Defining Algebraic Data Types with Existentially Quantified Variables</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.1.4">5.1.4</a></td><td><a href="#_5.1.4">Defining Algebraic Data Types with Universally Quantified Variables</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.1.5">5.1.5</a></td><td><a href="#_5.1.5">Strictness Annotations in Type Definitions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.1.6">5.1.6</a></td><td><a href="#_5.1.6">Semantic Restrictions on Algebraic Data Types</a></td></tr>
<tr><td><a href="#_5.2">5.2</a></td><td colspan="2"><a href="#_5.2">Defining Record Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.2.1">5.2.1</a></td><td><a href="#_5.2.1">Creating Records and Selection of Record Fields</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.2.2">5.2.2</a></td><td><a href="#_5.2.2">Record Patterns</a></td></tr>
<tr><td><a href="#_5.3">5.3</a></td><td colspan="2"><a href="#_5.3">Defining Synonym Types</a></td></tr>
<tr><td><a href="#_5.4">5.4</a></td><td colspan="2"><a href="#_5.4">Defining Abstract Data Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_5.4.1">5.4.1</a></td><td><a href="#_5.4.1">Defining Abstract Data Types with Synonym Type Definition</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_6"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 6 Overloading</p></a></td></tr>
<tr><td><a href="#_6.1">6.1</a></td><td colspan="2"><a href="#_6.1">Type Classes</a></td></tr>
<tr><td><a href="#_6.2">6.2</a></td><td colspan="2"><a href="#_6.2">Functions Defined in Terms of Overloaded Functions</a></td></tr>
<tr><td><a href="#_6.3">6.3</a></td><td colspan="2"><a href="#_6.3">Type Classes Defined in Terms of Overloaded Functions</a></td></tr>
<tr><td><a href="#_6.4">6.4</a></td><td colspan="2"><a href="#_6.4">Type Constructor Classes</a></td></tr>
<tr><td><a href="#_6.5">6.5</a></td><td colspan="2"><a href="#_6.5">Overlapping Instances</a></td></tr>
<tr><td><a href="#_6.6">6.6</a></td><td colspan="2"><a href="#_6.6">Internal Overloading</a></td></tr>
<tr><td><a href="#_6.7">6.7</a></td><td colspan="2"><a href="#_6.7">Defining Derived Members in a Class</a></td></tr>
<tr><td><a href="#_6.8">6.8</a></td><td colspan="2"><a href="#_6.8">A Shorthand for Defining Overloaded Functions</a></td></tr>
<tr><td><a href="#_6.9">6.9</a></td><td colspan="2"><a href="#_6.9">Classes Defined in Terms of Other Classes</a></td></tr>
<tr><td><a href="#_6.10">6.10</a></td><td colspan="2"><a href="#_6.10">Exporting Type Classes</a></td></tr>
<tr><td><a href="#_6.11">6.11</a></td><td colspan="2"><a href="#_6.11">Semantic Restrictions on Type Classes</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_7"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 7 Generic Programming</p></a></td></tr>
<tr><td><a href="#_7.1">7.1</a></td><td colspan="2"><a href="#_7.1">Basic Ideas Behind Generic Programming</a></td></tr>
<tr><td><a href="#_7.2">7.2</a></td><td colspan="2"><a href="#_7.2">Defining Generic Functions</a></td></tr>
<tr><td><a href="#_7.3">7.3</a></td><td colspan="2"><a href="#_7.3">Deriving Generic Functions</a></td></tr>
<tr><td><a href="#_7.4">7.4</a></td><td colspan="2"><a href="#_7.4">Applying Generic Functions</a></td></tr>
<tr><td><a href="#_7.5">7.5</a></td><td colspan="2"><a href="#_7.5">Using Constructor Information</a></td></tr>
<tr><td><a href="#_7.6">7.6</a></td><td colspan="2"><a href="#_7.6">Generic Functions and Uniqueness Typing</a></td></tr>
<tr><td><a href="#_7.7">7.7</a></td><td colspan="2"><a href="#_7.7">Exporting Generic Functions</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_8"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 8 Dynamics</p></a></td></tr>
<tr><td><a href="#_8.1">8.1</a></td><td colspan="2"><a href="#_8.1">Packing Expressions into a Dynamic</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.1.1">8.1.1</a></td><td><a href="#_8.1.1">Packing Abstract Data Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.1.2">8.1.2</a></td><td><a href="#_8.1.2">Packing Overloaded Functions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.1.3">8.1.3</a></td><td><a href="#_8.1.3">Packing Expressions of Unique Type</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.1.4">8.1.4</a></td><td><a href="#_8.1.4">Packing Arguments of Unknown Type</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.1.5">8.1.5</a></td><td><a href="#_8.1.5">Using Dynamic Typing to Defeat the Static Type System</a></td></tr>
<tr><td><a href="#_8.2">8.2</a></td><td colspan="2"><a href="#_8.2">Unpacking Dynamics Using a Dynamic Pattern Match</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.2.1">8.2.1</a></td><td><a href="#_8.2.1">Unpacking Abstract Data Types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.2.2">8.2.2</a></td><td><a href="#_8.2.2">Unpacking of Overloaded Functions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.2.3">8.2.3</a></td><td><a href="#_8.2.3">Unpacking Expressions of Unique Type</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.2.4">8.2.4</a></td><td><a href="#_8.2.4">Checking and Unifying Types Schemes using Type Pattern Variables</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_8.2.5">8.2.5</a></td><td><a href="#_8.2.5">Checking and Unifying Unknown Types using Overloaded Type Variables</a></td></tr>
<tr><td><a href="#_8.3">8.3</a></td><td colspan="2"><a href="#_8.3">Type Safe Communication using Dynamics</a></td></tr>
<tr><td><a href="#_8.4">8.4</a></td><td colspan="2"><a href="#_8.4">Architecture of the implementation</a></td></tr>
<tr><td><a href="#_8.5">8.5</a></td><td colspan="2"><a href="#_8.5">Semantic Restrictions on Dynamics</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_9"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 9 Uniqueness Typing</p></a></td></tr>
<tr><td><a href="#_9.1">9.1</a></td><td colspan="2"><a href="#_9.1">Basic Ideas behind Uniqueness Typing</a></td></tr>
<tr><td><a href="#_9.2">9.2</a></td><td colspan="2"><a href="#_9.2">Attribute Propagation</a></td></tr>
<tr><td><a href="#_9.3">9.3</a></td><td colspan="2"><a href="#_9.3">Defining New Types with Uniqueness Attributes</a></td></tr>
<tr><td><a href="#_9.4">9.4</a></td><td colspan="2"><a href="#_9.4">Uniqueness and Sharing</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_9.4.1">9.4.1</a></td><td><a href="#_9.4.1">Higher Order Uniqueness Typing</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_9.4.2">9.4.2</a></td><td><a href="#_9.4.2">Uniqueness Type Coercions</a></td></tr>
<tr><td><a href="#_9.5">9.5</a></td><td colspan="2"><a href="#_9.5">Combining Uniqueness Typing and Overloading</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_9.5.1">9.5.1</a></td><td><a href="#_9.5.1">Constructor Classes</a></td></tr>
<tr><td><a href="#_9.6">9.6</a></td><td colspan="2"><a href="#_9.6">Higher-Order Type Definitions</a></td></tr>
<tr><td><a href="#_9.7">9.7</a></td><td colspan="2"><a href="#_9.7">Destructive Updates using Uniqueness Typing</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_10"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 10 Strictness, Macros and Efficiency</p></a></td></tr>
<tr><td><a href="#_10.1">10.1</a></td><td colspan="2"><a href="#_10.1">Annotations to Change Lazy Evaluation into Strict Evaluation</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_10.1.1">10.1.1</a></td><td><a href="#_10.1.1">Advantages and Disadvantages of Lazy versus Strict Evaluation</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_10.1.2">10.1.2</a></td><td><a href="#_10.1.2">Strict and Lazy Context</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_10.1.3">10.1.3</a></td><td><a href="#_10.1.3">Space Consumption in Strict and Lazy Context</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_10.1.4">10.1.4</a></td><td><a href="#_10.1.4">Time Consumption in Strict and Lazy Context</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_10.1.5">10.1.5</a></td><td><a href="#_10.1.5">Changing Lazy into Strict Evaluation</a></td></tr>
<tr><td><a href="#_10.2">10.2</a></td><td colspan="2"><a href="#_10.2">Defining Graphs on the Global Level</a></td></tr>
<tr><td><a href="#_10.3">10.3</a></td><td colspan="2"><a href="#_10.3">Defining Macros</a></td></tr>
<tr><td><a href="#_10.4">10.4</a></td><td colspan="2"><a href="#_10.4">Efficiency Tips</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_11"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Chapter 11 Foreign Language Interface</p></a></td></tr>
<tr><td><a href="#_11.1">11.1</a></td><td colspan="2"><a href="#_11.1">Foreign Export</a></td></tr>
<tr><td><a href="#_11.2">11.2</a></td><td colspan="2"><a href="#_11.2">Using ABC instructions</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_A"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Appendix A Context-Free Syntax Description</p></a></td></tr>
<tr><td><a href="#_A.1">A.1</a></td><td colspan="2"><a href="#_A.1">Clean Program</a></td></tr>
<tr><td><a href="#_A.2">A.2</a></td><td colspan="2"><a href="#_A.2">Import Definition</a></td></tr>
<tr><td><a href="#_A.3">A.3</a></td><td colspan="2"><a href="#_A.3">Function Definition</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_A.3.1">A.3.1</a></td><td><a href="#_A.3.1">Types of Functions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_A.3.2">A.3.2</a></td><td><a href="#_A.3.2">Patterns</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_A.3.3">A.3.3</a></td><td><a href="#_A.3.3">Graph Expressions</a></td></tr>
<tr><td><a href="#_A.4">A.4</a></td><td colspan="2"><a href="#_A.4">Macro Definition</a></td></tr>
<tr><td><a href="#_A.5">A.5</a></td><td colspan="2"><a href="#_A.5">Type Definition</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_A.5.1">A.5.1</a></td><td><a href="#_A.5.1">Types Expression</a></td></tr>
<tr><td><a href="#_A.6">A.6</a></td><td colspan="2"><a href="#_A.6">Class and Generic Definitions</a></td></tr>
<tr><td><a href="#_A.7">A.7</a></td><td colspan="2"><a href="#_A.7">Foreign Export Definition</a></td></tr>
<tr><td><a href="#_A.8">A.8</a></td><td colspan="2"><a href="#_A.8">Names</a></td></tr>
<tr><td><a href="#_A.9">A.9</a></td><td colspan="2"><a href="#_A.9">Denotations</a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_B"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Appendix B Lexical Structure</p></a></td></tr>
<tr><td><a href="#_B.1">B.1</a></td><td colspan="2"><a href="#_B.1">Lexical Program Structure</a></td></tr>
<tr><td><a href="#_B.2">B.2</a></td><td colspan="2"><a href="#_B.2">Comments</a></td></tr>
<tr><td><a href="#_B.3">B.3</a></td><td colspan="2"><a href="#_B.3">Reserved Keywords and Symbols </a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_C"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Appendix C Bibliography</p></a></td></tr>
<tr style="padding-top:6.0pt;padding-bottom:6.0pt;font-weight:bold;text-transform:uppercase"><td colspan="3"><a href="#_D"><p style="margin-bottom:6.0pt;margin-top:6.0pt;background-color:#9999FF ">Appendix D Compiler Extensions</p></a></td></tr>
<tr><td><a href="#_D.1">D.1</a></td><td colspan="2"><a href="#_D.1">Clean 3.0 Compiler Extensions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_D.1.1">D.1.1</a></td><td><a href="#_D.1.1">New imports</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_D.1.2">D.1.2</a></td><td><a href="#_D.1.2">Uniqueness typing additions</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_D.1.3">D.1.3</a></td><td><a href="#_D.1.3">New strictness annotations</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_D.1.4">D.1.4</a></td><td><a href="#_D.1.4">Hierarchical modules</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_D.1.5">D.1.5</a></td><td><a href="#_D.1.5">New types</a></td></tr>
<tr><td>&nbsp&nbsp&nbsp&nbsp</td><td><a href="#_D.1.6">D.1.6</a></td><td><a href="#_D.1.6">Generics additions</a></td></tr>
<tr><td><a href="#_D.2">D.2</a></td><td colspan="2"><a href="#_D.2">Clean Development Compiler Extensions</a></td></tr>
<tr><td><a href="#_D.3">D.3</a></td><td colspan="2"><a href="#_D.3">Clean ITask Compiler Extensions</a></td></tr>
</table>
<!-- chapter:Preface-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><div style="background-color:#9999FF;"><a id="_P"><h1 style="text-align:right;padding-top:0.6em;margin-bottom:0.6em;">Version 3.0<br>Language Report</h1>
<h1 style="text-align:right;margin-top:0.6em;">Preface</h1></div></div>
<p style="text-align:justify;">CLEAN is a practical applicable general-purpose lazy pure functional programming language suited for the development of real world applications.</p>
<p style="text-align:justify;">CLEAN has many features among which some very special ones.</p>
<p style="text-align:justify;">Functional languages are usually implemented using graph-rewriting techniques. CLEAN has explicit graph rewriting <i>semantics</i>; one can explicitly define the <i>sharing</i> of <i>structures</i> (<i>cyclic structures</i> as well) in the language (Barendregt et al., 1987; Sleep et al., 1993, Eekelen et al., 1997). This provides a better framework for controlling the time space behavior of functional programs.</p>
<p style="text-align:justify;">Of particular importance for practical use is CLEAN's Uniqueness Type System (Barendsen and Smetsers, 1993a) enabling the incorporation of destructive updates of arbitrary objects within a pure functional framework and the creation of direct interfaces with the outside world.</p>
<p style="text-align:justify;">CLEAN's "unique" features have made it possible to predefine (in CLEAN) a sophisticated and efficient I/O library (Achten and Plasmeijer, 1992 &amp; 1995). The CLEAN Object I/O library enables a CLEAN programmer to <i>specify interactive window based I/O applications</i> on a very high level of abstraction. One can define callback functions and I/O components with arbitrary local states thus providing an object-oriented style of programming (Achten, 1996; Achten and Plasmeijer, 1997). The library forms a platform independent interface to window-based systems: one can port window based I/O ap-plications written in CLEAN to different platforms (we support Mac and PC) without modification of source code.</p>
<p style="text-align:justify;">Although CLEAN is <i>by default</i> a <i>lazy language</i> one can smoothly turn it into a <i>strict language</i> to obtain optimal time/space behavior: <i>functions</i> can be defined <i>lazy</i> as well as <i>(partially) strict</i> in their arguments; any (recursive) <i>data structure</i> can be defined <i>lazy </i>as well as <i>(partially) strict</i> in any of its arguments.</p>
<p style="text-align:justify;">The rich type system of CLEAN 1.3 (offering high-order types, polymorph types, type classes, uniqueness types, existentially quantified types, algebraic types, abstract types, synonym types, record types, arrays, lists) is extended with <i>multi parameter type constructor classes</i> and <i>universally quantified types</i> currently limited to rank 2, rank n is in preparation). Furthermore, arrays and lists are better integrated in the language. Strict, spine-strict, unboxed and overloaded lists are predefined in the language.</p>
<p style="text-align:justify;">CLEAN now offers a hybrid type system with both static and dynamic typing. An object (expression) of static type can be changed into an object of dynamic type (a "<span style="font-family:courier;">Dynamic</span>") and backwards. One can read a <span style="font-family:courier;">Dynamic</span> written by another CLEAN program with one function call. A <span style="font-family:courier;">Dynamic</span> can contain data as well as (unevaluated) functions. This means that one can very easy transfer data as well as code (!) from one CLEAN application to another in a <i>type safe</i> manner enabling <i>mobile code</i> and <i>persistent storage</i> of an expression. This technique involves just-in-time code generation, dynamic linking and dynamic type unification.</p>
<p style="text-align:justify;">CLEAN offers support for generic programming using an extension of the class overloading mechanism. One can define functions like equality, <span style="font-family:courier;">map</span>, <span style="font-family:courier;">foldr</span> and the like in a generic way such that these functions are available for any (user defined) data structure. The generic functions are very flexible since they not only work on types of kind star but also on higher order kinds.</p>
<p style="text-align:justify;">CLEAN (Brus <i>et al.</i>, 1987; Nöcker <i>et al.</i>, 1991; Plasmeijer and Van Eekelen, 1993) is not only well known for its many features but also for its fast compiler producing very efficient code (Smetsers <i>et al.</i>, 1991). The new CLEAN 2.0 compiler is written in CLEAN . The CLEAN compiler is one of the fastest in the world and it produces very good code. For example, the compiler can compile itself from scratch within a minute.</p>
<p style="text-align:justify;">The CLEAN 2.0 system includes lots of tools and libraries, all written in CLEAN of course. Included is an IDE (Integrated Development Environment), a dedicated text editor, a project manager, a code generator generating native code (the only piece of software written in C), a static linker, a dynamic linker, a proof system (Sparkle), a test system (GAST), a heap profiler, a time profiler, and lots of libraries.</p>
<p style="text-align:justify;">People already familiar with other functional programming languages (such as Haskell; (Hudak et al., 1992), Gofer/Hugs (Jones, 1993), Miranda (Turner, 1985) and SML (Harper et al., 1986)) will have no difficulty to program in CLEAN. We hope that you will enjoy CLEAN's rich collection of features, CLEAN's compilation speed and the quality of the produced code (we generate native code for all platforms we support). CLEAN runs on a PC (Windows 2000, '98, '95, WindowsNT). There are also versions running on the Mac and Linux.</p>
<p style="text-align:justify;">Research on CLEAN started in 1984 (the Dutch Parallel Machine Project) in which we had to good idea to focuss on compilation techniques for classical computer architectures. Many new concepts came out of the research of the CLEAN team (see below). These ideas are not only incorporated in our own system, many of them have also been adopted by other languages like Haskell and Mercury.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMore Information on Clean</h3>
<p style="text-align:justify;">A tutorial teaching how to program in CLEAN can be found on our web pages.</p>
<p style="text-align:justify;">See <span style="color:#0000FF;">http://wiki.clean.cs.ru.nl/Functional_Programming_in_Clean</span>.</p>
<p style="text-align:justify;">Information about the libraries (including the I/O library) that are available for CLEAN can also be found on the web, surf to </p>
<p style="text-align:justify;"><span style="color:#0000FF;">http://wiki.clean.cs.ru.nl/Libraries</span>.</p>
<p style="text-align:justify;">There is a manual teaching the use of the Object I/O library. It includes many examples showing you how to write interactive window based programs.</p>
<p style="text-align:justify;">See <span style="color:#0000FF;">http://clean.cs.ru.nl/download/supported/ObjectIO.1.2/doc/tutorial.pdf</span>.</p>
<p style="text-align:justify;">The basic concepts behind CLEAN (albeit of one of the very first versions, namely CLEAN 0.8) as well as an explanation of the basic implementation techniques used can be found in Plasmeijer and Van Eekelen (Adisson-Wesley, 1993). The book is out of print, but copies can found on </p>
<p style="text-align:justify;"><span style="color:#0000FF;">http://wiki.clean.cs.ru.nl/Functional_Programming_and_Parallel_Graph_Rewriting</span></p>
<p style="text-align:justify;">There are many papers on the concepts introduced by the CLEAN group (such as <i>term graph rewriting</i> (Barendregt <i>et al</i>., 1987), <i>lazy copying</i> (van Eekelen <i>et al</i>., 1991), <i>abstract reduction</i> (Nöcker, 1993), <i>uniqueness typing</i> (Barendsen and Smetsers, 1993, 1996), CLEAN's <i>I/O concept</i> (Achten, 1996 &amp; 1997), <i>Lazy Copying</i> for Concurrent CLEAN (Kesseler, 1991 &amp; 1996), Type dependent Functions for Dynamics (Pil, 1999), I/O of Dynamics (Vervoort, 2001), a Typed Operating System (van Weelden, 2001). For the most recent information on papers (<span style="color:#0000FF;">http://wiki.clean.cs.ru.nl/Publications</span>) and general information about CLEAN (<span style="color:#0000FF;">http://clean.cs.ru.nl</span>) please check our web pages.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAbout this Language Report</h3>
<p style="text-align:justify;">In this report the syntax and semantics of CLEAN version 2.0 are explained. We always give a motivation <i>why</i> we have included a certain feature. Although the report is not intended as introduction into the language, we did our best to make it as readable as possible. Nevertheless, one sometimes has to work through several sections spread all over the report. We have included links where possible to support browsing through the manual.</p>
<p style="text-align:justify;">At several places in this report context free syntax fragments of CLEAN are given. We sometimes repeat fragments that are also given elsewhere just to make the description clearer (e.g. in the uniqueness typing chapter we repeat parts of the syntax for the classical types). We hope that this is not confusing. The complete collection of context free grammar rules is summarized in Appendix A.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSome Remarks on the Clean Syntax</h3>
<p style="text-align:justify;">The syntax of CLEAN is similar to the one used in most other modern functional languages. However, there are a couple of small syntactic differences we want to point out here for people who don?t like to read language reports.</p>
<p style="text-align:justify;">In CLEAN the arity of a function is reflected in its type. When a function is defined its uncurried type is specified! To avoid any confusion we want to explicitly state here that in CLEAN there is no restriction whatsoever on the curried use of functions. However, we don't feel a need to express this in every type. Actually, the way we express types of functions more clearly reflects the way curried functions are internally treated.</p>
<p><div style="background-color:#FFFF45";>E.g., the standard map function (arity 2) is specified in CLEAN as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::(a&nbsp;-&gt;&nbsp;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;&nbsp;=&nbsp;[f&nbsp;x:map&nbsp;f&nbsp;xs]<br></div>
</p><p style="text-align:justify;">Each predefined structure such as a list, a tuple, a record or array has its own kind of brackets: lazy lists are alwaysdenotated with square brackets <span style="font-family:courier;">[...]</span>, strict lists are denotated by <span style="font-family:courier;">[! ...]</span>, spine strict lists by <span style="font-family:courier;">[... !]</span>, overloaded lists by <span style="font-family:courier;"> [|...]]</span><span style="font-family:courier;"> , unboxed lists by </span><span style="font-family:courier;">[#&Tau;]</span>. For tuples the usual parentheses are used <span style="font-family:courier;">(...,...)</span>, curly braces are used for records (indexed by field name) as well as for arrays (indexed by number).</p>
<p style="text-align:justify;">In types funny symbols can appear like <span style="font-family:courier;">.</span>, <span style="font-family:courier;">u:</span>, <span style="font-family:courier;">*,</span> <span style="font-family:courier;">!</span> which can be ignored and left out if one is not interested in uniqueness typing or strictness.</p>
<p style="text-align:justify;">There are only a few keywords in CLEAN leading to a heavily overloaded use of <span style="font-family:courier;">:</span> and <span style="font-family:courier;">=</span> symbols:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">function::argstype&nbsp;-&gt;&nbsp;restype&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;specification&nbsp;of&nbsp;a&nbsp;function</span><br></p>
</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">function&nbsp;pattern<br>
|&nbsp;guard&nbsp;=&nbsp;rhs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;function</span><br></p>
</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">selector&nbsp;=&nbsp;graph&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;constant/CAF/graph</span><br></p>
</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">function&nbsp;args&nbsp;:==&nbsp;rhs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;macro</span><br></p>
</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::Type&nbsp;args&nbsp;=&nbsp;typedef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;an&nbsp;algebraic&nbsp;data&nbsp;type&nbsp;definition</span><br>
::Type&nbsp;args&nbsp;:==&nbsp;typedef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;type&nbsp;synonym&nbsp;definition</span><br>
::Type&nbsp;args&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;an&nbsp;abstract&nbsp;type&nbsp;definition</span><br></p>
</p>
<p style="text-align:justify;">As is common in modern functional languages, there is a layout rule in CLEAN (<span style="color:blue;"><a href="#_2.3">see 2.3</a></span>). For reasons of portability it is assumed that a tab space is set to 4 white spaces and that a non-proportional font is used.</p>
<p><div style="background-color:#FFFF45";>Function definition in CLEAN making use of the layout rule.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
primes::&nbsp;[Int]<br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;sieve::&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
&nbsp;&nbsp;sieve&nbsp;[pr:r]&nbsp;&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<br>
<br>
&nbsp;&nbsp;filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]<br>
&nbsp;&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<br>
&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNotational Conventions Used in this Report</h3>
<p style="text-align:justify;">The following <i>notational conventions</i> are used in this report. Text is printed in Microsoft Sans Serif 9pts,</p>
<table style="background-color:#FFCC99;"><tr><td style="width:100%;">the context free syntax descriptions are given in  Microsoft Sans Serif 9pts,</td></tr>
</table><p></p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">examples&nbsp;of&nbsp;CLEAN&nbsp;programs&nbsp;are&nbsp;given&nbsp;in&nbsp;Courier&nbsp;New&nbsp;9pts,<br></p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Semantic restrictions are always given in a bulleted list-of-points. When these restrictions are not obeyed they will almost always result in a compile-time error. In very few cases the restrictions can only be detected at run-time (array index out-of-range, partial function called outside the domain).</td></tr>
</table>
<p style="text-align:justify;">The following notational conventions are used in the context-free syntax descriptions:</p>
<p></p><table style="width:100%;"><tr><td style="width:9.81818181818182%;">[notion]</td><td style="width:64.0018181818182%;">means that the presence of notion is optional</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}</td><td style="width:64.0018181818182%;">means that notion can occur zero or more times</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}+</td><td style="width:64.0018181818182%;">means that notion occurs at least once</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}-<i>list</i></td><td style="width:64.0018181818182%;">means one or more occurrences of notion separated by commas</td></tr>
<tr><td style="width:9.81818181818182%;"><span style="font-family:courier;color:#993300;"><b>terminals</b></span></td><td style="width:64.0018181818182%;">are printed in <span style="font-family:courier;color:#993300;"><b>9 pts courier bold brown</b></span></td></tr>
<tr><td style="width:9.81818181818182%;"><span style="font-family:courier;color:#FF0000;"><b>keywords</b></span></td><td style="width:64.0018181818182%;">are printed in <span style="font-family:courier;color:#FF0000;"><b>9 pts courier bold red</b></span></td></tr>
<tr><td style="width:9.81818181818182%;"><span style="font-family:courier;color:#0000FF;"><b>terminals</b></span></td><td style="width:64.0018181818182%;">that can be left out in layout mode are printed in <span style="font-family:courier;color:#0000FF;"><b>9 pts courier bold blue</b></span></td></tr>
<tr><td style="width:9.81818181818182%;">~</td><td style="width:64.0018181818182%;">is used for concatenation of notions</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}/ str</td><td style="width:64.0018181818182%;">means the longest expression not containing the string str</td></tr>
</table><p></p>
<p style="text-align:justify;">All CLEAN examples given in this report assume that the layout dependent mode has been chosen which means that redundant semi-colons and curly braces are left out (<span style="color:blue;"><a href="#_2.3.3">see 2.3.3</a></span>).</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHow to Obtain Clean</h3>
<p style="text-align:justify;">CLEAN and the INTEGRATED DEVELOPMENT ENVIRONMENT (IDE) can be used free of charge. They can be obtained</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">via World Wide Web (<span style="color:#0000FF;">http://clean.cs.ru.nl</span>) or </td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">via ftp (<span style="color:#0000FF;">ftp://ftp.cs.ru.nl</span> in directory <i>pub/Clean)</i></td></tr></table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCurrent State of the Clean System</h3>
<p style="text-align:justify;"><span style="font-family:courier;color:#993300;"><b>Release 2.1 (November 2002).</b></span></p>
<p style="text-align:justify;">Compared with the previous version the following changes have been made.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Experimental features of the previous version, such as dynamics (<span style="color:blue;"><a href="#_8">see Chapter 8</a></span>), generics (<span style="color:blue;"><a href="#_7">see Chapter 7</a></span>) and strict-lists (<span style="color:blue;"><a href="#_4.2">see 4.2</a></span>) have been improved and further incorporated in the language.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Many bugs, most of which appeared in the new features, have been removed.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The quality of the generated code has been improved.</td></tr>
</table>
<p style="text-align:justify;"><span style="font-family:courier;color:#993300;"><b>Release 2.0 (November 2001).</b></span></p>
<p style="text-align:justify;">There are <i>many</i> changes compared to the previous release (CLEAN 1.3.x). We have added many new features in CLEAN 2.0 we hope you will like.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN 2.0 has multi-parameter type constructor classes. <span style="color:blue;"><a href="#_6.4">See Section 6.4</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN 2.0 has universally quantified data types and functions (rank 2). See Section <span style="color:blue;"><a href="#_3.7.4">3.7.4</a></span> and <span style="color:blue;"><a href="#_5.1.4">5.1.4</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The explicit import mechanism has been refined. One can now more precisely address what to import and what not. <span style="color:blue;"><a href="#_2.5.1">See 2.5.1</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Cyclic depedencies between definition modules are allowed. This makes it easier to define implementation modules that share definitions. <span style="color:blue;"><a href="#_2.5.1">See 2.5.1</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Definitions in a definition module need not to be repeated in the corresponding implementation module anymore. <span style="color:blue;"><a href="#_2.4">See 2.4</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Due to multi-parameter type constructor classes a better incorporation of the type Array could be made. <span style="color:blue;"><a href="#_4.4">See 4.4</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN 2.0 offers an hybrid type system: one can have statically and dynamically typed objects (<b>Dynamics</b>). A statically typed expression can be changed into a dynamically typed one and backwards. The type of a <span style="font-family:courier;">Dynamic</span>can be inspected via a pattern match, one can ensure that <span style="font-family:courier;">Dynamics</span> fit together by using run-time type unification, one can store a <span style="font-family:courier;">Dynamic</span> into a file with one function call or read a <span style="font-family:courier;">Dynamic</span> stored by another CLEAN application. <span style="font-family:courier;">Dynamics</span> can be used to store and retrieve information without the need for writing parsers, it can be used to exchange data and code (!) between applications in a type safe manner. <span style="font-family:courier;">Dynamics</span>make it easy to create mobile code, create plug-ins or create a persistent store. The CLEAN run-time system has been extended to support dynamic type checking, dynamic type unification, lazy dynamic linking and just-in-time code generation (<span style="color:blue;"><a href="#_8">See Chapter 8</a></span>).</td></tr>
</table>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">There is special syntax and support for strict and unboxed lists. One can easily change from lazy to strict and backwards. Overloaded functions can be defined which work for any list (lazy, strict or unboxed). <span style="color:blue;"><a href="#_4.2">See 4.2</a></span>. One can write functions like <span style="font-family:courier;">==</span>, <span style="font-family:courier;">map</span>, <span style="font-family:courier;">foldr</span> in a generic way. The <span style="font-family:courier;">generic functions</span> one can define can work on higher order kinds. With kind indexed functions one can indicated which kind is actually meant (<span style="color:blue;"><a href="#_7">see Chapter 7</a></span>). A generic definition can be specialized for a certain concrete type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The CLEAN system has been changed and extended: a new version of the CLEAN IDE, a new version of the run-time-system, and a dynamic linker is included. <span style="color:blue;"><a href="#_8.3">See 8.3</a></span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN 2.0 comes with an integrated proof system  (Sparkle), all written in CLEAN of course. See <span style="color:#0000FF;">http://www.cs.kun.nl/Sparkle</span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN 2.0 is open source. All source code will be made available on the net.</td></tr>
</table>
<p style="text-align:justify;">We have also removed things:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">We do not longer support annotations for concurrent evaluations ({P} and {I} annotations. However, we are working on a library that will support distributed evaluation of CLEAN expressions using Dynamics (see Van Weelden and Plasmeijer, 2002).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">There is no strict let-before expression (<span style="font-family:courier;">let!</span>) anymore in CLEAN 2.x. You still can enforce strict evaluation using the strict hash let (<span style="font-family:courier;">#!</span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">One cannot specify default instances anymore that could be used to disambiguate possible ambiguous internal overloading. Disambiguating can be done by explicitely specifying the required type.</td></tr>
</table>
<p style="text-align:justify;">There is also some bad news:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Due to all these changes CLEAN 2.0 is <i>not</i> upwards compatible with CLEAN 1.3.x. Many things are the same but there are small differences as well. So, one has to put some effort in porting a CLEAN 1.3.x application to CLEAN 2.0. The most important syntactical differences are described below. Note that we do no longer support CLEAN 1.3.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The CLEAN 1.3 compiler is written in C. The CLEAN 2.0 compiler has been rewritten from scratch in CLEAN. The internal structure of the new compiler is a better than the old one, but the new compiler has become a bit slower than the previous C version as well. Large programs will take about 1.7 times as much time to compile (which is still pretty impressive for a lazy functional language).</td></tr>
</table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSyntactic differences between Clean 1.3 and Clean 2.0</h3>
<p style="text-align:justify;">CLEAN 2.x is not downward compatible with CLEAN 1.3.x. Probably you have to change your 1.3.x sources to get them through the CLEAN 2.x compiler.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDifferences in Expression Syntax</h3>
<p style="text-align:justify;">There is no <i>strict let</i> expression (<span style="font-family:courier;">let!</span>) anymore in CLEAN 2.x. You still can enforce strict evaluation using the strict hash let (<span style="font-family:courier;">#!</span>).</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDifferences in the Type System</h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">For <i>multiparameter type</i> classes a small change in the syntax for instance definitions was necessary. In CLEAN 1.3.x it was assumed that every instance definition only has one type argument. So in the following 1.3.x instance definition</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;c&nbsp;T1&nbsp;T2<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">the type <span style="font-family:courier;">(T1 T2)</span> was meant (the type <span style="font-family:courier;">T1</span> with the argument <span style="font-family:courier;">T2</span>). This should be written in CLEAN 2.x as</td></tr></table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;c&nbsp;(T1&nbsp;T2)<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">otherwise <span style="font-family:courier;">T1</span> and <span style="font-family:courier;">T2</span> will be interpreted as two types.</td></tr></table>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The <i>type</i> <span style="font-family:courier;">Array</span> has changed. In CLEAN 2.x the <span style="font-family:courier;">Array</span> class has become a multiparameter class, whose first argument type is the array and whose second argument type is the array element (see ??). Therefore a 1.3 definition like</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MkArray::&nbsp;!Int&nbsp;(Int&nbsp;-&gt;&nbsp;e)&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;&amp;&nbsp;ArrayElem&nbsp;e<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MkArray&nbsp;i&nbsp;f&nbsp;=&nbsp;{f&nbsp;j&nbsp;\&nbsp;j&nbsp;&lt;-&nbsp;[0..i-1]}<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">becomes in CLEAN 2.x:</td></tr></table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MkArray::&nbsp;!Int&nbsp;(Int&nbsp;-&gt;&nbsp;e)&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MkArray&nbsp;i&nbsp;f&nbsp;=&nbsp;{f&nbsp;j&nbsp;\&nbsp;j&nbsp;&lt;-&nbsp;[0..i-1]}<br></p>
</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">There is a difference in <i>resolving overloading</i>. Consider the following code:</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class&nbsp;c&nbsp;a&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;a<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance&nbsp;c&nbsp;[Int]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;[1]&nbsp;=&nbsp;[2]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;[x:xs]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c&nbsp;xs<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">Although this is accepted by CLEAN 1.3.x, CLEAN 2.x will complain: "Overloading error [...,..,f]: c no instance available of type [a]." The CLEAN 2.x compiler applies no type unification after resolving overloading. So <span style="font-family:courier;">c</span> is in function <span style="font-family:courier;">f</span> applied to a list with a polymorph element type (<span style="font-family:courier;">[a]</span>). And this is considered to be different from the instance type <span style="font-family:courier;">[Int]</span>. If you give f the type <span style="font-family:courier;">[Int] -&gt; [Int]</span> the upper code will be accepted.</td></tr></table>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN 2.x handles <i>uniqueness attributes in type synonyms</i> different than CLEAN 1.3.x. Consider the following definitions:</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;ListList&nbsp;a&nbsp;:==&nbsp;[[a]]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;::&nbsp;*(ListList&nbsp;*{Int})&nbsp;-&gt;&nbsp;*{Int}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;[[a]]&nbsp;=&nbsp;{&nbsp;a&nbsp;&amp;&nbsp;[0]=0&nbsp;}<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">In CLEAN 1.3.x the <span style="font-family:courier;">ListList</span> type synonym was expanded to</td></tr></table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;::&nbsp;*[*[*{Int}]]&nbsp;-&gt;&nbsp;*{Int}<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">which is correct in CLEAN 1.3.x. However, CLEAN 2.x expands it to</td></tr></table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;::&nbsp;*[[*{Int}]]&nbsp;-&gt;&nbsp;*{Int}<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">This yields a uniqueness error in CLEAN 2.x because the inner list is shared but contains a unique object. This problem happens only with type synonyms that have attributes "inbetween". An "inbetween" attribute is neither the "root" attribute nor the attribute of an actual argument. E.g. with the upper type synonym, the formal argument "<span style="font-family:courier;">a</span>" is substituted with <span style="font-family:courier;">*{Int}</span>. Note that also the "<span style="font-family:courier;">*</span>" is substituted for "<span style="font-family:courier;">a</span>". Because we wrote <span style="font-family:courier;">*(ListList ...)</span> the root attribute is "<span style="font-family:courier;">*</span>". The result of expanding <span style="font-family:courier;">*(ListList *{Int})</span> is <span style="font-family:courier;">*[u:[*{Int]]</span>. "<span style="font-family:courier;">u</span>" is an attribute "inbetween" because it is neither the root attribute nor the attribute of a formal argument. Such attributes are made _non_unique_ in CLEAN 2.x and this is why the upper code is not accepted. The code will be accepted if you redefine <span style="font-family:courier;">ListList</span> to</td></tr></table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;ListList&nbsp;a&nbsp;:==&nbsp;[*[a]]<br></p>
</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Anonymous uniqueness attributes in type contexts</i> are not allowed in CLEAN 2.x. So in the following function type simply remove the point.</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;::&nbsp;a&nbsp;|&nbsp;myClass&nbsp;.a<br></p>
</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The <span style="font-family:courier;">String</span> type has become a <i>predefined type</i>. As a consequence you cannot import this type explicitly anymore. So:</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;StdString&nbsp;import&nbsp;::&nbsp;String<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">is not valid.</td></tr></table>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">There was a bug in the uniqueness typing system of CLEAN 1.3: Records or data constructors could have existentially quantified variables, whose uniqueness attribute did _not_ propagate. This bug has been solved in CLEAN 2.x. As a consequence, the 2.x compiler might complain about your program where the 1.3.x compiler was happy. The problem might occur when you use the object I/O library and you use objects with a uniquely attributed local state. Now the object becomes unique as well and may not be shared anymore.</td></tr>
</table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDifferences in the Module System</h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The syntax and semantics of <i>explicit import statements</i> has been completely revised. With CLEAN 2.x it is possible to discriminate the different namespaces in import statements. In CLEAN 1.3.x the following statement</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>from</b></span>&nbsp;m&nbsp;<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;F<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">could have caused the import of a <i>function</i> <span style="font-family:courier;">F</span> together with a <i>type</i> <span style="font-family:courier;">F</span> and a <i>class</i> <span style="font-family:courier;">F</span> with all its instances from m. In CLEAN 2.x one can precisely describe from which name space one wants to import (<span style="color:blue;"><a href="#_2.5.2">see 2.5.2</a></span>). For example, the following import statement</td></tr></table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>from</b></span>&nbsp;m&nbsp;<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;&nbsp;F,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;T1,&nbsp;::&nbsp;T2(..),&nbsp;::&nbsp;T3(C1,&nbsp;C2),&nbsp;::&nbsp;T4{..},&nbsp;::&nbsp;T5{field1,&nbsp;field2},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C1,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C2(..),&nbsp;<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C3(mem1,&nbsp;mem2)<br></p>
</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="text-align:justify;">causes the following declarations to be imported: the <i>function</i> or <i>macro</i> <span style="font-family:courier;">F</span>, the <i>type</i> <span style="font-family:courier;">T1</span>, the <i>algebraic type</i> <span style="font-family:courier;">T2</span> with <i>all</i> it's constructors that are exported by <span style="font-family:courier;">m</span>, the <i>algebraic type</i> <span style="font-family:courier;">T3</span> with it's constructors <span style="font-family:courier;">C1</span> and <span style="font-family:courier;">C2</span>, the <i>record type</i> <span style="font-family:courier;">T4</span> with <i>all</i> it's fields that are exported by <span style="font-family:courier;">m</span>, the <i>record type</i> <span style="font-family:courier;">T5</span> with it's fields <span style="font-family:courier;">field1</span> and <span style="font-family:courier;">field2</span>, the <i>class</i> <span style="font-family:courier;">C1</span>, the<i>class</i> <span style="font-family:courier;">C2</span> with all it's members that are exported by <span style="font-family:courier;">m</span>, the <i>class</i> <span style="font-family:courier;">C3</span> with it's members <span style="font-family:courier;">mem1</span> and <span style="font-family:courier;">mem2</span>.</td></tr></table>
<p style="text-align:justify;"><span style="font-family:courier;color:#993300;"><b>Previous Releases.</b></span>The first release of CLEAN was publicly available in 1987 and had version number 0.5 (we thought half of the work was done, ;-)). At that time, CLEAN was only thought as an intermediate language. Many releases followed. One of them was version 0.8 which is used in the Plasmeijer &amp; Van Eekelen Bible (Adisson-Wesley, 1993). Version 1.0 was the first mature version of CLEAN.</p>
<!-- chapter:Chapter 1-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_1"><br>Chapter 1<br><br>Basic Semantics</a></h1></div>
<p style="text-align:justify;">The semantics of CLEAN is based on <i>Term Graph Rewriting Systems</i> (Barendregt, 1987; Plasmeijer and Van Eekelen, 1993). This means that functions in a CLEAN program semantically work on <i>graphs</i> instead of the usual <i>terms</i>. This enabled us to incorporate CLEAN's typical features (definition of cyclic data structures, lazy copying, uniqueness typing) which would otherwise be very difficult to give a proper semantics for. However, in many cases the programmer does not need to be aware of the fact that he/she is manipulating graphs. Evaluation of a CLEAN program takes place in the same way as in other lazy functional languages. One of the "differences" between CLEAN and other functional languages is that when a variable occurs more than once in a function body, the semantics <i>prescribe</i> that the actual argument is shared (the semantics of most other languages do not prescribe this although it is common practice in any implementation of a functional language). Furthermore, one can label any expression to make the definition of cyclic structures possible. So, people familiar with other functional languages will have no problems writing CLEAN programs.</p>
<p style="text-align:justify;">When larger applications are being written, or, when CLEAN is interfaced with the non-functional world, or, when efficiency counts, or, when one simply wants to have a good understanding of the language it is good to have some knowledge of the basic semantics of CLEAN which is based on term graph rewriting. In this chapter a short introduction into the basic semantics of CLEAN is given. An extensive treatment of the underlying semantics and the implementation techniques of CLEAN can be found in Plasmeijer and Van Eekelen (1993).</p>
<h2 style="background-color:#9999FF;"><a id="_1.1">1.1 Graph Rewriting</a></h2>
<p style="text-align:justify;">A CLEAN <i>program</i> basically consists of a number of <i>graph rewrite rules</i> (<i>function definitions</i>) which specify how a given <i>graph</i> (the <i>initial expression</i>) has to be <i>rewritten</i>.</p>
<p style="text-align:justify;">A <i>graph</i> is a set of nodes. Each node has a defining <i>node-identifier</i> (the <i>node-id</i>). A <i>node</i> consists of a <i>symbol</i> and a (possibly empty) sequence of <i>applied node-id's</i> (the <i>arguments</i> of the symbol) <i>Applied node-id's</i> can be seen as <i>references</i> (<i>arcs</i>) to nodes in the graph, as such they have a <i>direction</i>: from the node in which the node-id is applied to the node of which the node-id is the defining identifier.</p>
<p style="text-align:justify;">Each <i>graph rewrite rule</i> consists of a <i>left-hand side graph</i> (the <i>pattern</i>) and a <i>right-hand side</i> (rhs) consisting of a graph<i> </i>(the <i>contractum</i>) or just a <i>single</i> node-id (a <i>redirection</i>). In CLEAN rewrite rules are not comparing: the left-hand side (lhs) graph of a rule is a tree, i.e. each node identifier is applied only once, so there exists exactly one path from the root to a node of this graph.</p>
<p style="text-align:justify;">A rewrite rule defines a (<i>partial</i>) <i>function</i>. The <i>function symbol</i> is the root symbol of the left-hand side graph of the rule alternatives. All other symbols that appear in rewrite rules, are <i>constructor symbols</i>.</p>
<p style="text-align:justify;">The <i>program graph</i> is the graph that is rewritten according to the rules. Initially, this program graph is fixed: it consists of a single node containing the symbol Start, so there is no need to specify this graph in the program explicitly. The part of the graph that matches the pattern of a certain rewrite rule is called a <i>redex</i> (<i>reducible expression</i>). A <i>rewrite of a redex</i> to its <i>reduct</i> can take place according to the right-hand side of the corresponding rewrite rule. If the right-hand side is a contractum then the rewrite consists of building this contractum and doing a redirection of the root of the redex to root of the right-hand side. Otherwise, only a redirection of the root of the redex to the single node-id specified on the right-hand side is performed. A <i>redirection</i> of a node-id n1 to a node-id n2 means that all applied occurrences of n1 are replaced by occurrences of n2 (which is in reality commonly implemented by <i>overwriting</i> n1 with n2).</p>
<p style="text-align:justify;">A <i>reduction strategy</i> is a function that makes choices out of the available redexes. A <i>reducer</i> is a process that reduces redexes that are indicated by the strategy. The result of a reducer  is reached as soon as the reduction strategy does not indicate redexes any more. A graph is in <i>normal form</i> if none of the patterns in the rules match any part of the graph. A graph is said to be in root normal form when the root of a graph is not the root of a redex and can never become the root of a redex. In general it is undecidable whether a graph is in root normal form.</p>
<p style="text-align:justify;">A pattern <i>partially matches</i> a graph if firstly the symbol of the root of the pattern equals the symbol of the root of the graph and secondly in positions where symbols in the pattern are not syntactically equal to symbols in the graph, the corresponding sub-graph is a redex or the sub-graph itself is partially matching a rule. A graph is in <i>strong root normal form</i> if the graph does not partially match any rule. It is decidable whether or not a graph is in strong root normal form. A graph in strong root normal form does not partially match any rule, so it is also in root normal form.</p>
<p style="text-align:justify;">The default reduction strategy used in CLEAN is the <i>functional reduction strategy</i>. Reducing graphs according to this strategy resembles very much the way execution proceeds in other lazy functional languages: in the standard lambda calculus semantics the functional strategy corresponds to normal order reduction. On graph rewrite rules the functional strategy proceeds as follows: if there are several rewrite rules for a particular function, the rules are tried in textual order; patterns are tested from left to right; evaluation to strong root normal form of arguments is forced when an actual argument is matched against a corresponding non-variable part of the pattern. A formal definition of this strategy can be found in (Toyama <i>et al.</i>, 1991).</p>
<h3 style="background-color:#9999FF;"><a id="_1.1.1">1.1.1 A Small Example</a></h3>
<p style="text-align:justify;">Consider the following CLEAN program:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Add&nbsp;Zero&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)<br>
Add&nbsp;(Succ&nbsp;a)&nbsp;z&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Succ&nbsp;(Add&nbsp;a&nbsp;z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)<br>
<br>
Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp;(Succ&nbsp;o)&nbsp;o<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;Zero&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)<br></p>
</p>
<p style="text-align:justify;">In CLEAN a distinction is between function definitions (graph rewriting rules) and graphs (constant definitions). A semantic equivalent definition of the program above is given below where this distinction is made explicit ("=&gt;" indicates a rewrite rule whereas "=:" is used for a constant (<i>sub-</i>) <i>graph</i> definition</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Add&nbsp;Zero&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)<br>
Add&nbsp;(Succ&nbsp;a)&nbsp;z&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Succ&nbsp;(Add&nbsp;a&nbsp;z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)<br>
<br>
Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp;(Succ&nbsp;o)&nbsp;o<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=:&nbsp;Zero&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)<br></p>
</p>
<p style="text-align:justify;">These rules are internally translated to a semantically equivalent set of rules in which the graph structure on both left-hand side as right-hand side of the rewrite rules has been made explicit by adding node-id's. Using the set of rules with explicit node-id's it will be easier to understand what the meaning is of the rules in the graph rewriting world.</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">x&nbsp;=:&nbsp;Add&nbsp;y&nbsp;z<br>
y&nbsp;=:&nbsp;Zero&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)<br>
x&nbsp;=:&nbsp;Add&nbsp;y&nbsp;z<br>
y&nbsp;=:&nbsp;Succ&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;m&nbsp;=:&nbsp;Succ&nbsp;n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=:&nbsp;Add&nbsp;a&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)<br>
<br>
x&nbsp;=:&nbsp;Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;m&nbsp;=:&nbsp;Add&nbsp;n&nbsp;o<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=:&nbsp;Succ&nbsp;o<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=:&nbsp;Zero&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)<br></p>
<p style="text-align:justify;">The fixed initial program graph that is in memory when a program starts is the following:</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:50%;">The initial graph in linear notation:</td><td style="text-align:justify;width:50%;">The initial graph in pictorial notation:</td></tr></table>
<table style="width:100%;"><tr><td style="width:50%;"><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">@DataRoot&nbsp;&nbsp;&nbsp;&nbsp;=:&nbsp;Graph&nbsp;@StartNode<br>
@StartNode&nbsp;&nbsp;&nbsp;=:&nbsp;Start<br></p>
</td><td style="width:50%;"><svg width="444.444444444444" height="54">
<text font-family="courier" font-weight="bold" font-size="16px" x="76.8" y="18" fill="#000000">@DataRoot=:Graph</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="67.2" y="54" fill="#000000">@StartNode=:Start</text>
<path d="M206.4 22.5L206.4 40.5" fill="none" stroke="#000000"/>
<path d="M206.4 40.5L208.832143241427 34.8618442752845L206.4 37.5L203.967856758573 34.8618442752845 Z" fill="none" stroke="#000000"/>
</svg>
</td></tr></table><p style="text-align:justify;">To distinguish the node-id's appearing in the rewrite rules from the node-id's appearing in the graph the latter always begin with a "<span style="font-family:courier;">@</span>".</p>
<p style="text-align:justify;">The initial graph is rewritten until it is in normal form. Therefore a CLEAN program must at least contain a "<i>start rule</i>" that matches this initial graph via a pattern. The right-hand side of the start rule specifies the actual computation. In this start rule in the left-hand side the symbol <span style="font-family:courier;">Start</span> is used. However, the symbols <span style="font-family:courier;">Graph</span> and <span style="font-family:courier;">Initial</span> (<span style="color:blue;"><a href="#_1.2">see 1.2</a></span>) are internal, so they cannot actually be addressed in any rule.</p>
<p style="text-align:justify;">The patterns in rewrite rules contain <i>formal node-id's</i>. During the matching these formal nodeid's are mapped to the <i>actual node-id's</i>of the graph  After that the following semantic actions are performed:</p>
<p style="text-align:justify;">The start node is the only redex matching rule (3). The contractum can now be constructed:</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:50%;">The contractum in linear notation:</td><td style="text-align:justify;width:50%;">The contractum in pictorial notation:</td></tr></table>
<table style="width:100%;"><tr><td style="width:50%;"><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">@A&nbsp;=:&nbsp;Add&nbsp;&nbsp;@B&nbsp;@C<br>
@B&nbsp;=:&nbsp;Succ&nbsp;@C<br>
@C&nbsp;=:&nbsp;Zero<br></p>
</td><td style="width:50%;"><svg width="444.444444444444" height="90">
<text font-family="courier" font-weight="bold" font-size="16px" x="153.6" y="18" fill="#000000">@A=:Add</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="105.6" y="54" fill="#000000">@B=:Succ @C=:Zero</text>
<path d="M201.6 22.5L172.8 40.5" fill="none" stroke="#000000"/>
<path d="M172.8 40.5L179.617255659676 38.79301085656L175.657092243004 38.7143173481228L176.721898330945 35.4950178993023 Z" fill="none" stroke="#000000"/>
<path d="M211.2 22.5L240 40.5" fill="none" stroke="#000000"/>
<path d="M240 40.5L236.078101669055 35.4950178993023L237.142907756996 38.7143173481228L233.182744340324 38.79301085656 Z" fill="none" stroke="#000000"/>
<path d="M172.8 58.5L172.8 70.5C172.8 75.4705627482,178.6910373312 79.5,183.466666666667 79.5L229.333333333333 79.5C235.224370664533 79.5,240 74.5294372518,240 70.5L240 70.5" fill="none" stroke="#000000"/>
<path d="M240 70.5L240 58.5" fill="none" stroke="#000000"/>
<path d="M240 58.5L237.567856758573 64.1381557247154L240 61.5L242.432143241427 64.1381557247154 Z" fill="none" stroke="#000000"/>
</svg>
</td></tr></table><p style="text-align:justify;">All applied occurrences of <span style="font-family:courier;">@StartNode</span> will be replaced by occurrences of <span style="font-family:courier;">@A</span>. The graph after rewriting is then:</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:50%;">The graph after rewriting:</td><td style="text-align:justify;width:50%;">Pictorial notation:</td></tr></table>
<table style="width:100%;"><tr><td style="width:50%;"><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">@DataRoot&nbsp;&nbsp;&nbsp;&nbsp;=:&nbsp;Graph&nbsp;@A<br>
@StartNode&nbsp;&nbsp;&nbsp;=:&nbsp;Start<br>
@A&nbsp;=:&nbsp;Add&nbsp;&nbsp;@B&nbsp;@C<br>
@B&nbsp;=:&nbsp;Succ&nbsp;@C<br>
@C&nbsp;=:&nbsp;Zero<br></p>
</td><td style="width:50%;"><svg width="444.444444444444" height="162">
<text font-family="courier" font-weight="bold" font-size="16px" x="76.8" y="18" fill="#000000">@DataRoot=:Graph</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="67.2" y="54" fill="#000000">@StartNode=:Start</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="153.6" y="90" fill="#000000">@A=:Add</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="105.6" y="126" fill="#000000">@B=:Succ @C=:Zero</text>
<path d="M206.4 22.5C206.4 27.4705627482,212.2910373312 31.5,217.066666666667 31.5L252.622222222222 31.5C258.513259553422 31.5,263.288888888889 36.4705627482,263.288888888889 40.5L263.288888888889 54C263.288888888889 58.9705627482,257.397851557689 63,252.622222222222 63L217.066666666667 63C211.175629335467 63,206.4 67.9705627482,206.4 72" fill="none" stroke="#000000"/>
<path d="M206.4 72L206.4 79.5" fill="none" stroke="#000000"/>
<path d="M206.4 79.5L208.832143241427 73.8618442752846L206.4 76.5L203.967856758573 73.8618442752846 Z" fill="none" stroke="#000000"/>
<path d="M201.6 94.5L172.8 112.5" fill="none" stroke="#000000"/>
<path d="M172.8 112.5L179.617255659676 110.79301085656L175.657092243004 110.714317348123L176.721898330945 107.495017899302 Z" fill="none" stroke="#000000"/>
<path d="M211.2 94.5L240 112.5" fill="none" stroke="#000000"/>
<path d="M240 112.5L236.078101669055 107.495017899302L237.142907756996 110.714317348123L233.182744340324 110.79301085656 Z" fill="none" stroke="#000000"/>
<path d="M172.8 130.5L172.8 142.5C172.8 147.4705627482,178.6910373312 151.5,183.466666666667 151.5L229.333333333333 151.5C235.224370664533 151.5,240 146.5294372518,240 142.5L240 142.5" fill="none" stroke="#000000"/>
<path d="M240 142.5L240 130.5" fill="none" stroke="#000000"/>
<path d="M240 130.5L237.567856758573 136.138155724715L240 133.5L242.432143241427 136.138155724715 Z" fill="none" stroke="#000000"/>
</svg>
</td></tr></table><p style="text-align:justify;">This completes one rewrite. All nodes that are not accessible from <span style="font-family:courier;">@DataRoot</span> are garbage and not considered any more in the next rewrite steps. In an implementation once in a while garbage collection is performed in order to reclaim the memory space occupied by these garbage nodes. In this example the start node is not accessible from the data root node after the rewrite step and can be left out.</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:50%;">The graph after garbage collection:</td><td style="text-align:justify;width:50%;">Pictorial notation:</td></tr></table>
<table style="width:100%;"><tr><td style="width:50%;"><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">@DataRoot&nbsp;&nbsp;&nbsp;=:&nbsp;Graph&nbsp;@A<br>
@A&nbsp;=:&nbsp;Add&nbsp;&nbsp;@B&nbsp;@C<br>
@B&nbsp;=:&nbsp;Succ&nbsp;@C<br>
@C&nbsp;=:&nbsp;Zero<br></p>
</td><td style="width:50%;"><svg width="444.444444444444" height="126">
<text font-family="courier" font-weight="bold" font-size="16px" x="76.8" y="18" fill="#000000">@DataRoot=:Graph</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="153.6" y="54" fill="#000000">@A=:Add</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="105.6" y="90" fill="#000000">@B=:Succ @C=:Zero</text>
<path d="M206.4 22.5L206.4 40.5" fill="none" stroke="#000000"/>
<path d="M206.4 40.5L208.832143241427 34.8618442752845L206.4 37.5L203.967856758573 34.8618442752845 Z" fill="none" stroke="#000000"/>
<path d="M201.6 58.5L172.8 76.5" fill="none" stroke="#000000"/>
<path d="M172.8 76.5L179.617255659676 74.79301085656L175.657092243004 74.7143173481228L176.721898330945 71.4950178993023 Z" fill="none" stroke="#000000"/>
<path d="M211.2 58.5L240 76.5" fill="none" stroke="#000000"/>
<path d="M240 76.5L236.078101669055 71.4950178993023L237.142907756996 74.7143173481228L233.182744340324 74.79301085656 Z" fill="none" stroke="#000000"/>
<path d="M172.8 94.5L172.8 106.5C172.8 111.4705627482,178.6910373312 115.5,183.466666666667 115.5L229.333333333333 115.5C235.224370664533 115.5,240 110.5294372518,240 106.5L240 106.5" fill="none" stroke="#000000"/>
<path d="M240 106.5L240 94.5" fill="none" stroke="#000000"/>
<path d="M240 94.5L237.567856758573 100.138155724715L240 97.5L242.432143241427 100.138155724715 Z" fill="none" stroke="#000000"/>
</svg>
</td></tr></table><p style="text-align:justify;">The graph accessible from <span style="font-family:courier;">@DataRoot</span> still contains a redex. It matches rule 2 yielding the expected normal form:</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:50%;">The final graph:</td><td style="text-align:justify;width:50%;">Pictorial notation:</td></tr></table>
<table style="width:100%;"><tr><td style="width:50%;"><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">@DataRoot&nbsp;=:&nbsp;Graph&nbsp;@D<br>
@D&nbsp;=:&nbsp;Succ&nbsp;@C<br>
@C&nbsp;=:&nbsp;Zero<br></p>
</td><td style="width:50%;"><svg width="444.444444444444" height="90">
<text font-family="courier" font-weight="bold" font-size="16px" x="76.8" y="18" fill="#000000">@DataRoot=:Graph</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="144" y="54" fill="#000000">@D=:Succ</text>
<text font-family="courier" font-weight="bold" font-size="16px" x="144" y="90" fill="#000000">@C=:Zero</text>
<path d="M206.4 22.5L206.4 40.5" fill="none" stroke="#000000"/>
<path d="M206.4 40.5L208.832143241427 34.8618442752845L206.4 37.5L203.967856758573 34.8618442752845 Z" fill="none" stroke="#000000"/>
<path d="M206.4 58.5L206.4 76.5" fill="none" stroke="#000000"/>
<path d="M206.4 76.5L208.832143241427 70.8618442752846L206.4 73.5L203.967856758573 70.8618442752846 Z" fill="none" stroke="#000000"/>
</svg>
</td></tr></table><p style="text-align:justify;">The fact that graphs are being used in CLEAN gives the programmer the ability to explicitly share terms or to create cyclic structures. In this way time and space efficiency can be obtained.</p>
<h2 style="background-color:#9999FF;"><a id="_1.2">1.2 Global Graphs</a></h2>
<p style="text-align:justify;">Due to the presence of global graphs in CLEAN the initial graph in a specific CLEAN program is slightly different from the basic semantics. In a specific CLEAN program the initial graph is defined as:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">@DataRoot&nbsp;&nbsp;&nbsp;&nbsp;=:&nbsp;Graph&nbsp;@StartNode&nbsp;@GlobId1&nbsp;@GlobId2&nbsp;...&nbsp;@GlobIdn<br>
@StartNode&nbsp;&nbsp;&nbsp;=:&nbsp;Start<br>
@GlobId1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=:&nbsp;Initial<br>
@GlobId2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=:&nbsp;Initial<br>
...<br>
@GlobIdn&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=:&nbsp;Initial<br></p>
</p>
<p style="text-align:justify;">The root of the initial graph will not only contain the node-id of the start node, the root of the graph to be rewritten, but it will also contain for each <i>global graph</i> (<span style="color:blue;"><a href="#_10.2">see 10.2</a></span>) a reference to an initial node (initialized with the symbol <span style="font-family:courier;">Initial</span>). All references to a specific global graph will be references to its initial node or, when it is rewritten, they will be references to its reduct.</p>
<!-- chapter:Chapter 2-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_2"><br>Chapter 2<br><br>Modules and Scopes</a></h1></div>
<p style="text-align:justify;">A CLEAN program is composed out of modules. Each module is stored in a file that contains CLEAN source code. There are implementation modules and definition modules, in the spirit of Modula-2 (<b>Wirth</b>, 1982). This module system is used for several reasons.</p>
<table style="width:100%;"><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">-</td><td style="text-align:justify;">First of all, the module structure is used to <i>control the scope of definitions</i>. The basic idea is that definitions only have a meaning in the implementation module they are defined in unless  they are exported by the corresponding definition module.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">-</td><td style="text-align:justify;">Having the exported definitions collected in a separate definition module has as advantage that one in addition obtains a <i>self-contained interface document</i> one can reach out to others. The definition module is a document that defines which functions and data types can be used by others without revealing uninteresting implementation details.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">-</td><td style="text-align:justify;">Furthermore, the module structure enables <i>separate compilation</i> that heavily reduces compilation time. If the definition module stays the same, a change in an implementation module only will cause the recompilation of that implementation module. When the definition module is changed as well, only those implementation modules that are affected by this change need to be recompiled.</td></tr></table>
</td></table>
<p style="text-align:justify;">In this Chapter we explain the module structure of CLEAN and the influence it has on the scope of definitions. New scopes can also be introduced inside modules. This is further explained in the <span style="color:blue;"><a href="#_2">Chapters 2</a></span> and <span style="color:blue;"><a href="#_3">3</a></span>.</p>
<p style="text-align:justify;">In the pictures in the subsections below nested boxes indicate nested scopes.</p>
<h2 style="background-color:#9999FF;"><a id="_2.1">2.1 Identifiers, Scopes and Name Spaces</a></h2>
<h3 style="background-color:#9999FF;"><a id="_2.1.1">2.1.1 Naming Conventions of Identifiers</a></h3>
<p style="text-align:justify;">In CLEAN we distinguish the following kind of <i>identifiers</i>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ModuleName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">ModuleDirectoryName <span style="font-family:courier;color:#993300;"><b>.</b></span> ModuleName</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ModuleDirectoryName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:64.7254545454546%px'" colspan="3">UpperCaseId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">FunctionName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ConstructorName</span></td><td style="width:12.2454545454545%px'" colspan="3">=</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">SelectorVariable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">Variable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">MacroName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">FieldName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">TypeName</span></td><td style="width:12.2454545454545%px'" colspan="3">=</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">TypeVariable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">UniqueTypeVariable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ClassName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">MemberName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LowerCaseId</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">LowerCaseChar~{IdChar}</td></tr>
<tr><td style="width:23.0290909090909%;">UpperCaseId</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">UpperCaseChar~{IdChar}</td></tr>
<tr><td style="width:23.0290909090909%;">SymbolId</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{SymbolChar}+</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LowerCaseChar</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>a</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>b</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>c</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>d</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>e</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>f</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>g</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>h</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>i</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>j</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>k</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>l</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>m</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>n</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>o</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>p</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>q</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>r</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>s</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>t</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>u</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>v</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>w</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>x</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>y</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>z</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">UpperCaseChar</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>A</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>B</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>C</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>D</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>E</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>F</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>G</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>H</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>I</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>J</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>K</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>L</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>M</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>N</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>O</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>P</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>Q</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>R</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>S</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>T</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>U</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>V</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>W</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>X</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>Y</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>Z</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">SymbolChar</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>~</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>@</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>$</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>%</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>^</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>?</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:64.9636363636364%px'" colspan="5"><span style="font-family:courier;color:#993300;"><b>!</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>+</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>-</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>*</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>&lt;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>&gt;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>\</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>/</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>&amp;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>=</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="19"><span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">IdChar</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="19">LowerCaseChar</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="19">UpperCaseChar</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="19">Digit</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>_</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:74.3454545454545%px'" colspan="17"><span style="font-family:courier;color:#993300;"><b>`</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Digit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>7</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>8</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>9</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">The convention used is that variables always start with a lowercase character while constructors and types always start with an uppercase character. The other identifiers can either start with an uppercase or a lowercase character. Notice that for the identifiers names can be used consisting of a combination of lower and/or uppercase characters but one can also define identifiers constructed from special characters like <span style="font-family:courier;">+</span>, <span style="font-family:courier;">&lt;</span>, etc. (<span style="color:blue;"><a href="#_A">see Appendix A</a></span>). These two kinds of identifiers cannot be mixed. This makes it possible to leave out white space in expressions like <span style="font-family:courier;">a+1</span> (same as <span style="font-family:courier;">a + 1</span>).</p>
<h3 style="background-color:#9999FF;"><a id="_2.1.2">2.1.2 Scopes and Name Spaces</a></h3>
<p style="text-align:justify;">The <i>scope</i> is the program region in which definitions (e.g. function definition, class definition, macro definition, type definition) with the identifiers introduced (e.g. function name, class name, class variable, macro name, type constructor name, type variable name) have a meaning.</p>
<p style="text-align:justify;">It must be clear from the context to which definition an identifier is referring. If all identifiers in a scope have different names than it will always be clear which definition is meant. However, one generally wants to have a free choice in naming identifiers. If identifiers belong to different <i>name spaces</i> no conflict can arise even if the same name is used. In CLEAN the following name spaces exist:</p>
<table style="border-spacing:-;width:100%;"><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">ModuleNames form a name space;</td></tr>
<td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">FunctionNames, ConstructorNames, SelectorVariables, Variables and MacroNames form a name space;</td></tr>
<td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">FieldNames form a name space;</td></tr>
<td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">TypeNames, TypeVariables and UniqueTypeVariables form a name space;</td></tr>
<td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">ClassNames form a name space.</td></tr>
</table>
<p style="text-align:justify;">So, it is allowed to use the same identifier name for different purposes as long as the identifier belongs to different name spaces.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Identifiers belonging to the same name space must all have different names within the same scope. Under certain conditions it is allowed to use the same name for different functions and operators (overloading, <span style="color:blue;"><a href="#_6">see Chapter 6</a></span>).</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_2.1.3">2.1.3 Nesting of Scopes</a></h3>
<p style="text-align:justify;">Reusing identifier names is possible by introducing a new scope level. Scopes can be nested: within a scope a new <i>nested scope</i> can be defined. Within such a nested scope new definitions can be given, new names can be introduced. As usual it is allowed in a nested scope to redefine definitions or re-use names given in a surrounding scope: When a name is re-used the old name and definition is no longer in scope and cannot be used in the new scope. A definition given or a name introduced in a (nested) scope has no meaning in surrounding scopes. It has a meaning for all scopes nested within it (unless they are redefined within such a nested scope). </p>
<h2 style="background-color:#9999FF;"><a id="_2.2">2.2 Modular Structure of Clean Programs</a></h2>
<p style="text-align:justify;">A CLEAN program consists of a collection of <i>definition modules</i> and <i>implementation modules</i>. An implementation module and a definition module <i>correspond</i> to each other if the names of the two modules are the same. The basic idea is that the definitions given in an implementation module only have a meaning in the module in which they are defined unless these definitions are exported by putting them into the corresponding definition module. In that case the definitions also have a meaning in those other modules in which the definitions are imported (<span style="color:blue;"><a href="#_2.5">see 2.5</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CleanProgram</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{Module}+</td></tr>
<tr><td style="width:23.0290909090909%;">Module</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">DefinitionModule</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ImplementationModule</td></tr>
<tr><td style="width:23.0290909090909%;">DefinitionModule</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>definition module</b></span> <span style="font-family:courier;">ModuleName</span> ;</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{DefDefinition}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>system module</b></span> <span style="font-family:courier;">ModuleName</span> ;</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{DefDefinition}</td></tr>
<tr><td style="width:23.0290909090909%;">ImplementationModule</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>] <span style="font-family:courier;color:#FF0000;"><b>module</b></span> <span style="font-family:courier;">ModuleName</span> ;</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{ImplDefinition}</td></tr>
</table><p></p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An executable CLEAN program consists at least of one implementation module, the <i>main</i> or <i>start module</i>, which is the top-most module (<i>root module</i>) of a CLEAN program.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Each CLEAN module has to be put in a separate file.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The name of a module (i.e. the module name) should be the same as the name of the file (minus the suffix) in which the module is stored.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A <i>definition</i> module should have .<i>dcl</i> as suffix; an <i>implementation</i> module should have <i>.icl </i>as suffix.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A definition module can have at most one corresponding implementation module.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Every implementation module (except the main module, <span style="color:blue;"><a href="#_2.3.1">see 2.3.1</a></span>) must have a corresponding definition module.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_2.3">2.3 Implementation Modules</a></h2>
<h3 style="background-color:#9999FF;"><a id="_2.3.1">2.3.1 The Main or Start Module</a></h3>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In the main module a <span style="font-family:courier;">Start</span> rule has to be defined (<span style="color:blue;"><a href="#_1">see Chapter 1</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Only in the main module one can leave out the keyword implementation in the module header. In that case the <span style="font-family:courier;">implementation module</span> does not need to have a corresponding definition module (which makes sense for a topmost module).</td></tr>
</table>
<p><div style="background-color:#FFFF45";>A very tiny but complete CLEAN program consisting of one implementation module.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;hello<br>
<br>
Start&nbsp;=&nbsp;"Hello&nbsp;World!"<br></div>
</p><p style="text-align:justify;"><i>Evaluation of a</i> CLEAN <i>program</i> consists of the evaluation of the application defined in the right-hand side of the <span style="font-family:courier;">Start </span><i>rule</i> to normal form (<span style="color:blue;"><a href="#_1">see Chapter 1</a></span>). The right-hand side of the <span style="font-family:courier;">Start</span> rule is regarded to be the <i>initial expression</i> to be computed.</p>
<p style="text-align:justify;">It is allowed to have a <span style="font-family:courier;">Start</span> rule in other implementation modules as well. This can be handy for testing functions defined in such a module: to evaluate such a <span style="font-family:courier;">Start</span> rule simply generate an application with the module as root and execute it. In the CLEAN IDE one can specify which module has to be regarded as being the root module.</p>
<p style="text-align:justify;">The definition of the left-hand side of the Start rule consists of the <i>symbol </i><span style="font-family:courier;">Start</span> with one optional argument (of type <span style="font-family:courier;">*World</span>), which is the environment parameter, which is necessary to write interactive applications.</p>
<p style="text-align:justify;">A CLEAN program can run in two modes.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspI/O Using the Console</h3>
<p style="text-align:justify;">The first mode is a <i>console mode</i>. It is chosen when the Start rule is defined as a <i>nullary</i> function.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Start::&nbsp;TypeOfStartFunction<br>
Start&nbsp;=&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;initial&nbsp;expression</span><br></p>
</p>
<p style="text-align:justify;">In the console mode, that part of the <i>initial expression</i> (indicated by the right-hand side of the Start rule), which is in <i>root normal form</i> (also called the head normal form or root stable form), is printed as soon as possible. The console mode can be used for instance to test or debug functions.</p>
<p style="text-align:justify;">In the CLEAN IDE one can choose to print the result of a <span style="font-family:courier;">Start</span> expression <i>with</i> or <i>without</i> the data constructors.</p>
<p><div style="background-color:#FFFF45";>For example, the initial expression</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Start::&nbsp;String<br>
Start&nbsp;=&nbsp;"Hello&nbsp;World!"<br>
<br></div>
<div style="background-color:#FFFF45";>in mode "show data constructors" will print: <span style="font-family:courier;">"Hello World!"</span>, in mode "don't show data constructors" it will print: <span style="font-family:courier;">Hello World!</span></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspI/O on the Unique World</h3>
<p style="text-align:justify;">The second mode is the <i>world mode</i>. It is chosen when the optional additional parameter (which is of type <span style="font-family:courier;">*World</span>) is added to the <span style="font-family:courier;">Start</span> rule and delivered as result.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Start::&nbsp;*World&nbsp;-&gt;&nbsp;*World<br>
Start&nbsp;=&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;initial&nbsp;expression&nbsp;returning&nbsp;a&nbsp;changed&nbsp;world</span><br></p>
</p>
<p style="text-align:justify;">The world which is given to the initial expression is an <i>abstract data structure</i>, an <i>abstract world</i> of type *World which models <i>the concrete physical world</i> as seen from the program. The abstract world can in principle contain <i>anything</i> what a functional program needs to interact during execution with the concrete world. The world can be seen as a <i>state</i> and modifications of the world can be realized via <i>state transition functions</i> defined on the world or a part of the world. By requiring that these state transition functions work on a <i>unique</i> world the modifications of the abstract world can directly be realized in the real physical world, without loss of efficiency and without losing referential transparency (<span style="color:blue;"><a href="#_9">see Chapter 9</a></span>)</p>
<p style="text-align:justify;">The concrete way in which the world can be handled in CLEAN is determined by the system programmer. One way to handle the world is by using the predefined CLEAN I/O library, which can be regarded as a platform independent mini operating system. It makes it possible to do file I/O, window based I/O, dynamic process creation and process communication in a pure functional language in an efficient way. The definition of the I/O library is treated in a separate document (<span style="color:#0000FF;">Object IO tutorial</span>, Achten <i>et al.</i>, 1997).</p>
<h3 style="background-color:#9999FF;"><a id="_2.3.2">2.3.2 Scope of Global Definitions in Implementation Modules</a></h3>
<p style="text-align:justify;">In an implementation module the following global definitions can be specified in <i>any</i> order.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ImplDefinition</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">ImportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_2.5">see 2.5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">FunctionDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3">see Chapter 3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">GraphDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.6">see 3.6</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">MacroDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_10.3">see 10.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5">see Chapter 5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ClassDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_6">see Chapter 6</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">GenericsDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_7">see Chapter 7</a></span></td></tr>
</table><p></p>
<p style="text-align:justify;"><i>Definitions</i> on the <i>global</i> level (= outermost level in the module,) have in principle the whole implementation module as scope (see Figure 2.1).</p>
<div style="background-color:#FFFF45";><b>Figure 2.1</b> (Scope of global definitions inside an implementation module).</div>
<div style="position: absolute;height:16.875em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 270" width="100%" height="100%">
<path d="M0 16.5 h441.6 v222 h-441.6 Z" fill="none" stroke="#000000"/>
<path d="M111.644444444444 55.5 h322.844444444444 v15 h-322.844444444444 Z" fill="none" stroke="#000000"/>
<path d="M140.444444444444 91.5 h294.044444444444 v15 h-294.044444444444 Z" fill="none" stroke="#000000"/>
<path d="M121.244444444444 109.5 h313.244444444444 v15 h-313.244444444444 Z" fill="none" stroke="#000000"/>
<path d="M102.044444444444 145.5 h332.444444444444 v15 h-332.444444444444 Z" fill="none" stroke="#000000"/>
<path d="M54.0444444444444 181.5 h380.444444444444 v15 h-380.444444444444 Z" fill="none" stroke="#000000"/>
<path d="M92.4444444444444 217.5 h342.044444444444 v15 h-342.044444444444 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
<span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;XXX<br>
<br>
::&nbsp;TypeName&nbsp;typevars&nbsp;=&nbsp;type_expression&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;new&nbsp;type</span><br>
<br>
functionName::&nbsp;type_of_args&nbsp;-&gt;&nbsp;type_of_result&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;function</span><br>
functionName&nbsp;args&nbsp;=&nbsp;expression&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;function</span><br>
<br>
selector&nbsp;=&nbsp;expression&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;constant&nbsp;graph</span><br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;className&nbsp;=&nbsp;expression&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;class</span><br>
<br>
macroName&nbsp;args&nbsp;:==&nbsp;&nbsp;expression&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;a&nbsp;macro</span><br>
<br></p>
<p style="text-align:justify;">Types can only be defined globally (<span style="color:blue;"><a href="#_5">see Chapter 5</a></span>) and therefore always have a meaning in the whole implementation module.  Type  variables  introduced  on  the  left-hand  side  of  a  (algebraic,  record,  synonym,  overload,  class,  instance, function, graph) type definition have the right-hand side of the type definition as scope.</p>
<p style="text-align:justify;">Functions, the type of these functions, constants (selectors) and macro's can be defined on the <i>global</i> level as well as on a <i>local</i> level in nested scopes. When defined globally they have a meaning in the whole implementation module. Arguments introduced on the left-hand side of a definition (formal arguments) only have a meaning in the corresponding right-hand side.</p>
<p style="text-align:justify;">Functions, the type of these functions, constants (selectors) and macro's can also be defined locally in a new scope. However, new scopes can only be introduced at certain points. In functional languages local definitions are by tradition defined by using <i>let</i>-expressions (definitions given <i>before</i> they are used in a certain expression, nice for a bottom-up style of programming) and <i>where</i>-blocks (definitions given <i>afterwards</i>, nice for a top-down style of programming). These constructs are explained in detail in Chapter 3.</p>
<h3 style="background-color:#9999FF;"><a id="_2.3.3">2.3.3 Begin and End of a Definition: the Layout Rule</a></h3>
<p style="text-align:justify;">CLEAN programs can be written in two modes: layout sensitive mode 'on' and 'off'. The layout sensitive mode is switched off when a semi-colon is specified after the module name. In that case each definition has to be ended with a semicolon '<span style="font-family:courier;color:#0000FF;">;</span>'. A new scope has to begin with '<span style="font-family:courier;color:#0000FF;">{</span>' and ends with a :<span style="font-family:courier;color:#0000FF;">}</span>'. This mode is handy if CLEAN code is generated automatically (e.g. by a compiler).</p>
<p><div style="background-color:#FFFF45";>Example of a CLEAN program <i>not</i> using the layout rule.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;primes<span style="color:#0000FF;">;</span><br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdEnv<span style="color:#0000FF;">;</span><br>
<br>
primes::&nbsp;[Int]<span style="color:#0000FF;">;</span><br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<span style="color:#0000FF;">;</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
<span style="color:#0000FF;">{</span>&nbsp;&nbsp;&nbsp;sieve::&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<span style="color:#0000FF;">;</span>&nbsp;sieve&nbsp;[pr:r]&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<span style="color:#0000FF;">;</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<span style="color:#0000FF;">;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<span style="color:#0000FF;">;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<span style="color:#0000FF;">;</span><br>
<span style="color:#0000FF;">}</span><br></div>
</p><p style="text-align:justify;">Programs look a little bit old fashion C-like in this way. Functional programmers generally prefer a more mathematical style. Hence, as is common in modern functional languages, there is a layout rule in CLEAN. When a semicolon does not end the header of a module, a CLEAN program has become layout sensitive. The <i>layout rule</i> assumes the omission of the semi-colon ('<span style="font-family:courier;color:#0000FF;">'</span>') that ends a definition and of the braces ('<span style="font-family:courier;color:#0000FF;">{</span>' and '<span style="font-family:courier;color:#0000FF;">}</span>') that are used to group a list of definitions. These symbols are automatically added according to the following rules:</p>
<p style="text-align:justify;">In <i>layout sensitive mode</i> the indentation of the first lexeme after the keywords <span style="font-family:courier;color:#FF0000;"><b>let</b></span>, <span style="font-family:courier;">#</span>, <span style="font-family:courier;">#!</span>, <span style="font-family:courier;color:#FF0000;"><b>of</b></span>, <span style="font-family:courier;color:#FF0000;"><b>where</b></span>, or <span style="font-family:courier;color:#FF0000;"><b>with</b></span> determines the indentation that the group of definitions following the keyword has to obey. Depending on the indentation of the first lexeme on a subsequent line the following happens. A new definition is assumed if the lexeme starts on the same indentation (and a semicolon is inserted). A previous definition is assumed to be continued if the lexeme is indented more. The group of definitions ends (and a close brace is inserted) if the lexeme is indented less. Global definitions are assumed to start in column 0.</p>
<p style="text-align:justify;">We strongly advise to write programs in layout sensitive mode. <i>For reasons of portability it is assumed that a tab space is set to 4 white spaces and that a non-proportional font is used.</i></p>
<p><div style="background-color:#FFFF45";>Same program using the layout sensitive mode.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;primes<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdEnv<br>
<br>
primes::&nbsp;[Int]<br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve::&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve&nbsp;[pr:r]&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
&nbsp;&nbsp;&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_2.4">2.4 Definition Modules</a></h2>
<p style="text-align:justify;">The definitions given in an implementation module only have a meaning in the module in which they are defined. If you want to <i>export</i> a definition, you have to specify the definition in the corresponding definition module. Some definitions can only appear in implementation modules, not in definition modules. The idea is to hide the actual implementation from the outside world. The is good for software engineering reasons while another advantage is that an implementation module can be recompiled separately without a need to recompile other modules. Recompilation of other modules is only necessary when a definition module is changed. All modules depending on the changed module will have to be recompiled as well. Implementations of functions, graphs and class sinstances are therefore only allowed in <i>implementation</i> modules. They are exported by only specifying their type definition in the definition module. Also the right-hand side of any type definition can remain hidden. In this way an abstract data type is created (<span style="color:blue;"><a href="#_5.4">see 5.4</a></span>).</p>
<p style="text-align:justify;">In a definition module the following global definitions can be given in <i>any</i> order.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DefDefinition</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">ImportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_2.5">see 2.5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">FunctionExportTypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.7">see 3.7</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">MacroDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_10.3">see 10.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5">see Chapter 5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ClassDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_6">see Chapter 6</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TypeClassInstanceExportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_6.10">see 6.10</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">GenericExportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_7">see Chapter 7</a></span></td></tr>
</table><p></p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The definitions given in an implementation module only have a meaning in the module in which they are defined (<span style="color:blue;"><a href="#_2.3">see 2.3</a></span>) unless these definitions are exported by putting them into the corresponding definition module. In  that case they also have a meaning in those other modules in which the definitions are imported (<span style="color:blue;"><a href="#_2.5">see 2.5</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In the corresponding implementation module all exported definitions have to get an appropriate implementation (this holds for functions, abstract data types, class instances).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An <i>abstract data type</i> is exported by specifying the left-hand side of a type rule in the definition module. In the corresponding implementation module the abstract type <i>has to be defined again</i> but then right-hand side has to be defined as well. For such an abstract data type only the name of the type is exported but not its definition.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A <i>function</i>,  global <i>graph</i> or <i>class instance</i> is exported by defining the type header in the definition module. For optimal efficiency it is recommended also to specify strictness annotations (<span style="color:blue;"><a href="#_10.1">see 10.1</a></span>). For library functions it is recommended also to specify the uniqueness type attributes (<span style="color:blue;"><a href="#_9">see Chapter 9</a></span>). The implementation of a function, a graph, a class instance has to be given in the corresponding implementation module.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Although it is not required anymore to repeat an exported definition in the corresponding implementation module, it is a good habit to do so to keep the implementation module readable. If a definition is repeated, the definition given in the definition module and in the implementation module should be the same (modulo variable names).</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Definition module.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>definition</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;ListOperations<br>
<br>
::complex&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;abstract&nbsp;type&nbsp;definition</span><br>
<br>
re::&nbsp;complex&nbsp;-&gt;&nbsp;Real&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;function&nbsp;taking&nbsp;the&nbsp;real&nbsp;part&nbsp;of&nbsp;complex&nbsp;number</span><br>
im::&nbsp;complex&nbsp;-&gt;&nbsp;Real&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;function&nbsp;taking&nbsp;the&nbsp;imaginary&nbsp;part&nbsp;of&nbsp;complex</span><br>
<br>
mkcomplex::&nbsp;Real&nbsp;Real&nbsp;-&gt;&nbsp;Complex&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;function&nbsp;creating&nbsp;a&nbsp;complex&nbsp;number</span><br></div>
</p><p><div style="background-color:#FFFF45";>corresponding implementation module:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;ListOperations<br>
<br>
::complex&nbsp;:==&nbsp;(!Real,!Real)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;type&nbsp;synonym</span><br>
<br>
re::&nbsp;complex&nbsp;-&gt;&nbsp;Real&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;function&nbsp;followed&nbsp;by&nbsp;its&nbsp;implementation</span><br>
re&nbsp;(frst,_)&nbsp;=&nbsp;frst<br>
<br>
im::&nbsp;complex&nbsp;-&gt;&nbsp;Real<br>
im&nbsp;(_,scnd)&nbsp;=&nbsp;scnd<br>
<br>
mkcomplex::&nbsp;Real&nbsp;Real&nbsp;-&gt;&nbsp;Complex<br>
mkcomplex&nbsp;frst&nbsp;scnd&nbsp;=&nbsp;(frst,scnd)<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_2.5">2.5 Importing Definitions</a></h2>
<p style="text-align:justify;">Via an <i>import statement</i> a definition <i>exported</i> by a definition module (<span style="color:blue;"><a href="#_2.4">see 2.4</a></span>) can be <i>imported</i> into any other (definition or implementation) module. There are two kinds of import statements, <i>explicit</i> imports and <i>implicit</i> imports.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ImportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">ImplicitImportDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ExplicitImportDef</td></tr>
</table><p></p>
<p style="text-align:justify;">A module <i>depends</i> on another module if it imports something from that other module. In CLEAN 2.x cyclic dependencies are allowed.</p>
<h3 style="background-color:#9999FF;"><a id="_2.5.1">2.5.1 Explicit Imports of Definitions</a></h3>
<p style="text-align:justify;"><i>Explicit imports</i> are import statements in which the modules to import from as well as the identifiers indicating the definitions to import are explicitly specified. All identifiers explicitly being imported in a definition or implementation module will be included in the global scope level (= outermost scope, <span style="color:blue;"><a href="#_2.3.2">see 2.3.2</a></span>) of the module that does the import.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ExplicitImportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>from</b></span><span style="font-family:courier;"> ModuleName </span><span style="font-family:courier;color:#FF0000;"><b>import</b></span> [<span style="font-family:courier;color:#993300;"><b>qualified</b></span>] {Imports}-list <span style="font-family:courier;color:#0000FF;">;</span></td></tr>
<tr><td style="width:23.0290909090909%;">Imports</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span><span style="font-family:courier;">TypeName</span> [ConstructorsOrFields]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span><span style="font-family:courier;"> ClassName</span> [Members]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span><span style="font-family:courier;"> ClassName</span> {SimpleType}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>generic</b></span> <span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorsOrFields</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(..)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>{<span style="font-family:courier;">ConstructorName</span>}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{..}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>{<span style="font-family:courier;">FieldName</span>}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Members</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(..)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>{<span style="font-family:courier;">MemberName</span>}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">One can import functions or macro's, types with optionally their corresponding constructors, record types with optionally their corresponding fieldnames, classes, instances of classes and generic functions. The syntax makes it possible to discriminate between the different namespaces that exist in CLEAN (<span style="color:blue;"><a href="#_2.1.2">see 2.1.2</a></span>)</p>
<p><div style="background-color:#FFFF45";>Example of an explicit import.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;XXX<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>from</b></span>&nbsp;m&nbsp;<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;&nbsp;&nbsp;&nbsp;F,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;T1,&nbsp;::&nbsp;T2(..),&nbsp;::&nbsp;T3(C1,&nbsp;C2),&nbsp;::&nbsp;T4{..},&nbsp;::&nbsp;T5{field1,&nbsp;field2},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C1,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C2(..),&nbsp;<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C3(mem1,&nbsp;mem2),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;C4&nbsp;Int,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;g<br>
<br></div>
<div style="background-color:#FFFF45";>With the import statement the following definition exported by module <span style="font-family:courier;">m</span> are imported in module <span style="font-family:courier;">XXX</span>: the <i>function</i> or <i>macro</i> <span style="font-family:courier;">F</span>, the <i>type</i> <span style="font-family:courier;">T1</span>, the <i>algebraic</i> type <span style="font-family:courier;">T2</span> with <i>all</i> it's constructors that are exported by m, the <i>algebraic type </i><span style="font-family:courier;">T3</span> with it's constructors <span style="font-family:courier;">C1</span> and <span style="font-family:courier;">C2</span>, the <i>record type</i> <span style="font-family:courier;">T4</span> with <i>all</i> it's fields that are exported by m, the <i>record type</i> <span style="font-family:courier;">T5</span> with it's fields <span style="font-family:courier;">field1</span> and <span style="font-family:courier;">field2</span>, the <i>class</i> <span style="font-family:courier;">C1</span>, the <i>class</i> <span style="font-family:courier;">C2</span> with all it's members that are exported by <span style="font-family:courier;">m</span>, the <i>class</i> <span style="font-family:courier;">C3</span> with it's members <span style="font-family:courier;">mem1</span> and <span style="font-family:courier;">mem2</span>, the instance of <i>class</i> <span style="font-family:courier;">C4</span> defined on integers, the generic function <span style="font-family:courier;">g</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><p style="text-align:justify;">Importing identifiers can cause error messages because the imported identifiers may be in conflict with other identifiers in this scope (remember that identifiers belonging to the same name space must all have different names within the same scope, <span style="color:blue;"><a href="#_2.1">see 2.1</a></span>). This problem can be solved by renaming the internally defined identifiers or by renaming the imported identifiers (eg by adding an additional module layer just to rename things).</p>
<h3 style="background-color:#9999FF;"><a id="_2.5.2">2.5.2 Implicit Imports of Definitions</a></h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ImplicitImportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>import</b></span> [<span style="font-family:courier;color:#993300;"><b>qualified</b></span>] {<span style="font-family:courier;">ModuleName</span>}-list <span style="font-family:courier;color:#0000FF;">;</span></td></tr>
</table><p></p>
<p style="text-align:justify;"><i>Implicit imports</i> are import statements in which only the module name to import from is mentioned. In this case <i>all</i> definitions that are <i>exported</i> from that module are imported as well as <i>all</i> definitions that on their turn are <i>imported</i> in the indicated definition module, and so on. So, all related definitions from various modules can be imported with one single import. This opens the possibility for definition modules to serve as a kind of <i>'pass-through'</i> module. Hence, it is meaningful to have definition modules with import statements but without any definitions and without a corresponding implementation module.</p>
<p><div style="background-color:#FFFF45";>Example of an implicit import: all (arithmetic) rules which are predefined can be imported easily with one import statement.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;MyStdEnv<br></div>
</p><p style="text-align:justify;">importing implicitly all definitions imported by the definition module '<span style="font-family:courier;">MyStdEnv</span>' which is defined below (note that definition module '<span style="font-family:courier;">MyStdEnv</span>' does not require a corresponding implementation module) :</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>definition</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;MyStdEnv<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;<span style="font-family:courier;">StdBool</span>,&nbsp;<span style="font-family:courier;">StdChar</span>,&nbsp;<span style="font-family:courier;">StdInt</span>,&nbsp;<span style="font-family:courier;">StdReal</span>,&nbsp;<span style="font-family:courier;">StdString</span><br></p>
</p>
<p style="text-align:justify;">All identifiers implicitly being imported in a definition or implementation module will be included in the global scope level (= outermost scope, <span style="color:blue;"><a href="#_2.3.2">see 2.3.2</a></span>) of the module that does the import.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Importing identifiers can cause error messages because the imported identifiers may be in conflict with other identifiers in this scope (remember that identifiers belonging to the same name space must all have different names within the same scope, <span style="color:blue;"><a href="#_2.1">see 2.1</a></span>). This problem can be solved by renaming the internally defined identifiers or by renaming the imported identifiers (eg by adding an additional module layer just to rename identifiers).</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_2.6">2.6 System Definition and Implementation Modules</a></h2>
<p style="text-align:justify;">System modules are special modules. A <i>system definition module</i> indicates that the corresponding implementation module is a <i>system implementation module</i> which does not contain ordinary CLEAN rules. In system implementation modules it is allowed to define <i>foreign functions</i>: the bodies of these foreign functions are written in another language than CLEAN. System implementation modules make it possible to create interfaces to operating systems, to file systems or to increase execution speed of heavily used functions or complex data structures. Typically, predefined function and operators for arithmetic and File I/O are implemented as system modules.</p>
<p style="text-align:justify;">System implementation modules may use machine code, C-code, abstract machine code (PABC-code) or code written in any other language. What exactly is allowed depends on the CLEAN compiler used and the platform for which code is generated. The keyword <span style="font-family:courier;color:#FF0000;"><b>code</b></span> is reserved to make it possible to write CLEAN programs in a foreign language. This is not treated in this reference manual.</p>
<p style="text-align:justify;">When one writes system implementation modules one has to be very careful because the correctness of the functions can no longer be checked by the CLEAN compiler. Therefore, the programmer is now responsible for the following:</p>
<table style="width:100%;"><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">!</td><td style="text-align:justify;">The function must be correctly typed.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">!</td><td style="text-align:justify;">When a function destructively updates one of its (sub-)arguments, the corresponding type of the arguments should have the uniqueness type attribute. Furthermore, those arguments must be strict.</td></tr></table>
</td></table>
<!-- chapter:Chapter 3-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_3"><br>Chapter 3<br><br>Defining Functions and Constants</a></h1></div>
<p style="text-align:justify;">In this Chapter we explain how functions (actually: <i>graph rewrite rules</i>) and constants (actually: graph expressions) are defined in CLEAN. The body of a function consists of an (root) expression (<span style="color:blue;"><a href="#_3.4">see 3.4</a></span>). With help of patterns (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) and guards  (<span style="color:blue;"><a href="#_3.3">see 3.3</a></span>) a distinction can be made between several alternative definitions for a function. Functions and constants can be defined locally in a function definition. For programming convenience (forcing evaluation, observation of unique objects and threading of sequencial operations) a special let construction is provided (<span style="color:blue;"><a href="#_3.5.1">see 3.5.1</a></span>). The typing of functions is discussed in <span style="color:blue;"><a href="#_3.7">Section 3.7</a></span>. For overloaded functions see <span style="color:blue;"><a href="#_6">Chapter 6</a></span>. For functions working on unique datatypes <span style="color:blue;"><a href="#_9">see Chapter 9</a></span>.</p>
<h2 style="background-color:#9999FF;"><a id="_3.1">3.1 Functions</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionDef</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">[FunctionTypeDef]</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4">see Chapter 4 for typing functions</a></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%px'" colspan="2">DefOfFunction</td></tr>
<tr><td style="width:23.0290909090909%;">DefOfFunction</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{FunctionAltDef <span style="color:#0000FF;">;</span>}+</td></tr>
<tr><td style="width:23.0290909090909%;">FunctionAltDef</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">Function {Pattern}</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.2">see 3.2 for patterns</a></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%px'" colspan="2">{GuardAlt}</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:27.0690909090909%;">{LetBeforeExpression}</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%px'" colspan="2">FunctionResult</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:27.0690909090909%;">[LocalFunctionAltDefs]</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.5">see 3.5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">FunctionResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard GuardRhs</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.3">see 3.3 for guards</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">GuardAlt</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr GuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">GuardRhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{GuardAlt} {LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">{GuardAlt} {LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> GuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">Function</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;">FunctionName</span></td><td style="width:48.84%;">// ordinary function</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:48.84%;">// operator function used prefix</td></tr>
<tr><td style="width:23.0290909090909%;">FunctionBody</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">RootExpression <span style="color:#0000FF;">;</span></td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.4">see 3.4</a></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:27.0690909090909%;">[LocalFunctionDefs]</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.5">see 3.5</a></span></td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>function definition</i> consists of one or more definition of a <i>function alternative</i> (rewrite rule). On the left-hand side of such a function alternative a <i>pattern</i> can be specified which can serve a whole sequence of <i>guarded function bodies</i> (called the <i>rule alternatives</i>) The root expression (<span style="color:blue;"><a href="#_3.4">see 3.4</a></span>) of a particular rule alternative is chosen for evaluation when</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the patterns specified in the formal arguments are matching the corresponding actual arguments of the function application (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) <i>and</i></td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the optional <i>guard</i> (<span style="color:blue;"><a href="#_3.3">see 3.3</a></span>) specified on the right-hand side evaluates to <span style="font-family:courier;">True</span>.</td></tr></table>
<p style="text-align:justify;"> The alternatives are tried in textual order. A function can be preceded by a definition of its type (<span style="color:blue;"><a href="#_3.7">Section 3.7</a></span>).</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Function definitions are only allowed in implementation modules (<span style="color:blue;"><a href="#_2.3">see 2.3</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is required that the function alternatives of a function are textually grouped together (separated by semi-colons when the layout sensitive mode is not chosen).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Each alternative of a function must start with the same function symbol.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A function has a fixed arity, so in each rule the same number of formal arguments must be specified. Functions can be used curried and applied to any number of arguments though, as usual in higher order functional languages.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The function name must in principle be different from other names in the same name space and same scope (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>). However, it is possible to overload functions and operators (<span style="color:blue;"><a href="#_6">see Chapter 6</a></span>).</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example of function definitions in a CLEAN module.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;example&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;module&nbsp;header</span><br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdInt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;implicit&nbsp;import</span><br>
<br>
map::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;map</span><br>
map&nbsp;f&nbsp;list&nbsp;=&nbsp;[f&nbsp;e&nbsp;\\&nbsp;e&nbsp;&lt;-&nbsp;list]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;the&nbsp;function&nbsp;map</span><br>
<br>
Start::&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;Start&nbsp;rule</span><br>
Start&nbsp;=&nbsp;map&nbsp;square&nbsp;[1..1000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;definition&nbsp;of&nbsp;the&nbsp;Start&nbsp;rule</span><br></div>
</p><p style="text-align:justify;">An <i>operator</i> is a <i>function with arity two</i> that can be used as infix operator (brackets are left out) or as ordinary prefix function (the operator name preceding its arguments has to be surrounded by brackets). The <i>precedence</i> (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>) and <i>fixity</i> (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>eft, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>ight, <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>) that can be defined in the type definition (<span style="color:blue;"><a href="#_3.7.1">see 3.7.1</a></span>) of the operators determine the priority of the operator application in an expression. A higher precedence binds more tightly. When operators have equal precedence, the fixity determines the priority.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an operator is used in infix position <i>both</i> arguments have to be present. Operators can be used in a curried way, but then they have to be used as ordinary prefix functions.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Operator definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(++)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>&nbsp;0::&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;[a]<br>
(++)&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ly&nbsp;&nbsp;=&nbsp;ly<br>
(++)&nbsp;[x:xs]&nbsp;&nbsp;ly&nbsp;&nbsp;=&nbsp;[x:xs&nbsp;++&nbsp;ly]<br>
<br>
(o)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>&nbsp;9::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(c&nbsp;-&gt;&nbsp;a)&nbsp;-&gt;&nbsp;(c&nbsp;-&gt;&nbsp;b)<br>
(o)&nbsp;f&nbsp;g&nbsp;=&nbsp;\x&nbsp;=&nbsp;f&nbsp;(g&nbsp;x)<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_3.2">3.2 Patterns</a></h2>
<p style="text-align:justify;">A <i>pattern</i> specified on the left-hand side of a function definition specifies the formal arguments of a function. A function alternative is chosen only if the actual arguments of the function application match the formal arguments. A formal argument is either a constant (some <i>data constructor</i> with its optional arguments that can consist of sub-patterns) or it is a variable.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Pattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">[Variable <span style="font-family:courier;color:#993300;"><b>=:</b></span>] BrackPattern</td></tr>
<tr><td style="width:23.0290909090909%;">BrackPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphPattern<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">PatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">SpecialPattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.7836363636364%;">DynamicPattern</td><td style="width:48.1254545454545%;">// <span style="color:blue;"><a href="#_8">see Chapter 8</a></span></td></tr>
<tr><td style="width:100%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;">GraphPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:27.7836363636364%;">Constructor {Pattern}</td><td style="width:48.1254545454545%;"><span style="font-family:courier;color:#0000FF;">// Ordinary data constructor</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.7836363636364%;">GraphPattern <span style="font-family:courier;">ConstructorName</span></td><td style="width:48.1254545454545%;"><span style="font-family:courier;color:#0000FF;">// Infix data constructor</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">GraphPattern </td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Pattern </td></tr>
<tr><td style="width:100%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;">PatternVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">Variable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">_ </td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>pattern variable</i> can be a (node) <i>variable</i> or a <i>wildcard</i>. A <i>variable</i> is a formal argument of a function that matches on <i>any</i> concrete value of the corresponding actual argument and therefore it does <i>not</i> force evaluation of this argument. A <i>wildcard</i> is an <i>anonymous</i> variable ("_") one can use to indicate that the corresponding argument is not used in the right-hand side of the function. A <i>variable</i> can be attached to a pattern (using the symbol '<span style="font-family:courier;">=:</span>') that makes it possible to identify (<i>label</i>) the whole pattern as well as its contents. When a constant (data constructor) is specified as formal argument, the actual argument must contain the same constant in order to have a successful match.</p>
<p><div style="background-color:#FFFF45";>Example of an algebraic data type definition and its use in a pattern match in a function definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Nil<br>
<br>
Mirror::&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;Tree&nbsp;a<br>
Mirror&nbsp;(Node&nbsp;e&nbsp;left&nbsp;right)&nbsp;=&nbsp;Node&nbsp;e&nbsp;(Mirror&nbsp;right)&nbsp;(Mirror&nbsp;left)<br>
Mirror&nbsp;Nil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Nil<br></div>
</p><p><div style="background-color:#FFFF45";>Use of anonymous variables.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Complex&nbsp;:==&nbsp;(!Real,!Real)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;synonym&nbsp;type&nbsp;def</span><br>
<br>
realpart::&nbsp;Complex&nbsp;-&gt;&nbsp;Real<br>
realpart&nbsp;(re,_)&nbsp;=&nbsp;re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;re&nbsp;and&nbsp;_&nbsp;are&nbsp;pattern&nbsp;variables</span><br></div>
</p><p><div style="background-color:#FFFF45";>Use of list patterns, use of guards, use of variables to identify patterns and sub-patterns; merge merges two (sorted) lazy lists into one (sorted) list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
merge::&nbsp;[Int]&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
merge&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;=&nbsp;f<br>
merge&nbsp;[]&nbsp;s&nbsp;&nbsp;&nbsp;=&nbsp;s<br>
merge&nbsp;f=:[x:xs]&nbsp;s=:[y:ys]<br>
|&nbsp;x&lt;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[x:merge&nbsp;xs&nbsp;s]<br>
|&nbsp;x==y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;merge&nbsp;f&nbsp;ys<br>
|&nbsp;otherwise&nbsp;&nbsp;=&nbsp;[y:merge&nbsp;f&nbsp;ys]<br></div>
</p><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is possible that the specified patterns turn a function into a partial function (<span style="color:blue;"><a href="#_3.7.3">see 3.7.3</a></span>). When a partial function is applied outside the domain for which the function is defined it will result into a <i>run-time</i> error. A compile time <i>warning</i> is generated that such a situation might arise.</td></tr>
</table>
<p style="text-align:justify;">The formal arguments of a function and the function body are contained in a new local scope.</p>
<div style="position: absolute;height:2.25em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 36" width="100%" height="100%">
<path d="M121.244444444444 1.5 h316.8 v16.5 h-316.8 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">functionName&nbsp;args&nbsp;=&nbsp;expression<br></p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All variable symbols introduced at the left-hand side of a function definition must have different names.</td></tr>
</table>
<p style="text-align:justify;">For convenience and efficiency special syntax is provided to express pattern match on data structures of predefined type and record type. They are treated elsewhere (see below).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SpecialPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">BasicValuePattern</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.1.2">see 4.1.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ListPattern</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.2.2">see 4.2.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TuplePattern</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.3.2">see 4.3.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ArrayPattern</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.4.2">see 4.4.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">RecordPattern</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.2.2">see 5.2.2</a></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_3.3">3.3 Guards</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Guard</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BooleanExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>guard</i> is a Boolean expression attached to a rule alternative that can be regarded as generalisation of the pattern matching mechanism: the alternative only matches when the patterns defined on the left hand-side match <i>and</i> its (optional) guard evaluates to <span style="font-family:courier;">True</span> (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>). Otherwise the <i>next</i> alternative of the function is tried. Pattern matching always takes place <i>before</i> the guards are evaluated.</p>
<p style="text-align:justify;">The guards are tried in <i>textual order</i>. The alternative corresponding to the first guard that yields <span style="font-family:courier;">True</span> will be evaluated. A right-hand side without a guard can be regarded to have a guard that always evaluates to <span style="font-family:courier;">True</span>(the 'otherwise' or 'default' case). In <span style="font-family:courier;">keyword</span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> is synonym for <span style="font-family:courier;">True</span> for people who like to emphasize the default option.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Only the last rule alternative of a function can have otherwise as guard or can have no guard.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is possible that the guards turn the function into a partial function (<span style="color:blue;"><a href="#_3.7.3">see 3.7.3</a></span>). When a partial function is applied outside the domain for which the function is defined it will result into a <i>run-time</i> error. At compile time this cannot be detected.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Function definition with guards.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
filter&nbsp;pr&nbsp;[n:str]<br>
|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;str<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;str]<br></div>
</p><p><div style="background-color:#FFFF45";>Equivalent definition of previous <span style="font-family:courier;">filter</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
filter::&nbsp;Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
filter&nbsp;pr&nbsp;[n:str]<br>
|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;str<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;str]<br></div>
</p><p style="text-align:justify;">Guards can be nested. When a guard on one level evaluates to <span style="font-family:courier;">True</span>, the guards on a next level are tried.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">To ensure that at least one of the alternatives of a nested guard will be successful, a nested guarded alternative must always have a 'default case' as last alternative.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example of a nested guard. </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
example&nbsp;arg1&nbsp;arg2<br>
|&nbsp;predicate11&nbsp;arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;if&nbsp;predicate11&nbsp;arg1</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;predicate21&nbsp;arg2&nbsp;=&nbsp;calculate1&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;&nbsp;then&nbsp;(if&nbsp;predicate21&nbsp;arg2</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;predicate22&nbsp;arg2&nbsp;=&nbsp;calculate2&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;&nbsp;elseif&nbsp;predicate22&nbsp;arg2&nbsp;then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;calculate3&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;&nbsp;else&nbsp;...)</span><br>
|&nbsp;predicate12&nbsp;arg1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;calculate4&nbsp;arg1&nbsp;arg2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;elseif&nbsp;predicate12&nbsp;arg1&nbsp;then&nbsp;...</span><br></div>
</p><h2 style="background-color:#9999FF;"><a id="_3.4">3.4 Expressions</a></h2>
<p style="text-align:justify;">The main body of a function is called the <i>root expression</i>. The root expression is a graph expression.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RootExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">Application</td></tr>
<tr><td style="width:23.0290909090909%;">Application</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{BrackGraph}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr Operator GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">GenericAppExpr</td></tr>
<tr><td style="width:23.0290909090909%;">BrackGraph</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">GraphVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Function</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">(GraphExpr)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">LambdaAbstr</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.4.1">see 3.4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">CaseExpr</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.4.2">see 3.4.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">LetExpr</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.5.1">see 3.5.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">SpecialExpression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">DynamicExpression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">MatchesPatternExpr</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.4.2">see 3.4.2</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Function</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Constructor</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">ConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">ConstructorName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Operator</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">ConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;">GraphVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Variable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">SelectorVariable</td></tr>
</table><p></p>
<p style="text-align:justify;">An expression generally expresses an application of a function to its actual arguments or the (automatic) creation of a data structure simply by applying a data constructor to its arguments. Each function or data constructor can be used in a <i>curried</i> way and can therefore be applied to any number (zero or more) of arguments. A function will only be rewritten if it is applied to a number of arguments equal to the arity of the function (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>). Function and constructors applied on zero arguments just form a syntactic unit (for non-operators no brackets are needed in this case).</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All expressions have to be of correct type (<span style="color:blue;"><a href="#_5">see Chapter 5</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All symbols that appear in an expression must have been defined somewhere within the scope in which the expression appears (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">There has to be a definition for each node variable and selector variable within in the scope of the graph expression.</td></tr>
</table>
<p style="text-align:justify;"><i>Operators</i> are special functions or data constructors defined with arity two which can be applied in infix position  The <i>precedence</i> (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>) and <i>fixity</i> (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>eft, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>ight, <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>) which can be defined in the type definition of the operators determine the priority of the operator application in an expression. A higher precedence binds more tightly. When operators have equal precedence, the fixity determines the priority. In an expression an ordinary function application has a very high priority (<span style="font-family:courier;">10</span>). Only selection of record elements (<span style="color:blue;"><a href="#_5.2.1">see 5.2.1</a></span>) and array elements (<span style="color:blue;"><a href="#_4.4.1">see 4.4.1</a></span>) binds more tightly (<span style="font-family:courier;">11</span>). Besides that, due to the priority, brackets can sometimes be omitted; operator applications behave just like other applications.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is not allowed to apply operators with equal precedence in an expression in such a way tha  their fixity conflict. So, when in <span style="font-family:courier;">a1 op1 a2 op2 a3</span> the operators <span style="font-family:courier;">op1</span> and <span style="font-family:courier;">op2</span> have the same precedence a conflict arises when <span style="font-family:courier;">op1</span> is defined as infixr implying that the expression must be read as <span style="font-family:courier;">a1</span> <span style="font-family:courier;">op1</span> <span style="font-family:courier;">(a2</span> <span style="font-family:courier;">op2</span> <span style="font-family:courier;">a3)</span> while <span style="font-family:courier;">op2</span> is defined as <span style="font-family:courier;">infixl</span> implying that the expression must be read as <span style="font-family:courier;">(a1</span> <span style="font-family:courier;">op1</span> <span style="font-family:courier;">a2)</span> <span style="font-family:courier;">op2</span> <span style="font-family:courier;">a3</span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an operator is used in infix position <i>both</i> arguments have to be present. Operators can be used in a <i>curried</i> way (applied to less than two arguments), but then they have to be used as ordinary <i>prefix</i> functions / constructors. When an operator is used as prefix function c.q. constructor, it has to be surrounded by brackets.</td></tr>
</table>
<p style="text-align:justify;">There are two kinds of variables that can appear in a graph expression: <i>variables</i> introduced as <i>formal argument</i> of a function (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span> and <span style="color:blue;"><a href="#_3.2">3.2</a></span>) and <i>selector variables</i> (defined in a <i>selector</i> to identify parts of a graph expression, <span style="color:blue;"><a href="#_3.6">see 3.6</a></span>).</p>
<p><div style="background-color:#FFFF45";>Example of a cyclic root expression. y is the root expression referring to a cyclic graph. The multiplication operator * is used prefix here in a curried way.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
ham::&nbsp;[Int]<br>
ham&nbsp;=&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;y&nbsp;=&nbsp;[1:merge&nbsp;(map&nbsp;((*)&nbsp;2)&nbsp;y)&nbsp;(merge&nbsp;(map&nbsp;((*)&nbsp;3)&nbsp;y)&nbsp;(map&nbsp;((*)&nbsp;5)&nbsp;y))]<br></div>
</p><p style="text-align:justify;">For convenience and efficiency special syntax is provided to create expressions of data structures of predefined type and of record type that is considered as a special kind of algebraic type. They are treated in elsewhere.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SpecialExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">BasicValue</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.1.1">see 4.1.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">List</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.2.1">see 4.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">Tuple</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.3.1">see 4.3.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">Array</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.4.1">see 4.4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ArraySelection</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.4.1">see 4.4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">Record</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.2.1">see 5.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">RecordSelection</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.2.1">see 5.2.1</a></span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_3.4.1">3.4.1 Lambda Abstraction</a></h3>
<p style="text-align:justify;">Sometimes it can be convenient to define a tiny function in an expression "right on the spot". For this purpose one can use a <i>lambda abstraction</i>. An anonymous function is defined which can have several formal arguments that can be patterns as common in ordinary function definitions (<span style="color:blue;"><a href="#_3">see Chapter 3</a></span>). However, only simple functions can be defined in this way: no rule alternatives, and no local function definitions.</p>
<p style="text-align:justify;">It is also allowed to use the arrow ('<span style="font-family:courier;">-&gt;</span>') to separate  the  formal  arguments from the function body:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LambdaAbstr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>\</b></span> {Pattern}+ {LambdaGuardAlt} {LetBeforeExpression} LambdaResult</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>= </b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard LambdaGuardRhs</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of a Lambda expression.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
AddTupleList::&nbsp;[(Int,Int)]&nbsp;-&gt;&nbsp;[Int]<br>
AddTupleList&nbsp;list&nbsp;=&nbsp;map&nbsp;((x,y)&nbsp;=&nbsp;x+y)&nbsp;list<br></div>
</p><p style="text-align:justify;">A lambda expression introduces a new scope (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>).</p>
<div style="background-color:#FFFF45";>The arguments of the anonymous function being defined have the only a meaning in the corresponding function body.</div>
<div style="position: absolute;height:3.375em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 54" width="100%" height="100%">
<path d="M15.6444444444444 18 h336 v16.5 h-336 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
\&nbsp;arg1&nbsp;arg2&nbsp;...&nbsp;argn&nbsp;=&nbsp;function_body<br></p>
<p style="text-align:justify;">Let-before expressions and guards can be used in lambda abstractions:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LambdaGuardAlt</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr LambdaGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaGuardRhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LambdaGuardAlt} {LetBeforeExpression} LambdaGuardResult</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaGuardResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>= </b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> LambdaGuardRhs</td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_3.4.2">3.4.2 Case Expression and Conditional Expression</a></h3>
<p style="text-align:justify;">For programming convenience a <i>case expression</i> and <i>conditional expression</i> are added.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CaseExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>case</b></span> GraphExpr <span style="font-family:courier;color:#FF0000;"><b>of</b></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#0000FF;"><b>{</b></span> {CaseAltDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>if</b></span> BrackGraph BrackGraph BrackGraph</td></tr>
<tr><td style="width:23.0290909090909%;">CaseAltDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{Pattern}</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{CaseGuardAlt} {LetBeforeExpression} CaseResult</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[LocalFunctionAltDefs]</td></tr>
<tr><td style="width:23.0290909090909%;">CaseResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard CaseGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">CaseGuardAlt</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr CaseGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">CaseGuardRhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{CaseGuardAlt} {LetBeforeExpression} CaseGuardResult</td></tr>
<tr><td style="width:23.0290909090909%;">CaseGuardResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> CaseGuardRhs</td></tr>
</table><p></p>
<p style="text-align:justify;">In a <i>case expression</i> first the discriminating expression is evaluated after which the case alternatives are tried in textual order. Case alternatives are similar to function alternatives. This is not so strange because a case expression is internally translated to a function definition (see the example below). Each alternative contains a left-hand side pattern (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) that is optionally followed by a <i>let-before</i> (<span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span>) and a guard (<span style="color:blue;"><a href="#_3.3">see 3.3</a></span>). When a pattern matches and the optional guard evaluates to <span style="font-family:courier;">True</span> the corresponding alternative is chosen. A new block structure (scope) is created for each case alternative (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>).</p>
<p style="text-align:justify;">It is also allowed to use the arrow ('<span style="font-family:courier;">-&gt;</span>') to separate the case alternatives</p>
<div style="background-color:#FFFF45";>The variables defined in the patterns have the only a meaning in the corresponding alternative.</div>
<div style="position: absolute;height:6.75em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 108" width="100%" height="100%">
<path d="M34.8444444444444 16.5 h249.6 v16.5 h-249.6 Z" fill="none" stroke="#000000"/>
<path d="M34.8444444444444 36 h249.6 v15 h-249.6 Z" fill="none" stroke="#000000"/>
<path d="M34.8444444444444 72 h249.6 v16.5 h-249.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>case</b></span>&nbsp;expression&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;pattern1&nbsp;=&nbsp;alternative1<br>
&nbsp;&nbsp;&nbsp;&nbsp;pattern2&nbsp;=&nbsp;alternative2<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;patternn&nbsp;=&nbsp;alternativen<br></p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All alternatives in the case expression must be of the same type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When none of the patterns matches a <i>run-time</i> error is generated.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>The case expression</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h&nbsp;x&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>case</b></span>&nbsp;g&nbsp;x&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[hd:_]&nbsp;&nbsp;=&nbsp;hd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"result&nbsp;of&nbsp;call&nbsp;g&nbsp;x&nbsp;in&nbsp;h&nbsp;is&nbsp;empty"<br>
<br></div>
<div style="background-color:#FFFF45";>is semantically equivalent to:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h&nbsp;x&nbsp;=&nbsp;mycase&nbsp;(g&nbsp;x)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;mycase&nbsp;&nbsp;[hd:_]&nbsp;&nbsp;=&nbsp;hd<br>
&nbsp;&nbsp;&nbsp;&nbsp;mycase&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"result&nbsp;of&nbsp;call&nbsp;g&nbsp;x&nbsp;in&nbsp;h&nbsp;is&nbsp;empty"<br></div>
</p><p style="text-align:justify;">In a <i>conditional expression</i> first the Boolean expression is evaluated after which either the then- or the else-part is chosen. The conditional expression can be seen as a simple kind of case expression.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The then- and else-part in the conditional expression must be of the same type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The discriminating expression must be of type <span style="font-family:courier;">Bool</span>.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_3.4.3">3.4.3 Matches Pattern Expression</a></h3>
<p style="text-align:justify;"><span style="font-family:courier;">expression</span> <span style="font-family:courier;">=:</span> <span style="font-family:courier;">pattern</span> in an expression yields <span style="font-family:courier;">True</span> if the <span style="font-family:courier;">expression</span> matches the <span style="font-family:courier;">pattern</span> and <span style="font-family:courier;">False</span> otherwise. Variable names are not allowed in the <span style="font-family:courier;">pattern</span>, but <span style="font-family:courier;">_</span>'s may be used. The compiler converts the expression to a case if the pattern is more complicated than just a constructor and <span style="font-family:courier;">_</span>'s.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">MatchesPatternExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr <span style="font-family:courier;color:#993300;"><b>=:</b></span> <span style="font-family:courier;">ConstructorName</span> { <span style="font-family:courier;color:#993300;"><b>_</b></span> }</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GraphExpr <span style="font-family:courier;color:#993300;"><b>=:</b></span> BrackPattern</td></tr>
</table><p></p>
<p style="text-align:justify;"><span style="font-family:courier;">=:</span> in expressions binds stronger than function application. This includes additional <span style="font-family:courier;">_</span>'s after a <span style="font-family:courier;">ConstructorName</span>, so <span style="font-family:courier;">x=:(Constructor _ _)</span> may be written without parenthesis as <span style="font-family:courier;">x=:Constructor _ _</span>, for example:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;T&nbsp;=&nbsp;X&nbsp;Int&nbsp;|&nbsp;Y&nbsp;Int&nbsp;Int&nbsp;|&nbsp;Z<span style="font-family:courier;color:#0000FF;"><b>;</b></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;algebraic&nbsp;type&nbsp;definition&nbsp;</span><br>
<br>
isXorY&nbsp;t&nbsp;&nbsp;=&nbsp;&nbsp;t=:X&nbsp;_&nbsp;||&nbsp;t=:Y&nbsp;_&nbsp;_<span style="font-family:courier;color:#0000FF;"><b>;</b></span><br></p>
</p>
<h2 style="background-color:#9999FF;"><a id="_3.5">3.5 Local Definitions</a></h2>
<p style="text-align:justify;">Sometimes it is convenient to introduce definitions that have a limited scope and are not visible throughout the whole module. One can define <i>functions</i> that have a local scope, i.e. which have only a meaning in a certain program region.</p>
<p style="text-align:justify;">Outside the scope the functions are unknown. This locality can be used to get a better program structure: functions that are only used in a certain program area can remain hidden outside that area.</p>
<p style="text-align:justify;">Besides functions one can also define constant selectors. Constants are named graph expressions (<span style="color:blue;"><a href="#_3.6">see 3.6</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LocalDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">FunctionDef</td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_3.5.1">3.5.1 Let Expression: Local Definitions in Expressions</a></h3>
<p style="text-align:justify;">A <i>let</i> expression is an expression that enables to introduce a new scope (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>)  in an expression in which local functions and constants can be defined. Such local definitions can be introduced anywhere in an expression using a let expression with the following syntax.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LetExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>let</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span> <span style="font-family:courier;color:#FF0000;"><b>in</b></span> GraphExpr</td></tr>
</table><p></p>
<div style="background-color:#FFFF45";>The function and selectors defined in the let block only have a meaning within the <i>expression</i>.</div>
<div style="position: absolute;height:7.875em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 126" width="100%" height="100%">
<path d="M0 18 h374.4 v88.5 h-374.4 Z" fill="none" stroke="#000000"/>
<path d="M121.244444444444 36 h249.6 v16.5 h-249.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
<span style="font-family:courier;color:#FF0000;"><b>let</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;arguments&nbsp;=&nbsp;function_body<br>
&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
<span style="font-family:courier;color:#FF0000;"><b>in</b></span>&nbsp;&nbsp;expression<br></p>
<p><div style="background-color:#FFFF45";>Example of a let expression used within a list comprehension.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
doublefibs&nbsp;n&nbsp;=&nbsp;[<span style="font-family:courier;color:#FF0000;"><b>let</b></span>&nbsp;a&nbsp;=&nbsp;fib&nbsp;i&nbsp;<span style="font-family:courier;color:#FF0000;"><b>in</b></span>&nbsp;(a,&nbsp;a)&nbsp;\&nbsp;i&nbsp;&lt;-&nbsp;[0..n]]<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_3.5.2">3.5.2 Where Block: Local Definitions in a Function Alternative</a></h3>
<p style="text-align:justify;">At the end of each function alternative one can locally define functions and constant graphs in a <i>where block</i>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LocalFunctionAltDefs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">Functions and graphs defined in a <i>where</i> block can be used anywhere in the corresponding function alternative (i.e. in all guards and rule alternatives following a pattern, <span style="color:blue;"><a href="#_3.1">see 3.1</a></span>) as indicated in the following picture showing the scope of a <i>where</i> block.</p>
<div style="background-color:#FFFF45";>The function and selectors defined in the where block can be used locally in the whole function definition.</div>
<div style="position: absolute;height:11.25em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 180" width="100%" height="100%">
<path d="M82.8444444444444 18 h393.6 v142.5 h-393.6 Z" fill="none" stroke="#000000"/>
<path d="M102.044444444444 34.5 h326.4 v16.5 h-326.4 Z" fill="none" stroke="#000000"/>
<path d="M102.044444444444 54 h326.4 v16.5 h-326.4 Z" fill="none" stroke="#000000"/>
<path d="M265.244444444444 126 h201.6 v16.5 h-201.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
function&nbsp;formal_arguments<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard1&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;function_alternative1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard2&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;function_alternative2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;default_alternative<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_function&nbsp;args&nbsp;=&nbsp;function_body<br>
<br></p>
<p><div style="background-color:#FFFF45";>sieve and filter are local functions defined in a where block. They have only a meaning inside primes. At the global level the functions are unknown.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
primes::[Int]<br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve::[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;primes</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve&nbsp;[pr:r]&nbsp;&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;filter::Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;primes</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<br></div>
</p><p style="text-align:justify;">Notice that the scope rules are such that the formal arguments of the surrounding function alternative are visible to the locally defined functions and graphs. The arguments can therefore directly be addressed in the local definitions. Such local definitions cannot always be typed explicitly (<span style="color:blue;"><a href="#_3.7">see 3.7</a></span>).</p>
<p><div style="background-color:#FFFF45";>Alternative definition of <span style="font-family:courier;">primes</span>. The function filter is locally defined for <span style="font-family:courier;">sieve</span>.<span style="font-family:courier;">filter</span> can directly access arguments <span style="font-family:courier;">pr</span> of <span style="font-family:courier;">sieve</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
primes::[Int]<br>
primes&nbsp;=&nbsp;sieve&nbsp;[2..]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve::[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;primes</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sieve&nbsp;[pr:r]&nbsp;&nbsp;=&nbsp;[pr:sieve&nbsp;(filter&nbsp;pr&nbsp;r)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter::Int&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;local&nbsp;function&nbsp;of&nbsp;sieve</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter&nbsp;pr&nbsp;[n:r]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&nbsp;mod&nbsp;pr&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;=&nbsp;filter&nbsp;pr&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n:filter&nbsp;pr&nbsp;r]<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_3.5.3">3.5.3 With Block: Local Definitions in a Guarded Alternative</a></h3>
<p style="text-align:justify;">One can also locally define functions and graphs at the end of each guarded rule alternative using a <i>with block</i>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LocalFunctionDefs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#FF0000;"><b>with</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">LocalDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">FunctionDef</td></tr>
</table><p></p>
<p style="text-align:justify;">Functions and graphs defined in a <i>with</i> block can only be used in the corresponding rule alternative as indicated in the following picture showing the scope of a <i>with</i> block.</p>
<div style="background-color:#FFFF45";>The function and selectors defined in the <i>with</i> block can be locally only be used in the corresponding function alternative.</div>
<div style="position: absolute;height:14.625em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 234" width="100%" height="100%">
<path d="M82.8444444444444 21 h566.4 v190.5 h-566.4 Z" fill="none" stroke="#000000"/>
<path d="M246.044444444444 37.5 h398.933333333333 v75 h-398.933333333333 Z" fill="none" stroke="#000000"/>
<path d="M438.044444444444 91.5 h201.6 v16.5 h-201.6 Z" fill="none" stroke="#000000"/>
<path d="M246.044444444444 127.5 h398.933333333333 v75 h-398.933333333333 Z" fill="none" stroke="#000000"/>
<path d="M438.044444444444 181.5 h201.6 v16.5 h-201.6 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
function&nbsp;formal&nbsp;arguments<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;function_alternative1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>with</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_function&nbsp;args&nbsp;=&nbsp;function_body<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;function_alternative2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>with</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selector&nbsp;=&nbsp;expr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_function&nbsp;args&nbsp;=&nbsp;function_body<br>
<br></p>
<p style="text-align:justify;">Notice that the scope rules are such that the arguments of the surrounding guarded rule alternative are visible to the locally defined functions and graphs. The arguments can therefore directly be addressed in the local definitions. Such local definitions cannot always be typed explicitly (<span style="color:blue;"><a href="#_3.7">see 3.7</a></span>).</p>
<h3 style="background-color:#9999FF;"><a id="_3.5.4">3.5.4 Let-Before Expression: Local Constants defined between Guards</a></h3>
<p style="text-align:justify;">Many of the functions for input and output in the CLEAN I/O library are state transition functions. Such a state is often passed from one function to another in a single threaded way (<span style="color:blue;"><a href="#_9">see Chapter 9</a></span>) to force a specific order of evaluation. This is certainly the case when the state is of unique type. The threading parameter has to be renamed to distinguish its different versions. The following example shows a typical example:</p>
<p><div style="background-color:#FFFF45";>Use of state transition functions. The uniquely typed state file is passed from one function to another involving a number of renamings: file, file1, file2)</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
readchars::&nbsp;*File&nbsp;-&gt;&nbsp;([Char],&nbsp;*File)<br>
readchars&nbsp;file<br>
|&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],file1)<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;([char:chars],&nbsp;file2)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(ok,char,file1)&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;(chars,file2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;readchars&nbsp;file1<br></div>
</p><p style="text-align:justify;">This explicit renaming of threaded parameters not only looks very ugly, these kind of definitions are sometimes also hard to read as well (in which order do things happen? which state is passed in which situation?). We have to admit: an imperative style of programming is much easier to read when things have to happen in a certain order such as is the case when doing I/O. That is why we have introduced <i>let-before</i> expressions.</p>
<p style="text-align:justify;"><i>Let-before</i> expressions are special let expressions that can be defined before a guard or function body. In this way one can specify sequential actions in the order in which they suppose to happen. <i>Let-before</i> expressions have the following syntax:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LetBeforeExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b># </b></span>{GraphDefOrUpdate}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>#!</b></span>{GraphDefOrUpdate}+</td></tr>
<tr><td style="width:23.0290909090909%;">GraphDefOrUpdate</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:58.1709090909091%;">Variable <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {<span style="font-family:courier;">FieldName</span> {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:17.7381818181818%;">// <span style="color:blue;"><a href="#_5.2.1">see 5.2.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:58.1709090909091%;">Variable <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {ArrayIndex {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:17.7381818181818%;">// <span style="color:blue;"><a href="#_4.4.1">see 4.4.1</a></span></td></tr>
</table><p></p>
<p style="text-align:justify;">The form with the exclamation mark (<span style="font-family:courier;">#!</span>) forces the evaluation of the node-ids that appear in the left-hand sides of the definitions. Notice that one can only define constant selectors (GraphDef) in a Let-before expression. One cannot define functions.</p>
<p style="text-align:justify;"><i>Let-before</i> expressions have a special scope rule to obtain an imperative programming look. The variables in the left-hand side of these definitions do not appear in the scope of the right-hand side of that definition, but they do appear in the scope of the other definitions that follow (including the root expression, excluding local definitions in where blocks.</p>
<div style="background-color:#FFFF45";>This is shown in the following picture:</div>
<div style="position: absolute;height:10.125em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 162" width="100%" height="100%">
<path d="M79.2888888888889 18 h270.577777777778 v124.5 h-270.577777777778 Z" fill="none" stroke="#000000"/>
<path d="M82.8444444444444 111L82.8444444444444 39L198.044444444444 39L198.044444444444 57L345.6 57L345.6 111 Z" fill="none" stroke="#000000"/>
<path d="M86.4 108L86.4 75L201.6 75L201.6 93L342.044444444444 93L342.044444444444 108 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
Function&nbsp;args<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;selector1&nbsp;&nbsp;=&nbsp;expression1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;expression2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;selector2&nbsp;&nbsp;=&nbsp;expression3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;guard2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;expression4<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_definitions<br></p>
<p style="text-align:justify;">Notice that a variable defined in a let-before expression cannot be used in a where expression. The reverse is true however: definitions in the where expression can be used in the let before expression.</p>
<p><div style="background-color:#FFFF45";>Use of let before expressions, short notation, re-using names taking use of the special scope of the let before)</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
readchars::&nbsp;*File&nbsp;-&gt;&nbsp;([Char],&nbsp;*File)<br>
readchars&nbsp;file<br>
#&nbsp;&nbsp;&nbsp;(ok,char,file)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br>
|&nbsp;&nbsp;&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],file)<br>
#&nbsp;&nbsp;&nbsp;(chars,file)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;readchars&nbsp;file<br>
=&nbsp;&nbsp;&nbsp;([char:chars],&nbsp;file)<br></div>
</p><p><div style="background-color:#FFFF45";>Equivalent definition renaming threaded parameters</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
readchars::&nbsp;*File&nbsp;-&gt;&nbsp;([Char],&nbsp;*File)<br>
readchars&nbsp;file<br>
#&nbsp;&nbsp;&nbsp;(ok,char,file1)&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br>
|&nbsp;&nbsp;&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],file1)<br>
#&nbsp;&nbsp;&nbsp;(chars,&nbsp;file2)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;readchars&nbsp;file1<br>
=&nbsp;&nbsp;&nbsp;([char:chars],&nbsp;file2)<br></div>
</p><p style="text-align:justify;">The notation can also be dangerous: the same name is used on different spots while the meaning of the name is not always  the  same  (one has to  take  the  scope  into account which  changes  from  definition  to  definition).  However,  the notation  is  rather  safe  when  it  is  used  to  thread  parameters  of  unique  type.  The  type  system  will  spot  it  when  such parameters are not used in a correct single threaded manner. We do not recommend the use of let before expressions to adopt an imperative programming style for other cases.</p>
<p><div style="background-color:#FFFF45";>Abuse of let before expression.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
exchange::&nbsp;(a,&nbsp;b)&nbsp;-&gt;&nbsp;(b,&nbsp;a)<br>
exchange&nbsp;(x,&nbsp;y)<br>
#&nbsp;&nbsp;&nbsp;temp&nbsp;=&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;temp<br>
=&nbsp;&nbsp;&nbsp;(x,&nbsp;y)<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_3.6">3.6 Defining Constants</a></h2>
<p style="text-align:justify;">One can give a name to a constant expression (actually a graph), such that the expression can be used in (and shared by) other expressions. One can also identify certain parts of a constant via a projection function called a selector (see below).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Selector <span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>:</b></span>] GraphExpr <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Graph locally defined in a function: the graph labeled <span style="font-family:courier;">last</span> is shared in the function <span style="font-family:courier;">StripNewline</span> and computed only once.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
StripNewline::&nbsp;String&nbsp;-&gt;&nbsp;String<br>
StripNewline&nbsp;""&nbsp;=&nbsp;""<br>
StripNewline&nbsp;string<br>
|&nbsp;string&nbsp;!!&nbsp;last&lt;&gt;'\n'&nbsp;=&nbsp;string<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;string%(0,last-1)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;last&nbsp;=&nbsp;maxindex&nbsp;string<br></div>
</p><p style="text-align:justify;">When a <i>graph</i> is <i>defined</i> actually a name is given to (part) of an expression. The definition of a graph can be compared with a definition of a <i>constant</i>(data) or a<i>constant</i> (<i>projection</i>) <i>function</i>. However, notice that graphs are constructed according to the basic semantics of CLEAN (<span style="color:blue;"><a href="#_1">see Chapter 1</a></span>) that means that multiple references to the same graph will result in <i>sharing</i> of that graph. Recursive references will result in <i>cyclic graph structures</i>. Graphs have the property that they <i>are computed only once</i> and that their value is <i>remembered</i>within the scope they are defined in.</p>
<p style="text-align:justify;">Graph definitions differ from constant function definitions. A <i>constant function definition</i> is just a function defined with arity zero (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>). A constant function defines an ordinary graph rewriting rule: multiple references to a function just means that the same definition is used such that a (constant) function <i>will be recomputed again</i> for each occurrence of <i>the function symbol made</i>. This difference can have consequences for the time and space behavior of function definitions (<span style="color:blue;"><a href="#_10.2">see 10.2</a></span>).</p>
<p><div style="background-color:#FFFF45";>The Hamming numbers defined using a locally defined cyclic constant graph and defined by using a globally defined recursive constant function. The first definition (ham1) is efficient because already computed numbers are reused via sharing. The second definition (ham2 ) is much more inefficient because the recursive function recomputes everything.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
ham1::&nbsp;[Int]<br>
ham1&nbsp;=&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;y&nbsp;=&nbsp;[1:merge&nbsp;(map&nbsp;((*)&nbsp;2)&nbsp;y)&nbsp;(merge&nbsp;(map&nbsp;((*)&nbsp;3)&nbsp;y)&nbsp;(map&nbsp;((*)&nbsp;5)&nbsp;y))]<br>
<br>
ham2::&nbsp;[Int]<br>
ham2&nbsp;=&nbsp;[1:merge&nbsp;(map&nbsp;((*)&nbsp;2)&nbsp;ham2)&nbsp;(merge&nbsp;(map&nbsp;((*)&nbsp;3)&nbsp;ham2)&nbsp;(map&nbsp;((*)&nbsp;5)&nbsp;ham2&nbsp;))]<br></div>
</p><p style="text-align:justify;">Syntactically the definition of a graph is distinguished from the definition of a function by the symbol which separates the left-hand side from the right-hand side: "<span style="font-family:courier;">=</span>" or "<span style="font-family:courier;">=&gt;</span>" is used for functions, while "<span style="font-family:courier;">=</span>" is used for local graphs and "<span style="font-family:courier;">=:</span>" for global graphs. However, in general "<span style="font-family:courier;">=</span>" is used both for functions and local graphs. Generally it is clear from the context which is meant (functions have parameters, selectors are also easy recognisible). However, when a simple constant is defined the syntax is ambiguous (it can be a constant function definition as well as a constant graph definition).</p>
<p style="text-align:justify;">To allow the use of the "<span style="font-family:courier;">=</span>" whenever possible, the following rule is followed. Local constant definitions are <i>by default</i> taken to be <i>graph</i> definitions and therefore shared, globally they are <i>by default</i> taken to be <i>function</i> definitions (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>) and therefore recomputed. If one wants to obtain a different behavior one has to explicit state the nature of the constant definition (has it to be shared or has it to be recomputed) by using "<span style="font-family:courier;">=:</span>" (on the global level, meaning it is a constant graph which is shared) or "<span style="font-family:courier;">=&gt;</span>" (on the local level, meaning it is a constant function and has to be recomputed).</p>
<p><div style="background-color:#FFFF45";>Local constant graph versus local constant function definition: <span style="font-family:courier;">biglist1</span> and <span style="font-family:courier;">biglist2</span> is a <i>graph</i> which is computed only once, <span style="font-family:courier;">biglist3</span> is a constant <i>function</i> which is computed every time it is applied. </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
biglist1&nbsp;=&nbsp;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;graph&nbsp;(if&nbsp;defined&nbsp;locally)</span><br>
biglist1&nbsp;=&nbsp;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;constant&nbsp;function&nbsp;(if&nbsp;defined&nbsp;globally)</span><br>
biglist2&nbsp;=:&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;graph&nbsp;(if&nbsp;defined&nbsp;globally)</span><br>
biglist3&nbsp;=&gt;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;constant&nbsp;function&nbsp;(always)</span><br></div>
</p><p style="text-align:justify;">The garbage collector will collect locally defined graphs when they are no longer connected to the root of the program graph (<span style="color:blue;"><a href="#_1">see Chapter 1</a></span>).</p>
<h3 style="background-color:#9999FF;"><a id="_3.6.1">3.6.1 Selectors</a></h3>
<p style="text-align:justify;">The left-hand side of a graph definition can be a simple name, but is can also be a more complicated pattern called a selector. A <i>selector</i> is a pattern which introduces one or more new <i>selector variables</i> implicitly defining <i>projection functions</i> to identify (parts of) a constant graph being defined One can identify the sub-graph as a whole or one can identify its components. A selector can contain constants (also user defined constants introduced by algebraic type definitions), variables and wildcards. With a <i>wildcard</i> one can indicate that one is not interested in certain components.</p>
<p style="text-align:justify;">Selectors cannot be defined globally. They can only locally be defined in a let (<span style="color:blue;"><a href="#_3.5.1">see 3.5.1</a></span>), a let-before (<span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span>), a where-block (<span style="color:blue;"><a href="#_3.5.2">see 3.5.2</a></span>), and a with-block (<span style="color:blue;"><a href="#_3.5.3">see 3.5.3</a></span>). Selectors can furthermore appear on the left-hand side of generators in list comprehensions (<span style="color:blue;"><a href="#_4.2.1">see 4.2.1</a></span>) and array comprehensions (<span style="color:blue;"><a href="#_4.4.1">see 4.4.1</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Selector</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">BrackPattern</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_3.2">for bracket patterns see 3.2</a></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Use of a selector to locally select tuple elements.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
unzip::[(a,b)]&nbsp;-&gt;&nbsp;([a],[b])<br>
unzip&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;([],[])<br>
unzip&nbsp;[(x,y):xys]&nbsp;=&nbsp;([x:xs],[y:ys])<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(xs,ys)&nbsp;=&nbsp;unzip&nbsp;xys<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a selector on the left-hand side of a graph definition is not matching the graph on the right-hand side it will result in a <i>run-time</i> error.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The selector variables introduced in the selector must be different from each other and not already be used in the same scope and name space (<span style="color:blue;"><a href="#_1.2">see 1.2</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">To avoid the specification of patterns that may fail at run-time, it is not allowed to test on zero arity constructors. For instance, list used in a selector pattern need to be of form <span style="font-family:courier;">[a:_]</span>. <span style="font-family:courier;">[a]</span> cannot be used because it stands for <span style="font-family:courier;">[a:[]]</span> implying a test on the zero arity constructor <span style="font-family:courier;">[]</span>. If the pattern is a record only those fields which contents one is interested in need to be indicated in the pattern</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Arrays cannot be used as pattern in a selector.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Selectors cannot be defined globally.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_3.7">3.7 Typing Functions</a></h2>
<p style="text-align:justify;">Although one is in general not obligated to explicitly specify the type of a function (the CLEAN compiler can in general <span style="font-family:courier;">infer</span> the type) the explicit specification of the type is <span style="font-family:courier;">highly recommended</span> to increase the readability of the program.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[FunctionTypeDef]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">DefOfFunction</td></tr>
<tr><td style="width:100%px'" colspan="3"></td></tr>
<tr><td style="width:23.0290909090909%;">FunctionTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span> [Fix][Prec] [<span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Fix</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixl</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixr</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infix</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Prec</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Digit</td></tr>
<tr><td style="width:23.0290909090909%;">FunctionType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[{ArgType}+ <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span>] Type [ClassContext] [UnqTypeUnEqualities]</td></tr>
<tr><td style="width:23.0290909090909%;">ArgType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
<tr><td style="width:23.0290909090909%;">Type</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{BrackType}+</td></tr>
<tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;">UniversalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">An explicit specification is <span style="font-family:courier;">required</span> when a function is exported, or when the programmer wants to impose additional restrictions on the application of the function (e.g. a more restricted type can be specified, strictness information can be added as explained in <span style="color:blue;"><a href="#_10.1">Chapter 10.1</a></span>, a class context for the type variables to express overloading can be defined as explained in <span style="color:blue;"><a href="#_7">Chapter 7</a></span>, uniqueness information can be added as explained in 3.7.5 Functions with Strict Arguments).</p>
<p style="text-align:justify;">The CLEAN type system uses a combination of Milner/Mycroft type assignment. This has as consequence that the type system in some rare cases is not capable to infer the type of a function (using the Milner/Hindley system) although it will approve a given type (using the Mycroft system; see Plasmeijer and Van Eekelen, 1993). Also when universally quantified types of rank 2 are used (<span style="color:blue;"><a href="#_3.7.4">see 3.7.4</a></span>), explicit typing by the programmer is required.</p>
<p style="text-align:justify;">The Cartesian product is used for the specification of the function type. The Cartesian product is denoted by juxtaposition of the bracketed argument types. For the case of a single argument the brackets can be left out. In type specifications the binding priority of the application of type constructors is higher than the binding of the arrow <span style="font-family:courier;">-&gt;</span>. To indicate that one defines an operator the function name is on the left-hand side surrounded by brackets.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The function symbol before the double colon should be the same as the function symbol of the corresponding rewrite rule.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The arity of the functions has to correspond with the number of arguments of which the Cartesian product is taken. So, in CLEAN one can tell the arity of the function by its type.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Showing how the arity of a function is reflected in type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;map&nbsp;has&nbsp;arity&nbsp;2</span><br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;&nbsp;&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br>
<br>
domap::&nbsp;((a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;domap&nbsp;has&nbsp;arity&nbsp;zero</span><br>
domap&nbsp;=&nbsp;map<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The arguments and the result types of a function should be of kind <span style="font-family:courier;">X</span>.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In the specification of a type of a locally defined function one cannot refer to a type variable introduced in the type specification of a surrounding function (there is not yet a scope rule on types defined). The programmer can therefore not specify the type of such a local function. However, the type will be inferred and checked (after it is lifted by the compiler to the global level) by the type system.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Counter example (illegal type specification). The function <span style="font-family:courier;">g</span> returns a tuple. The type of the first tuple element is the same as the type of the polymorphic argument of <span style="font-family:courier;">f</span>. Such a dependency (here indicated by "<span style="font-family:courier;">^</span><span style="font-family:courier;">" cannot be specified).</span></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f::&nbsp;a&nbsp;-&gt;&nbsp;(a,a)<br>
f&nbsp;x&nbsp;=&nbsp;g&nbsp;x<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;g::&nbsp;b&nbsp;-&gt;&nbsp;(a^,b)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;g&nbsp;y&nbsp;=&nbsp;(x,y)<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_3.7.1">3.7.1 Typing Curried Functions </a></h3>
<p style="text-align:justify;">In CLEAN all symbols (functions and constructors) are defined with <i>fixed arity</i>. However, in an application it is of course allowed to apply them to an arbitrary number of arguments. A <i>curried application</i> of a function is an application of a function with a number of arguments which is less than its arity (note that in CLEAN the arity of a function can be derived from its type). With the aid of the predefined internal function <i>_AP</i> a curried function applied on the required number of arguments is transformed into an equivalent uncurried function application.</p>
<p style="text-align:justify;">The type axiom's of the CLEAN type system include for all <span style="font-family:courier;">s</span> defined with arity <span style="font-family:courier;">n</span> the equivalence of <span style="font-family:courier;">s::(t1-&gt;(t2-&gt;(...(tn-&gt;tr)...))</span> with <span style="font-family:courier;">s::t1 t2 ... tn -&gt; tr</span>.</p>
<h3 style="background-color:#9999FF;"><a id="_3.7.2">3.7.2 Typing Operators</a></h3>
<p style="text-align:justify;">An <i>operator</i> is a <i>function with arity two</i> that can be used in infix position. An operator can be defined by enclosing the operator name between parentheses in the left-hand-side of the function definition. An operator has a <i>precedence</i> (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>, default <span style="font-family:courier;">9</span>) and a <span style="font-family:courier;color:#FF0000;"><b>fixity</b></span> (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span> or just <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>, default <span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>). A higher precedence binds more tightly. When operators have equal precedence, the fixity determines the priority. In an expression an ordinary function application always has the highest priority (<span style="font-family:courier;">10</span>). See also <span style="color:blue;"><a href="#_3.1">Section 3.1</a></span> and <span style="color:blue;"><a href="#_3.4">3.4</a></span>.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The type of an operator must obey the requirements as defined for typing functions with arity two.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">If the operator is explicitly typed the operator name should also be put between parentheses in the type rule.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an infix operator is enclosed between parentheses it can be applied as a prefix function. Possible recursive definitions of the newly defined operator on the right-hand-side also follow this convention.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example of an operator definition and its type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(o)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;8::&nbsp;(x&nbsp;-&gt;&nbsp;y)&nbsp;(z&nbsp;-&gt;&nbsp;x)&nbsp;-&gt;&nbsp;(z&nbsp;-&gt;&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;function&nbsp;composition<br>
(o)&nbsp;f&nbsp;g&nbsp;=&nbsp;\x&nbsp;-&gt;&nbsp;f&nbsp;(g&nbsp;x)<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_3.7.3">3.7.3 Typing Partial Functions</a></h3>
<p style="text-align:justify;">Patterns and guards imply a condition that has to be fulfilled before a rewrite rule can be applied (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span> and <span style="color:blue;"><a href="#_3.3">3.3</a></span>). This makes it possible to define <i>partial function s</i>, functions which are not defined for all possible values of the specified type.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a partial function is applied to a value outside the domain for which the function is defined it will result into a <i>run-time</i> error. The compiler gives a warning when functions are defined which might be partial.</td></tr>
</table>
<p style="text-align:justify;">With the <span style="font-family:courier;">abort</span> expression (see <span style="font-family:courier;">StdMisc.dcl</span>) one can change any partial function into a <i>total function</i> (the <span style="font-family:courier;">abort</span>expression can have any type). The abort expression can be used to give a user-defined run-time error message</p>
<p><div style="background-color:#FFFF45";>Use of abort to make a function total.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
fac::&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
fac&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br>
fac&nbsp;n<br>
|&nbsp;n&gt;=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;n&nbsp;*&nbsp;fac&nbsp;(n&nbsp;-&nbsp;1)<br>
|&nbsp;otherwise&nbsp;&nbsp;=&nbsp;abort&nbsp;"fac&nbsp;called&nbsp;with&nbsp;a&nbsp;negative&nbsp;number"<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_3.7.4">3.7.4 Explicit use of the Universal Quantifier in Function Types</a></h3>
<p style="text-align:justify;">When a type of a polymorphic function is specified in CLEAN, the universal quantifier is generally left out.</p>
<p><div style="background-color:#FFFF45";>The function <span style="font-family:courier;">map</span> defined as usual, no universal quantifier is specified:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;&nbsp;&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br></div>
</p><p><div style="background-color:#FFFF45";><b>Counter Example.</b> The same function <span style="font-family:courier;">map</span> again, but now the implicit assumed universal quantifier has been made visible. It shows the meaning of the specified type more precisely, but is makes the type definition a bit longer as well. <span style="color:#FF6600;"><b>The current version of Clean does not yet allow universal quantifiers on the topmost level !!</b></span></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;A.a&nbsp;b:&nbsp;(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;[]<br>
map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;&nbsp;&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br></div>
</p><p style="text-align:justify;"><span style="color:#FF6600;"><b>Not yet Implemented:</b></span> In Clean 2.0 it is allowed to explicitly write down the universal quantifier. One can write down the qualifier A. (for all) direct after the :: in the type definition of a function. In this way one can explicitly introduce the type variables used in the type definition of the function. As usual, the type variables thus introduced have the whole function type definition as scope.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[{ArgType}+ <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span>] Type [ClassContext] [UnqTypeUnEqualities]</td></tr>
<tr><td style="width:23.0290909090909%;">ArgType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
<tr><td style="width:23.0290909090909%;">Type</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{BrackType}+</td></tr>
<tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;">UniversalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">CLEAN offers Rank 2 polymorphism: it is possible to specify the universal quantifier with as scope the type of an argument of a function. This makes it possible to pass polymorphic functions as an argument to a function which otherwise would be treated monomorphic. The advantage of the use of Rank 2 polymorphism is that more programs will be approved by the type system, but one explicitly (by writing down the universal quantifier) has to specify in the type of function that such a polymorphic function is expected as argument or delivered as result.</p>
<p><div style="background-color:#FFFF45";>Example: The function <span style="font-family:courier;">h</span> is used to apply a polymorphic function of type <span style="font-family:courier;">(A.a: [a] -&gt; Int)</span> to a list of <span style="font-family:courier;">Int</span>as well as a list of <span style="font-family:courier;">Char</span>. Due to the explicit use of the universal quantifier in the type specification of <span style="font-family:courier;">h</span> this definition is approved.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h::&nbsp;(A.a:&nbsp;[a]&nbsp;-&gt;&nbsp;Int)&nbsp;-&gt;&nbsp;Int<br>
h&nbsp;f&nbsp;=&nbsp;f&nbsp;[1..100]&nbsp;+&nbsp;f&nbsp;['a'..'z']<br>
<br>
Start&nbsp;=&nbsp;h&nbsp;length<br></div>
</p><p><div style="background-color:#FFFF45";><b>Counter Example:</b> The function <span style="font-family:courier;">h2</span> is used to apply a function of type <span style="font-family:courier;">([a] -&gt; Int)</span> to a list of Int as well as a list of <span style="font-family:courier;">Char</span>. In this case the definition is rejected due to a type unification error. It is assumed that the argument of <span style="font-family:courier;">h2</span> is unifiable with <span style="font-family:courier;">[a] -&gt; Int</span>, but it is not assumed that the argument of <span style="font-family:courier;">h2</span> is <span style="font-family:courier;">(A.a: [a] -&gt; Int)</span>. So, the type variable a is unified with both <span style="font-family:courier;">Int</span> and <span style="font-family:courier;">Char</span>, which gives rise to a type error.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h2::&nbsp;([a]&nbsp;-&gt;&nbsp;Int)&nbsp;-&gt;&nbsp;Int<br>
h2&nbsp;f&nbsp;=&nbsp;f&nbsp;[1..100]&nbsp;+&nbsp;f&nbsp;['a'..'z']<br>
<br>
Start&nbsp;=&nbsp;h2&nbsp;length<br></div>
</p><p><div style="background-color:#FFFF45";><b>Counter Example: </b>The function h3 is used to apply a function to a list of <span style="font-family:courier;">Int</span> as well as a list of <span style="font-family:courier;">Char</span>. Since no type is specified the type inference system will assume <span style="font-family:courier;">f</span> to be of type <span style="font-family:courier;">([a] -&gt; Int)</span> but not of type <span style="font-family:courier;">(A.a: [a] -&gt; Int)</span>. The situation is the same as above and we will again get a type error.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
h3&nbsp;f&nbsp;=&nbsp;f&nbsp;[1..100]&nbsp;+&nbsp;f&nbsp;['a'..'z']<br>
<br>
Start&nbsp;=&nbsp;h3&nbsp;length<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">CLEAN cannot infer polymorphic functions of Rank 2 automatically! One is obligated to explicitly specify universally quantified types of Rank 2.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Explicit universal quantification on higher ranks than rank 2 (e.g. quantifiers specified somewhere inside the type specification of a function argument) is not allowed.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A polymorphic function of Rank 2 cannot be used in a curried way for those arguments in which the function is universally quantified.</td></tr>
</table>
<p><div style="background-color:#FFFF45";><b>Counter Examples:</b> In the example below it is shown that <span style="font-family:courier;">f1</span> can only be used when applied to <i>all</i> its arguments since its last argument is universally quantified. The function <span style="font-family:courier;">f2</span> can be used curried only with respect to its last argument that is not universally quantified.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f1::&nbsp;a&nbsp;(A.b:b-&gt;b)&nbsp;-&gt;&nbsp;a<br>
f1&nbsp;x&nbsp;id&nbsp;=&nbsp;id&nbsp;x<br>
<br>
f2::&nbsp;(A.b:b-&gt;b)&nbsp;a&nbsp;-&gt;&nbsp;a<br>
f2&nbsp;id&nbsp;x&nbsp;=&nbsp;id&nbsp;x<br>
<br>
illegal1&nbsp;=&nbsp;f1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;this&nbsp;will&nbsp;raise&nbsp;a&nbsp;type&nbsp;error</span><br>
<br>
illegal2&nbsp;=&nbsp;f1&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;this&nbsp;will&nbsp;raise&nbsp;a&nbsp;type&nbsp;error</span><br>
<br>
legal1&nbsp;::&nbsp;Int<br>
legal1&nbsp;=&nbsp;f1&nbsp;3&nbsp;id&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;id&nbsp;x&nbsp;=&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;ok</span><br>
<br>
illegal3&nbsp;=&nbsp;f2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;this&nbsp;will&nbsp;raise&nbsp;a&nbsp;type&nbsp;error</span><br>
<br>
legal2&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;a)<br>
legal2&nbsp;=&nbsp;f2&nbsp;id&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;id&nbsp;x&nbsp;=&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;ok</span><br>
<br>
legal3&nbsp;::&nbsp;Int<br>
legal3&nbsp;=&nbsp;f2&nbsp;id&nbsp;3&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;id&nbsp;x&nbsp;=&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;ok</span><br></div>
</p><h3 style="background-color:#9999FF;"><a id="_3.7.5">3.7.5 Functions with Strict Arguments </a></h3>
<p style="text-align:justify;">In the type definition of a function the arguments can optionally be annotated as being strict. In reasoning about functions it will always be true that the corresponding arguments will be in strong root normal form (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>) before the rewriting of the function takes place. In general, strictness information will increase the efficiency of execution (<span style="color:blue;"><a href="#_10">see Chapter 10</a></span>).</p>
<p><div style="background-color:#FFFF45";>Example of a function with strict annotated arguments.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Acker::&nbsp;!Int&nbsp;!Int&nbsp;-&gt;&nbsp;Int<br>
Acker&nbsp;0&nbsp;j&nbsp;=&nbsp;&nbsp;inc&nbsp;j<br>
Acker&nbsp;i&nbsp;0&nbsp;=&nbsp;&nbsp;Acker&nbsp;(dec&nbsp;i)&nbsp;1<br>
Acker&nbsp;i&nbsp;j&nbsp;=&nbsp;&nbsp;Acker&nbsp;(dec&nbsp;i)&nbsp;(Acker&nbsp;i&nbsp;(dec&nbsp;j))<br></div>
</p><p style="text-align:justify;">The CLEAN compiler includes a fast and clever strictness analyzer that is based on abstract reduction (Nöcker, 1993). The compiler can derive the strictness of the function arguments in many cases, such as for the example above. Therefore there is generally no need to add strictness annotations to the type of a function by hand. When a function is exported from a module (<span style="color:blue;"><a href="#_2">see Chapter 2</a></span>), its type has to be specified in the definition module. To obtain optimal efficiency, the programmer should also include the strictness information to the type definition in the definition module. One can ask the compiler to print out the types with the derived strictness information and paste this into the definition module.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Notice that strictness annotations are only allowed at the outermost level of the argument type. Strictness annotations inside type instances of arguments are not possible (with exception for some predefined types like tuples and lists). Any (part of) a data structure can be changed from lazy to strict, but this has to be specified in the type definition (<span style="color:blue;"><a href="#_5.1.5">see 5.1.5</a></span>).</td></tr>
</table>
<!-- chapter:Chapter 4-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_4"><br>Chapter 4<br><br>Predefined Types</a></h1></div>
<p style="text-align:justify;">Certain types like <span style="font-family:courier;">Int</span>egers, <span style="font-family:courier;">Bool</span>eans, <span style="font-family:courier;">Char</span>acters, <span style="font-family:courier;">Real</span>s, Lists, Tuples and Arrays are that frequently used that they have been predefined in CLEAN for reasons of efficiency and/or notational convenience. These types and the syntactic sugar that has been added to create and to inspect (via pattern matching) objects of these popular types are treated in this chapter.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PredefinedType</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">BasicType</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.1">see 4.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ListType</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.2">see 4.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TupleType</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.3">see 4.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ArrayType</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.4">see 4.4</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ArrowType</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.6">see 4.6</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">PredefType</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_4.7">see 4.7</a></span></td></tr>
</table><p></p>
<p style="text-align:justify;">In Chapter 5 we will explain how new types can be defined.</p>
<h2 style="background-color:#9999FF;"><a id="_4.1">4.1 Basic Types: Int, Real, Char and Bool</a></h2>
<p style="text-align:justify;"><i>Basic types</i> are <i>algebraic types</i> (<span style="color:blue;"><a href="#_5.1">see 5.1</a></span>) which are predefined for reasons of efficiency and convenience: <span style="font-family:courier;">Int</span> (for 32 bits integer values), <span style="font-family:courier;">Real</span> (for 64 bit double precision floating point values), <span style="font-family:courier;">Char</span> (for 8 bits ASCII character values) and <span style="font-family:courier;">Bool</span>(for 8 bits Boolean values). For programming convenience special syntax is introduced to denote constant values (data constructors) of these predefined types. Functions to create and manipulate objects of basic types can be found in the CLEAN <span style="font-family:courier;">StdEnv</span> library (as indicated below).</p>
<p style="text-align:justify;">There is also a special notation to denote a string (an unboxed array of characters, <span style="color:blue;"><a href="#_4.4">see 4.4</a></span>) as well as to denote a list of characters (<span style="color:blue;"><a href="#_4.2.1">see 4.2.1</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BasicType</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Int</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdInt.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Real</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdReal.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Char</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdChar.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Bool</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdBool.dcl</span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_4.1.1">4.1.1 Creating Constant Values of Basic Type</a></h3>
<p style="text-align:justify;">In a graph expression a <i>constant value</i>of basic type <span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Real</span>, <span style="font-family:courier;">Bool</span> or <span style="font-family:courier;">Char</span> can be created.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BasicValue</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">IntDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RealDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">BoolDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">CharDenotation</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">IntDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:29.7654545454545%;">[Sign]{Digit}+</td><td style="width:46.1436363636364%;">// decimal number</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:29.7654545454545%;">[Sign]0{OctDigit}+</td><td style="width:46.1436363636364%;">// octal number</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:29.7654545454545%;">[Sign]0x{HexDigit}+</td><td style="width:46.1436363636364%;">// hexadecimal number</td></tr>
<tr><td style="width:23.0290909090909%;">Sign</td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">+ | -</td></tr>
<tr><td style="width:23.0290909090909%;">RealDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:29.7654545454545%;">[Sign]{Digit}+.{Digit}+[E[Sign]{Digit}+]</td><td style="width:46.1436363636364%;"></td></tr>
<tr><td style="width:23.0290909090909%;">BoolDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">True | False</td></tr>
<tr><td style="width:23.0290909090909%;">CharDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">CharDel AnyChar/CharDel CharDel</td></tr>
<tr><td style="width:23.0290909090909%;">CharsDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">CharDel {AnyChar/CharDel}+ CharDel</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AnyChar</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="23">IdChar | ReservedChar | SpecialChar</td></tr>
<tr><td style="width:23.0290909090909%;">ReservedChar</td><td style="width:1.06181818181818%;">=</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>(</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>{</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>}</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>[</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>]</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>,</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:60.1272727272727%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>.</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">SpecialChar</td><td style="width:1.06181818181818%;">=</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\n</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\r</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\f</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:3.12727272727273%px'" colspan="4"><span style="font-family:courier;color:#993300;"><b>\b</b></span></td><td style="width:64.8181818181818%px'" colspan="13">// newline,return,formf,backspace</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\t</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\\</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:5.78181818181818%px'" colspan="6"><span style="font-family:courier;color:#993300;"><b>\</b></span>CharDel</td><td style="width:64.8181818181818%px'" colspan="13">// tab,backslash,character delimiter</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\</b></span>StringDel</td><td style="width:64.8181818181818%px'" colspan="13">// string delimiter</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\</b></span>{OctDigit}+</td><td style="width:64.8181818181818%px'" colspan="13">// octal number </td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\x</b></span>{HexDigit}+</td><td style="width:64.8181818181818%px'" colspan="13">// hexadecimal number </td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Digit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>7</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>8</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>9</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">OctDigit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:64.9636363636364%px'" colspan="5"><span style="font-family:courier;color:#993300;"><b>7</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">HexDigit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>7</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>8</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>9</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>A</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>B</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>C</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>D</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>E</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>F</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>a</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>b</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>c</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>d</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>e</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>f</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CharDel</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">'</td></tr>
<tr><td style="width:23.0290909090909%;">StringDel</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">"</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of denotations.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Integer&nbsp;(decimal):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0|1|2|...|8|9|10|&nbsp;...&nbsp;|-1|-2|&nbsp;...<br>
Integer&nbsp;(octal):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;00|01|02|...|07|010|&nbsp;...&nbsp;|-01|-02|&nbsp;...<br>
Integer&nbsp;(hexadecimal):&nbsp;&nbsp;&nbsp;&nbsp;0x0|0x1|0x2|...|0x8|0x9|0xA|0xB&nbsp;...&nbsp;|-0x1|-0x2|&nbsp;...<br>
Real:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0|1.5|0.314E10|&nbsp;...<br>
Boolean:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;True&nbsp;|&nbsp;False<br>
Character:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'a'|'b'|...|'A'|'B'|...<br>
String:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""&nbsp;|&nbsp;"Rinus"|"Marko"|...<br>
List&nbsp;of&nbsp;characters:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;['Rinus']|['Marko']|...<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_4.1.2">4.1.2 Patterns of Basic Type</a></h3>
<p style="text-align:justify;">A <i>constant value</i> of predefined <i>basic type</i> <span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Real</span>, <span style="font-family:courier;">Bool</span> or <span style="font-family:courier;">Char</span> (<span style="color:blue;"><a href="#_4.1">see 4.1</a></span>) can be specified as pattern.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The denotation of such a value must obey the syntactic description given in above.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Use of Integer values in a pattern.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
nfib::&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
nfib&nbsp;0&nbsp;=&nbsp;1<br>
nfib&nbsp;1&nbsp;=&nbsp;1<br>
nfib&nbsp;n&nbsp;=&nbsp;1&nbsp;+&nbsp;nfib&nbsp;(n-1)&nbsp;*&nbsp;nfib&nbsp;(n-2)<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_4.2">4.2 Lists</a></h2>
<p style="text-align:justify;">A <i>list</i>is an algebraic data type predefined just for programming convenience. A list can contain an <i>infinite number</i> of elements. All elements must be of the <i>same type</i>. Lists are very often used in functional languages and therefore the usual syntactic sugar is provided for the creation and manipulation of lists (dot-dot expressions, list comprehensions) while there is also special syntax for a <i>list of characters</i>.</p>
<p style="text-align:justify;">Lists can be lazy (default), and optionally be defined as head strict, spine strict, strict (both head and spine strict), head strict unboxed, and strict unboxed. Lazy, strict and unboxed lists are all objects of <i>different:</i> type. All these different types of lists have different time and space properties ( <span style="color:blue;"><a href="#_10.1.3">see 10.1.3</a></span>). Because these lists are of different type, conversion functions are needed to change e.g. a lazy list to a strict list. Functions defined on one type of a list cannot be applied to another type of list. However, one can define overloaded functions that can be used on any list: lazy, strict as well as on unboxed lists.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ListType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] Type [SpineStrictness]<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ListKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// head strict list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// head strict, unboxed list</td></tr>
<tr><td style="width:23.0290909090909%;">SpineStrictness</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// tail (spine) strict list</td></tr>
</table><p></p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All elements of a list must be of the <i>same type</i>.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_4.2.1">4.2.1 Creating Lists</a></h3>
<p style="text-align:justify;">Because lists are very convenient and very frequently used data structures, there are several syntactical constructs in CLEAN for creating lists, including <i>dot-dot expressions</i> and <i>ZF-expressions</i>. Since CLEAN is a lazy functional language, the default list in CLEAN is a <i>lazy</i> list. However, in some cases <i>strict lists</i>, <i>spine strict lists</i> and <i>unboxed</i> lists can be more convenient and more efficient.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">List</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">ListDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">DotDotExpression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ZF-expression</td></tr>
</table><p></p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All elements of a list must be of the same type.</td></tr>
</table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspLazy Lists</h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ListDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] [{LGraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>:</b></span> GraphExpr]] [SpineStrictness] <span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">LGraphExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">CharsDenotation</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CharsDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">CharDel {AnyChar/CharDel}+ CharDel</td></tr>
<tr><td style="width:23.0290909090909%;">CharDel</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">'</td></tr>
</table><p></p>
<p style="text-align:justify;">One way to create a list is by explicit enumeration of the list elements. Lists are constructed by adding one or more elements to an existing list.</p>
<p><div style="background-color:#FFFF45";>Various ways to define a lazy list with the integer elements <span style="font-family:courier;">1</span>,<span style="font-family:courier;">3</span>,<span style="font-family:courier;">5</span>,<span style="font-family:courier;">7</span>,<span style="font-family:courier;">9</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
[1:[3:[5:[7:[9:[]]]]]]<br>
[1:3:5:7:9:[]]<br>
[1,3,5,7,9]<br>
[1:[3,5,7,9]]<br>
[1,3,5:[7,9]]<br></div>
</p><p style="text-align:justify;">A special notation is provided for the frequently used <i>list of characters</i>.</p>
<p><div style="background-color:#FFFF45";>Various ways to define a lazy list with the characters '<span style="font-family:courier;">a</span>', '<span style="font-family:courier;">b</span>' and '<span style="font-family:courier;">c</span>'.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
['a':['b':['c':[]]]]<br>
['a','b','c']<br>
['abc']<br>
['ab','c']<br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspStrict , Unboxed and Overloaded Lists</h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ListKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// head strict list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// unboxed list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span></td><td style="width:48.84%;">// overloaded list</td></tr>
<tr><td style="width:23.0290909090909%;">SpineStrictness</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// spine strict list</td></tr>
</table><p></p>
<p style="text-align:justify;">In CLEAN <i>any</i> data structure can be made (partially) strict or unboxed (<span style="color:blue;"><a href="#_10.1">see 10.1</a></span>). This has consequences for the time and space behavior of the data structure.</p>
<p style="text-align:justify;">For instance, <i>lazy lists</i> are very convenient (nothing is evaluated unless it is really needed for the computation, one can deal with infinite data structures), but they can be inefficient as well if actually always all lists elements are evaluated sooner or later. <i>Strict lists</i> are often more efficient, but one has to be certain not to trigger a not used infinite computation. <i>Spine strict lists</i> can be more efficient as well, but one cannot handle infinite lists in this way. Unboxed lists are head strict. The difference with a strict list is that the representation of an <i>unboxed list</i> is more compact: instead of a pointer to the lists element the list element itself is stored in the list. However, unboxed lists have as disadvantage that they can only be used in certain cases: they can only contain elements of basic type, records and tuples. It does not make sense to offer unboxing for arbitrary types: boxing saves space, but not if Cons nodes are copied often: the lists elements are copied as well while otherwise the contents could remain shared using the element pointer instead.</p>
<p style="text-align:justify;">In terms of efficiency it can make quite a difference (e.g. strict lists can sometimes be 6 times faster) which kind of list is actually used. But, it is in general not decidable which kind of list is best to use. This depends on how a list is used in a program. A wrong choice might turn a program from useful to useless (too inefficient), from terminating to non-terminating.</p>
<p style="text-align:justify;">Because lists are so frequently used, special syntax is provided to make it easier for a programmer to change from one type of list to another, just by changing the kind of brackets used. One can define a list of which the <i>head</i>element is strict but the spine is lazy (indicated by <span style="font-family:courier;">[! ]</span>), a list of which the <i>spine</i> is strict but the head element is lazy (indicated by <span style="font-family:courier;">[ !]</span>) and a completely evaluated list (indicated by <span style="font-family:courier;">[! !]</span>). One can have an unboxed list with a strict head element (indicated by <span style="font-family:courier;">[# ]</span>) and a completely evaluated unboxed list of which in addition the spine is strict as well (indicated by <i>[# !]</i></p>
<p style="text-align:justify;">Note that all these different lists are of different type and consequently these lists cannot be mixed and unified with each other. With conversion functions offered in the CLEAN libraries it is possible to convert one list type into another. It is also possible to define an overloaded list and overloaded functions that work on <i>any</i> list (see hereafter).</p>
<p><div style="background-color:#FFFF45";>Various types of lists.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">[&nbsp;&nbsp;fac&nbsp;10&nbsp;:&nbsp;expression&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;lazy&nbsp;list</span><br>
[!&nbsp;fac&nbsp;10&nbsp;:&nbsp;expression&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;head&nbsp;strict&nbsp;list</span><br>
[!&nbsp;fac&nbsp;10&nbsp;:&nbsp;expression&nbsp;!]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;head&nbsp;strict&nbsp;and&nbsp;tail&nbsp;strict&nbsp;list</span><br>
[#&nbsp;fac&nbsp;10&nbsp;:&nbsp;expression&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;head&nbsp;strict&nbsp;list,&nbsp;unboxed</span><br>
[#&nbsp;fac&nbsp;10&nbsp;:&nbsp;expression&nbsp;!]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;head&nbsp;strict&nbsp;and&nbsp;tail&nbsp;strict&nbsp;list,&nbsp;unboxed</span><br></div>
</p><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Unboxed data structures can only contain elements of basic type, records and arrays.</td></tr>
</table>
<p style="text-align:justify;">One can create an <i>overloaded</i> list that will fit on any type of list (lazy, strict or unboxed)</p>
<p><div style="background-color:#FFFF45";>Example of an overloaded list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
[|&nbsp;fac&nbsp;10&nbsp;:&nbsp;expression&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;overloaded&nbsp;list</span><br></div>
</p><p style="text-align:justify;">Other ways to create lists are via dot-dot expressions and list comprehensions.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDotDot Expressions</h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DotDotExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] GraphExpr [<span style="font-family:courier;color:#993300;"><b>,</b></span>GraphExpr]<span style="font-family:courier;color:#993300;"><b>..</b></span>[GraphExpr] [SpineStrictness] <span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">With a dot-dot expression the list elements can be enumerated by giving the first element (<span style="font-family:courier;">n1</span>), an optional second element (<span style="font-family:courier;">n2</span>) and an optional last element (<span style="font-family:courier;">e</span>).</p>
<p><div style="background-color:#FFFF45";>Alternative ways to define a list a dot dot expression.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
[1,3..9]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;[1,3,5,7,9]</span><br>
[1..9]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;[1,2,3,4,5,6,7,8,9]</span><br>
[1..]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;[1,2,3,4,5&nbsp;and&nbsp;so&nbsp;on&nbsp;...</span><br>
['a'..'c']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;['abc']</span><br></div>
</p><p style="text-align:justify;">The generated list is in general calculated as follows:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">from_then_to::&nbsp;!a&nbsp;!a&nbsp;!a&nbsp;-&gt;&nbsp;.[a]&nbsp;|&nbsp;Enum&nbsp;a<br>
from_then_to&nbsp;n1&nbsp;n2&nbsp;e<br>
|&nbsp;n1&nbsp;&lt;=&nbsp;n2&nbsp;&nbsp;&nbsp;=&nbsp;_from_by_to&nbsp;n1&nbsp;(n2-n1)&nbsp;e<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;_from_by_down_to&nbsp;n1&nbsp;(n2-n1)&nbsp;e<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;from_by_to&nbsp;n&nbsp;s&nbsp;e<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&lt;=e&nbsp;&nbsp;&nbsp;=&nbsp;[n&nbsp;:&nbsp;_from_by_to&nbsp;(n+s)&nbsp;s&nbsp;e]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;from_by_down_to&nbsp;n&nbsp;s&nbsp;e<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&gt;=e&nbsp;&nbsp;&nbsp;=&nbsp;[n&nbsp;:&nbsp;_from_by_down_to&nbsp;(n+s)&nbsp;s&nbsp;e]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br></p>
</p>
<p style="text-align:justify;">The step size is <i>one</i> by default. If no last element is specified an infinite list is generated.</p>
<p style="text-align:justify;">With a dot-dot expression one can also define a lazy list, a strict list, an unboxed list or an overloaded list.</p>
<p><div style="background-color:#FFFF45";>Different types of lists (lazy, strict, unboxed and overloaded can be defined with a dot dot expression as well.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
[&nbsp;&nbsp;1,3..9&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;lazy&nbsp;list</span><br>
[!&nbsp;1,3..9&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;head&nbsp;strict&nbsp;list</span><br>
[!&nbsp;1,3..9&nbsp;!]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;strict&nbsp;list&nbsp;(head&nbsp;and&nbsp;spine)</span><br>
[#&nbsp;1,3..9&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;head&nbsp;strict&nbsp;list,&nbsp;unboxed</span><br>
[#&nbsp;1,3..9&nbsp;!]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;strict&nbsp;list&nbsp;(head&nbsp;and&nbsp;spine),&nbsp;unboxed</span><br>
[|&nbsp;1,3..9&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;an&nbsp;overloaded&nbsp;list</span><br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Dot-dot expression can only be used if one imports <span style="font-family:courier;">StdEnum</span><span style="font-family:courier;"> from the standard library.</span></td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Dot-dot expressions are predefined on objects of type <span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Real</span> and <span style="font-family:courier;">Char</span>, but dot-dots can also be applied to any user defined data structure for which the class enumeration type has been instantiated (see CLEANs Standard Environment).</td></tr>
</table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspList Comprehensions</h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ZF-expression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] GraphExpr <span style="font-family:courier;color:#993300;"><b>\</b></span>{Qualifier}-list [SpineStrictness]<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Qualifier</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">Generators { <span style="font-family:courier;color:#993300;"><b>,</b></span> <span style="font-family:courier;color:#FF0000;"><b>let</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span> } {<span style="font-family:courier;color:#993300;"><b>|</b></span>Guard}</td></tr>
<tr><td style="width:23.0290909090909%;">Generators</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{Generator}-list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Generator {<span style="font-family:courier;color:#993300;"><b>&amp;</b></span> Generator}</td></tr>
<tr><td style="width:23.0290909090909%;">Generator</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">Selector <span style="font-family:courier;color:#993300;"><b>&lt;-</b></span> ListExpr</td><td style="width:48.84%;">// select from a lazy list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">Selector <span style="font-family:courier;color:#993300;"><b>&lt;|-</b></span> ListExpr</td><td style="width:48.84%;">// select from an overloaded list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">Selector <span style="font-family:courier;color:#993300;"><b>&lt;-:</b></span> ArrayExpr</td><td style="width:48.84%;">// select from an array</td></tr>
<tr><td style="width:23.0290909090909%;">Selector</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">BrackPattern</td><td style="width:48.84%;">// for brack patterns <span style="color:blue;"><a href="#_3.2">see 3.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">ListExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">Guard</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">BooleanExpr</td></tr>
<tr><td style="width:23.0290909090909%;">BooleanExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">ListKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// head strict list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// unboxed list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span></td><td style="width:48.84%;">// overloaded list</td></tr>
<tr><td style="width:23.0290909090909%;">SpineStrictness</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// spine strict list</td></tr>
</table><p></p>
<p style="text-align:justify;">With a list generator called a ZF-expression one can construct a list composed from elements drawn from other lists or arrays. With a <i>list generator</i>one can draw elements from lazy list. The symbol '<span style="font-family:courier;">&lt;-</span>' is used to draw elements from a lazy list, the symbol '<span style="font-family:courier;">&lt;|-</span>' can be used to draw elements from any (lazy, strict, unboxed) list. With an <i>array generator</i> (use symbol  '<span style="font-family:courier;">&lt;-:</span>') one can draw elements from any array. One can define several generators in a row separated by a comma. The last generator in such a sequence will vary first. One can also define several generators in a row separated by a '<span style="font-family:courier;">&amp;</span>'. All generators in such a sequence will vary at the same time but the drawing of elements will stop as soon of one the generators is exhausted. This construct can be used instead of the zip-functions that are commonly used. <i>Selectors</i> are simple patterns to identify parts of a graph expression. They are explained in <span style="color:blue;"><a href="#_3.6">Section 3.6</a></span>. Only those lists produced by a generator that match the specified selector are taken into account. Guards can be used as filter in the usual way.</p>
<p style="text-align:justify;">The scope of the selector variables introduced on the left-hand side of a generator is such that the variables can be used in the guards and other generators that follow. All variables introduced in this way can be used in the expression before the <span style="font-family:courier;">\\</span> (see the picture below).</p>
<div style="position: absolute;height:6.75em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 108" width="100%" height="100%">
<path d="M12.0888888888889 78L12.0888888888889 3L284.444444444444 3L284.444444444444 21L384 21L384 78 Z" fill="none" stroke="#000000"/>
<path d="M15.6444444444444 75L15.6444444444444 6L118.755555555556 6L118.755555555556 39L284.444444444444 39L284.444444444444 57L380.444444444444 57L380.444444444444 75 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">[&nbsp;expression&nbsp;\\&nbsp;&nbsp;selector&nbsp;&nbsp;&lt;-&nbsp;expression<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;guard<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;selector&nbsp;&nbsp;&lt;-&nbsp;expression<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;guard<br>
]<br></p>
<p><div style="background-color:#FFFF45";>ZF-expression:<br>expr1 yields [(0,0), (0,1), (0,2), (1,0), (1,1), (1,2), (2,0), (2,1), (2,2), (3,0), (3,1), (3,2)]<br>expr2 yields [(0,0), (1,1), (2,2)].<br>expr3 yields [(0,0), (1,0), (1,1), (2,0), (2,1), (2,2), (3,0), (3,1), (3,2), (3,3)])<br></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
expr1&nbsp;=&nbsp;[(x,y)&nbsp;\\&nbsp;x&nbsp;&lt;-&nbsp;[0..3]&nbsp;,&nbsp;y&nbsp;&lt;-&nbsp;[0..2]]<br>
expr2&nbsp;=&nbsp;[(x,y)&nbsp;\\&nbsp;x&nbsp;&lt;-&nbsp;[0..3]&nbsp;&amp;&nbsp;y&nbsp;&lt;-&nbsp;[0..2]]<br>
expr3&nbsp;=&nbsp;[(x,y)&nbsp;\\&nbsp;x&nbsp;&lt;-&nbsp;[0..3]&nbsp;,&nbsp;y&nbsp;&lt;-&nbsp;[0..x]]<br></div>
</p>
<p><div style="background-color:#FFFF45";>ZF-expression: a well-know sort.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
sort::&nbsp;[a]&nbsp;-&gt;&nbsp;[a]&nbsp;|&nbsp;Ord&nbsp;a<br>
sort&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
sort&nbsp;[p:ps]&nbsp;&nbsp;=&nbsp;sort&nbsp;[x&nbsp;\\&nbsp;x&lt;-ps&nbsp;|&nbsp;x&lt;=p]&nbsp;++&nbsp;[p]&nbsp;++&nbsp;sort&nbsp;[x&nbsp;\\&nbsp;x&lt;-ps&nbsp;|&nbsp;x&gt;p]<br></div>
</p><p><div style="background-color:#FFFF45";>ZF-expression sorting a strict (head and tail strict) list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
ssort::&nbsp;[!a!]&nbsp;-&gt;&nbsp;[!a!]&nbsp;|&nbsp;Ord&nbsp;a<br>
ssort&nbsp;[!!]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[!!]<br>
ssort&nbsp;[!p:ps!]&nbsp;&nbsp;&nbsp;=&nbsp;ssort&nbsp;[!x&nbsp;\\&nbsp;x&lt;|-ps&nbsp;|x&lt;=p!]&nbsp;++&nbsp;[!p!]&nbsp;++&nbsp;ssort&nbsp;[!x&nbsp;\\&nbsp;x&nbsp;&lt;|-ps&nbsp;|&nbsp;x&gt;p!]<br></div>
</p><p><div style="background-color:#FFFF45";>Overloaded ZF-expression sorting any list (lazy, strict or unboxed).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
gsort::&nbsp;(l&nbsp;a)&nbsp;-&gt;&nbsp;(l&nbsp;a)&nbsp;|&nbsp;Ord&nbsp;a&nbsp;&amp;&nbsp;List&nbsp;l&nbsp;a<br>
gsort&nbsp;[|]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[|]<br>
gsort&nbsp;[|p:ps]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gsort&nbsp;[|x&nbsp;\\&nbsp;x&lt;|-ps&nbsp;|&nbsp;x&lt;=p]&nbsp;++&nbsp;[|p]&nbsp;++&nbsp;gsort&nbsp;[|x&nbsp;\\&nbsp;x&nbsp;&lt;|-ps&nbsp;|&nbsp;x&gt;p]<br></div>
</p><p><div style="background-color:#FFFF45";>ZF-expression: converting an array into a list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
ArrayA&nbsp;=&nbsp;{1,2,3,4,5}<br>
<br>
ListA::&nbsp;[a]<br>
ListA&nbsp;=&nbsp;[a&nbsp;\\&nbsp;a&nbsp;&lt;-:&nbsp;ArrayA]<br></div>
</p><p style="text-align:justify;">Local definitions can be introduced in a ZF expression after generator(s) using <span style="font-family:courier;color:#993300;"><b>,</b></span> <span style="font-family:courier;color:#FF0000;"><b>let</b></span>:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Qualifier</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Generators { <span style="font-family:courier;color:#993300;"><b>,</b></span> <span style="font-family:courier;color:#FF0000;"><b>let</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span> } {<span style="font-family:courier;color:#993300;"><b>|</b></span>Guard}</td></tr>
</table><p></p>
<p style="text-align:justify;">The variables introduced in this way can be used in the guard and local definitions, other qualifiers that follow, and the expression before the <span style="font-family:courier;">\\</span>.</p>
<h3 style="background-color:#9999FF;"><a id="_4.2.2">4.2.2 List Patterns</a></h3>
<p style="text-align:justify;">An object of the predefined algebraic type <i>list</i> can be specified as pattern in a function, case expression or list generator.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ListPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind][{LGraphPattern}-list [<span style="font-family:courier;color:#993300;"><b>:</b></span> GraphPattern]] [SpineStrictness]<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">LGraphPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphPattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">CharsDenotation</td></tr>
<tr><td style="width:23.0290909090909%;">ListKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// head strict list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// unboxed head strict list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span></td><td style="width:48.84%;">// overloaded list</td></tr>
<tr><td style="width:23.0290909090909%;">SpineStrictness</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// spine strict list</td></tr>
</table><p></p>
<p style="text-align:justify;">Notice that only simple list patterns can be specified (one cannot use a dot-dot expression or list comprehension to define a list pattern).</p>
<p><div style="background-color:#FFFF45";>Use of list patterns, use of guards, use of variables to identify patterns and sub-patterns; merge merges two (sorted) lazy lists into one (sorted) list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
merge::&nbsp;[Int]&nbsp;[Int]&nbsp;-&gt;&nbsp;[Int]<br>
merge&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;=&nbsp;f<br>
merge&nbsp;[]&nbsp;s&nbsp;&nbsp;&nbsp;=&nbsp;s<br>
merge&nbsp;f=:[x:xs]&nbsp;s=:[y:ys]<br>
|&nbsp;x&lt;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[x:merge&nbsp;xs&nbsp;s]<br>
|&nbsp;x==y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;merge&nbsp;f&nbsp;ys<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;[y:merge&nbsp;f&nbsp;ys]<br></div>
</p><p><div style="background-color:#FFFF45";><span style="font-family:courier;">merge_u</span> merges two (sorted) head strict unboxed lists into one strict unboxed (sorted) list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
merge_u::&nbsp;[#Int]&nbsp;[#Int]&nbsp;-&gt;&nbsp;[#Int]<br>
merge_u&nbsp;f&nbsp;[#]&nbsp;=&nbsp;f<br>
merge_u&nbsp;[#]&nbsp;s&nbsp;=&nbsp;s<br>
merge_u&nbsp;f=:[#x:xs]&nbsp;s=:[#y:ys]<br>
|&nbsp;x&lt;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[#x:merge_u&nbsp;xs&nbsp;s]<br>
|&nbsp;x==y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;merge_u&nbsp;f&nbsp;ys<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;=&nbsp;[#y:merge_u&nbsp;f&nbsp;ys]<br></div>
</p><p><div style="background-color:#FFFF45";><span style="font-family:courier;">merge_l</span> merges two (sorted) lists into one (sorted) list. Any list (lazy, strict or unboxed) can be merged, but both lists have to be the same (both lazy, strict, head strict, tail strict or unboxed)</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
merge_l::&nbsp;(l&nbsp;a)(l&nbsp;a)&nbsp;-&gt;&nbsp;(l&nbsp;a)&nbsp;|&nbsp;List&nbsp;l&nbsp;a<br>
merge_l&nbsp;f&nbsp;[|]&nbsp;=&nbsp;f<br>
merge_l&nbsp;[|]&nbsp;s&nbsp;=&nbsp;s<br>
merge_l&nbsp;f=:[|x:xs]&nbsp;s=:[|y:ys]<br>
|&nbsp;x&lt;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[|x:merge_l&nbsp;xs&nbsp;s]<br>
|&nbsp;x==y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;merge_l&nbsp;f&nbsp;ys<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;&nbsp;=&nbsp;[|y:merge_l&nbsp;f&nbsp;ys]<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_4.3">4.3 Tuples</a></h2>
<p style="text-align:justify;">A <i>tuple</i> is an algebraic data type predefined for reasons of programming convenience and efficiency. Tuples have as advantage that they allow bundling a <i>finite number</i> of objects of <i>arbitrary type</i> into a new object without being forced to define a new algebraic type for such a new object. This is in particular handy for functions that return several values.</p>
<h3 style="background-color:#9999FF;"><a id="_4.3.1">4.3.1 Creating Tuples</a></h3>
<p style="text-align:justify;"><i>Tuples</i> can be created that can be used to combine different (sub-)graphs into one data structure without being forced to define a new type for this combination. The elements of a tuple need <i>not</i> be of the same type. Tuples are in particular handy for functions that return multiple results.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Tuple</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphExpr<span style="font-family:courier;color:#993300;"><b>,</b></span>{GraphExpr}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of a Tuple of type <span style="font-family:courier;">(String,Int,[Char])</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
("this&nbsp;is&nbsp;a&nbsp;tuple&nbsp;with",3,['elements'])<br></div>
</p><p style="text-align:justify;">One can turn a lazy tuple element into a strict one by putting strictness annotations in the corresponding type instance on the tuple elements that one would like to make strict. When the corresponding tuple is put into a strict context the tuple and the strict annotated tuple elements will be evaluated. As usual one has to take care that these elements do not represent an infinite computation.</p>
<p style="text-align:justify;">Strict and lazy tuples are regarded to be of different type. <i>However, unlike is the case with any other data structure, the compiler will automatically convert strict tuples into lazy ones, and the other way around.</i> This is done for programming convenience. Due to the complexity of this automatic transformation, the conversion is done for tuples only! For the programmer it means that he can freely mix tuples with strict and lazy tuple elements. The type system will not complain when a strict tuple is offered while a lazy tuple is required. The compiler will automatically insert code to convert non-strict tuple elements into a strict version and backwards whenever this is needed.</p>
<p><div style="background-color:#FFFF45";>Example of a complex number as tuple type with strict components.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Complex&nbsp;:==&nbsp;(!Real,!Real)<br>
<br>
(+)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;!Complex&nbsp;!Complex&nbsp;-&gt;&nbsp;Complex<br>
(+)&nbsp;(r1,i1)&nbsp;(r2,i2)&nbsp;=&nbsp;(r1+r2,i1+i2)<br>
<br></div>
<div style="background-color:#FFFF45";>which is equivalent to</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(+)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;!(!Real,!Real)&nbsp;!(!Real,!Real)&nbsp;-&gt;&nbsp;(!Real,!Real)<br>
(+)&nbsp;(r1,i1)&nbsp;(r2,i2)&nbsp;=&nbsp;(r1+r2,i1+i2)<br>
<br></div>
<div style="background-color:#FFFF45";>when for instance G is defined as</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
G::&nbsp;Int&nbsp;-&gt;&nbsp;(Real,Real)<br>
<br></div>
<div style="background-color:#FFFF45";>than the following application is approved by the type system:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Start&nbsp;=&nbsp;G&nbsp;1&nbsp;+&nbsp;G<br>
<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_4.3.2">4.3.2 Tuple Patterns</a></h3>
<p style="text-align:justify;">An object of the predefined algebraic type <i>tuple</i> can be specified as pattern in a function, case expression or list generator.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TuplePattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">(GraphPattern,{GraphPattern}-list)</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of the use of a pattern match on Tuples to access components of a Complex number.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;complex&nbsp;:==&nbsp;(Real,Real)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;complex&nbsp;is&nbsp;defined&nbsp;as&nbsp;type&nbsp;synonym&nbsp;for&nbsp;(real,Real)</span><br>
<br>
realpart::&nbsp;Complex&nbsp;-&gt;&nbsp;Real<br>
realpart&nbsp;(re,_)&nbsp;=&nbsp;re&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;selecting&nbsp;the&nbsp;real&nbsp;part&nbsp;of&nbsp;a&nbsp;Complex&nbsp;number</span><br>
<br>
imagpart::&nbsp;Complex&nbsp;-&gt;&nbsp;Real<br>
imagpart&nbsp;(_,im)&nbsp;=&nbsp;im&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;selecting&nbsp;the&nbsp;imaginary&nbsp;part&nbsp;of&nbsp;a&nbsp;Complex&nbsp;number</span><br></div>
</p><h2 style="background-color:#9999FF;"><a id="_4.4">4.4 Arrays</a></h2>
<p style="text-align:justify;">An <i>array</i> is an algebraic data type predefined for reasons of efficiency. Arrays contain a <i>finite number</i> of elements that all have to be of the <i>same type</i>. An array has as property that its elements can be accessed via <i>indexing</i> in <i>constant time</i>. An <i>array index</i> must be an integer value between <span style="font-family:courier;">0</span> and the number of elements of the array-<span style="font-family:courier;">1</span>. Destructive update of array elements is possible thanks to uniqueness typing. For programming convenience special syntax is provided for the creation, selection and updating of array elements (array comprehensions) while there is also special syntax for <i>strings</i> (i.e. unboxed arrays of characters). Arrays have as disadvantage that their use increases the possibility of a runtime error (indices that might get out-of-range).</p>
<p style="text-align:justify;">To obtain optimal efficiency in time and space, arrays are implemented different depending on the concrete type of the array elements. By default an array is implemented as a <i>lazy array</i> (type <span style="font-family:courier;">{a}</span>), i.e. an array consists of a contiguous block of memory containing pointers to the array elements. The same representation is chosen if <i>strict arrays</i> (define its type as <span style="font-family:courier;">{!a})</span> are being used. The difference is that <i>all</i> elements of a strict array will be evaluated if the array is evaluated. It makes no sense to make a distinction between head strictness and tail strictness for arrays as is the case for lists. As usual one has to take care that the strict elements do not represent an infinite computation.</p>
<p style="text-align:justify;">For elements of basic type, record type and tuple type an <i>unboxed array</i> (define its type as <span style="font-family:courier;">{#a}</span>) can be used. In that latter case the pointers are replaced by the array elements themselves. Lazy, strict and unboxed arrays are considered  to be objects of different type. However, most predefined operations on arrays are overloaded such that they can be used on lazy, on strict as well as on unboxed arrays.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrayType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>{</b></span>[ArrayKind] Type<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ArrayKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// strict array</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// unboxed array</td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_4.4.1">4.4.1 Creating Arrays and Selection of field Elements</a></h3>
<p style="text-align:justify;">An <i>array</i> is a tuple/record-like data structure in which <i>all</i> elements are of the <i>same type</i>. Instead of selection by position or field name the elements of an array can be selected very efficiently in <i>constant time</i> by indexing. The update of arrays is done destructively in CLEAN and therefore arrays have to be unique (<span style="color:blue;"><a href="#_9">see Chapter 9</a></span>) if one wants to use this feature. Arrays are very useful if time and space consumption is becoming very critical (CLEAN arrays are implemented very efficiently). If efficiency is not a big issue we recommend <i>not</i> to use arrays but to use lists instead: lists induce a much better programming style. Lists are more flexible and less error prone: array elements can only be accessed via indices and if you make a calculation error, indices may point outside the array bounds. This is detected, but only at run-time. In CLEAN, array indices always start with 0. More dimensional arrays (e.g. a matrix) can be defined as an array of arrays.</p>
<p style="text-align:justify;">For efficiency reasons, arrays are available of several types: there are <i>lazy arrays</i> (type <span style="font-family:courier;">{a}</span>), <i>strict arrays</i> (type <span style="font-family:courier;">{!a}</span>) and <i>unboxed arrays</i> (e.g. type<span style="font-family:courier;">{#Int}</span>). All these arrays are considered to be of <i>different</i> type. By using the overloading mechanism (type constructor classes) one can still define (overloaded) functions that work on any of these arrays.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Array</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">ArrayDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ArrayUpdate</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ArrayComprehension</td></tr>
</table><p></p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All elements of an array need to be of same type.</td></tr>
</table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSimple Array</h3>
<p style="text-align:justify;">A new array can be created in a number of ways. A direct way is to simply <i>list</i> the <i>array elements</i>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrayDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[ArrayKind] {GraphExpr}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">StringDenotation</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">StringDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">StringDel{AnyChar/StringDel}StringDel</td></tr>
<tr><td style="width:23.0290909090909%;">StrignDel</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>"</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">By default this array denotation is overloaded. The type determines whether a lazy, strict or unboxed array is created. The created array is <i>unique</i> (the <span style="font-family:courier;">*</span> or <span style="font-family:courier;">.</span> attribute in front of the type, <span style="color:blue;"><a href="#_9">see Chapter 9</a></span>) to make destructive updates possible.</p>
<p style="text-align:justify;">A lazy array is a box with pointers pointing to the array elements. One can also create a strict array by adding a <span style="font-family:courier;">!</span> after <span style="font-family:courier;">{</span> (or explicitly define its type as <span style="font-family:courier;">{!Int}</span>), which will have the property that the elements to which the array box points will always be evaluated. One can furthermore create an unboxed array by adding a <span style="font-family:courier;">#</span> (or explicitly define its type as <span style="font-family:courier;">{#Int}</span>), which will have the property that the evaluated elements (which have to be of basic value) are stored directly in the array box itself. Clearly the last one is the most efficient representation (<span style="color:blue;"><a href="#_10">see also Chapter 10</a></span>).</p>
<p><div style="background-color:#FFFF45";>Creating a lazy array, strict and unboxed unique array of integers with elements 1,3,5,7,9.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MyLazyArray::&nbsp;.{Int}<br>
MyLazyArray&nbsp;=&nbsp;{1,3,5,7,9}&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;overloaded&nbsp;array&nbsp;denotation</span><br>
<br>
MyStrictArray::&nbsp;.{!Int}<br>
MyStrictArray&nbsp;=&nbsp;{!1,3,5,7,9}<br>
<br>
MyUnboxedArray::&nbsp;.{#Int}<br>
MyUnboxedArray&nbsp;=&nbsp;{#1,3,5,7,9}<br></div>
</p><p><div style="background-color:#FFFF45";>Creating a two dimensional array, in this case a unique array of unique arrays of unboxed integers.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MatrixA::&nbsp;{.{#Int}}<br>
MatrixA&nbsp;=&nbsp;{{1,2,3,4},{5,6,7,8}}<br></div>
</p><p style="text-align:justify;">To make it possible to use operators such as array selection on any of these arrays (of actually different type) a multi parameter type constructor class has been defined (in <span style="font-family:courier;">StdArray</span>) which expresses that "some kind of array structure is created". The compiler will therefore deduce the following general type:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Array&nbsp;::&nbsp;.(a&nbsp;Int)|&nbsp;Array&nbsp;a&nbsp;Int<br>
Array&nbsp;=&nbsp;{1,3,5,7,9}<br></p>
</p>
<p style="text-align:justify;">A <i>string</i> is predefined type which equivalent to an <i>unboxed array of characters</i> <span style="font-family:courier;">{#Char}</span>. Notice that this array is <i>not</i> unique, such that a destructive update of a string is <i>not</i> allowed. There is special syntax to denote strings.</p>
<p><div style="background-color:#FFFF45";>Some ways to define a string, i.e. an unboxed array of character.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
"abc"<br>
{'a','b','c'}<br></div>
</p><p style="text-align:justify;">There are a number of handy functions for the creation and manipulation of arrays predefined in CLEAN 's Standard Environment. These functions are overloaded to be able to deal with any type of array. The class restrictions for these functions express that "an array structure is required" containing "an array element".</p>
<p><div style="background-color:#FFFF45";>Type of some predefined functions on <span style="font-family:courier;">Arrays</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
createArray&nbsp;&nbsp;::&nbsp;!Int&nbsp;e&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;size&nbsp;arg1,&nbsp;a.[i]&nbsp;=&nbsp;arg2</span><br>
size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(a&nbsp;e)&nbsp;-&gt;&nbsp;Int&nbsp;|&nbsp;Array&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;number&nbsp;of&nbsp;elements&nbsp;in&nbsp;array</span><br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspArray Update and Array Comprehensions</h3>
<p style="text-align:justify;">It is also possible to construct a new array out of an existing one (a <i>functional array update</i>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrayUpdate</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span> ArrayExpr <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {ArrayIndex {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ArrayComprehension</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[ArrayKind] GraphExpr <span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Selection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
</table><p></p>
<p style="text-align:justify;">Left from the <span style="font-family:courier;">&amp; (a &amp; [i] = v</span> is pronounced as: array <span style="font-family:courier;">a</span> with for <span style="font-family:courier;">a.[i]</span> the value <span style="font-family:courier;">v</span>. The old array has to be specified which has to be of unique type to make destructive updating possible. On the right from the <span style="font-family:courier;">&amp;</span> those array elements are listed in which the new array differs from the old one. One can change any element of the array or any field or array element of a record or array stored in the array. The <span style="font-family:courier;">&amp;</span>-operator is strict in its arguments.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An array expression must be of type array.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The array expression to the left of the update operator '<span style="font-family:courier;">&amp;</span>' should yield an object of type unique array.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An array index must be an integer value between <span style="font-family:courier;">0</span> and the number of elements of the array-<span style="font-family:courier;">1</span>. An index out of this range will result in a <i>run-time</i> error.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Unboxed arrays can only be of basic type, record type or array type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>A unique array of any type created by an overloaded function cannot be converted to a non-unique array.</i></td></tr>
</table>
<p style="text-align:justify;"><i>Important</i>: For reasons of efficiency we have defined the updates only on arrays which are of <i>unique</i> type (<span style="font-family:courier;">*{..}</span>), such that the update can always be done <i>destructively</i> (!) which is semantically sound because the original unique array is known not to be used anymore.</p>
<p><div style="background-color:#FFFF45";>Creating an array with the integer elements 1,3,5,7,9 using the update operator.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
{CreateArray&nbsp;5&nbsp;0&nbsp;&amp;&nbsp;[0]&nbsp;=&nbsp;1,&nbsp;[1]&nbsp;=&nbsp;3,&nbsp;[2]&nbsp;=&nbsp;5,&nbsp;[3]&nbsp;=&nbsp;7,&nbsp;[4]&nbsp;=&nbsp;9}<br>
{CreateArray&nbsp;5&nbsp;0&nbsp;&amp;&nbsp;[1]&nbsp;=&nbsp;3,&nbsp;[0]&nbsp;=&nbsp;1,&nbsp;[3]&nbsp;=&nbsp;7,&nbsp;[4]&nbsp;=&nbsp;9,&nbsp;[2]&nbsp;=&nbsp;5}<br></div>
</p><p style="text-align:justify;">One can use an <i>array comprehension</i> to list these elements compactly in the same spirit as with a list comprehension (<span style="color:blue;"><a href="#_4.2.1">see 4.2.1</a></span>).</p>
<p style="text-align:justify;">Array comprehensions can be used in combination with the update operator. Used in combination with the update operator the original uniquely typed array is updated destructively. The combination of array comprehensions and update operator makes it possible to selectively update array elements on a high level of abstraction.</p>
<p><div style="background-color:#FFFF45";>Creating an array with the integer elements 1,3,5,7,9 using the update operator in combination with array and list comprehensions.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
{CreateArray&nbsp;5&nbsp;0&nbsp;&amp;&nbsp;[i]&nbsp;=&nbsp;2*i+1&nbsp;\\&nbsp;i&nbsp;&lt;-&nbsp;[0..4]}<br>
{CreateArray&nbsp;5&nbsp;0&nbsp;&amp;&nbsp;[i]&nbsp;=&nbsp;elem&nbsp;\\&nbsp;elem&nbsp;&lt;-:&nbsp;{1,3,5,7,9}&nbsp;&amp;&nbsp;i&nbsp;&lt;-&nbsp;[0..4]}<br>
{CreateArray&nbsp;5&nbsp;0&nbsp;&amp;&nbsp;elem&nbsp;\\&nbsp;elem&nbsp;&lt;-:&nbsp;{1,3,5,7,9}}<br></div>
</p><p style="text-align:justify;">Array comprehensions used without update operator automatically generate a whole new array. The size of this new array will be equal to the size of the first array or list generator from which elements are drawn. Drawn elements that are rejected by a corresponding guard result in an undefined array element on the corresponding position.</p>
<p><div style="background-color:#FFFF45";>Creating an array with the integer elements 1,3,5,7,9 using array and list comprehensions.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
{elem&nbsp;\\&nbsp;elem&nbsp;&lt;-:&nbsp;{1,3,5,7,9}}<br>
{elem&nbsp;\\&nbsp;elem&nbsp;&lt;-&nbsp;&nbsp;[1,3,5,7,9]}<br></div>
</p><p><div style="background-color:#FFFF45";>Array creation, selection, update). The most general types have been defined. One can of course always restrict to a more specific type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MkArray::&nbsp;!Int&nbsp;(Int&nbsp;-&gt;&nbsp;e)&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
MkArray&nbsp;i&nbsp;f&nbsp;=&nbsp;{f&nbsp;j&nbsp;\\&nbsp;j&nbsp;&lt;-&nbsp;[0..i-1]}<br>
<br>
SetArray::&nbsp;*(a&nbsp;e)&nbsp;Int&nbsp;e&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
SetArray&nbsp;a&nbsp;i&nbsp;v&nbsp;=&nbsp;{a&nbsp;&amp;&nbsp;[i]&nbsp;=&nbsp;v}<br>
<br>
CA::&nbsp;Int&nbsp;e&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
CA&nbsp;i&nbsp;e&nbsp;=&nbsp;createArray&nbsp;i&nbsp;e<br>
<br>
InvPerm::&nbsp;{Int}&nbsp;-&gt;.{Int}<br>
InvPerm&nbsp;a&nbsp;=&nbsp;{CA&nbsp;(size&nbsp;a)&nbsp;0&nbsp;&amp;&nbsp;[a.[i]]&nbsp;=&nbsp;i&nbsp;\\&nbsp;i&nbsp;&lt;-&nbsp;[0..maxindex&nbsp;a]}<br>
<br>
ScaleArray::&nbsp;e&nbsp;(a&nbsp;e)&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e&nbsp;&amp;&nbsp;Arith&nbsp;e<br>
ScaleArray&nbsp;x&nbsp;a&nbsp;=&nbsp;{x&nbsp;*&nbsp;e&nbsp;\\&nbsp;e&nbsp;&lt;-:&nbsp;a}<br>
<br>
MapArray::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(ar&nbsp;a)&nbsp;-&gt;.(ar&nbsp;b)&nbsp;|&nbsp;Array&nbsp;ar&nbsp;a&nbsp;&amp;&nbsp;Array&nbsp;ar&nbsp;b<br>
MapArray&nbsp;f&nbsp;a&nbsp;=&nbsp;{f&nbsp;e&nbsp;\\&nbsp;e&nbsp;&lt;-:&nbsp;a}<br>
<br>
inner::&nbsp;(a&nbsp;e)&nbsp;(a&nbsp;e)&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e&nbsp;&amp;&nbsp;Arith&nbsp;e<br>
inner&nbsp;v&nbsp;w<br>
|&nbsp;size&nbsp;v&nbsp;==&nbsp;size&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;{vi&nbsp;*&nbsp;wi&nbsp;\\&nbsp;vi&nbsp;&lt;-:&nbsp;v&nbsp;&amp;&nbsp;wi&nbsp;&lt;-:&nbsp;w}<br>
|&nbsp;otherwise&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"cannot&nbsp;take&nbsp;inner&nbsp;product"<br>
<br>
ToArray::&nbsp;[e]&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
ToArray&nbsp;list&nbsp;=&nbsp;{e&nbsp;\\&nbsp;e&nbsp;&lt;-&nbsp;list}<br>
<br>
ToList::&nbsp;(a&nbsp;e)&nbsp;-&gt;.[e]&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
ToList&nbsp;array&nbsp;=&nbsp;[e&nbsp;\\&nbsp;e&nbsp;&lt;-:&nbsp;array]<br></div>
</p><p><div style="background-color:#FFFF45";>Example of operations on 2 dimensional arrays generating new arrays.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
maxindex&nbsp;n&nbsp;:==&nbsp;size&nbsp;n&nbsp;-&nbsp;1<br>
<br>
Adj::&nbsp;{{#Int}}&nbsp;-&gt;.{.{#Int}}<br>
Adj&nbsp;ma&nbsp;=&nbsp;{{ma.[i,j]&nbsp;\\&nbsp;i&nbsp;&lt;-&nbsp;rowindex}&nbsp;\\&nbsp;j&nbsp;&lt;-&nbsp;colindex}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;rowindex&nbsp;=&nbsp;[0..maxindex&nbsp;ma]<br>
&nbsp;&nbsp;&nbsp;&nbsp;colindex&nbsp;=&nbsp;[0..maxindex&nbsp;ma.[0]]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Multiply::&nbsp;{{#Int}}&nbsp;{{#Int}}&nbsp;-&gt;.{.{#Int}}<br>
&nbsp;&nbsp;&nbsp;&nbsp;Multiply&nbsp;a&nbsp;b&nbsp;=&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;{sum&nbsp;[a.[i,j]*b.[j,k]&nbsp;\\&nbsp;j&nbsp;&lt;-&nbsp;colindex]&nbsp;\\&nbsp;k&nbsp;&lt;-&nbsp;rowindex}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;i&nbsp;&lt;-&nbsp;rowindex<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rowindex&nbsp;=&nbsp;[0..maxindex&nbsp;a]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colindex&nbsp;=&nbsp;[0..maxindex&nbsp;a.[0]]<br></div>
</p><p><div style="background-color:#FFFF45";>Updating unique arrays using a unique array selection.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MyArray::&nbsp;.{#Real}<br>
MyArray&nbsp;=&nbsp;{1.5,2.3,3.4}<br>
<br>
ScaleArrayElem::&nbsp;*{#Real}&nbsp;Int&nbsp;Real&nbsp;-&gt;&nbsp;.{#Real}<br>
ScaleArrayElem&nbsp;ar&nbsp;i&nbsp;factor<br>
#&nbsp;(elem,ar)&nbsp;=&nbsp;ar![i]<br>
=&nbsp;{ar&nbsp;&amp;&nbsp;[i]&nbsp;=&nbsp;elem*factor}<br>
<br>
Scale2DArrayElem::&nbsp;{*{#Real}}&nbsp;(Int,Int)&nbsp;Real&nbsp;-&gt;&nbsp;{.{#Real}}<br>
Scale2DArrayElem&nbsp;ar&nbsp;(i,j)&nbsp;factor<br>
#&nbsp;(elem,ar)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ar![i].[j]<br>
=&nbsp;{ar&nbsp;&amp;&nbsp;[i].[j]&nbsp;&nbsp;&nbsp;=&nbsp;elem*factor}<br>
<br>
Scale2DArrayElem2::&nbsp;{*{#Real}}&nbsp;(Int,Int)&nbsp;Real&nbsp;-&gt;&nbsp;{.{#Real}}<br>
Scale2DArrayElem2&nbsp;ar&nbsp;(i,j)&nbsp;factor<br>
#&nbsp;(elem,ar)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ar![i,j]<br>
=&nbsp;{ar&nbsp;&amp;&nbsp;[i,j]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;elem*factor}<br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp# with Array Update</h3>
<p style="text-align:justify;"><span style="font-family:courier;">variable = {variable &amp; </span>updates<span style="font-family:courier;">}</span> after <span style="font-family:courier;">#</span> or <span style="font-family:courier;">#!</span> can be abbreviated to <span style="font-family:courier;">variable &amp; </span>updates, by omitting <span style="font-family:courier;">= {variable</span> and <span style="font-family:courier;">}</span>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:76.4981818181818%;">Variable <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {ArrayIndex {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">For example</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">#&nbsp;a&nbsp;&amp;&nbsp;[i]&nbsp;=&nbsp;x<br><div style="background-color:#FFFF45";>instead of</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">#&nbsp;a&nbsp;=&nbsp;{a&nbsp;&amp;&nbsp;[i]&nbsp;=&nbsp;x}<br></div>
</p><p style="text-align:justify;">Multiple indices and fields are also possible, for example: (for record updates <span style="color:blue;"><a href="#_5.2.1">see 5.2.1 below</a></span>)</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">#&nbsp;r&nbsp;&amp;&nbsp;a.[i].x&nbsp;=&nbsp;y<br><div style="background-color:#FFFF45";>instead of</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">#&nbsp;r&nbsp;=&nbsp;{r&nbsp;&amp;&nbsp;a.[i].x&nbsp;=&nbsp;y}<br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSelection of an Array Element</h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArraySelection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"> ArrayExpr<span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[ArrayExpr<span style="font-family:courier;color:#993300;"><b>!</b></span>ArrayIndex {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayIndex</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>[</b></span>{IntegerExpr}-list<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">IntegerExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">Selection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex</td></tr>
</table><p></p>
<p style="text-align:justify;">With an <i>array selection</i> (using the '<span style="font-family:courier;">.</span>' symbol) one can select an array element. When an object <span style="font-family:courier;">a</span> is of type <span style="font-family:courier;">Array</span>, the <span style="font-family:courier;">i</span>th element can be selected (computed) via <span style="font-family:courier;">a.[i]</span>. Array selection is left-associative: <span style="font-family:courier;">a.[i,j,k]</span> means <span style="font-family:courier;">((a.[i]).[j]).[k]</span>. A "unique" selection using the '<span style="font-family:courier;">!</span>' symbol returns a tuple containing the demanded array element and the original array. This type of array selection can be very handy for destructively updating of uniquely typed arrays with values that depend on the current contents of the array. Array selection binds more tightly (priority <span style="font-family:courier;">11</span>) than application (priority <span style="font-family:courier;">10</span>).</p>
<h3 style="background-color:#9999FF;"><a id="_4.4.2">4.4.2 Array Patterns</a></h3>
<p style="text-align:justify;">An object of type <i>array</i> can be specified as pattern. Notice that only simple array patterns can be specified on the left-hand side (one cannot use array comprehensions). Only those array elements which contents one would like to use in the right-hand side need to be mentioned in the pattern.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All array elements of an array need to be of same type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An array index must be an integer value between <span style="font-family:courier;">0</span> and the number of elements of the array-<span style="font-family:courier;">1</span>. Accessing an array with an index out of this range will result in a <i>run-time</i> error.</td></tr>
</table>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrayPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>{GraphPattern}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>{ArrayIndex <span style="font-family:courier;color:#993300;"><b>=</b></span> Variable}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">StringDenotation</td></tr>
</table><p></p>
<p style="text-align:justify;">It is allowed in the pattern to use an index expression in terms of the other formal arguments (of type <span style="font-family:courier;">Int</span>) passed to the function to make a flexible array access possible.</p>
<p><div style="background-color:#FFFF45";>Use of array patterns.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Swap::&nbsp;!Int&nbsp;!Int&nbsp;!*(a&nbsp;e)&nbsp;-&gt;.(a&nbsp;e)&nbsp;|&nbsp;Array&nbsp;a&nbsp;e<br>
Swap&nbsp;i&nbsp;j&nbsp;a=:{[i]=ai,[j]=aj}&nbsp;=&nbsp;{a&nbsp;&amp;&nbsp;[i]=aj,[j]=ai}<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_4.5">4.5 Predefined Type Constructors</a></h2>
<p style="text-align:justify;">Predefined types can also be used in curried way. To make this possible a type constructor has been predefined for all predefined types of higher order kind (<span style="color:blue;"><a href="#_5.1.2">see also 5.1.2</a></span>). The kind <span style="font-family:courier;">X</span> stands for any so-called <i>first-order</i> type: a type expecting no further arguments ((<span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Bool</span>, <span style="font-family:courier;">[Int]</span>, etcetera). All function arguments are of kind <span style="font-family:courier;">X</span><span style="font-family:courier;">. The kind </span><span style="font-family:courier;">X -&gt; X</span>stands for a type that can be applied to a (first-order) type, which then yields another first-order type, <span style="font-family:courier;">X -&gt; X -&gt; X</span> expects two type arguments, and so on.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Int,&nbsp;Bool,&nbsp;[Int],&nbsp;Tree&nbsp;[Int]&nbsp;&nbsp;&nbsp;::&nbsp;X<br>
[],&nbsp;Tree,&nbsp;(,)&nbsp;Int,&nbsp;(-&gt;)&nbsp;a,&nbsp;{}&nbsp;&nbsp;::&nbsp;X&nbsp;-&gt;&nbsp;X<br>
(,),&nbsp;(-&gt;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;X&nbsp;-&gt;&nbsp;X&nbsp;-&gt;&nbsp;X<br>
(,,)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;X&nbsp;-&gt;&nbsp;X&nbsp;-&gt;&nbsp;X&nbsp;-&gt;&nbsp;X<br></p>
</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PredefinedTypeConstructor</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[]</b></span></td><td style="width:48.84%;">// list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[! ]</b></span></td><td style="width:48.84%;">// head strict list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[ !]</b></span></td><td style="width:48.84%;">// tail strict list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[!!]</b></span></td><td style="width:48.84%;">// strict list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[#]</b></span></td><td style="width:48.84%;">// unboxed head strict list type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[#!]</b></span></td><td style="width:48.84%;">// unboxed strict list type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>{<span style="font-family:courier;color:#993300;"><b>,</b></span>}+<span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:48.84%;">// tuple type constructor (arity &gt;= 2)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{}</b></span></td><td style="width:48.84%;">// lazy array type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{!}</b></span></td><td style="width:48.84%;">// strict array type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{#}</b></span></td><td style="width:48.84%;">// unboxed array type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>(-&gt;)</b></span></td><td style="width:48.84%;">// arrow type constructor</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>So, all predefined types can be written down in prefix notation as well, as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">[]&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;[a]<br>
[!&nbsp;]&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;[!a]<br>
[&nbsp;!]&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;[a!]<br>
[!!]&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;[!a!]<br>
[#&nbsp;]&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;[#a]<br>
[#!]&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;[#a!]<br>
(,)&nbsp;a&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;(a,b)<br>
(,,)&nbsp;a&nbsp;b&nbsp;c&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;(a,b,c)&nbsp;and&nbsp;so&nbsp;on&nbsp;for&nbsp;n-tuples<br>
{}&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;{a}<br>
{!}&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;{!a}<br>
{#}&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;{#a}<br>
(-&gt;)&nbsp;a&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;equivalent&nbsp;with&nbsp;(a&nbsp;-&gt;&nbsp;b)<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_4.6">4.6 Arrow Types</a></h2>
<p style="text-align:justify;">The <i>arrow type</i> is a predefined type constructor used to indicate <i>function objects</i>(these functions have at least arity one). One can use the Cartesian product (uncurried version) to denote the function type (<span style="color:blue;"><a href="#_3.7">see 3.7</a></span>) to obtain a compact notation. Curried functions applications and types are automatically converted to their uncurried equivalent versions.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrowType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>Type <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> Type<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of an arrow type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
((a&nbsp;b&nbsp;-&gt;&nbsp;c)&nbsp;[a]&nbsp;[b]&nbsp;-&gt;&nbsp;[c])<br>
<br></div>
<div style="background-color:#FFFF45";>being equivalent with:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
((a&nbsp;-&gt;&nbsp;b&nbsp;-&gt;&nbsp;c)&nbsp;-&gt;&nbsp;[a]&nbsp;-&gt;&nbsp;[b]&nbsp;-&gt;&nbsp;[c])<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_4.7">4.7 Predefined Abstract Types</a></h2>
<p style="text-align:justify;"><i>Abstract data types</i> are types of which the actual definition is hidden (<span style="color:blue;"><a href="#_5.4">see 5.4</a></span>). In CLEAN the types <span style="font-family:courier;">World</span> and <span style="font-family:courier;">File</span> are <i>predefined abstract data types</i>. They are recognised by the compiler and treated specially, either for efficiency or because they play a special role in the language. Since the actual definition is hidden it is not possible to denotate constant values of these predefined abstract types. There are functions predefined in the CLEAN library for the creation and manipulation of these predefined abstract data types. Some functions work (only) on unique objects.</p>
<p style="text-align:justify;">An object of type <span style="font-family:courier;">*World</span> (<span style="font-family:courier;">*</span> indicates that the world is unique) is automatically created when a program is started. This object is optionally given as argument to the <span style="font-family:courier;">Start</span> function  (<span style="color:blue;"><a href="#_2.3">see 2.3</a></span>). With this object efficient interfacing with the outside world (which is indeed unique) is possible.</p>
<p style="text-align:justify;">An object of type <span style="font-family:courier;">File</span> or <span style="font-family:courier;">*File</span> (unique <span style="font-family:courier;">File</span>) can be created by means of the functions defined in <span style="font-family:courier;">StdFileIO</span> (see CLEANs Standard Library). It makes direct manipulation of persistent data possible. The type <span style="font-family:courier;">File</span> is predefined for reasons of efficiency: CLEAN <span style="font-family:courier;">Files</span> are directly coupled to concrete files.</p>
<p style="text-align:justify;">The type String is a predefined synonym type that is predefined for convenience. The type is synonym for an unboxed array of characters <span style="font-family:courier;">{#Char}</span>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PredefType</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>World</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdWorld.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>File</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdFileIO.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>String</b></span></td><td style="width:48.84%;">// synonym for {#Char}</td></tr>
</table><p></p>
<!-- chapter:Chapter 5-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_5"><br>Chapter 5<br><br>Defining New Types</a></h1></div>
<p style="text-align:justify;">CLEAN is a strongly typed language: every object (graph) and function (graph rewrite rule) in CLEAN has a type. The basic type system of CLEAN is based on the classical polymorphic Milner/Hindley/Mycroft (Milner  1978; Hindley 1969, Mycroft, 1984) type system. This type system is adapted for graph rewriting systems and extended with <i>basic types</i>, (possibly <i>existentially and universally quantified</i>) <i>algebraic types</i>, <i>record types</i>, <i>abstract types</i> and <i>synonym types</i>.</p>
<p style="text-align:justify;">New types can be defined in an implementation as well as in a definition module. Types can <i>only</i> be defined on the global level. Abstract types can only be defined in a definition module hiding the actual implementation in the corresponding implementation module.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">AlgebraicTypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.1">see 5.1</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">RecordTypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.2">see 5.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">SynonymTypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.3">see 5.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">AbstractTypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_5.4">see 5.4</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">AbstractSynonymTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">ExtensibleAlgebraicTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">AlgebraicTypeDefExtension</td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_5.1">5.1 Defining Algebraic Data Types</a></h2>
<p style="text-align:justify;">With an algebraic data type one assigns a new type constructor (a new type) to a newly introduced data structure. The data structure consists of a new constant value (called the data constructor) that can have zero or more arguments (of any type). Every data constructor must unambiguously have been (pre) defined in an algebraic data type definition  Several data constructors can be introduced in one algebraic data type definition which makes it possible to define alternative data structures of the same algebraic data type. The data constructors can, just like functions, be used in a curried way. Also type constructors can be used in a curried way, albeit only in the type world of course.</p>
<p style="text-align:justify;">Polymorphic algebraic data types can be defined by adding (possibly existentially or universally quantified, see below) type variables to the type constructors on the left-hand side of the algebraic data type definition. The arguments of the data constructor in a type definition are type instances of types (that are defined or are being defined).</p>
<p style="text-align:justify;">Types can be preceded by uniqueness type attributes (<span style="color:blue;"><a href="#_9">see Chapter 9</a></span>). The arguments of a defined data constructor can optionally be annotated as being strict (<span style="color:blue;"><a href="#_5.1.5">see 5.1.5</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:9.05454545454545%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs</td><td style="width:66.8545454545455%;"><span style="font-family:courier;color:#993300;"><b>=</b></span> ConstructorDef</td></tr>
<tr><td style="width:33.1454545454545%px'" colspan="3"></td><td style="width:66.8545454545455%;">{<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeLhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#993300;"><b>*</b></span>] TypeConstructor {TypeVariable}</td></tr>
<tr><td style="width:23.0290909090909%;">TypeConstructor</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeName</span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[ExistentalQuantVariables] <span style="font-family:courier;">ConstructorName</span> {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[ExistentalQuantVariables] (<span style="font-family:courier;">ConstructorName</span>) [Fix][Prec] {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;">Fix</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixl</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixr</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infix</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Prec</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Digit</td></tr>
<tr><td style="width:100%px'" colspan="3"></td></tr>
<tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;">ArgType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
<tr><td style="width:23.0290909090909%;">ExistentalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>E.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">UniversalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of an algebraic type definition and its use.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Day&nbsp;=&nbsp;Mon&nbsp;|&nbsp;Tue&nbsp;|&nbsp;Wed&nbsp;|&nbsp;Thu&nbsp;|&nbsp;Fri&nbsp;|&nbsp;Sat&nbsp;|&nbsp;Sun<br>
::Tree&nbsp;a&nbsp;=&nbsp;NilTree<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;NodeTree&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
<br>
MyTree::&nbsp;(Tree&nbsp;Int)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;constant&nbsp;function&nbsp;yielding&nbsp;a&nbsp;Tree&nbsp;of&nbsp;Int</span><br>
MyTree&nbsp;=&nbsp;NodeTree&nbsp;1&nbsp;NilTree&nbsp;NilTree<br></div>
</p><p style="text-align:justify;">An algebraic data type definition can be seen as the specification of a grammar in which is specified what legal data objects are of that specific type. Notice that all other CLEAN types (basic, list, tuple, array, record, abstract types) can be regarded as special cases of an algebraic type.</p>
<p style="text-align:justify;">Constructors with two arguments can be defined as <span style="font-family:courier;color:#FF0000;"><b>infix</b></span> constructor, in a similar way as function operators (with fixity (<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>, <span style="font-family:courier;color:#FF0000;"><b>infixr</b></span> or just <span style="font-family:courier;color:#FF0000;"><b>infix</b></span>, default <span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>) and precedence (<span style="font-family:courier;">0</span> through <span style="font-family:courier;">9</span>, default <span style="font-family:courier;">9</span>). If infix constructors are surrounded by brackets they can also be used in prefix position (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span> and <span style="color:blue;"><a href="#_3.4">3.4</a></span>). In a pattern match they can be written down in infix position as well.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a constructor operator is used in infix position (in an expression or in a in a pattern) <i>both</i> arguments have to be present. Constructor operators can be used in a curried way, but then they have to be used as ordinary prefix constructors (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span> and <span style="color:blue;"><a href="#_3.4">3.4</a></span>).</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Algebraic type definition and constructor pattern in function definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Tree2&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(/\)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;0&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Value&nbsp;a<br>
<br>
Mirror::&nbsp;(Tree2&nbsp;a)&nbsp;-&gt;&nbsp;Tree2&nbsp;a<br>
Mirror&nbsp;(left/\right)&nbsp;&nbsp;=&nbsp;Mirror&nbsp;right/\Mirror&nbsp;left<br>
Mirror&nbsp;leaf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;leaf<br></div>
</p><p><div style="background-color:#FFFF45";>Example of an algebraic type defining an infix data constructor and a function on this type; notice that one cannot use a '<span style="font-family:courier;">:</span>' because this character is already reserved.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::List&nbsp;a&nbsp;=&nbsp;(&lt;:&gt;)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>&nbsp;5&nbsp;a&nbsp;(List&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Nil<br>
<br>
Head::&nbsp;(List&nbsp;a)&nbsp;-&gt;&nbsp;a<br>
Head&nbsp;(x&lt;:&gt;xs)&nbsp;=&nbsp;x<br></div>
</p><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All data constructors being defined in the scope must have <i>different</i> names, to make type inferencing possible.</td></tr>
</table>
<div style="background-color:#FFFF45";>Scope of type definitions.</div>
<div style="position: absolute;height:7.875em;width:44.4444444444444em"><span><svg viewBox="0 0 711.111111111111 126" width="100%" height="100%">
<path d="M0 18 h403.2 v88.5 h-403.2 Z" fill="none" stroke="#000000"/>
<path d="M179.911111111111 52.5 h218.311111111111 v18 h-218.311111111111 Z" fill="none" stroke="#000000"/>
</svg></span></div>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><br>
<span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;XYZ<br>
<br>
::&nbsp;Type_contructor&nbsp;type_vars&nbsp;=&nbsp;expression<br>
<br>
other_definitions<br></p>
<h3 style="background-color:#9999FF;"><a id="_5.1.1">5.1.1 Using Constructors in Patterns</a></h3>
<p style="text-align:justify;">An algebraic data type can be used in a pattern. The pattern consists of the <i>data constructor</i> (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) with its optional arguments which on its turn can contain <i>sub-patterns</i>. A constructor pattern forces evaluation of the corresponding actual argument to strong root normal form since the strategy has to determine whether the actual argument indeed is equal to the specified constructor.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:27.7836363636364%;">Constructor</td><td style="width:48.1254545454545%;">// Zero arity Constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.7836363636364%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>Constructor {Pattern}<span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:48.1254545454545%;">// Constructor pattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.7836363636364%;">GraphPattern <span style="font-family:courier;">ConstructorName</span></td><td style="width:48.1254545454545%;">// Infix Constructor operator</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%px'" colspan="2">GraphPattern</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of an algebraic data type definition and its use in a pattern in function definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Nil<br>
<br>
Mirror::&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;Tree&nbsp;a<br>
Mirror&nbsp;(Node&nbsp;e&nbsp;left&nbsp;right)&nbsp;=&nbsp;Node&nbsp;e&nbsp;(Mirror&nbsp;right)&nbsp;(Mirror&nbsp;left)<br>
Mirror&nbsp;Nil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Nil<br></div>
</p><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The data constructor used in a patter must have been defined in an algebraic data type definition.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_5.1.2">5.1.2 Using Higher Order Types</a></h3>
<p style="text-align:justify;">In an algebraic type definition ordinary types can be used (such as a basic type, e.g. <span style="font-family:courier;">Int</span>, or a list type, e.g. <span style="font-family:courier;">[Int]</span>, or an instantiation of a user defined type, e.g. Tree Int), but one can also use <i>higher order types</i>. Higher order types can be constructed by curried applications of the type constructors. Higher order types can be applied in the type world in a similar way as higher order functions in the function world. The use of higher order types increases the flexibility with which algebraic types can be defined. Predefined types can also be used in curried way (<span style="color:blue;"><a href="#_4.5">see 4.5</a></span>). Higher order types play an important role in combination with type classes (<span style="color:blue;"><a href="#_6">see Chapter 6</a></span>).</p>
<p style="text-align:justify;">Of course, one needs to ensure that all types are applied in a correct way. To be able to specify the rules that indicate whether a type itself is correct, we introduce the notion of <i>kind</i>. A kind can be seen as the 'type of a type' In our case, the kind of a type expresses the number of type arguments this type may have. The kind <span style="font-family:courier;">X</span> stands for any so-called <i>first-order</i> type: a type expecting no further arguments ((<span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Bool</span>, <span style="font-family:courier;">[Int]</span>, etcetera). All function arguments are of kind <span style="font-family:courier;">X</span>. The kind <span style="font-family:courier;">X -&gt; X</span> stands for a type that can be applied to a (first-order) type, which then yields another first-order type, <span style="font-family:courier;">X -&gt; X -&gt; X</span> expects two type arguments, and so on.</p>
<p style="text-align:justify;">In CLEAN each <i>top-level</i> type should have kind <span style="font-family:courier;">X</span>. A top-level type is a type that occurs either as an argument or result type of a function or as argument type of a data constructor (in some algebraic type definition). The rule for determining the kinds of the type variables (which can be of any order) is fairly simple: The kind of a type variable directly follows from its use. If a variable has no arguments, its kind is <span style="font-family:courier;">X</span>. Otherwise its kind corresponds to the number of arguments to which the variable is applied. The kind of type variable determines its possible instantiations, i.e. it can only be instantiated with a type, which is of the same kind as the type variable itself.</p>
<p><div style="background-color:#FFFF45";>Example of an algebraic type using higher order types; the type variable <span style="font-family:courier;">t</span>in the definition of <span style="font-family:courier;">Tree2</span> s of kind <span style="font-family:courier;">X -&gt; X</span>. <span style="font-family:courier;">Tree2</span> is instantiated with a list (also of kind <span style="font-family:courier;">X -&gt; X</span>) in the definition of <span style="font-family:courier;">MyTree2</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Tree2&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;NilTree<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;NodeTree&nbsp;(t&nbsp;Int)&nbsp;(Tree2&nbsp;t)&nbsp;(Tree2&nbsp;t)<br>
<br>
MyTree2::&nbsp;Tree2&nbsp;[]<br>
MyTree2&nbsp;=&nbsp;NodeTree&nbsp;[1,2,3]&nbsp;NilTree&nbsp;NilTree<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_5.1.3">5.1.3 Defining Algebraic Data Types with Existentially Quantified Variables</a></h3>
<p style="text-align:justify;">An algebraic type definition can contain <i>existentially quantified type variable s</i> (or, for short, existential type variables) (<b>Läufer</b> 1992). These special variables are defined on the right-hand side of the type definition and are indicated by preceding them with "<span style="font-family:courier;color:#993300;"><b>E.</b></span>". Existential types are useful if one wants to create (recursive) data structures in which objects of <i>different types</i> are being stored (e.g. a list with elements of different types).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:9.05454545454545%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs</td><td style="width:66.8545454545455%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>=</b></span> ConstructorDef</td></tr>
<tr><td style="width:33.1454545454545%px'" colspan="3"></td><td style="width:66.8545454545455%px'" colspan="7">{<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] <span style="font-family:courier;">ConstructorName</span> {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] (<span style="font-family:courier;">ConstructorName</span>) [Fix][Prec] {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;">ExistentalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8"><span style="font-family:courier;color:#993300;"><b>E.</b></span>{TypeVariable}+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of the use of an existentially quantified type. In this example a record (<span style="color:blue;"><a href="#_5.2">see 5.2</a></span>) is defined containing an existentially quantified state <span style="font-family:courier;">s</span>, a method to change this state  s, and a method to convert the state <span style="font-family:courier;">s</span> into a <span style="font-family:courier;">String</span>. Notice that upon creation of the record <span style="font-family:courier;">MyObject</span> the type of the internal state and the methods defined on the state are consistent (in this case the state is of type <span style="font-family:courier;">Int</span>). The methods stored in the object <span style="font-family:courier;">Object</span> can (only) be applied on the state of that object thus enabling an object-oriented style of programming. The concrete type of the state hidden in the object is not visible from outside. To show it to the outside world one has to convert the state, which can be of any type, to an ordinary not existentially quantified type. For instance,<span style="font-family:courier;">PrintState</span> converts the any state into a <span style="font-family:courier;">String</span>. Objects that have states of different type are considered to be of the same type and can for instance be part of the same list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Object&nbsp;=&nbsp;E.s:&nbsp;{state::s,&nbsp;method::s-&gt;s,&nbsp;tostring::&nbsp;s&nbsp;-&gt;&nbsp;String&nbsp;}<br>
<br>
MyObject&nbsp;=&nbsp;&nbsp;&nbsp;{&nbsp;state&nbsp;=&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;method&nbsp;=&nbsp;(+)&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;tostring&nbsp;=&nbsp;toString<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
IncrementObject&nbsp;obj=:{method,state}&nbsp;=&nbsp;{obj&nbsp;&amp;&nbsp;state&nbsp;=&nbsp;method&nbsp;state}<br>
<br>
PrintState&nbsp;obj=:{tostring,state}&nbsp;=&nbsp;tostring&nbsp;state<br>
<br>
Start&nbsp;=&nbsp;PrintState&nbsp;(IncrementObject&nbsp;MyObject)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;4</span><br></div>
</p><p style="text-align:justify;">To ensure correctness of typing, there is a limitation imposed on the use of <i>existentially quantified data</i> structures.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Once a data structure containing existentially quantified parts is created the type of these components are forgotten. This means that, in general, if such a data structured is passed to another function it is statically impossible to determine the actual types of those components: it can be of any type. Therefore, a function having an existentially quantified data structure as input is not allowed to make specific type assumptions on the parts that correspond to the existential type variables. This implies that one can only instantiate an existential type variable with a concrete type when the object is created. In all other cases it can only be unified with a universally quantified type.</td></tr>
</table>
<p><div style="background-color:#FFFF45";><b>Counter Example</b>. Illegal use of an object with existentially quantified components.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Start&nbsp;=&nbsp;(IncrementObject&nbsp;MyObject).state<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_5.1.4">5.1.4 Defining Algebraic Data Types with Universally Quantified Variables</a></h3>
<p style="text-align:justify;">An algebraic type definition can contain <i>universally quantified type variables</i> (or, for short, universal type variables) of Rank 2 (on the argument position of a data constructor). These special variables are defined on the right-hand side of a type definition on the arguments position of the data constructor being defined and have to be preceded by an  "<span style="font-family:courier;color:#993300;"><b>A.</b></span>" (meaning: "for all"). It can be used to store polymorphic functions that work on arguments of 'any' type. The universal type is very useful for constructing dictionaries for overloaded functions (<span style="color:blue;"><a href="#_6">see Chapter 6</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:9.05454545454545%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs</td><td style="width:66.8545454545455%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>=</b></span> ConstructorDef</td></tr>
<tr><td style="width:33.1454545454545%px'" colspan="3"></td><td style="width:66.8545454545455%px'" colspan="7">{<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] <span style="font-family:courier;">ConstructorName</span> {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] (<span style="font-family:courier;">ConstructorName</span>) [Fix][Prec] {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;">ArgType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="8">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
<tr><td style="width:23.0290909090909%;">UniversalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable}+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";><b>Counter Example</b>. The following program is ill typed. Although an identity function is stored in <span style="font-family:courier;">T2</span>, <span style="font-family:courier;">T2</span> can contain any function that can be unified with <span style="font-family:courier;">b -&gt; b</span> (for instance <span style="font-family:courier;">Int -&gt; Int</span> will do). Therefore a type error is given for <span style="font-family:courier;">f2</span> since <span style="font-family:courier;">g</span> is applied to both an <span style="font-family:courier;">Int</span> and a <span style="font-family:courier;">Char</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;T2&nbsp;b&nbsp;=&nbsp;C2&nbsp;(b&nbsp;-&gt;&nbsp;b)<br>
<br>
f2::&nbsp;(T2&nbsp;b)&nbsp;-&gt;&nbsp;(Int,Char)<br>
f2&nbsp;(C2&nbsp;g)&nbsp;=&nbsp;(g&nbsp;1,&nbsp;g&nbsp;'a')<br>
<br>
Id::a&nbsp;-&gt;&nbsp;a<br>
Id&nbsp;x&nbsp;=&nbsp;x<br>
<br>
Start&nbsp;=&nbsp;f2&nbsp;(C2&nbsp;Ids)<br></div>
</p><p><div style="background-color:#FFFF45";>Example of the use of a universally quantified type. In contrast with the example above it is now specified that <span style="font-family:courier;">T</span> must contain a universally quantified function <span style="font-family:courier;">b -&gt; b</span>. The identity function <span style="font-family:courier;">Id</span> can be stored in <span style="font-family:courier;">T</span>, since its type <span style="font-family:courier;">Id::a -&gt; a</span> is actually a shorthand for <span style="font-family:courier;">Id::A.a:a -&gt; a</span>.  A function from <span style="font-family:courier;">Int -&gt; Int</span> cannot be stored in <span style="font-family:courier;">T</span> since this type is not unifiable with <span style="font-family:courier;">A.a:a -&gt; a</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">::&nbsp;T&nbsp;=&nbsp;C&nbsp;(A.b:&nbsp;b&nbsp;-&gt;&nbsp;b)<br>
<br>
f::&nbsp;(T&nbsp;b)&nbsp;-&gt;&nbsp;(Int,Char)<br>
f&nbsp;(C&nbsp;g)&nbsp;=&nbsp;(g&nbsp;1,&nbsp;g&nbsp;'a')<br>
<br>
Id::a&nbsp;-&gt;&nbsp;a<br>
Id&nbsp;x&nbsp;=&nbsp;x<br>
<br>
Start&nbsp;=&nbsp;f&nbsp;(C&nbsp;Ids)<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_5.1.5">5.1.5 Strictness Annotations in Type Definitions</a></h3>
<p style="text-align:justify;">Functional programs will generally run much more efficient when strict data structures are being used instead of lazy ones. If the inefficiency of your program becomes problematic one can think of changing lazy data structures into strict ones. This has to be done by hand in the definition of the type.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:9.05454545454545%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs</td><td style="width:66.8545454545455%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>=</b></span> ConstructorDef</td></tr>
<tr><td style="width:33.1454545454545%px'" colspan="3"></td><td style="width:66.8545454545455%px'" colspan="7">{<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] <span style="font-family:courier;">ConstructorName</span> {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] (<span style="font-family:courier;">ConstructorName</span>) [Fix][Prec] {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;">Strict</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8"><span style="font-family:courier;color:#993300;"><b>!</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">In the type definition of a constructor (in an algebraic data type definition or in a definition of a record type) the arguments of the data constructor can <i>optionally</i> be annotated as being strict. So, some arguments can be defined strict while others can be defined as being lazy. In reasoning about objects of such a type it will always be true that the annotated argument will be in strong root normal form when the object is examined. Whenever a new object is created in a strict context, the compiler will take care of the evaluation of the strict annotated arguments. When the new object is created in a lazy context, the compiler will insert code that will take care of the evaluation whenever the object is put into a strict context. If one makes a data structure strict in a certain argument, it is better not define infinite instances of such a data structure to avoid non-termination.</p>
<p style="text-align:justify;">So, in a type definition one can define a data constructor to be strict in zero or more of its arguments. Strictness is a property of data structure that is specified in its type.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In general (with the exceptions of tuples) one cannot arbitrary mix strict and non-strict data structures because they are considered to be of different type.</td></tr>
</table>
<p style="text-align:justify;">When a strict annotated argument is put in a strict context while the argument is defined in terms of another strict annotated data structure the latter is put in a strict context as well and therefore also evaluated. So, one can change the default <i>lazy semantics</i> of CLEAN into a (<i>hyper</i>) <i>strict semantics</i> as demanded. The type system will check the consistency of types and ensure that the specified strictness is maintained.</p>
<p style="text-align:justify;">There is no explicit notation for creating unboxed versions of an algebraic data type. The compiler will automatically choose the most efficient representation for a given data type. For algebraic data type definitions containing strict elements of basic type, record type and array type an unboxed representation will be chosen.</p>
<p><div style="background-color:#FFFF45";>Example: both integer values in the definition of <span style="font-family:courier;">Point</span> are strict and will be stored unboxed since they are known to be of basic type. The integer values stored in <span style="font-family:courier;">MyPoint</span> are strict as well, but will be stored unboxed since <span style="font-family:courier;">MyTuple</span> is polymorphic.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Point&nbsp;=&nbsp;(!Int,!Int)<br>
<br>
::MyTuple&nbsp;a&nbsp;=&nbsp;Pair&nbsp;!a&nbsp;!a<br>
<br>
::MyPoint&nbsp;:==&nbsp;MyTuple&nbsp;Int<br></div>
</p><p><div style="background-color:#FFFF45";>A user defined lazy list similar to type <span style="font-family:courier;">[a]</span> could be defined in algebraic type definition as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::LazyList&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;LazyCons&nbsp;a&nbsp;(LazyList&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;LazyNil<br></div>
</p><p><div style="background-color:#FFFF45";>A head strict list similar to type <span style="font-family:courier;">[!a]</span> could be defined in algebraic type definition as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::HeadSList&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;HeadSCons&nbsp;!a&nbsp;(HeadSList&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;HeadSNil<br></div>
</p><p><div style="background-color:#FFFF45";>A tail strict list similar to type <span style="font-family:courier;">[a!]</span> could be defined in algebraic type definition as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::TailSList&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;TailSCons&nbsp;a&nbsp;!(TailSList&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;TailSNil<br></div>
</p><p><div style="background-color:#FFFF45";>A strict listssimilar to type <span style="font-family:courier;">[!a!]</span> could be defined in algebraic type definition as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::StrictList&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;StrictCons&nbsp;!a&nbsp;!(StrictList&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;StrictNil<br></div>
</p><p><div style="background-color:#FFFF45";>An unboxed list similar to type <span style="font-family:courier;">[#Int]</span>could be defined in algebraic type definition as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::UnboxedIList&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;UnboxedICons&nbsp;!Int&nbsp;&nbsp;UnboxedIList<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;UnboxedINil<br></div>
</p><p><div style="background-color:#FFFF45";>An unboxed list similar to type <span style="font-family:courier;">[#Int!]</span> could be defined in algebraic type definition as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::UnboxedIList&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;UnboxedICons&nbsp;!Int&nbsp;&nbsp;!UnboxedIList<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;UnboxedINil<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_5.1.6">5.1.6 Semantic Restrictions on Algebraic Data Types</a></h3>
<p style="text-align:justify;">Other semantic restrictions on algebraic data types:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The name of a type must be different from other names in the same scope and name space (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The name of a type variable must be different from other type variable names in the same scope and name space</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">All type variables used on the right-hand side are bound, i.e. must either be introduced on the left-hand side of the algebraic type being defined, or they must be bound by an existential quantifier on the right-hand side, or, they must be bound by a universal quantifier specified on the corresponding argument.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A data constructor can only be defined once within the same scope and name space. So, each data constructor unambiguously identifies its type to make type inferencing possible.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a data constructor is used in infix position both arguments have to be present. Data constructors can be used in a curried way in the function world, but then they have to be used as ordinary prefix constructors.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Type constructors can be used in a curried way in the type world; to use predefined bracket-like type constructors (for lists, tuples, arrays) in a curried way they must be used in prefix notation.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The right-hand side of an algebraic data type definition should yield a type of kind<span style="font-family:courier;">X</span>, all arguments of the data constructor being defined should be of kind <span style="font-family:courier;">X</span> as well.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A type can only be instantiated with a type that is of the same kind.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An existentially quantified type variable specified in an algebraic type can only be instantiated with a concrete type (= not a type variable) when a data structure of this type is created.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_5.2">5.2 Defining Record Types</a></h2>
<p style="text-align:justify;">A <i>record type</i> is basically an algebraic data type in which exactly one constructor is defined. Special about records is that a <i>field name</i> is attached to each of the arguments of the data constructor and that</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">records cannot be used in a curried way.</td></tr>
</table>
<p style="text-align:justify;">Compared with ordinary algebraic data structures the use of records gives a lot of notational convenience because the field names enable <i>selection by field name</i> instead of <i>selection by position</i>. When a record is created <i>all</i> arguments of the constructor have to be defined but one can specify the arguments in <i>any</i> order. Furthermore, when pattern matching is performed on a record, one only has to mention those fields one is interested in (<span style="color:blue;"><a href="#_5.2.2">see 5.2.2</a></span>). A record can be created via a functional update (<span style="color:blue;"><a href="#_5.2.1">see 5.2.1</a></span>). In that case one only has to specify the values for those fields that differ from the old record. Matching and creation of records can hence be specified in CLEAN in such a way that after a change in the structure of a record only those functions have to be changed that are explicitly referring to the changed fields.</p>
<p style="text-align:justify;">Existential and universal type variables (<span style="color:blue;"><a href="#_5.1.3">see 5.1.3</a></span> and <span style="color:blue;"><a href="#_5.1.4">5.1.4</a></span>) are allowed in record types (as in any other type). The arguments of the constructor can optionally be annotated as being strict (<span style="color:blue;"><a href="#_10.1">see 10.1</a></span>). The optional uniqueness attributes are treated in <span style="color:blue;"><a href="#_9">Chapter 9</a></span>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>=</b></span> [ExistentalQuantVariables] [Strict] <span style="font-family:courier;color:#993300;"><b>{</b></span>{<span style="font-family:courier;">FieldName</span> <span style="font-family:courier;color:#993300;"><b>::</b></span>FieldType}-list<span style="font-family:courier;color:#993300;"><b>}</b></span> <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">FieldType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] Type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">UniversalQuantVariables [Strict] Type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
</table><p></p>
<p style="text-align:justify;">As data constructor for a record the name of the record type is used internally.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The semantic restrictions that apply for algebraic data types also hold for record types.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The field names inside one record all have to be different. It is allowed to use the same field name in different records. If the same names are used in different records, one can explicitly specify the intended record type when the record is constructed.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example of a record definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Complex&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;{&nbsp;re&nbsp;::&nbsp;Real<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;im&nbsp;::&nbsp;Real<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br></div>
</p><p style="text-align:justify;">The combination of existential type variables in record types are of use for an object oriented style of programming.</p>
<p><div style="background-color:#FFFF45";>Example of the use of an existentially quantified record. One can create an object of a certain type that can have different representations.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Object&nbsp;=&nbsp;E.x:&nbsp;&nbsp;{&nbsp;state&nbsp;&nbsp;::&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;get&nbsp;::&nbsp;x&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;set&nbsp;::&nbsp;x&nbsp;Int&nbsp;-&gt;&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
CreateObject1::&nbsp;Object<br>
CreateObject1&nbsp;=&nbsp;{state&nbsp;=&nbsp;[],&nbsp;get&nbsp;=&nbsp;myget,&nbsp;set&nbsp;=&nbsp;myset}<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;myget::&nbsp;[Int]&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;myget&nbsp;[i:is]&nbsp;=&nbsp;i<br>
&nbsp;&nbsp;&nbsp;&nbsp;myget&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;myset::&nbsp;[Int]&nbsp;Int&nbsp;-&gt;&nbsp;[Int]<br>
&nbsp;&nbsp;&nbsp;&nbsp;myset&nbsp;is&nbsp;i&nbsp;=&nbsp;[i:is]<br></div>
</p><p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">CreateObject2&nbsp;=&nbsp;{state&nbsp;=&nbsp;0.0,&nbsp;get&nbsp;=&nbsp;myget,&nbsp;set&nbsp;=&nbsp;myset}<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;myget::&nbsp;Real&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;myget&nbsp;r&nbsp;=&nbsp;toInt&nbsp;r<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;myset::&nbsp;Real&nbsp;Int&nbsp;-&gt;&nbsp;Real<br>
&nbsp;&nbsp;&nbsp;&nbsp;myset&nbsp;r&nbsp;i&nbsp;=&nbsp;r&nbsp;+&nbsp;toReal&nbsp;i<br>
<br>
Get::&nbsp;Object&nbsp;-&gt;&nbsp;Int<br>
Get&nbsp;{state,get}&nbsp;=&nbsp;get&nbsp;state<br>
<br>
Set::&nbsp;Object&nbsp;Int&nbsp;-&gt;&nbsp;Object<br>
Set&nbsp;o=:{state,set}&nbsp;i&nbsp;=&nbsp;{o&nbsp;&amp;&nbsp;state&nbsp;=&nbsp;set&nbsp;state&nbsp;i}<br>
<br>
Start::&nbsp;[Object]<br>
Start&nbsp;=&nbsp;map&nbsp;(Set&nbsp;3)&nbsp;[CreateObject1,CreateObject2]<br></p>
</p>
<p><div style="background-color:#FFFF45";>Example of a complex number as record type with strict components.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Complex&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;re::&nbsp;!Real<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;im::&nbsp;!Real<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
(+)&nbsp;infixl&nbsp;6::&nbsp;!Complex&nbsp;!Complex&nbsp;-&gt;&nbsp;Complex<br>
(+)&nbsp;{re=r1,im=i1}&nbsp;{re=r2,im=i2}&nbsp;=&nbsp;{re=r1+r2,im=i1+i2}<br></div>
</p><p style="text-align:justify;">The compiler often unboxes records to make the generated code more efficient. However in some cases this is less efficient, for example for abstract data types, large unique records that can be updated in place, or when records are shared. Therefore unboxing can be prevented by adding an ! before the { in the record type definition.</p>
<h3 style="background-color:#9999FF;"><a id="_5.2.1">5.2.1 Creating Records and Selection of Record Fields</a></h3>
<p style="text-align:justify;">A <i>record</i> is a tuple-like algebraic data structure that has the advantage that its elements can be selected by field name rather than by position.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Record</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">RecordDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordUpdate</td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSimple Records</h3>
<p style="text-align:justify;">The first way is to create a record is by <i>explicitly</i> defining a value for <i>each</i> of its fields.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[<span style="font-family:courier;">TypeName</span><span style="font-family:courier;color:#993300;"><b>|</b></span>] {<span style="font-family:courier;">FieldName</span> <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Creation of a record.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Point&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;{&nbsp;x::&nbsp;Real&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;record&nbsp;type&nbsp;definition</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;y::&nbsp;Real<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
::ColorPoint&nbsp;=&nbsp;&nbsp;&nbsp;{&nbsp;p::&nbsp;Point&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;record&nbsp;type&nbsp;definition</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;c::&nbsp;Color<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
::Color&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;Red&nbsp;|&nbsp;Green&nbsp;|&nbsp;Blue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;algebraic&nbsp;type&nbsp;definition</span><br>
<br>
CreateColorPoint::&nbsp;(Real,Real)&nbsp;Color&nbsp;-&gt;&nbsp;ColorPoint&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;function</span><br>
CreateColorPoint&nbsp;(px,py)&nbsp;col&nbsp;=&nbsp;{&nbsp;c&nbsp;=&nbsp;col&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;function&nbsp;creating&nbsp;a&nbsp;new&nbsp;record</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;p&nbsp;=&nbsp;{&nbsp;x&nbsp;=&nbsp;px<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;y&nbsp;=&nbsp;py<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A record can only be used if its type has been defined in a record type definition; the field names used must be identical to the field names specified in the corresponding type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When creating a record explicitly, the order in which the record fields are instantiated is irrelevant, but <i>all</i> fields have to get a value; the type of these values must be an instantiation of the corresponding type specified in record type definition. Curried use of records is <i>not</i> possible.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When creating a record, its type constructor that can be used to disambiguate the record from other records; the type constructor can be left out if there is <i>at least</i> one field name is specified which is not being defined in some other record.</td></tr>
</table>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRecord Update</h3>
<p style="text-align:justify;">The second way is to construct a new record out of an existing one (a <i>functional record update</i>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordUpdate</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[<span style="font-family:courier;">TypeName</span><span style="font-family:courier;color:#993300;"><b>|</b></span>][RecordExpr <span style="font-family:courier;color:#993300;"><b>&amp;</b></span>][{<span style="font-family:courier;">FieldName</span> {Selection} = GraphExpr}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Selection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex</td></tr>
<tr><td style="width:23.0290909090909%;">RecordExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
</table><p></p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The record expression must yield a record.</td></tr>
</table>
<p style="text-align:justify;">The record written to the left of the <span style="font-family:courier;">&amp; (r &amp; f = v</span> is pronounced as: <span style="font-family:courier;">r</span> with for <span style="font-family:courier;">f</span> the value <span style="font-family:courier;">v</span>) is the record to be duplicated.  On the right from the <span style="font-family:courier;">&amp;</span> the structures are specified in which the new record <i>differs</i> from the old one. A structure can be any field of the record or a selection of any field or array element of a record or array stored in this record. All other fields are duplicated and created<i>implicitly</i>. Notice that the functional update is not an update in the classical, destructive sense since a <i>new</i> record is created.  The functional update of records is performed very efficient such that we have not added support for destructive updates of records of unique type. The <span style="font-family:courier;">&amp;</span>-operator is strict in the record argument and arguments for strict fields.</p>
<p><div style="background-color:#FFFF45";>Updating a record within a record using the functional update.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MoveColorPoint::&nbsp;ColorPoint&nbsp;(Real,Real)&nbsp;-&gt;&nbsp;ColorPoint<br>
MoveColorPoint&nbsp;cp&nbsp;(dx,dy)&nbsp;=&nbsp;{cp&nbsp;&amp;&nbsp;p.x&nbsp;=&nbsp;cp.p.x&nbsp;+&nbsp;dx,&nbsp;p.y&nbsp;=&nbsp;c.p.y&nbsp;+&nbsp;dy}<br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp# with Record Update</h3>
<p style="text-align:justify;"><span style="font-family:courier;">variable = {variable &amp; </span>updates<span style="font-family:courier;">}</span> after <span style="font-family:courier;">#</span> or <span style="font-family:courier;">#!</span> can be abbreviated to <span style="font-family:courier;">variable &amp; </span>updates, by omitting <span style="font-family:courier;">= {variable</span> and <span style="font-family:courier;">}</span> (same as for array updates in <span style="color:blue;"><a href="#_4.4.1">section 4.4.1</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:76.4981818181818%;">Variable <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {<span style="font-family:courier;">FieldName</span> {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">For example:</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">#&nbsp;r&nbsp;&amp;&nbsp;x&nbsp;=&nbsp;1<br><div style="background-color:#FFFF45";>instead of</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">#&nbsp;r&nbsp;=&nbsp;{r&nbsp;&amp;&nbsp;x&nbsp;=&nbsp;1}<br></div>
</p><p style="text-align:justify;">Multiple updates are also allowed, for example:</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">#&nbsp;r&nbsp;&amp;&nbsp;x=1,&nbsp;y=2,&nbsp;z.c='a'<br><div style="background-color:#FFFF45";>instead of</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">#&nbsp;r&nbsp;=&nbsp;{r&nbsp;&amp;&nbsp;x=1,&nbsp;y=2,&nbsp;z.c='a'}<br></div>
</p><h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSelection of a Record Field</h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordSelection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">RecordExpr [<span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">TypeName</span>]<span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span> {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordExpr [<span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">TypeName</span>]<span style="font-family:courier;color:#993300;"><b>!</b></span><span style="font-family:courier;">FieldName</span> {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;">Selection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex</td></tr>
</table><p></p>
<p style="text-align:justify;">With a <i>record selection</i> (using the '<span style="font-family:courier;">.</span>' symbol) one can select the value stored in the indicated record field. A "unique" selection using the '<span style="font-family:courier;">!</span>' symbol returns a tuple containing the demanded record field and the original record. This type of record selection can be very handy for destructively updating of uniquely typed records with values that depend on the current contents of the record. Record selection binds more tightly (priority <span style="font-family:courier;">11</span>) than application (priority <span style="font-family:courier;">10</span>).</p>
<p><div style="background-color:#FFFF45";>Record selection.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
GetPoint::&nbsp;ColorPoint&nbsp;-&gt;&nbsp;Point<br>
GetPoint&nbsp;cp&nbsp;=&nbsp;cp.p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;selection&nbsp;of&nbsp;a&nbsp;record&nbsp;field</span><br>
<br>
GetXPoint::&nbsp;ColorPoint&nbsp;-&gt;&nbsp;Real<br>
GetXPoint&nbsp;cp&nbsp;=&nbsp;cp.p.x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;selection&nbsp;of&nbsp;a&nbsp;record&nbsp;field</span><br>
<br>
GetXPoint2::&nbsp;*ColorPoint&nbsp;-&gt;&nbsp;(Real,.ColorPoint)<br>
GetXPoint2&nbsp;cp&nbsp;=&nbsp;cp!p.x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;selection&nbsp;of&nbsp;a&nbsp;record&nbsp;f</span><br></div>
</p><h3 style="background-color:#9999FF;"><a id="_5.2.2">5.2.2 Record Patterns</a></h3>
<p style="text-align:justify;">An object of type <i>record</i> can be specified as pattern. Only those fields which contents one would like to use in the right-hand side need to be mentioned in the pattern.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[<span style="font-family:courier;">TypeName</span> <span style="font-family:courier;color:#993300;"><b>|</b></span>] {<span style="font-family:courier;">FieldName</span> [<span style="font-family:courier;color:#993300;"><b>=</b></span> GraphPattern]}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
</table><p></p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The type of the record must have been defined in a record type definition.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The field names specified in the pattern must be identical to the field names specified in the corresponding type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When matching a record, the type contructor which can be used to disambiguate the record from other records, can only be left out if there is <i>at least </i>one field name is specified which is not being defined in some other record.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Use of record patterns.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Tree&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;Node&nbsp;(RecTree&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;Leaf&nbsp;a<br>
::RecTree&nbsp;a&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;elem&nbsp;&nbsp;::&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;left&nbsp;&nbsp;::&nbsp;Tree&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;right&nbsp;&nbsp;::&nbsp;Tree&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
Mirror::&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;Tree&nbsp;a<br>
Mirror&nbsp;(Node&nbsp;tree=:{left=l,right=r})&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Node&nbsp;{tree&nbsp;&amp;&nbsp;left=r,right=l}<br>
Mirror&nbsp;leaf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;leaf<br></div>
</p><p><div style="background-color:#FFFF45";>The first alternative of function <span style="font-family:courier;">Mirror</span> defined in another equivalent way:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Mirror&nbsp;(Node&nbsp;tree=:{left,right})&nbsp;=&nbsp;Node&nbsp;{tree&nbsp;&amp;&nbsp;left=right,right=left}<br>
<br></div>
<div style="background-color:#FFFF45";>or (except <span style="font-family:courier;">tree</span> may be evaluated lazily):</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Mirror&nbsp;(Node&nbsp;tree)&nbsp;=&nbsp;Node&nbsp;{tree&nbsp;&amp;&nbsp;left=tree.right,right=tree.left}<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_5.3">5.3 Defining Synonym Types</a></h2>
<p style="text-align:justify;"><i>Synonym types</i> permit the programmer to introduce a new type name for an existing type.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SynonymTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>:==</b></span> Type <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">For the left-hand side the same restrictions hold as for algebraic types.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Cyclic definitions of synonym types (e.g. <span style="font-family:courier;">::T a b :== G a b; ::G a b :== T a b</span>) are not allowed.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example of a type synonym definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Operator&nbsp;a&nbsp;:==&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br>
<br>
map2::&nbsp;(Operator&nbsp;a)&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;[a]<br>
map2&nbsp;op&nbsp;[]&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
map2&nbsp;op&nbsp;[f1:r1]&nbsp;[f2:r2]&nbsp;&nbsp;&nbsp;=&nbsp;[op&nbsp;f1&nbsp;f2&nbsp;:map2&nbsp;op&nbsp;r1&nbsp;r2]<br>
<br>
Start::&nbsp;Int<br>
Start&nbsp;=&nbsp;map2&nbsp;(*)&nbsp;[2,3,4,5]&nbsp;[7,8,9,10]<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_5.4">5.4 Defining Abstract Data Types</a></h2>
<p style="text-align:justify;">A type can be exported by defining the type in a CLEAN definition module (<span style="color:blue;"><a href="#_2">see Chapter 2</a></span>). For software engineering reasons it sometimes better only to export the name of a type but not its concrete definition (the right-hand side of the type definition). The type then becomes an <i>abstract data type</i>. In CLEAN this is done by specifying only the left-hand-side of a type in the definition module while the concrete definition (the right-hand side of the type definition) is hidden in the implementation module. So, CLEAN's module structure is used to hide the actual implementation. When one wants to do something useful with objects of abstract types one needs to export functions that can create and manipulate objects of this type as well.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Abstract data type definitions are only allowed in definition modules, the concrete definition has to be given in the corresponding implementation module.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The left-hand side of the concrete type should be identical to (modulo alpha conversion for variable names) the left-hand side of the abstract type definition (inclusive strictness and uniqueness type attributes).</td></tr>
</table>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AbstractTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of an abstract data type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>definition</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;stack<br>
<br>
::Stack&nbsp;a<br>
<br>
Empty&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;&nbsp;&nbsp;(Stack&nbsp;a)<br>
isEmpty&nbsp;&nbsp;::&nbsp;&nbsp;&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;Bool<br>
Top&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;&nbsp;&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;a<br>
Push&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;a&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;Stack&nbsp;a<br>
Pop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;&nbsp;&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;Stack&nbsp;a<br></div>
</p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;stack<br>
<br>
::Stack&nbsp;a&nbsp;:==&nbsp;[a]<br>
<br>
Empty::&nbsp;(Stack&nbsp;a)<br>
Empty&nbsp;=&nbsp;[]<br>
<br>
isEmpty::&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;Bool<br>
isEmpty&nbsp;[]&nbsp;=&nbsp;True<br>
isEmpty&nbsp;s&nbsp;&nbsp;=&nbsp;False<br>
<br>
Top::&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;a<br>
Top&nbsp;[e:s]&nbsp;=&nbsp;e<br>
<br>
Push::&nbsp;a&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;Stack&nbsp;a<br>
Push&nbsp;e&nbsp;s&nbsp;=&nbsp;[e:s]<br>
<br>
Pop::&nbsp;(Stack&nbsp;a)&nbsp;-&gt;&nbsp;Stack&nbsp;a<br>
Pop&nbsp;[e:s]&nbsp;=&nbsp;s<br></p>
<h3 style="background-color:#9999FF;"><a id="_5.4.1">5.4.1 Defining Abstract Data Types with Synonym Type Definition</a></h3>
<p style="text-align:justify;">Because the concrete definition of an abstract data type does not appear in the definition module, the compiler cannot generate optimal code. Therefore, if the concrete type is a synonym type, the right-hand-side of the definition may be included surrounded by brackets:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AbstractSynonymTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs ( <span style="font-family:courier;color:#993300;"><b>:==</b></span> Type ) <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">The type of the implementation is still hidden as for other abstract data types, except that the compiler uses it only to generate the same code as for a synonym type.</p>
<!-- chapter:Chapter 6-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_6"><br>Chapter 6<br><br>Overloading</a></h1></div>
<p style="text-align:justify;">CLEAN allows functions and operators to be <i>overloaded</i>. <i>Type classes</i> and type constructor classes are provided (which look similar to Haskell (Hudak et  al. 1992) and Gofer (Jones, 1993), although our classes have slightly different semantics) with which a restricted context can be imposed on a type variable in a type specification.</p>
<p style="text-align:justify;">If one defines a function it should in general have a name that is <i>different</i> from all other function names defined within the same scope and name space (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>). However, it is sometimes very convenient to <i>overload</i> certain  functions and operators (e.g. <span style="font-family:courier;">+</span>,<span style="font-family:courier;">-</span>,<span style="font-family:courier;">==</span>), i.e. use <i>identical</i> names for <i>different</i> functions or operators that perform <i>similar tasks</i> albeit on objects of <i>different types</i>.</p>
<p style="text-align:justify;">In principle it is possible to simulate a kind of overloading by using records. One simply defines a record (<span style="color:blue;"><a href="#_5.2">see 5.2</a></span>) in which a collection of functions are stored that somehow belong to each other. Now the field name of the record can be used as (overloaded) synonym for any concrete function stored on the corresponding position. The record can be regarded as a kind of <i>dictionary</i> in which the concrete function can be looked up.</p>
<p><div style="background-color:#FFFF45";>Example of the use of a dictionary record to simulate overloading. <i>sumlist</i> can use the field name add as synonym for any concrete function obeying the type as specified in the record definition. The operators <span style="font-family:courier;">+.</span>, <span style="font-family:courier;">+^</span>, <span style="font-family:courier;">-.</span> and <span style="font-family:courier;">-^</span> are assumed to be predefined primitives operators for addition and subtraction on the basic types <span style="font-family:courier;">Real</span> and <span style="font-family:courier;">Int</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::Arith&nbsp;a&nbsp;=&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;subtract&nbsp;::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br>
<br>
ArithReal&nbsp;=&nbsp;{&nbsp;add&nbsp;=&nbsp;(+.),&nbsp;subtract&nbsp;=&nbsp;(-.)&nbsp;}&nbsp;<br>
ArithInt&nbsp;&nbsp;=&nbsp;{&nbsp;add&nbsp;=&nbsp;(+^),&nbsp;subtract&nbsp;=&nbsp;(-^)&nbsp;}&nbsp;<br>
<br>
sumlist::&nbsp;(Arith&nbsp;a)&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;[a]&nbsp;<br>
sumlist&nbsp;arith&nbsp;[x:xs]&nbsp;[y:ys]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;[arith.add&nbsp;x&nbsp;y:sumlist&nbsp;arith&nbsp;xs&nbsp;ys]&nbsp;<br>
sumlist&nbsp;arith&nbsp;x&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;[]&nbsp;<br>
<br>
Start&nbsp;=&nbsp;sumlist&nbsp;ArithInt&nbsp;[1..10]&nbsp;[11..20]<br></div>
</p><p style="text-align:justify;">A disadvantage of such a dictionary record is that it is syntactically not so nice (e.g. one explicitly has to pass the record to the appropriate function) and that one has to pay a huge price for efficiency (due to the use of higher order functions) as well. CLEAN's overloading system as introduced below enables the CLEAN system to automatically create and add dictionaries as argument to the appropriate function definitions and function applications. To avoid efficiency loss the CLEAN compiler will substitute the intended concrete function for the overloaded function application where possible. In worst case however CLEAN's overloading system will indeed have to generate a dictionary record that is then automatically passed as additional parameter to the appropriate function.</p>
<h2 style="background-color:#9999FF;"><a id="_6.1">6.1 Type Classes</a></h2>
<p style="text-align:justify;">In a <i>type class definition</i> one gives a name to a <i>set of overloaded functions</i> (this is similar to the definition of a type of the dictionary record as explained above). For each <i>overloaded function</i> or <i>operator</i> which is a <i>member</i> of the class the <i>overloaded name</i> and its <i>overloaded type</i> is specified. The <i>type class variables</i> are used to indicate how the different instantiations of the class vary from each other. CLEAN offers multi-parameter type constructor classes, similar to those available in Haskell.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeClassDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> ClassName TypeVariable+ [ClassContext]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {ClassMemberDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span>] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> FunctionName TypeVariable+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType<span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> (FunctionName) [Fix][Prec] TypeVariable+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType<span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ClassMemberDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">FunctionTypeDef</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[MacroDef]</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of the definition of a type class; in this case the class named <span style="font-family:courier;">Arith</span> contains two overloaded operators.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Arith&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br></div>
</p><p><div style="background-color:#FFFF45";>Example. Classes can have several type class variables.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Arith2&nbsp;a&nbsp;b&nbsp;c<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(:+:)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;a&nbsp;b&nbsp;-&gt;&nbsp;c<br></div>
</p><p style="text-align:justify;">With an <i>instance declaration</i> an instance of a given class can be defined (this is similar to the creation of a dictionary record). When the instance is made one has to be specify for which <i>concrete type</i> an instance is created. For each overloaded function in the class an <i>instance of the overloaded function</i> or <i>operator</i> has to be defined. The type of the instance can be found via uniform substitution of the type class variables by the corresponding type instances specified in the instance definition.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeClassInstanceDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span> <span style="font-family:courier;">ClassName</span> Type+ [ClassContext]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:27.0690909090909%;">[[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span>{DefOfFunction}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span>]</td><td style="width:48.84%;">// in implementation modules</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:27.0690909090909%;">[Special] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:48.84%;">// in definition modules</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of the definition of an instance of a type class <span style="font-family:courier;">Arith</span> for type <span style="font-family:courier;">Int</span>. The type of the concrete functions can be  obtained via uniform substitution of the type class variable in the class definition by the corresponding type specified in the instance definition. One is not obliged to repeat the type of the concrete functions instantiated (nor the fixity or associativity in the case of operators).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith&nbsp;Int<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)::&nbsp;Int&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
	&nbsp;&nbsp;&nbsp;(+)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+^&nbsp;y<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)::&nbsp;Int&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;-^&nbsp;y<br></div>
</p><p><div style="background-color:#FFFF45";>Example of the definition of an instance of a type class <span style="font-family:courier;">Arith</span> for type <span style="font-family:courier;">Real</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith&nbsp;Real<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+.&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;-.&nbsp;y<br></div>
</p><p><div style="background-color:#FFFF45";>Example. Instantiation of <span style="font-family:courier;">Arith2</span> using the instantiations of <span style="font-family:courier;">Arith</span> specified above.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith2&nbsp;Int&nbsp;&nbsp;Int&nbsp;&nbsp;Int&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;(:+:)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith2&nbsp;Int&nbsp;&nbsp;Real&nbsp;Real&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;(:+:)&nbsp;x&nbsp;y&nbsp;=&nbsp;toReal&nbsp;x&nbsp;+&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith2&nbsp;Real&nbsp;Int&nbsp;&nbsp;Real&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;(:+:)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+&nbsp;toReal&nbsp;y<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith2&nbsp;Real&nbsp;Real&nbsp;Real&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span>&nbsp;(:+:)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+&nbsp;y<br></div>
</p><p style="text-align:justify;">One can define as many instances of a class as one likes. Instances can be added later on in any module that has imported the class one wants to instantiate.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When an instance of a class is defined a concrete definition has to be given for all the class members.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_6.2">6.2 Functions Defined in Terms of Overloaded Functions</a></h2>
<p style="text-align:justify;">When an overloaded name is encountered in an expression, the compiler will determine which of the corresponding concrete functions/operators is meant by looking at the concrete type of the expression. This type is used to determine which concrete function to apply.</p>
<p style="text-align:justify;">All instances of a type variable of a certain class have to be of a flat type (see the restrictions mentioned in <span style="color:blue;"><a href="#_6.11">6.11</a></span>).</p>
<p style="text-align:justify;">If it is clear from the type of the expression which one of the concrete instantiations is meant the compiler will in principle substitute the concrete function for the overloaded one, such that no efficiency is lost.</p>
<p><div style="background-color:#FFFF45";>Example of the substitution of a concrete function for an overloaded one. Given the definitions above the function</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
inc&nbsp;n&nbsp;=&nbsp;n&nbsp;+&nbsp;1<br>
<br></div>
<div style="background-color:#FFFF45";>will be internally transformed into</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
inc&nbsp;n&nbsp;=&nbsp;n&nbsp;+^&nbsp;1<br></div>
</p><p style="text-align:justify;">However, it is very well possible that the compiler, given the type of the expression, cannot decide which one of the corresponding concrete functions to apply. The new function then becomes overloaded as well.</p>
<p><div style="background-color:#FFFF45";>For instance, the function</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
add&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+&nbsp;y<br>
<br></div>
<div style="background-color:#FFFF45";>becomes overloaded as well because it cannot be determined which concrete instances can be applied: <span style="font-family:courier;">add</span>can be applied to arguments of any type, as long as addition (<span style="font-family:courier;">+</span>) is defined on them.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><p style="text-align:justify;">This has as consequence that an additional restriction must be imposed on the type of such an expression. A <i>class context</i> has to be added to the function type to express that the function can only be applied provided that the appropriate type classes have been instantiated (in fact one specifies the type of the dictionary record which has to be passed to the function in worst case). Such a context can also be regarded as an additional restriction imposed on a type variable, introducing a kind of <i>bounded polymorphism</i>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[{ArgType}+ <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span>] Type [ClassContext] [UnqTypeUnEqualities]</td></tr>
<tr><td style="width:23.0290909090909%;">ClassContext</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> ClassOrGenericName-list {SimpleType}+ {<span style="font-family:courier;color:#993300;"><b>&amp;</b></span> <span style="font-family:courier;">ClassName</span>-list {SimpleType}+ }</td></tr>
<tr><td style="width:23.0290909090909%;">ClassOrGenericName</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">ClassName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> TypeKind</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of the use of a class context to impose a restriction on the instantiation of a type variable. The function <span style="font-family:courier;">add</span> can be applied on arguments of any type under the condition that an instance of the class <span style="font-family:courier;">Arith</span> is defined on them.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
add::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;Arith&nbsp;a<br>
add&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+&nbsp;y<br></div>
</p><p style="text-align:justify;">CLEAN's type system can infer class contexts automatically. If a type class is specified as a restricted context the type system will check the correctness of the specification (as always a type specification can be more restrictive than is deduced by the compiler).</p>
<h2 style="background-color:#9999FF;"><a id="_6.3">6.3 Type Classes Defined in Terms of Overloaded Functions</a></h2>
<p style="text-align:justify;">The concrete functions defined in a class instance definition can also be defined in terms of (other) overloaded functions. This is reflected in the type of the instantiated functions. Both the concrete type and the context restriction have to be specified.</p>
<p><div style="background-color:#FFFF45";>Example of an instance declaration with a type which is depending on the same type class. The function <span style="font-family:courier;">+</span> on lists can be defined in terms of the overloaded operator <span style="font-family:courier;">+</span>on the list elements. With this definition <span style="font-family:courier;">+</span>is defined not only on lists, but also on a list of lists etcetera.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Arith&nbsp;[a]&nbsp;|&nbsp;Arith&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;on&nbsp;lists</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;[a]&nbsp;|&nbsp;Arith&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;[x:xs]&nbsp;[y:ys]&nbsp;=&nbsp;[x&nbsp;+&nbsp;y:xs&nbsp;+&nbsp;ys]<br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;[a]&nbsp;|&nbsp;Arith&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)&nbsp;[x:xs]&nbsp;[y:ys]&nbsp;=&nbsp;[x&nbsp;-&nbsp;y:xs&nbsp;-&nbsp;ys]<br>
&nbsp;&nbsp;&nbsp;&nbsp;(-)&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br></div>
</p><p><div style="background-color:#FFFF45";>Equality class.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;Bool<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;[a]&nbsp;|&nbsp;Eq&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;on&nbsp;lists</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;[a]&nbsp;[a]&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;Eq&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;[x:xs]&nbsp;[y:ys]&nbsp;=&nbsp;x&nbsp;==&nbsp;y&nbsp;&amp;&amp;&nbsp;xs&nbsp;==&nbsp;ys<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;True<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;False<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_6.4">6.4 Type Constructor Classes</a></h2>
<p style="text-align:justify;">The CLEAN type system offers the possibility to use higher order types (<span style="color:blue;"><a href="#_3.7.1">see 3.7.1</a></span>). This makes it possible to define <i>type constructor classes</i> (similar to constructor classes as introduced in Gofer, Jones (1993)). In that case the overloaded type variable of the type class is not of kind <span style="font-family:courier;">X</span>, but of higher order, e.g. <span style="font-family:courier;">X -&gt; X</span>, <span style="font-family:courier;">X -&gt; X -&gt; X</span>, etcetera. This offers the possibility to define overloaded functions that can be instantiated with type constructors of higher order (as usual, the overloaded type variable and a concrete instantiation of this type variable need to be of the same kind). This makes it possible to overload more complex functions like map and the like.</p>
<p><div style="background-color:#FFFF45";>Example of a definition of a type constructor class. The class <span style="font-family:courier;">Functor</span> including the overloaded function <span style="font-family:courier;">map</span> which varies in type variable <span style="font-family:courier;">f</span> of kind <span style="font-family:courier;">X -&gt; X</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Functor&nbsp;f<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;map::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(f&nbsp;a)&nbsp;-&gt;&nbsp;(f&nbsp;b)<br></div>
</p><p><div style="background-color:#FFFF45";>Example of an instantiation of a type constructor class. An instantiation of the well-known function <span style="font-family:courier;">map</span> applied on lists (<span style="font-family:courier;">[]</span> is of kind <span style="font-family:courier;">X -&gt; X</span>), and a map function defined on <span style="font-family:courier;">Tree</span>'s (<span style="font-family:courier;">Tree</span> is of kind <span style="font-family:courier;">X -&gt; X</span>).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Functor&nbsp;[]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;map::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;f&nbsp;[x:xs]&nbsp;=&nbsp;[f&nbsp;x&nbsp;:&nbsp;map&nbsp;f&nbsp;xs]<br>
&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
<br>
::Tree&nbsp;a&nbsp;=&nbsp;(/\)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;0&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Leaf&nbsp;a<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Functor&nbsp;Tree<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;map::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;(Tree&nbsp;b)<br>
&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;f&nbsp;(l/\r)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;map&nbsp;f&nbsp;l&nbsp;/\&nbsp;map&nbsp;f&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;f&nbsp;(Leaf&nbsp;a)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Leaf&nbsp;(f&nbsp;a)<br></div>
</p><p style="text-align:justify;">CLEAN 2.0 offers the possibility to define generic functions. With generic functions one is able to define a function like <span style="font-family:courier;">map</span> once that works for <i>any</i> type (see ???).</p>
<h2 style="background-color:#9999FF;"><a id="_6.5">6.5 Overlapping Instances</a></h2>
<p style="text-align:justify;">Identical instances of the same class are not allowed. The compiler would not know which instance to choose. However, it is not required that all instances are of different type. It is allowed to specify an instance of a class of which the types overlap with some other instance given for that class, i.e. the types of the different class instances are different but they can be unified with each other. It is even allowed to specify an instance that works for any type, just by instantiating with a type variable instead of instantiating with a concrete type. This can be handy to define a simple default case (see also the section one generic definitions). If more than one instance is applicable, the compiler will always choose the most specific instantiation.</p>
<p><div style="background-color:#FFFF45";>Example of overlapping instances. Below there are three instances given for the class <span style="font-family:courier;">Eq</span>: one for <span style="font-family:courier;">Int</span>eger values, one for <span style="font-family:courier;">Real</span> values, and one for objects of any type. The latter instance is more general and overlaps with both the other instances that are more specific. If <span style="font-family:courier;">Int</span>egers or <span style="font-family:courier;">Real</span>s are compared, the corresponding equality function will be chosen. For all other types for which no specific instances for equality are defined, the general instance will be chosen. </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;Bool<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;on&nbsp;Integers</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;==^&nbsp;y<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;Real&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;on&nbsp;Reals</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;==.&nbsp;y<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;generic&nbsp;instance&nbsp;for&nbsp;Eq</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;x&nbsp;y&nbsp;=&nbsp;False<br></div>
</p><p style="text-align:justify;">It is sometimes unclear which of the class instances is the most specific. In that case the lexicographic order is chosen looking at the specified instances (with type variables always <span style="font-family:courier;">&lt;=</span> type constructors).</p>
<p><div style="background-color:#FFFF45";>Example of overlapping instances. The two instances of class <span style="font-family:courier;">C</span> overlap with each other. In the <span style="font-family:courier;">Start</span> rule the function <span style="font-family:courier;">f</span> is applied to two <span style="font-family:courier;">Bool</span>ean values. In this case any of the two instances of <span style="font-family:courier;">f</span> could be chosen. They both can be applied (one has type <span style="font-family:courier;">f::Bool a -&gt; Bool</span>, the other <span style="font-family:courier;">f::a Bool -&gt; Bool</span>, <span style="font-family:courier;">Start</span> requires <span style="font-family:courier;">f:: Bool Bool -&gt; Bool</span>). The compiler will choose the first instance, because in lexicographical order <span style="font-family:courier;"> instance C Bool dontcare</span> &lt;= <span style="font-family:courier;">instance C dontcare Bool</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;C&nbsp;a1&nbsp;a2<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;f::&nbsp;a1&nbsp;a2&nbsp;-&gt;&nbsp;Bool<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;C&nbsp;Bool&nbsp;dontcare<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;b&nbsp;x&nbsp;&nbsp;=&nbsp;b<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;C&nbsp;dontcare&nbsp;Bool<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;x&nbsp;b&nbsp;&nbsp;=&nbsp;b<br>
<br>
Start&nbsp;=&nbsp;f&nbsp;True&nbsp;False&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;the&nbsp;result&nbsp;will&nbsp;yield&nbsp;True</span><br></div>
</p><h2 style="background-color:#9999FF;"><a id="_6.6">6.6 Internal Overloading</a></h2>
<p style="text-align:justify;">It is possible that a CLEAN expression using overloaded functions is internally ambiguously overloaded. The problem can occur when an overloaded function is used which has on overloaded type in which an overloaded type variable appears on the right-hand side of the <span style="font-family:courier;">-&gt;</span>. If such a function is applied in such a way that the overloaded type does not appear in the resulting type of the application, any of the available instances of the overloaded function can be used.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In that case that an overloaded function is internally ambiguously overloaded the compiler cannot determine which instance to take: a type error is given.</td></tr>
</table>
<p><div style="background-color:#FFFF45";><b>Counter example</b> (ambiguous internal overloaded expression). The function body of <span style="font-family:courier;">f</span> is internally ambiguously overloaded which results in a type error. It is not possible to determine whether its argument should be converted to an <span style="font-family:courier;">Int</span> or to a <span style="font-family:courier;">Bool</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Read&nbsp;&nbsp;a::&nbsp;a&nbsp;-&gt;&nbsp;String<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Write&nbsp;a::&nbsp;String&nbsp;-&gt;&nbsp;a<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Read&nbsp;&nbsp;Int,&nbsp;Bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;export&nbsp;of&nbsp;class&nbsp;instance,&nbsp;see&nbsp;6.10</span><br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Write&nbsp;Int,&nbsp;Bool<br>
<br>
f::&nbsp;String&nbsp;-&gt;&nbsp;String<br>
f&nbsp;x&nbsp;=&nbsp;Write&nbsp;(Read&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;!&nbsp;This&nbsp;results&nbsp;in&nbsp;a&nbsp;type&nbsp;error&nbsp;!</span><br></div>
</p><p style="text-align:justify;">One can solve such an ambiguity by splitting up the expression in parts that are typed explicitly such that it becomes clear which of the instances should be used.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">f::&nbsp;String&nbsp;-&gt;&nbsp;String<br>
f&nbsp;x&nbsp;=&nbsp;Write&nbsp;(MyRead&nbsp;x)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;MyRead::&nbsp;Int&nbsp;-&gt;&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;MyRead&nbsp;x&nbsp;=&nbsp;Read&nbsp;x<br></p>
</p>
<p><div style="background-color:#FFFF45";><b>Counter example</b> (ambiguous internal overloaded expression). The function <span style="font-family:courier;">:+:</span> is internally ambiguously overloaded which results in a type error. The compiler is not able to infer the result type <span style="font-family:courier;">c</span> of the multi parameter type class <span style="font-family:courier;">Arith2 a b c</span>. The reason is that the compiler will first do the type unification and then tries to solve the overloading. In this case solving the overloading will have consequences for other overloading situations. The system can only solve one overloaded situation at a time and solving the overloading may not have any effect on other unifications.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Start&nbsp;::&nbsp;Int<br>
Start&nbsp;=&nbsp;2&nbsp;:+:&nbsp;3&nbsp;:+:&nbsp;4<br></div>
</p><p><div style="background-color:#FFFF45";><b>Example </b>(ambiguous internal overloaded expression). By explicitly specifying types the overloading can be solved. The following program is accepted.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Start::&nbsp;Int<br>
Start&nbsp;=&nbsp;2&nbsp;:+:&nbsp;more<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;more::&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;=&nbsp;3&nbsp;:+:&nbsp;4<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_6.7">6.7 Defining Derived Members in a Class</a></h2>
<p style="text-align:justify;">The members of a class consist of a set of functions or operators that logically belong to each other. It is often the case that the effect of some members (<i>derived members</i>) can be expressed in others. For instance, <span style="font-family:courier;">&lt;&gt;</span> can be regarded as synonym for <span style="font-family:courier;">not (==)</span>. For software engineering (the fixed relation is made explicit) and efficiency (one does not need to include such derived members in the dictionary record) it is good to make this relation explicit. In CLEAN the existing macro facilities (<span style="color:blue;"><a href="#_10.3">see Chapter 10.3</a></span>) are used for this purpose.</p>
<p><div style="background-color:#FFFF45";>Classes with macro definitions to specify derived members.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;Bool<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&gt;)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;&nbsp;Bool&nbsp;|&nbsp;Eq&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&gt;)&nbsp;x&nbsp;y&nbsp;:==&nbsp;not&nbsp;(x&nbsp;==&nbsp;y)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Ord&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;&nbsp;Bool<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&gt;)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;&nbsp;Bool&nbsp;|&nbsp;Ord&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&gt;)&nbsp;x&nbsp;y&nbsp;:==&nbsp;y&nbsp;&lt;&nbsp;x<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;=)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;&nbsp;Bool&nbsp;|&nbsp;Ord&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;=)&nbsp;x&nbsp;y&nbsp;:==&nbsp;not&nbsp;(y&lt;x)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&gt;=)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;&nbsp;Bool&nbsp;|&nbsp;Ord&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&gt;=)&nbsp;x&nbsp;y&nbsp;:==&nbsp;not&nbsp;(x&lt;y)<br>
<br>
min::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;Ord&nbsp;a<br>
min&nbsp;x&nbsp;y&nbsp;:==&nbsp;if&nbsp;(x&lt;y)&nbsp;x&nbsp;y<br>
<br>
max::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;Ord&nbsp;a<br>
max&nbsp;x&nbsp;y&nbsp;:==&nbsp;if&nbsp;(x&lt;y)&nbsp;y&nbsp;x<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_6.8">6.8 A Shorthand for Defining Overloaded Functions</a></h2>
<p style="text-align:justify;">A class definition seems sometimes a bit overdone when a class actually only consists of one member. Special syntax is provided for this case.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeClassDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> ClassName TypeVariable+ [ClassContext]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {ClassMemberDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span>] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> FunctionName TypeVariable+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType<span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> (FunctionName) [Fix][Prec] TypeVariable+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType<span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example of an overloaded function/operator.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;(+)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6&nbsp;a::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br>
<br></div>
<div style="background-color:#FFFF45";>which is shorthand for:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;+&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixl</b></span>&nbsp;6::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br></div>
</p><p style="text-align:justify;">The instantiation of such a simple one-member class is done in a similar way as with ordinary classes, using the name of the overloaded function as class name.</p>
<p><div style="background-color:#FFFF45";>Example of an instantiation of an overloaded function/operator.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;+&nbsp;Int<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(+)&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+^&nbsp;y<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_6.9">6.9 Classes Defined in Terms of Other Classes</a></h2>
<p style="text-align:justify;">In the definition of a class one can optionally specify that other classes that already have been defined elsewhere are included. The classes to include are specified as context after the overloaded type variable. It is not needed (but it is allowed) to define new members in the class body of the new class. In this way one can give a new name to a collection of existing classes creating a hierarchy of classes (cyclic dependencies are forbidden). Since one and the same class can be included in several other classes, one can combine classes in different kinds of meaningful ways. For an example have a closer look at the CLEAN standard library (see e.g. <span style="font-family:courier;">StdOverloaded</span> and <span style="font-family:courier;">StdClass</span>)</p>
<p><div style="background-color:#FFFF45";>Example of defining classes in terms of existing classes. The class <span style="font-family:courier;">Arith</span> consists of the class <span style="font-family:courier;">+</span><span style="font-family:courier;"> and </span><span style="font-family:courier;">-</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
class&nbsp;(+)&nbsp;infixl&nbsp;6&nbsp;a::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br>
<br>
class&nbsp;(-)&nbsp;infixl&nbsp;6&nbsp;a::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a<br>
<br>
class&nbsp;Arith&nbsp;a&nbsp;|&nbsp;+,-&nbsp;a<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_6.10">6.10 Exporting Type Classes</a></h2>
<p style="text-align:justify;">To export a class one simply repeats the class definition in the definition module (<span style="color:blue;"><a href="#_2">see Chapter 2</a></span>). To export an instantiation of a class one simply repeats the instance definition in the definition module, however <i>without</i> revealing the concrete implementation (which can only be specified in the implementation module).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeClassInstanceDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span> <span style="font-family:courier;">ClassName</span> Type+ [ClassContext]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:29.4581818181818%;">[[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span>{DefOfFunction}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span>]</td><td style="width:46.4509090909091%;">// only in implementation modules</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:29.4581818181818%;">[Special] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:46.4509090909091%;">// only in definition modules</td></tr>
<tr><td style="width:23.0290909090909%;">Special</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#FF0000;"><b>special</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span>{<span style="font-family:courier;">TypeVariable</span> <span style="font-family:courier;color:#993300;"><b>=</b></span> Type}-list { <span style="font-family:courier;color:#0000FF;"><b>;</b></span> {<span style="font-family:courier;">TypeVariable</span> <span style="font-family:courier;color:#993300;"><b>=</b></span> Type}-list }<span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Exporting classes and instances.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>definition</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;example<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Eq&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;the&nbsp;class&nbsp;Eq&nbsp;is&nbsp;exported</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;Bool<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;[a]&nbsp;|&nbsp;Eq&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;an&nbsp;instance&nbsp;of&nbsp;Eq&nbsp;on&nbsp;lists&nbsp;is&nbsp;exported</span><br>
<span style="font-family:courier;color:#FF0000;"><b>special</b></span>&nbsp;&nbsp;a&nbsp;=&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;with&nbsp;an&nbsp;additional&nbsp;specialised&nbsp;version&nbsp;for&nbsp;[Int]</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;Real&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;and&nbsp;an&nbsp;additional&nbsp;specialised&nbsp;version&nbsp;for&nbsp;[Real]</span><br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;general&nbsp;instance&nbsp;of&nbsp;Eq&nbsp;is&nbsp;exported</span><br></div>
</p><p style="text-align:justify;">For reasons of efficiency the compiler will always make specialized efficient versions of overloaded functions inside an implementation module. For each concrete application of an overloaded function a specialized version is made for the concrete type the overloaded function is applied to. So, when an overloaded function is used in the implementation module in which the overloaded function is defined, no overhead is introduced.</p>
<p style="text-align:justify;">However, when an overloaded function is exported it is unknown with which concrete instances the function will be applied. So, a dictionary record is constructed in which the concrete function can be stored as is explained in the introduction of this Section. This approach can be very inefficient, especially in comparison to a specialized version. One can therefore ask the compiler to generate specialized versions of an overloaded function that is being exported. This can be done by using the keyword <span style="font-family:courier;color:#FF0000;"><b>special</b></span>. If the exported overloaded function will be used very frequently, we advise to specialize the function for the most important types it will be applied on.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A specialised function can only be generated if for all type variables which appear in the instance definition of a class a concrete type is defined.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_6.11">6.11 Semantic Restrictions on Type Classes</a></h2>
<p style="text-align:justify;">Semantic restrictions:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">When a class is instantiated a concrete definition must be given for each of the members in the class (not for derived members).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The type of a concrete function or operator must exactly match the overloaded type after uniform substitution of the overloaded type variable by the concrete type as specified in the corresponding type instance declaration.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The overloaded type variable and the concrete type must be of the same kind.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A type instance of an overloaded type must be a <i>flat type</i>, i.e. a type of the form <span style="font-family:courier;">T a1 ... an</span> where <span style="font-family:courier;">ai</span> are type variables which are <i>all</i> different.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is not allowed to use a type synonym as instance.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The start rule cannot have an overloaded type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">For the specification of derived members in a class the same restrictions hold as for defining macros.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A restricted context can only be imposed on one of the type variables appearing in the type of the expression.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The specification of the concrete functions can only be given in implementation modules.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A specialised function can only be generated if for all type variables which appear in the instance definition of a class a concrete type is defined.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">A request to generate a specialised function for a class instance can only be defined in a definition module.</td></tr>
</table>
<!-- chapter:Chapter 7-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_7"><br>Chapter 7<br><br>Generic Programming</a></h1></div>
<h2 style="background-color:#9999FF;"><a id="_7.1">7.1 Basic Ideas Behind Generic Programming</a></h2>
<p style="text-align:justify;">In the previous Chapter on overloading it is explained how type classes can be used to define <i>different</i> functions or operators that have the <i>same</i> name and perform <i>similar tasks</i> albeit on objects of <i>different types</i>. These tasks are supposed to be similar, but they are in general not exactly the same. The corresponding function bodies are often slightly different because the data structures on which the functions work differ. As a consequence, one has to explicitly specify an implementation for every concrete instance of an overloaded function.</p>
<p><div style="background-color:#FFFF45";>Equality class. The equality function on lists and trees. The programmer has to specify explicitly the function bodies for each concrete instantiation of equality.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;List&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;Nil&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Cons&nbsp;a&nbsp;(List&nbsp;a)<br>
::&nbsp;Tree&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;Leaf&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Node&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;Bool<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;(List&nbsp;a)&nbsp;|&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;(List&nbsp;a)&nbsp;(List&nbsp;a)&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;Eq&nbsp;a<br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;Nil&nbsp;Nil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;True<br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;(Cons&nbsp;x&nbsp;xs)&nbsp;(Cons&nbsp;x&nbsp;xs)=&nbsp;x&nbsp;==&nbsp;y&nbsp;&amp;&amp;&nbsp;xs&nbsp;==&nbsp;ys<br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;False<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Tree&nbsp;a&nbsp;|&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;Eq&nbsp;a<br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;(Leaf&nbsp;x)&nbsp;(Leaf&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;(Node&nbsp;lx&nbsp;rx)&nbsp;&nbsp;(Node&nbsp;ly&nbsp;ry)&nbsp;=&nbsp;lx&nbsp;==&nbsp;ly&nbsp;&amp;&amp;&nbsp;rx&nbsp;==&nbsp;ry<br>
&nbsp;&nbsp;&nbsp;(==)&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;False<br></div>
</p><p style="text-align:justify;">In the example above the programmer explicitly defines equality on lists and trees. For each new data type that we want to compare for equality, we have to define a similar instance. Moreover, if such a data type changes, the corresponding instance should be changed accordingly as well. Though the instances are <i>similar</i>, they are not the same since they operate on different data types.</p>
<p style="text-align:justify;">What is similar in these instances? Both instances perform pattern match on the arguments. If the constructors are the same, they compare constructor arguments pairwise. For constructors with no arguments <span style="font-family:courier;">True</span> is returned. For constructors with several arguments, the results on the arguments are combined with &amp;&amp;. If constructors are not the same, <span style="font-family:courier;">False</span> is returned. In other words, equality on a data type is defined by looking at the structure of the data type. More precisely, it is defined by induction on the structure of types. There are many more functions than just equality that expose the same kind of similarity in their instances. Below is the mapping function that can be defined for type constructors of kind *-&gt;*.</p>
<p><div style="background-color:#FFFF45";>The Functor provides the mapping function for a type constructor of kind *-&gt;* (<span style="color:blue;"><a href="#_6.4">see also 6.4</a></span>).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Functor&nbsp;f<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(f&nbsp;a)&nbsp;-&gt;&nbsp;(f&nbsp;b)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Functor&nbsp;List<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(List&nbsp;a)&nbsp;-&gt;&nbsp;(List&nbsp;b)<br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;f&nbsp;Nil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Nil<br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;f&nbsp;(Cons&nbsp;x&nbsp;xs)&nbsp;=&nbsp;Cons&nbsp;(f&nbsp;x)&nbsp;:&nbsp;Cons&nbsp;(fmap&nbsp;f&nbsp;xs)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Functor&nbsp;Tree<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;(Tree&nbsp;b)<br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;f&nbsp;(Leaf&nbsp;a)&nbsp;&nbsp;&nbsp;=&nbsp;Leaf&nbsp;(f&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;fmap&nbsp;f&nbsp;(Node&nbsp;l&nbsp;r)&nbsp;=&nbsp;Node&nbsp;(fmap&nbsp;f&nbsp;l)&nbsp;(fmap&nbsp;f&nbsp;r)<br></div>
</p><p style="text-align:justify;">Again, both instances are similar: they perform pattern match on constructors and pairwise mapping of their arguments. The results are packed back in the same constructor.</p>
<p style="text-align:justify;">Generic programming enables the programmer to capture this kind of similarities and define a single implementation for <i>all</i> instances of such a class of functions. To do so we need a universal structural representation of <i>all</i> data types. A generic function can then be defined <i>ones and forall</i> on that universal representation. A specific type is handled using its structural representation. In the rest of this section we will explain roughly how it all works. First we focus on the universal structural representation of types; then we show how a generic function can be defined on it; and at last we show how the generic definition is specialized to a concrete type. See also (Alimarine &amp; Plasmeijer, 2001, <span style="color:#0000FF;">A Generic Programming Extension for Clean</span>).</p>
<p style="text-align:justify;">In CLEAN data types are algebraic: they are built in of sums of products of type terms. For example, the <span style="font-family:courier;">List</span> type is a sum of two things: nullary product for <span style="font-family:courier;">Nil</span> and a binary product of the head and the tail for <span style="font-family:courier;">Cons</span>. The Tree type is a sum of unary product of elements for Leaf and binary product of trees for <span style="font-family:courier;">Node</span>. Having this in mind we can uniformly represent CLEAN data types using binary sums and products.</p>
<p><div style="background-color:#FFFF45";>Binary sum and product types defined in StdGeneric.dcl. These types are needed to represent CLEAN types as sums of products of types for the purpose of generic programming.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;UNIT&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;UNIT&nbsp;a<br>
::&nbsp;PAIR&nbsp;a&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PAIR&nbsp;a&nbsp;b<br>
::&nbsp;EITHER&nbsp;l&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LEFT&nbsp;l&nbsp;|&nbsp;RIGHT&nbsp;r<br></div>
</p><p style="text-align:justify;">The <span style="font-family:courier;">UNIT</span> type represents a nullary product. The <span style="font-family:courier;">PAIR</span> type is a binary product. The <span style="font-family:courier;">EITHER</span> type is a binary sum. We do not need a type for nullary sums, as in CLEAN data types have at least one alternative. As one can imagine, we want sum-product representation of types to be equivalent (i.e. isomorphic) to the original data types. In the following example we give representations for <span style="font-family:courier;">List</span> and <span style="font-family:courier;">Tree</span> with conversion functions that implement the required isomorphisms.</p>
<p><div style="background-color:#FFFF45";>Sum-product representation of the structure of <span style="font-family:courier;">List</span> and <span style="font-family:courier;">Tree</span> with conversion functions that implement isomorphisms between the types and their sum-product representations.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;ListS&nbsp;a&nbsp;:==&nbsp;EITHER&nbsp;UNIT&nbsp;(PAIR&nbsp;a&nbsp;(List&nbsp;a))<br>
<br>
listToStruct&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(List&nbsp;a)&nbsp;&nbsp;-&gt;&nbsp;_ListS&nbsp;a<br>
listToStruct&nbsp;Nil&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LEFT&nbsp;UNIT<br>
listToStruct&nbsp;(Cons&nbsp;x&nbsp;xs)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;RIGHT&nbsp;(PAIR&nbsp;x&nbsp;xs)<br>
<br>
listFromStruct&nbsp;&nbsp;&nbsp;::&nbsp;(ListS&nbsp;a)&nbsp;-&gt;&nbsp;_List&nbsp;a<br>
listFromStruct&nbsp;(LEFT&nbsp;UNIT)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Nil<br>
listFromStruct&nbsp;(RIGHT&nbsp;(PAIR&nbsp;x&nbsp;xs)&nbsp;&nbsp;=&nbsp;Cons&nbsp;x&nbsp;xs<br>
<br>
::&nbsp;TreeS&nbsp;a&nbsp;:==&nbsp;EITHER&nbsp;a&nbsp;(PAIR&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a))<br>
<br>
treeToStruct&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(Tree&nbsp;a)&nbsp;&nbsp;&nbsp;-&gt;&nbsp;_TreeS&nbsp;a<br>
treeFromStruct&nbsp;&nbsp;&nbsp;::&nbsp;(TreeS&nbsp;a)&nbsp;&nbsp;-&gt;&nbsp;_Tree&nbsp;a<br></div>
</p><p style="text-align:justify;">As we said, all algebraic types can be represented in this way. Basic types are not algebraic, but there are only few of them: they are represented by themselves. Arrow types are represented by the arrow type constructor (-&gt;). To define a function generically on the structure of a type it is enough to define instances on the components the structure can be built from. These are binary sums, binary products, basic types, and the arrow type.</p>
<p><div style="background-color:#FFFF45";>Equality on sums, products and primitive types. Equality cannot be feasibly defined for the arrow type, so the instance is omitted.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;UNIT<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;UNIT&nbsp;UNIT&nbsp;-&gt;&nbsp;Bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;UNIT&nbsp;UNIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;True<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;PAIR&nbsp;a&nbsp;b&nbsp;|&nbsp;Eq&nbsp;a&nbsp;&amp;&nbsp;Eq&nbsp;b<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;(PAIR&nbsp;a&nbsp;b)&nbsp;(PAIR&nbsp;a&nbsp;b)&nbsp;-&gt;&nbsp;Bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;(PAIR&nbsp;a1&nbsp;b1)&nbsp;(PAIR&nbsp;a2&nbsp;b2)&nbsp;=&nbsp;a1&nbsp;==&nbsp;a2&nbsp;&amp;&amp;&nbsp;b1&nbsp;==&nbsp;b2<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;EITHER&nbsp;a&nbsp;b&nbsp;|&nbsp;Eq&nbsp;a&nbsp;&amp;&nbsp;Eq&nbsp;b<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;(EITHER&nbsp;a&nbsp;b)&nbsp;(EITHER&nbsp;a&nbsp;b)&nbsp;-&gt;&nbsp;Bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;(LEFT&nbsp;x)&nbsp;&nbsp;(Leaf&nbsp;y)&nbsp;&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;(RIGHT&nbsp;x)&nbsp;(RIGHT&nbsp;y)&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;x_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;False<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Int<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;Int&nbsp;Int&nbsp;-&gt;&nbsp;Bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;x&nbsp;y&nbsp;=&nbsp;eqInt&nbsp;x&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;primitive&nbsp;equality&nbsp;on&nbsp;integers</span><br></div>
</p><p style="text-align:justify;">Having defined instances on the structure components we can generate instances for all other types automatically.</p>
<p><div style="background-color:#FFFF45";>Equality for lists and trees that can be automatically generated. Arguments are first converted to the structural representations which are then compared.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Eq&nbsp;(List&nbsp;a)&nbsp;|&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;(List&nbsp;a)&nbsp;(List&nbsp;a)&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;Eq&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;xs&nbsp;ys&nbsp;=&nbsp;listToStruct&nbsp;xs&nbsp;==&nbsp;listToStruct&nbsp;ys<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Tree&nbsp;a&nbsp;|&nbsp;Eq&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;Eq&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;(==)&nbsp;xs&nbsp;ys&nbsp;=&nbsp;treeToStruct&nbsp;xs&nbsp;==&nbsp;treeToStruct&nbsp;ys<br></div>
</p><p style="text-align:justify;">Not only instances of one class expose similarity in the definition of instances.</p>
<p><div style="background-color:#FFFF45";>The Bifunctor provides the mapping function for a type constructor of kind *-&gt;*-&gt;*. Instances are defined in a similar way to instances of Functor.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Tree2&nbsp;a&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Tip&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Bin&nbsp;b&nbsp;(Tree&nbsp;a&nbsp;b)&nbsp;(Tree&nbsp;a&nbsp;b)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;Bifunctor&nbsp;f<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bmap&nbsp;::&nbsp;(a1&nbsp;-&gt;&nbsp;b1)&nbsp;(a2&nbsp;-&gt;&nbsp;b2)&nbsp;(f&nbsp;a1&nbsp;a2)&nbsp;-&gt;&nbsp;(f&nbsp;b1&nbsp;b2)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;Bifunctor&nbsp;Tree<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bmap&nbsp;::&nbsp;(a1&nbsp;-&gt;&nbsp;b1)&nbsp;(a2&nbsp;-&gt;&nbsp;b2)&nbsp;(Tree2&nbsp;a1&nbsp;a2)&nbsp;-&gt;&nbsp;(Tree&nbsp;b1&nbsp;b2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;bmap&nbsp;f1&nbsp;f2&nbsp;(Tip&nbsp;x)&nbsp;=&nbsp;Tip&nbsp;(f1&nbsp;x)<br>
&nbsp;&nbsp;&nbsp;&nbsp;bmap&nbsp;f1&nbsp;f2&nbsp;(Bin&nbsp;x&nbsp;l&nbsp;r)&nbsp;=&nbsp;Bin&nbsp;(f2&nbsp;x)&nbsp;(bmap&nbsp;f1&nbsp;f2&nbsp;l)&nbsp;(bmap&nbsp;f1&nbsp;f2&nbsp;r)<br></div>
</p><p style="text-align:justify;">The instance in the example above also works in a similar way as the instance of Functor: it also maps substructures component-wise. Both Functor and Bifunctor provide <i>mapping</i> function. The difference is that one provides mapping for type constructors of kind *-&gt;* and the other for type constructors of kind *-&gt;*-&gt;*. In fact instances of mapping functions for all kinds are similar.</p>
<h2 style="background-color:#9999FF;"><a id="_7.2">7.2 Defining Generic Functions</a></h2>
<p style="text-align:justify;">The generic feature of CLEAN is able to derive instances for types of different kinds from a single generic definition. Such generic functions are known as kind-indexed generic functions (Alimarine &amp; Plasmeijer, <span style="color:#0000FF;">A Generic Programming Extension for Clean</span>). Actually, a generic function in CLEAN stands for a <i>set</i> of classes and instances of the <i>same</i> function for <i>different</i> kinds. Since CLEAN allows function to be used in a Curried manner (<span style="color:blue;"><a href="#_3.7.1">see 3.7.1</a></span>), the compiler is in general not able to deduce which kind of map is meant. Therefore the <i>kind</i> of a generic function application has to be specified explicitly.</p>
<p style="text-align:justify;">To define a generic function the programmer has to provide to things: the base type of the generic function and the base cases (instances) of the generic function.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericsDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericDef ;</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GenericCase;</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">DeriveDef ;</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>generic</b></span> <span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;">TypeVariable</span>+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType</td></tr>
<tr><td style="width:23.0290909090909%;">GenericCase</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#993300;"><b>{|</b></span>GenericTypeArg<span style="font-family:courier;color:#993300;"><b>|}</b></span> {Pattern}+ <span style="font-family:courier;color:#993300;"><b>=</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;">GenericTypeArg</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericMarkerType [<span style="font-family:courier;color:#FF0000;"><b>of</b></span> Pattern]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeVariable</span></td></tr>
<tr><td style="width:23.0290909090909%;">GenericMarkerType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>CONS</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>OBJECT</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>RECORD</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>FIELD</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">In the generic definition, recognised by the keyword <span style="font-family:courier;color:#FF0000;"><b>generic</b></span>, first the type of the generic function has to be specified. The type variables mentioned after the generic function name are called <i>generic type variables</i>. Similar to type classes, they are substituted by the actual instance type. A generic definition actually defines a <i>set</i> of type constructor classes. There is one class for each possible kind in the set. Such a generic funcion is sometimes called a kind-indexed class. The classes are generated using the type of the generic function. The classes always have one class variable, even if the generic function has several generic variables. The reason for this restriction is that the generic function can be defined by induction on one argument only.</p>
<p><div style="background-color:#FFFF45";>Example. The generic definition of equality.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;gEq&nbsp;a&nbsp;::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Bool<br>
gEq&nbsp;{|Int|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
gEq&nbsp;{|Char|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
gEq&nbsp;{|Bool|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
gEq&nbsp;{|Real|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x&nbsp;==&nbsp;y<br>
gEq&nbsp;{|UNIT|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;True<br>
gEq&nbsp;{|PAIR|}&nbsp;&nbsp;&nbsp;eqx&nbsp;eqy&nbsp;&nbsp;&nbsp;(PAIR&nbsp;x1&nbsp;y1)&nbsp;(PAIR&nbsp;x2&nbsp;y2)&nbsp;&nbsp;=&nbsp;eqx&nbsp;x1&nbsp;x2&nbsp;&amp;&amp;&nbsp;eqy&nbsp;y1&nbsp;y2<br>
gEq&nbsp;{|EITHER|}&nbsp;eql&nbsp;eqr&nbsp;&nbsp;&nbsp;(LEFT&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LEFT&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;eql&nbsp;x&nbsp;y<br>
gEq&nbsp;{|EITHER|}&nbsp;eql&nbsp;eqr&nbsp;&nbsp;&nbsp;(RIGHT&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;(RIGHT&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;eqr&nbsp;x&nbsp;y<br>
gEq&nbsp;{|EITHER|}&nbsp;eql&nbsp;eqr&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;False<br>
gEq&nbsp;{|CONS|}&nbsp;&nbsp;&nbsp;eq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONS&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONS&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;eq&nbsp;x&nbsp;y<br>
gEq&nbsp;{|OBJECT|}&nbsp;eq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(OBJECT&nbsp;x)&nbsp;&nbsp;&nbsp;(OBJECT&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;eq&nbsp;x&nbsp;y<br>
gEq&nbsp;{|RECORD|}&nbsp;eq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RECORD&nbsp;x)&nbsp;&nbsp;&nbsp;(RECORD&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;eq&nbsp;x&nbsp;y<br>
gEq&nbsp;{|FIELD|}&nbsp;&nbsp;eq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(FIELD&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;(FIELD&nbsp;y)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;eq&nbsp;x&nbsp;y<br></div>
</p><p><div style="background-color:#FFFF45";>Example. The generic definition of map.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;gMap&nbsp;a&nbsp;b&nbsp;::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;b<br>
gMap&nbsp;{|c|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x<br>
gMap&nbsp;{|PAIR|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fx&nbsp;fy&nbsp;&nbsp;&nbsp;&nbsp;(PAIR&nbsp;x&nbsp;y)&nbsp;&nbsp;&nbsp;=&nbsp;PAIR&nbsp;(fx&nbsp;x)&nbsp;(fy&nbsp;y)<br>
gMap&nbsp;{|EITHER|}&nbsp;&nbsp;&nbsp;fl&nbsp;fr&nbsp;&nbsp;&nbsp;&nbsp;(LEFT&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LEFT&nbsp;(fl&nbsp;x)<br>
gMap&nbsp;{|EITHER|}&nbsp;&nbsp;&nbsp;fl&nbsp;fr&nbsp;&nbsp;&nbsp;&nbsp;(RIGHT&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;RIGHT&nbsp;(fr&nbsp;x)<br>
gMap&nbsp;{|CONS|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONS&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CONS&nbsp;(fx&nbsp;x)<br>
gMap&nbsp;{|OBJECT|}&nbsp;&nbsp;&nbsp;fx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(OBJECT&nbsp;x)&nbsp;&nbsp;&nbsp;=&nbsp;OBJECT&nbsp;(fx&nbsp;x)<br>
gMap&nbsp;{|RECORD|}&nbsp;&nbsp;&nbsp;fx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RECORD&nbsp;x)&nbsp;&nbsp;&nbsp;=&nbsp;RECORD&nbsp;(fx&nbsp;x)<br>
gMap&nbsp;{|FIELD|}&nbsp;&nbsp;&nbsp;&nbsp;fx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(FIELD&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;FIELD&nbsp;(fx&nbsp;x)<br></div>
</p><p><div style="background-color:#FFFF45";>Classes that are automatically generated for the generic map function given above.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;gMap{|*|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;t&nbsp;-&gt;&nbsp;t<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;gMap{|*-&gt;*|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(t&nbsp;a)&nbsp;-&gt;&nbsp;t&nbsp;b<br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;gMap{|*-&gt;*-&gt;*|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(a1&nbsp;-&gt;&nbsp;b1)&nbsp;(a2&nbsp;-&gt;&nbsp;b2)&nbsp;(t&nbsp;a1&nbsp;a2)&nbsp;-&gt;&nbsp;t&nbsp;b1&nbsp;b2<br>
...<br></div>
</p><p style="text-align:justify;">Roughly the algorithm for deriving classes is the following.</p>
<p><div style="background-color:#FFFF45";>Algorithm for generating classes. Suppose we have a generic function <span style="font-family:courier;">genFun</span> with type <span style="font-family:courier;">GenFun</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;GenFun&nbsp;a1&nbsp;..&nbsp;an&nbsp;:==&nbsp;..<br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;genFun&nbsp;a1&nbsp;..&nbsp;an&nbsp;::&nbsp;GenFun&nbsp;a1&nbsp;..&nbsp;an<br>
<br></div>
<div style="background-color:#FFFF45";>A class for kind <i>k</i>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;genFun{|k|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;GenFun{|k|}&nbsp;t&nbsp;..&nbsp;t<br>
<br></div>
<div style="background-color:#FFFF45";>Is derived by induction on the structure of kind</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;GenFun{|*|}&nbsp;a1&nbsp;...&nbsp;an&nbsp;&nbsp;&nbsp;:==&nbsp;GenFun&nbsp;a1..&nbsp;an<br>
::&nbsp;GenFun{|k-&gt;l|}&nbsp;a1&nbsp;..an&nbsp;&nbsp;:==<br>
&nbsp;&nbsp;&nbsp;&nbsp;A.b1&nbsp;..&nbsp;bn:&nbsp;(GenFun{|k|}&nbsp;b1&nbsp;..&nbsp;bn)&nbsp;-&gt;&nbsp;GenFun{|l|}&nbsp;(a1&nbsp;b1)&nbsp;..&nbsp;(an&nbsp;bn)<br></div>
</p><p style="text-align:justify;">The programmer provides a set of basic cases for a generic function. Based on its basic cases a generic function can be derived for other types. See the next section for detailed discussion on types for which a generic function can and cannot be derived. Here we discuss what can be specified as the type argument in the definition of a generic base case</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>A Generic structural representation type</i>: <span style="font-family:courier;">UNIT</span>, <span style="font-family:courier;">PAIR</span>, <span style="font-family:courier;">EITHER</span>, <span style="font-family:courier;">CONS</span>, <span style="font-family:courier;">OBJECT</span>, <span style="font-family:courier;">RECORD</span> and <span style="font-family:courier;">FIELD</span>. The programmer <i>must always provide</i> these cases as they cannot be derived by the compiler. Without these cases a generic function cannot be derived for basically any type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Basic type</i>. If a generic function is supposed to work on types that involve basic types, instances for basic types must be provided.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Type variable</i>. Type variable stands for all types of kind *. If a generic function has a case for a type variable it means that by default all types of kind star will be handled by that instance. The programmer can override the default behavior by defining an instance on a specific type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Arrow type (-&gt;)</i>. If a generic function is supposed to work with types that involve the arrow type, an instance on the arrow type has to be provided.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Type constructor</i>. A programmer may provide instances on other types. This may be needed for two reasons:</td></tr>
</table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">1.</td><td style="text-align:justify;">The instance cannot be derived for the reasons explained in the next section.</td></tr>
<tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">2.</td><td style="text-align:justify;">The instance can be generated, but the programmer is not satisfied with generic behavior for this type and wants to provide a specific behavior.</td></tr>
</table><h2 style="background-color:#9999FF;"><a id="_7.3">7.3 Deriving Generic Functions</a></h2>
<p style="text-align:justify;">The user has to tell the compiler instances of which generic functions on which types are to be generated. This is done with the <i>derive</i> clause.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DeriveDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>derive</b></span> <span style="font-family:courier;">FunctionName</span> {<span style="font-family:courier;">TypeConstructorName</span>}-list</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Deriving instances of generic mapping and generic equality for List , Tree and standard list</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>derive</b></span>&nbsp;gEq&nbsp;&nbsp;List,&nbsp;Tree,&nbsp;[]<br>
<span style="font-family:courier;color:#FF0000;"><b>derive</b></span>&nbsp;gMap&nbsp;List,&nbsp;Tree,&nbsp;[]<br></div>
</p><p style="text-align:justify;">A generic function can be automatically specialized only to algebraic types that are not abstract in the module where the <i>derive</i> directive is given. A generic function cannot be automatically derived for the following types:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Generic structure representation types: </i><span style="font-family:courier;">UNIT</span>, <span style="font-family:courier;">PAIR</span>, <span style="font-family:courier;">EITHER</span>, <span style="font-family:courier;">CONS</span>, <span style="font-family:courier;">OBJECT</span>, <span style="font-family:courier;">RECORD</span>, <span style="font-family:courier;">FIELD</span>. See also the previous section. It is impossible to derive instances for these types automatically because they are themselves used to build structural representation of types that is needed to derive an instance. Deriving instances for then would yield non-terminating cyclic functions. Instances on these types must be provided for the user. Derived instances of algebraic types call these instances.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Arrow  type  (-&gt;)</i>. An instance on the arrow type has to be provided by the programmer, if he or she wants the generic function to work with types containing arrows.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Basic types</i> like <span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Char</span>, <span style="font-family:courier;">Real</span>, <span style="font-family:courier;">Bool</span>. In principle it is possible to represent all these basic types as algebraic types but that would be very inefficient. The user can provide a user defined instance on a basic type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Array types</i> as they are not algebraic. The user can provide a user defined instance on an array type.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Synonym types</i>. The user may instead derive a generic function for the types involved on the right-hand-side of a type synonym type definition.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Abstract types</i>. The compiler does not know the structure of an abstract data type needed to derive the instance.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;"><i>Quantified types</i>. The programmer has to manually provide instances for type definitions with universal and existential quantification.</td></tr>
</table>
<p style="text-align:justify;">The compiler issues an error if there is no required instance for a type available. Required instances are determined by the overloading mechanism.</p>
<h2 style="background-color:#9999FF;"><a id="_7.4">7.4 Applying Generic Functions</a></h2>
<p style="text-align:justify;">The generic function in Clean stands for a set of overloaded functions. There is one function in the set for each kind. When a generic function is applied, the compiler must select one overloaded function in the set. The compiler cannot derive the required kind automatically. For this reason a kind has to be provided explicitly at each generic function application. Between the brackets <span style="font-family:courier;">{|</span> and <span style="font-family:courier;">|}</span> one can specify the intended kind. The compiler then resolves overloading of the selected overloaded function as usually.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericAppExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span>TypeKind GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">TypeKind</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{|* </b></span>{<span style="font-family:courier;color:#993300;"><b>-&gt; *</b></span>} <span style="font-family:courier;color:#993300;"><b>|}</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example: a generic equality operator can be defined as equality on types of kind *.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(===)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infix</b></span>&nbsp;2&nbsp;::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;gEq{|*|}&nbsp;a<br>
(===)&nbsp;x&nbsp;y&nbsp;=&nbsp;gEq{|*|}&nbsp;x&nbsp;y<br></div>
</p><p><div style="background-color:#FFFF45";>Example: a mapping function <span style="font-family:courier;">fmap</span> for functors and <span style="font-family:courier;">bmap</span> for bifunctors can be defined in terms of the generic mapping function defined above just by specializing it for the appropriate kind.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
fmap&nbsp;::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(f&nbsp;a)&nbsp;-&gt;&nbsp;(f&nbsp;b)&nbsp;|&nbsp;gMap{|*-&gt;*|}&nbsp;f<br>
fmap&nbsp;f&nbsp;x&nbsp;y&nbsp;=&nbsp;gMap{|*-&gt;*|}&nbsp;f&nbsp;x&nbsp;y<br>
<br>
bmap&nbsp;::&nbsp;(a1&nbsp;-&gt;&nbsp;b1)&nbsp;(a2&nbsp;-&gt;&nbsp;b2)&nbsp;(f&nbsp;a1&nbsp;a2)&nbsp;-&gt;&nbsp;(f&nbsp;b1&nbsp;b2)&nbsp;|&nbsp;gMap{|*-&gt;*-&gt;*|}&nbsp;f<br>
bmap&nbsp;f1&nbsp;f2&nbsp;x&nbsp;y&nbsp;=&nbsp;gMap{|*-&gt;*-&gt;*|}&nbsp;f1&nbsp;f2&nbsp;x&nbsp;y<br></div>
</p><p><div style="background-color:#FFFF45";>Equality makes sense not only on for kind *. In the example we alter the standard way of comparing elements. Equality for kind * and *-&gt;* are explicitly used.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
eqListFsts&nbsp;::&nbsp;[(a,&nbsp;b)]&nbsp;[(a,&nbsp;c)]&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;gEq{|*|}&nbsp;a<br>
eqListFsts&nbsp;xs&nbsp;ys&nbsp;=&nbsp;gEq{|*-&gt;*|}&nbsp;( &nbsp;y&nbsp;-&gt;&nbsp;fst&nbsp;x&nbsp;===&nbsp;fst&nbsp;y)&nbsp;ys<br>
<br>
eqFsts&nbsp;::&nbsp;(f&nbsp;(a,&nbsp;b))&nbsp;(f&nbsp;(a,&nbsp;c))&nbsp;-&gt;&nbsp;Bool&nbsp;|&nbsp;gEq{|*-&gt;*|}&nbsp;f&nbsp;&amp;&nbsp;gEq{|*|}&nbsp;a<br>
eqFsts&nbsp;xs&nbsp;ys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gEq{|*-&gt;*|}&nbsp;( &nbsp;y&nbsp;-&gt;&nbsp;fst&nbsp;x&nbsp;===&nbsp;fst&nbsp;y)&nbsp;ys<br></div>
</p><p><div style="background-color:#FFFF45";>Examples of generic applications</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Start&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;gEq{|*|}&nbsp;[1,2,3]&nbsp;[2,3,3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;True</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;[1,2,3]&nbsp;===&nbsp;[1,2,3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;True</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gEq{|*-&gt;*|}&nbsp;(\x&nbsp;y&nbsp;-&gt;&nbsp;True)&nbsp;[1,2,3]&nbsp;[4,5,6]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;True</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_7.5">7.5 Using Constructor Information</a></h2>
<p style="text-align:justify;">As it was outlined above, the structural representation of types lacks information about specific constructors and record fields, such as name, arity etc. This is because this information is not really part of the structure of types: different types can have the same structure. However, some generic functions need this information. Consider, for example a generic toString function that converts a value of any type to a string. It needs to print constructor names. For that reason the structural representation of types is extended with special constructor and field markers that enable us to pass information about fields and constructors to a generic function.</p>
<p><div style="background-color:#FFFF45";>Definition of the constructor and field marker types (in StdGeneric.dcl).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;CONS&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CONS&nbsp;a<br>
::&nbsp;OBJECT&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;OBJECT&nbsp;a<br>
::&nbsp;RECORD&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;RECORD&nbsp;a<br>
::&nbsp;FIELD&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;FIELD&nbsp;a<br></div>
</p><p style="text-align:justify;">The markers themselves do not contain any information about constructors and fields. Instead, the information is passed to instances of a generic function on these markers.</p>
<p><div style="background-color:#FFFF45";>Examples of structural representation with constructor and field information</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;ListS&nbsp;a&nbsp;&nbsp;&nbsp;:==&nbsp;EITHER&nbsp;(CONS&nbsp;UNIT)&nbsp;(CONS&nbsp;(PAIR&nbsp;a&nbsp;(List&nbsp;a)))<br>
::&nbsp;TreeS&nbsp;a&nbsp;&nbsp;&nbsp;:==&nbsp;EITHER&nbsp;(CONS&nbsp;a)&nbsp;(CONS&nbsp;(PAIR&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)))<br>
<br>
::&nbsp;Complex&nbsp;&nbsp;&nbsp;=&nbsp;{&nbsp;re&nbsp;&nbsp;&nbsp;::&nbsp;Real,&nbsp;im&nbsp;&nbsp;&nbsp;::&nbsp;Real&nbsp;}<br>
::&nbsp;ComplexS&nbsp;&nbsp;:==&nbsp;PAIR&nbsp;(FIELD&nbsp;Real)&nbsp;(FIELD&nbsp;Real)<br></div>
</p><table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericTypeArg</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericMarkerType [<span style="font-family:courier;color:#FF0000;"><b>of</b></span> Pattern]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeVariable</span></td></tr>
<tr><td style="width:23.0290909090909%;">GenericMarkerType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>CONS</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>OBJECT</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>RECORD</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>FIELD</b></span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Definition of the algebraic type, constructor, record type and field descriptors (StdGeneric.dcl)<br>The algebraic type descriptor is passed after <span style="font-family:courier;color:#FF0000;"><b>of</b></span> in the OBJECT case of a generic function.<br></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">::&nbsp;GenericTypeDefDescriptor&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;gtd_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gtd_arity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gtd_num_conses&nbsp;::&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gtd_conses&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;[GenericConsDescriptor]<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br></div>
<div style="background-color:#FFFF45";>The constructor descriptor is passed after <span style="font-family:courier;color:#FF0000;"><b>of</b></span> in the CONS case of a generic function.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">::&nbsp;GenericConsDescriptor&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;gcd_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gcd_arity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gcd_prio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;GenConsPrio&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;priority&nbsp;and&nbsp;associativity</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gcd_type_def&nbsp;&nbsp;&nbsp;::&nbsp;GenericTypeDefDescriptor&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;def&nbsp;of&nbsp;the&nbsp;constructor</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gcd_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;GenType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;the&nbsp;constructor</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gcd_index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;index&nbsp;of&nbsp;the&nbsp;contructor&nbsp;in&nbsp;the&nbsp;type&nbsp;def</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br></div>
<div style="background-color:#FFFF45";>The record descriptor is passed after <span style="font-family:courier;color:#FF0000;"><b>of</b></span> in the RECORD case of a generic function.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">::&nbsp;GenericRecordDescriptor&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;grd_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;grd_arity&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;grd_type_arity&nbsp;::&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;arity&nbsp;of&nbsp;the&nbsp;type</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;grd_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;GenType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;type&nbsp;of&nbsp;the&nbsp;constructor</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;grd_fields&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;[String]<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br></div>
<div style="background-color:#FFFF45";>The field descriptor is passed after <span style="font-family:courier;color:#FF0000;"><b>of</b></span> in the FIELD case of a generic function.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;">::&nbsp;GenericFieldDescriptor&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;gfd_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;String<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gfd_index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;index&nbsp;of&nbsp;the&nbsp;field&nbsp;in&nbsp;the&nbsp;record</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;gfd_cons&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;GenericRecordDescriptor&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;the&nbsp;record&nbsp;constructor</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br></div>
</p><p><div style="background-color:#FFFF45";>Generic pretty printer.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
generic&nbsp;gToString&nbsp;a&nbsp;::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;String<br>
gToString&nbsp;{|Int|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;toString&nbsp;x<br>
gToString&nbsp;{|UNIT|}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x<br>
gToString&nbsp;{|PAIR|}&nbsp;fx&nbsp;fy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(PAIR&nbsp;x&nbsp;y)&nbsp;&nbsp;&nbsp;=&nbsp;fx&nbsp;sep&nbsp;x&nbsp;+++&nbsp;sep&nbsp;+++&nbsp;fy&nbsp;sep&nbsp;y<br>
gToString&nbsp;{|EITHER|}&nbsp;fl&nbsp;fr&nbsp;&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LEFT&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;fl&nbsp;sep&nbsp;x<br>
gToString&nbsp;{|EITHER|}&nbsp;fl&nbsp;fr&nbsp;&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RIGHT&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;fr&nbsp;sep&nbsp;x<br>
gToString&nbsp;{|CONS&nbsp;of&nbsp;c|}&nbsp;fx&nbsp;&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CONS&nbsp;x)<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;c.gcd_arity&nbsp;==&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c.gcd_name<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;isEmpty&nbsp;c.gcd_fields<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;"("&nbsp;+++&nbsp;c.gcd_name&nbsp;+++&nbsp;"&nbsp;"&nbsp;+++&nbsp;fx&nbsp;"&nbsp;"&nbsp;&nbsp;x&nbsp;+++&nbsp;")"<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;otherwise<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;"{"&nbsp;+++&nbsp;c.gcd_name&nbsp;+++&nbsp;"&nbsp;|&nbsp;"&nbsp;+++&nbsp;fx&nbsp;",&nbsp;"&nbsp;x&nbsp;+++&nbsp;"}"<br>
gToString&nbsp;{|FIELD&nbsp;of&nbsp;f|}&nbsp;fx&nbsp;&nbsp;&nbsp;sep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(FIELD&nbsp;x)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;f.gfd_name&nbsp;+++&nbsp;"="&nbsp;+++&nbsp;fx&nbsp;x<br>
<br>
toStr&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;String&nbsp;|&nbsp;gToString{|*|}&nbsp;a<br>
toStr&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;gToString{|*|}&nbsp;""&nbsp;x<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_7.6">7.6 Generic Functions and Uniqueness Typing</a></h2>
<p style="text-align:justify;">Uniqueness is very important in Clean. The generic extension can deal with uniqueness. The mechanism that derives generic types for different kinds is extended to deal with uniqueness information. Roughly speaking it deals with uniqueness attribute variables in the same way as it does with normal generic variables.</p>
<p><div style="background-color:#FFFF45";>The type of standard mapping for lists with uniqueness</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map&nbsp;::&nbsp;(.a&nbsp;-&gt;&nbsp;.b)&nbsp;![.a]&nbsp;-&gt;&nbsp;[.b]<br></div>
</p><p><div style="background-color:#FFFF45";>Generic mapping with uniqueness.  The instance on lists has the same uniqueness typing as the standard map</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;gMap&nbsp;a&nbsp;b&nbsp;::&nbsp;.a&nbsp;-&gt;&nbsp;.b<br></div>
</p><p style="text-align:justify;">Uniqueness information specified in the generic function is used in typing of generated code.</p>
<p><div style="background-color:#FFFF45";>Generated classes</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
class&nbsp;gMap{|*|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;.t&nbsp;-&gt;&nbsp;.t<br>
class&nbsp;gMap{|*-&gt;*|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(.a&nbsp;-&gt;&nbsp;.b)&nbsp;(.t&nbsp;.a)&nbsp;-&gt;&nbsp;.t&nbsp;.b<br>
class&nbsp;gMap{|*-&gt;*-&gt;*|}&nbsp;t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;(.a1&nbsp;-&gt;&nbsp;.b1)&nbsp;(.a2&nbsp;-&gt;&nbsp;.b2)&nbsp;(.t&nbsp;.a1&nbsp;.a2)&nbsp;-&gt;&nbsp;.t&nbsp;.b1&nbsp;.b2<br></div>
</p><p style="text-align:justify;">Current limitations with uniqueness: generated types for higher order types require local uniqueness inequalities which are currently not supported.</p>
<p><div style="background-color:#FFFF45";>Counter Example due to limitation in the current version of Clean.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
class&nbsp;gMap{|(*-&gt;*)-&gt;*|}&nbsp;t&nbsp;&nbsp;::<br>
&nbsp;&nbsp;&nbsp;&nbsp;(A.&nbsp;(a:a)&nbsp;(b:b):&nbsp;(.a&nbsp;-&gt;&nbsp;.b)&nbsp;-&gt;&nbsp;(f:f&nbsp;a:a)&nbsp;-&gt;&nbsp;g:g&nbsp;a:a,&nbsp;[f&nbsp;&lt;=&nbsp;a,&nbsp;g&nbsp;&lt;=&nbsp;b])<br>
&nbsp;&nbsp;&nbsp;&nbsp;(.t&nbsp;.f)&nbsp;-&gt;&nbsp;.t&nbsp;.g<br>
&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;[f&nbsp;&lt;=&nbsp;t,&nbsp;g&nbsp;&lt;=&nbsp;t]<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_7.7">7.7 Exporting Generic Functions</a></h2>
<p style="text-align:justify;">Generic declarations and generic cases - both provided and derived - can be exported from a module. Exporting a generic function is done by giving the <i>generic</i> declaration in the DCL module. Exporting provided and derived generic cases is done by means of <i>derive</i>.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericExportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericDef <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>derive</b></span> <span style="font-family:courier;">FunctionName</span> {DeriveExportTypeArg}-list <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">GenericDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>generic</b></span> <span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;">TypeVariable</span>+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DeriveExportTypeArg</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GenericMarkerType [<span style="font-family:courier;color:#FF0000;"><b>of</b></span> UsedGenericInfoFields]</td></tr>
<tr><td style="width:23.0290909090909%;">UsedGenericInfoFields</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[{<span style="font-family:courier;">FieldName</span>}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span></td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example. Exporting of generic mapping. Definition as given in module GenMap.dcl</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;gMap&nbsp;a&nbsp;b&nbsp;::&nbsp;.a&nbsp;-&gt;&nbsp;.b<br>
<span style="font-family:courier;color:#FF0000;"><b>derive</b></span>&nbsp;gMap&nbsp;c,&nbsp;PAIR,&nbsp;EITHER,&nbsp;CONS,&nbsp;FIELD,&nbsp;[]<br></div>
</p><p style="text-align:justify;">A generic function cannot be derived for an abstract data type, but it can be derived in the module where the abstract type defined. Thus, when one may export derived instance along with the abstract data type.</p>
<!-- chapter:Chapter 8-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_8"><br>Chapter 8<br><br>Dynamics</a></h1></div>
<p style="text-align:justify;">Dynamics are a new experimental feature of CLEAN. The concept is easy to understand, but the implementation is not so straightforward (see Vervoort and Plasmeijer, 2002). So, it will take some time before all bits and pieces are implemented and the system will work flawlessly. Please be patient.</p>
<p style="text-align:justify;">What can you do with "Dynamics"? With "Dynamics" it is possible to store and exchange a CLEAN expression between (different) CLEAN applications in an easy and type-safe way. The expression may contain (unevaluated!) data and (unevaluated!) function applications. Here are some examples of its use.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Almost all applications <i>store and fetch information to and from disk</i> (settings and the like). Traditionally, information written to file first has to be converted by the programmer to some (<i>String</i>) format. When the file is read in again a parser has to be constructed to parse the input and to convert the <i>String</i> back to the appropriate data structure. With <span style="font-family:courier;">Dynamic</span>s one can store and retrieve (almost) any CLEAN data structure in a type-safe way with just one (!) function call. Not only data can be saved, but also code (unevaluated functions, higher order functions), which is part of the data structure being stored. <span style="font-family:courier;">Dynamic</span>s make it easier to write a <i>persistent application</i>: an application that stores the settings in such a way that the next time the user will see everything in the same way as the last time the application was used.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Different independently programmed CLEAN applications, even applications <i>distributed</i> across a network, can easily <i>communicate arbitrary expressions</i> that can contain data as well as code (unevaluated functions) in a type-safe way. <span style="font-family:courier;">Dynamic</span>s can be communicated via files or via message passing primitives offered by the CLEAN libraries. The fact that CLEAN applications can communicate code means that a running CLEAN application can be extended with additional functionality. So, <i>plug-ins</i> and <i>mobile code</i> can be realized very easily and everything is <i>type-safe</i>.</td></tr>
</table>
<p style="text-align:justify;">To make all this possible we need some special facilities in the CLEAN language. But, in the CLEAN run-time system special support is needed as well. This includes <i>dynamic type checking</i>, <i>dynamic type unification</i>, dynamic encoding and <i>decoding</i> of arbitrary CLEAN <i>expressions and types</i>, <i>dynamic linking</i>, <i>garbage collection</i> of dynamics objects on disk, and <i>just-in-time code generation</i>.</p>
<p style="text-align:justify;">In CLEAN 2.0 we have added a <i>dynamic type system</i> such that CLEAN now offers a <i>hybrid type system</i> with both <i>static</i> as well as <i>dynamic typing</i>. An object (expression) of static type can be packed into an object of dynamic type (a "<span style="font-family:courier;">Dynamic</span>") and backwards. The type of a Dynamic can only be checked at run-time. An application can also check whether types of several Dynamics can be unified with each other, without a need to know what types are exactly stored into a Dynamic. In this way CLEAN applications can be used as control language to manage processes and plug-ins (see Van Weelden and Plasmeijer, 2002).</p>
<p style="text-align:justify;">In this Chapter we first explain how a Dynamic can be constructed (<span style="color:blue;"><a href="#_8.1">see 8.1</a></span>). In <span style="color:blue;"><a href="#_8.2">Section 8.2</a></span> we explain how the type of a <span style="font-family:courier;">Dynamic</span> can be inspected via a pattern match, and how one can ensure that <span style="font-family:courier;">Dynamics</span> fit together by using run-time type unification.</p>
<p style="text-align:justify;">We explain in <span style="color:blue;"><a href="#_8.3">Section 8.3</a></span> how dynamics can be used to realize type safe communication of expressions between independently executing applications. In Section 8.4 we explain the basic architecture of the CLEAN run-time system that makes this all possible. Semantic restrictions and restrictions of the current implementation are summarized in <span style="color:blue;"><a href="#_8.5">Section 8.5</a></span>.</p>
<h2 style="background-color:#9999FF;"><a id="_8.1">8.1 Packing Expressions into a Dynamic</a></h2>
<p style="text-align:justify;">Since CLEAN is a strongly typed language (<span style="color:blue;"><a href="#_5">see Chapter 5</a></span>), <i>every</i> expression in CLEAN has a <i>static type</i> determined at <i>compile time</i>. The CLEAN compiler is in general able to infer the static type of any expression or any function.</p>
<p><div style="background-color:#FFFF45";>Example of CLEAN expressions and their static type:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
3::Int<br>
map::(a&nbsp;-&gt;&nbsp;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;((+)&nbsp;1)::[Int]&nbsp;-&gt;[Int]<br>
MoveColorPoint&nbsp;Green::(Real,Real)&nbsp;-&gt;&nbsp;ColorPoint<br></div>
</p><p style="text-align:justify;">By using the keyword <span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span> one can (in principle) change <i>any</i>expression of static type <span style="font-family:courier;">:: &tau;</span> into a dynamically typed object of static type <span style="font-family:courier;">::Dynamic</span>. Such a "dynamic" is an object (a record to be precise) that contains the original expression as well as an encoding of the original static type of the expression. Both the expression as well as the encoding of its static type, are packed into a dynamic. At run-time, the contents of a dynamic (the value of the expression as well the encoded type) can be inspected via a dynamic pattern match (<span style="color:blue;"><a href="#_8.2">see 8.2</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DynamicExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span> GraphExpr [<span style="font-family:courier;color:#993300;"><b>::</b></span> [UniversalQuantVariables] Type [ClassContext]]</td></tr>
</table><p></p>
<p><div style="background-color:#FFFF45";>Example showing how one can pack an expression into a <span style="font-family:courier;">Dynamic</span>. Optionally, the static type of the expression one wants to pack into a Dynamic can be specified.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;3<br>
<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;3::Int<br>
<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;map::A.a&nbsp;b:(a-&gt;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;map::(Int&nbsp;-&gt;&nbsp;Real)&nbsp;[Int]&nbsp;-&gt;&nbsp;[Real]<br>
<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;map&nbsp;((+)&nbsp;1)<br>
<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;MoveColorPoint&nbsp;Green<br></div>
</p><p><div style="background-color:#FFFF45";>Example of a (constant) function creating a dynamic containing an expression of type <span style="font-family:courier;">Tree Int</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;|&nbsp;Leaf<br>
<br>
MyTree::Dynamic<br>
MyTree&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(DoubleTree&nbsp;1&nbsp;mytree)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;Doubletree&nbsp;rootvalue&nbsp;tree&nbsp;=&nbsp;Node&nbsp;rootvalue&nbsp;tree&nbsp;tree<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;mytree&nbsp;=&nbsp;(Node&nbsp;2&nbsp;(Node&nbsp;3&nbsp;Leaf&nbsp;Leaf)&nbsp;Leaf)<br></div>
</p><p style="text-align:justify;">Only the compiler is able to combine an expression with its type into a dynamic, such that it is guaranteed that the encoded type is indeed the type of the corresponding packed expression. However, as usual it is allowed to specify a more specific type than the one the compiler would infer. The compiler will check the correctness of such a (restricted) type specification. Polymorphic types can be stored as well.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">If an expression of polymorphic type is packed into a dynamic one needs to explicitly specify the universal quantifiers as well (see the example above).</td></tr>
</table>
<p style="text-align:justify;">In principle (there are a few exceptions), any algebraic data type can be packed into a dynamic, including basic types, function types, user defined types, polymorphic types, record types, all types of arrays, all types of lists, and existentially quantified types. The system can deal with synonym types as well. Restrictions hold for packing abstract data types, uniqueness types and overloaded functions, see the sub-sections below.</p>
<p style="text-align:justify;">The static type of the object created with the keyword "dynamic" is the predefined type <span style="font-family:courier;">Dynamic</span>. Since all objects created in this way are of type <span style="font-family:courier;">Dynamic</span>, the compiler is in general not able anymore to determine the static type hidden in the <span style="font-family:courier;">Dynamic</span> and it cannot check its type consistency anymore. The type stored into a <span style="font-family:courier;">Dynamic</span> has to be checked at run-time (<span style="color:blue;"><a href="#_8.2">see 8.2</a></span> and <span style="color:blue;"><a href="#_8.3">8.3</a></span>).</p>
<h3 style="background-color:#9999FF;"><a id="_8.1.1">8.1.1 Packing Abstract Data Types</a></h3>
<p style="text-align:justify;">Certain types simply cannot be packed into a <span style="font-family:courier;">Dynamic</span> for fundamental reasons. Examples are objects of abstract predefined type that have a special meaning in the real world, such as objects of type <span style="font-family:courier;">World</span> and of type <span style="font-family:courier;">File</span>. It is not sound to pack objects of these types into a Dynamic, because their real world counterpart cannot be packed and stored.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Abstract data types that have a meaning in the real world (such as World, File) cannot be packed into Dynamic.</td></tr>
</table>
<p style="text-align:justify;">A compile time error message will be given in those cases were the  compiler refuses to pack an expression into a <span style="font-family:courier;">Dynamic</span>.</p>
<p style="text-align:justify;">In the current implementation there are additional restrictions on the kind of types that can be packed into a<span style="font-family:courier;">Dynamic</span>. Currently it is not possible to pack any abstract data type into a dynamic at all. The reason is that the test on equality of abstract types is not easy: it does not seem to be enough to test the equality of the definitions of the types involved. We should also test whether the operations defined on these abstract data types are exactly the same. The most straightforward way to do this would be to require that abstract data types  are coming from the same module (repository).</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Expressions containing objects of abstract data type cannot be packed into a Dynamic. We are working on this. Check the latest version of the <span style="font-family:courier;">Clean</span> system.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_8.1.2">8.1.2 Packing Overloaded Functions</a></h3>
<p style="text-align:justify;">Overloaded functions can also be packed into a <span style="font-family:courier;">Dynamic</span>. In that case the corresponding type classes (<span style="color:blue;"><a href="#_6.1">see 6.1</a></span>) are packed as additional dictionary argument of the function into the <span style="font-family:courier;">Dynamic</span>. When the <span style="font-family:courier;">Dynamic</span> is unpacked in a pattern match, the same type classes have to be defined in the receiving function, otherwise the pattern match will fail (<span style="color:blue;"><a href="#_8.2.2">see 8.2.2</a></span>).</p>
<p><div style="background-color:#FFFF45";>Example: storing an overloaded function into a <span style="font-family:courier;">Dynamic</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
OverloadedDynamic::&nbsp;Dynamic<br>
OverloadedDynamic&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;plus&nbsp;::&nbsp;A.a:a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;+&nbsp;a<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;plus::&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;+&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;plus&nbsp;x&nbsp;y&nbsp;=&nbsp;x&nbsp;+&nbsp;y<br></div>
</p><p style="text-align:justify;">Currently, when an overloaded function is packed into a dynamic, one explicitly has to specify the type, including the forall quantifier and the class context.</p>
<h3 style="background-color:#9999FF;"><a id="_8.1.3">8.1.3 Packing Expressions of Unique Type</a></h3>
<p style="text-align:justify;">Expressions of unique type (<span style="color:blue;"><a href="#_9">see Chapter 9</a></span>) can also be packed into a Dynamic. However, the run-time system cannot deal with uniqueness type variables or with coercion statements (attribute variable inequalities). One can only use the type attribute "<span style="font-family:courier;">*</span>". Furthermore, one has to explicitly define the desired unicity in the type of the expression to be packed into a <span style="font-family:courier;">Dynamic</span>. Otherwise the unicity properties of the packed expression will not be stored. As usual, the compiler will check whether the specified type (including the uniqueness type attributes) of the packed expression is correct.</p>
<p><div style="background-color:#FFFF45";>Example: packing a function into a <span style="font-family:courier;">Dynamic</span> that can write a character to a unique file.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MyDynamic::&nbsp;Dynamic<br>
MyDynamic&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;fwritec&nbsp;::&nbsp;Char&nbsp;*File&nbsp;-&gt;&nbsp;*File<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Uniqueness type variables and coercion statements cannot be part of a type packed into a Dynamic.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Uniqueness type attributes are only taken into account if they are explicitly specified in the type of the packed dynamic.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Counter Example: <span style="font-family:courier;">Dynamics</span> cannot deal with uniqueness type variables or with attribute variable inequalities.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MyDynamic::&nbsp;Dynamic<br>
MyDynamic&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;append&nbsp;::&nbsp;[.a]&nbsp;u:[.a]&nbsp;-&gt;&nbsp;v:[.a]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;[u&lt;=v]<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_8.1.4">8.1.4 Packing Arguments of Unknown Type</a></h3>
<p style="text-align:justify;">The compiler is not in all cases capable to infer the concrete type to be assigned to a <span style="font-family:courier;">Dynamic</span>. For instance, when a polymorphic function is defined it is in general unknown what the type of the actual argument will be. If it is polymorphic, it can be of any type.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An argument of polymorphic type cannot be packed into a Dynamic.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Counter Example of a function creating a <span style="font-family:courier;">Dynamic</span>. Arguments of polymorphic type cannot be packed into a Dynamic.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
WrongCreateDynamic::&nbsp;t&nbsp;-&gt;&nbsp;Dynamic<br>
WrongCreateDynamic&nbsp;any&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;any<br></div>
</p><p style="text-align:justify;">If one wants to define a function that can wrap an arbitrary argument into a <span style="font-family:courier;">Dynamic</span>, not only the value, but also the concrete static type of that argument has to be passed to the function. For efficiency reasons, we of course do not want to pass the types of all arguments to all functions. Therefore, we have to know which of the arguments might be packed into a <span style="font-family:courier;">Dynamic</span>. A special class context restriction is used to express this. So, instead of a <i>polymorphic</i> function one has to define an <i>overloaded</i> function (<span style="color:blue;"><a href="#_6">see Chapter 6</a></span>). The class <span style="font-family:courier;">TC</span> (for <span style="font-family:courier;">T</span>ype <span style="font-family:courier;">C</span>ode) is predefined and an instance of this class is required whenever an argument of unknown type is packed into a dynamic. The compiler will automatically generate an appropriate instance of the TC when needed.</p>
<p><div style="background-color:#FFFF45";>Example of an overloaded function that can wrap an argument of arbitrary type into a <span style="font-family:courier;">Dynamic</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
CreateDynamic::&nbsp;t&nbsp;-&gt;&nbsp;Dynamic&nbsp;|&nbsp;TC&nbsp;t<br>
CreateDynamic&nbsp;any&nbsp;=&nbsp;dynamic&nbsp;any<br>
<br>
MyTree::&nbsp;Dynamic<br>
MyTree&nbsp;=&nbsp;CreateDynamic&nbsp;(Node&nbsp;2&nbsp;(Node&nbsp;3&nbsp;Leaf&nbsp;Leaf)&nbsp;Leaf)<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_8.1.5">8.1.5 Using Dynamic Typing to Defeat the Static Type System</a></h3>
<p style="text-align:justify;">Dynamic typing can also be used to do things the static type system would forbid. For instance, lists require that all lists elements are of the same type. Since all dynamic expressions are of type <span style="font-family:courier;">Dynamic</span>, one can combine objects of static different type into a list by turning them into a <span style="font-family:courier;">Dynamic</span>.</p>
<p><div style="background-color:#FFFF45";>Example: three ways to pack objects of different type into a list. The first method is to define a new type in which all types one likes to pack into a list are summarized with an appropriate constructor to distinguish them. For unpacking one can make a case distinction on the different constructors in a pattern match. Everything is nice statically typed but one can only pack and unpack the types that are mentioned in the wrapper type.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;WrapperType&nbsp;=&nbsp;I&nbsp;Int&nbsp;|&nbsp;R&nbsp;Real&nbsp;|&nbsp;C&nbsp;Char<br>
<br>
MyWrapperList&nbsp;=&nbsp;[I&nbsp;1,&nbsp;R&nbsp;3.14,&nbsp;C&nbsp;'a']<br></div>
</p><p><div style="background-color:#FFFF45";>The next way to pack objects of different types is by defining a list structure using an existential type (<span style="color:blue;"><a href="#_5.1.3">see 5.1.3</a></span>). Any type can be packed now but the disadvantage is that there is no simple way to distinguish the elements and unpack them once they are packed.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;ExstList&nbsp;=&nbsp;E.a:&nbsp;Cons&nbsp;a&nbsp;ExstList&nbsp;|&nbsp;Nil<br>
<br>
MyExstList&nbsp;=&nbsp;Cons&nbsp;1&nbsp;(Cons&nbsp;3.14&nbsp;(Cons&nbsp;'a'&nbsp;Nil)<br></div>
</p><p><div style="background-color:#FFFF45";>The third way is to wrap the values into a Dynamic. Any type can be packed and via a pattern match one can unwrap them as well. It is very inefficient though and one can only unwrap a value by explicitly naming the type in the pattern match (<span style="color:blue;"><a href="#_8.2">see 8.2</a></span>).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
MyDynamicList&nbsp;=&nbsp;[<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;1,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;3.14,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;'a']<br></div>
</p><p style="text-align:justify;">It is possible to write CLEAN programs in which all arguments are dynamically typed. You can do it, but it is not a good thing to do: programs with dynamics are less reliable (run-time type errors might occur) and much more inefficient. <span style="font-family:courier;">Dynamics</span> should be used for the purpose they are designed for: type-safe storage, retrieval, and communication of arbitrary expressions between (independent) applications.</p>
<h2 style="background-color:#9999FF;"><a id="_8.2">8.2 Unpacking Dynamics Using a Dynamic Pattern Match</a></h2>
<p style="text-align:justify;">When a <span style="font-family:courier;">Dynamic</span> is created (see above), its static type is the type <span style="font-family:courier;">Dynamic</span>. The compiler is in general not able anymore to determine what the original type was of the expression that is packed into a <span style="font-family:courier;">Dynamic</span>. The only way to figure that out is at run-time (that why it is called a <span style="font-family:courier;">Dynamic</span>), by inspecting the dynamic via a pattern match (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) or a case construct (<span style="color:blue;"><a href="#_3.4.2">see 3.4.2</a></span>). With a pattern match on a Dynamic one cannot only inspect the <i>value</i> of the expression that was packed into a <span style="font-family:courier;">Dynamic</span>, but also its original <i>type</i>. So, with <span style="font-family:courier;">Dynamics</span> run-time type checking and dynamic type unification is possible in CLEAN with all the advantages (more expressions can be typed) and disadvantages (type checking may fail at run-time) of a dynamic type system. The programmer has to take care of handling the case in which the pattern match fails due to a non-matching dynamic type.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DynamicPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphPattern <span style="font-family:courier;color:#993300;"><b>::</b></span> DynamicType<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">DynamicType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[UniversalQuantVariables] {DynPatternType}+ [ClassContext]</td></tr>
<tr><td style="width:23.0290909090909%;">DynPatternType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">TypePatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">OverloadedTypePatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;">TypePatternVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Variable</td></tr>
<tr><td style="width:23.0290909090909%;">OverloadedTypeVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Variable<span style="font-family:courier;color:#FF0000;"><b>^</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">Any expression that can be packed into a dynamic can also be unpacked using a dynamic pattern match. With a pattern match on <span style="font-family:courier;">Dynamic</span>s a case distinction can be made on the contents of the <span style="font-family:courier;">Dynamic</span>. If the actual <span style="font-family:courier;">Dynamic</span> matches the type <i>and</i> the value specified in the pattern, the corresponding function alternative is chosen. Since it is known in that case that the <span style="font-family:courier;">Dynamic</span> matches the specified type, this knowledge is used by the static type system: dynamics of known type can be handled as ordinary expressions in the body of the function. In this way dynamics can be converted back to ordinary statically typed expressions again. The static type checker will use the knowledge to check the type consistency in the body of the corresponding function alternative.</p>
<p><div style="background-color:#FFFF45";>Example: Use of a dynamic pattern match to check whether a <span style="font-family:courier;">Dynamic</span> is of a specific predefined type. The first alternative of the function transform matches if the <span style="font-family:courier;">Dynamic</span> contains the Integer of value <span style="font-family:courier;">0</span>. The second alternative is chosen if the <span style="font-family:courier;">Dynamic</span> contains any Integer (other than <span style="font-family:courier;">0</span>). The third alternative demands a function from <span style="font-family:courier;">[Int]</span> to <span style="font-family:courier;">[Int]</span>. The next alternative is chosen if the <span style="font-family:courier;">Dynamic</span> is a pair of two <span style="font-family:courier;">[Int]</span>. If none of the alternatives match, the last alternative is chosen. The program will yield an empty list in that case.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
transform&nbsp;::&nbsp;Dynamic&nbsp;-&gt;&nbsp;[Int]<br>
transform&nbsp;(0&nbsp;::&nbsp;Int)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br>
transform&nbsp;(n&nbsp;::&nbsp;Int)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[n]<br>
transform&nbsp;(f&nbsp;::&nbsp;[Int]-&gt;[Int])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;f&nbsp;[1..100]<br>
transform&nbsp;((x,y)&nbsp;::&nbsp;([Int],[Int]))&nbsp;=&nbsp;x&nbsp;++&nbsp;y<br>
transform&nbsp;other&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br></div>
</p><p style="text-align:justify;">Warning: when defining a pattern match on <span style="font-family:courier;">Dynamics</span>, one should always be aware that the pattern match might fail. So, we advise you to <i>always</i>include an alternative that can handle non-matching dynamics. The application will otherwise abort with an error message that none of the function alternatives matched.</p>
<p><div style="background-color:#FFFF45";>Example: use of a dynamic pattern match to check whether a <span style="font-family:courier;">Dynamic</span> is of a specific user defined algebraic data type. If the <span style="font-family:courier;">Dynamic</span> contains a <span style="font-family:courier;">Tree</span> of <span style="font-family:courier;">Int</span>, the function <span style="font-family:courier;">CountDynamicLeafs</span> will count the number of leafs in this tree. Otherwise CountDynamicLeafs  will return <span style="font-family:courier;">0</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;|&nbsp;Leaf<br>
<br>
CountDynamicLeafs&nbsp;::&nbsp;Dynamic&nbsp;-&gt;&nbsp;Int<br>
CountDynamicLeafs&nbsp;(tree&nbsp;::&nbsp;Tree&nbsp;Int)&nbsp;&nbsp;=&nbsp;countleafs&nbsp;tree<br>
CountDynamicLeafs&nbsp;other&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;countleafs&nbsp;::&nbsp;(Tree&nbsp;Int)&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;countleafs&nbsp;&nbsp;tree&nbsp;=&nbsp;count&nbsp;tree&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count::&nbsp;(Tree&nbsp;a)&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;Leaf&nbsp;nleafs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;nleafs&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;(Node&nbsp;left&nbsp;right)&nbsp;nleafs&nbsp;=&nbsp;count&nbsp;left&nbsp;(count&nbsp;right&nbsp;nleafs)<br>
<br>
MyTree&nbsp;::&nbsp;Dynamic<br>
MyTree&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(Node&nbsp;1&nbsp;(Node&nbsp;2&nbsp;(Node&nbsp;3&nbsp;Leaf&nbsp;Leaf)&nbsp;Leaf)&nbsp;(Node&nbsp;4&nbsp;Leaf&nbsp;Leaf))<br>
<br>
Start&nbsp;::&nbsp;Int<br>
Start&nbsp;=&nbsp;CountDynamicLeafs&nbsp;MyTree<br></div>
</p><p><div style="background-color:#FFFF45";>Example: use of a dynamic pattern match to check whether a <span style="font-family:courier;">Dynamic</span> is a polymorphic function (the identity function in this case).</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
TestId&nbsp;::&nbsp;Dynamic&nbsp;a&nbsp;-&gt;&nbsp;a<br>
TestId&nbsp;(id&nbsp;::&nbsp;A.b:&nbsp;b&nbsp;-&gt;&nbsp;b)&nbsp;x&nbsp;=&nbsp;id&nbsp;x<br>
TestId&nbsp;else&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">To avoid confusion with type pattern variables (<span style="color:blue;"><a href="#_8.2.4">see 8.2.4</a></span> and <span style="color:blue;"><a href="#_8.2.5">8.2.5</a></span>), polymorphic type variables have to be explicitly introduced with the forall quantifier <span style="font-family:courier;">(A</span>.).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Quantifiers are only allowed on the outermost level (Rank 1).</td></tr>
</table>
<p style="text-align:justify;"><span style="font-family:courier;">Dynamic</span>s can be created by functions in other modules or even come from other (totally different) <span style="font-family:courier;">Clean</span> applications (<span style="color:blue;"><a href="#_8.3">see 8.3</a></span>). It is therefore possible that in a <span style="font-family:courier;">Dynamic</span> a type with a certain name is stored, yet this type might have a type definition which is (slightly or totally) different from the type known in the matching function. So, the context in which a dynamic is packed might be totally different from the context in which the dynamic is unpacked via a pattern match. Hence, it is not enough that matching type constructors have identical names; they should also have exactly the same type definition. If not, the match will fail.</p>
<p style="text-align:justify;"><i>Two types are considered to be equal if and only if all the type definitions (type constructors, data constructors, class definitions) are syntactically identical modulo the names of type variables (alpha conversion is allowed). Type equivalence of type constructors is automatically checked by the </i><span style="font-family:courier;">Clean</span> run-time system, even if these types are defined in totally different <span style="font-family:courier;">Clean</span> applications. To make this possible, we had to change the architecture of the <span style="font-family:courier;">Clean</span> run-time system (<span style="color:blue;"><a href="#_8.4">see 8.4</a></span>).</p>
<p style="text-align:justify;">So, when a pattern match on a dynamic takes place, the following things are checked in the indicated order (case constructs are handled in a similar way):</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">1)</td><td style="text-align:justify;">All the type constructors (either of basic type, predefined or user defined) specified in a dynamic pattern will be compared with the name of the corresponding actual type constructors stored in the dynamics. If corresponding type constructors have different names, the pattern match fails and the next alternative is tried.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">2)</td><td style="text-align:justify;">If in the pattern match, corresponding type's constructors have the same name, the run-time system will check whether their type definitions (their type might have been defined in different <span style="font-family:courier;">Clean</span> applications or different <span style="font-family:courier;">Clean</span> modules) are the same as well. The system knows where to find these type definitions (<span style="color:blue;"><a href="#_8.3">see 8.3</a></span> and <span style="color:blue;"><a href="#_8.4">8.4</a></span>). If the definitions are not the same, the types are considered to be different. The pattern match fails and the next alternative is tried.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">3)</td><td style="text-align:justify;">If the types are the same, the actual data constructors (constant values) are compared with the data constructors specified in the patterns, as usual in a standard pattern match (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>) without dynamics. If all the specified constants match the actual values, the match is successful and the corresponding function alternative is chosen. Otherwise, the pattern match fails and the next alternative is tried.</td></tr></table>
<p style="text-align:justify;">In the current implementation there are additional restrictions on the kind of types that can be packed into a <span style="font-family:courier;">Dynamic</span> and therefore also be unpacked from a <span style="font-family:courier;">Dynamic</span> (<span style="color:blue;"><a href="#_8.2.1">see 8.2.1</a></span>, <span style="color:blue;"><a href="#_8.2.2">8.2.2</a></span>, and <span style="color:blue;"><a href="#_8.2.3">8.2.3</a></span>).</p>
<p style="text-align:justify;">In a dynamic pattern match one can explicitly specify to match on a certain type constructors (e.g. <span style="font-family:courier;">Tree Int</span>). One can also use a type pattern variable (<span style="color:blue;"><a href="#_8.2.4">see 8.2.4</a></span>) to specify a type scheme with which the actual type has to be unified. By using overloaded variables (<span style="color:blue;"><a href="#_8.2.5">see 8.2.5</a></span>) defined in the type of the function, the static context in which a function is used can have influence on the kind of dynamic that is accepted. So, there are two special types of variables that can occur in a type pattern: type pattern variables and overloaded type pattern variables.</p>
<h3 style="background-color:#9999FF;"><a id="_8.2.1">8.2.1 Unpacking Abstract Data Types</a></h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">It is not yet possible to pack or unpack an abstract data type. <span style="color:blue;"><a href="#_8.1.1">See also 8.1.1</a></span>.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_8.2.2">8.2.2 Unpacking of Overloaded Functions</a></h3>
<p style="text-align:justify;">One can specify a class restriction in the type in a dynamic pattern match. The system will check whether the actual dynamic contains a function that is indeed overloaded with exactly the same class context restriction as specified in the pattern. Two class definitions are regarded to be equal if all involved class definitions are syntactically equal, modulo alpha conversion of the type variables.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">One is obligated for overloaded type variables to introduce them via the forall quantifier in the pattern, to avoid confusion with type pattern variables (see <span style="color:blue;"><a href="#_8.2.4">8.2.4</a></span> and <span style="color:blue;"><a href="#_8.2.5">8.2.5</a></span>).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Quantifiers are only allowed on the outermost level.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example: Unpacking of an overloaded function. The pattern match will only be successful if the dynamic contains a function overloaded in <span style="font-family:courier;">+</span>. The corresponding class definitions will be checked: the definition of the class <span style="font-family:courier;">+</span> has to be the same as the class <span style="font-family:courier;">+</span> known in the context where the dynamic has been created. Due to the application of <span style="font-family:courier;">plus 2 3</span>, the type checker will require an instance for <span style="font-family:courier;">+</span> on integer values.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
CheckDynamic::&nbsp;Dynamic&nbsp;-&gt;&nbsp;Int<br>
CheckDynamic&nbsp;(plus&nbsp;::&nbsp;A.a&nbsp;:&nbsp;a&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;+&nbsp;a)&nbsp;=&nbsp;plus&nbsp;2&nbsp;3<br>
CheckDynamic&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_8.2.3">8.2.3 Unpacking Expressions of Unique Type</a></h3>
<p style="text-align:justify;">Expressions of unique type (<span style="color:blue;"><a href="#_9">see Chapter 9)</a></span> can also be unpacked via a dynamic pattern match. However, the run-time system cannot deal with uniqueness type variables or with coercion statements (attribute variable inequalities). One can only use the type attribute "<span style="font-family:courier;">*</span>". The match will only be successful if the specified types match and all type attributes also match. No coercion from unique to non-unique or the other way around will take place.</p>
<p><div style="background-color:#FFFF45";>Example: Unpacking a function that can write a character to a unique file.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
WriteCharDynamic::&nbsp;Dynamic&nbsp;Char&nbsp;*File&nbsp;-&gt;&nbsp;*File<br>
WriteCharDynamic&nbsp;(fwc&nbsp;::&nbsp;Char&nbsp;*File&nbsp;-&gt;&nbsp;*File)&nbsp;char&nbsp;myfile&nbsp;=&nbsp;fwc&nbsp;char&nbsp;myfile<br>
WriteCharDynamic&nbsp;else&nbsp;char&nbsp;myfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;myfile<br></div>
</p><table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Uniqueness type variables and coercion statements cannot be used in a dynamic pattern match.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The type attributes of the formal argument and the actual argument have to be exactly the same. No coercion from unique to non-unique or the other way around will take place.</td></tr>
</table>
<h3 style="background-color:#9999FF;"><a id="_8.2.4">8.2.4 Checking and Unifying Types Schemes using Type Pattern Variables</a></h3>
<p style="text-align:justify;">In an ordinary pattern match one can use <i>data constructors</i> (to test whether an argument is of a <i>specific value</i>) and <i>variables</i> (which match on <i>any concrete value</i> in the domain). Similarly, in a pattern match on a dynamic type one can use <i>type constructors</i> (to test whether a dynamic contains an expression of a <i>specific type</i>) and <i>type pattern variables</i> (which match on <i>any type</i>). However, there are differences between ordinary variables and type pattern variables as well. All ordinary variable symbols introduced at the left-hand side of a function definition must have different names (<span style="color:blue;"><a href="#_3.2">see 3.2</a></span>). But, the same type variable symbol can be used several times in the left-hand side (and, of course, also in the right-hand side) of a function definition. Type pattern variables have the function alternative as scope and can appear in a pattern as well as in the right-hand side of a function in the context of a dynamic type.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypePatternVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Variable</td></tr>
</table><p></p>
<p style="text-align:justify;">Each time the <i>same</i> type variable is used in the left-hand side, the pattern matching mechanism will try to <i>unify</i> the type variable with the concrete type stored in the dynamic. If the same type variable is used several times on the left hand-side, the most general unifier is determined that matches on <i>all</i> corresponding types in the dynamics. If no general unifier can be found, the match will fail. As usual, of all corresponding type constructors it will be checked whether they are indeed the same: the corresponding type definitions have to be equivalent (<span style="color:blue;"><a href="#_8.2">see 8.2</a></span>). Type equivalence of matching type constructors is automatically checked by the <span style="font-family:courier;">Clean</span> run-time system, even if these types are defined in different <span style="font-family:courier;">Clean</span> applications.</p>
<p style="text-align:justify;">Type pattern variables are very handy. They can be used to check for certain type schemes or to check the internal type consistency between different Dynamics, while the checking function does not exactly has to know which concrete types are actually stored in a dynamic. One can make use of type pattern variables to manage and control plug-ins in a flexible way see 8.3).</p>
<p><div style="background-color:#FFFF45";>The function <span style="font-family:courier;">dynApply</span> has two arguments of type <span style="font-family:courier;">Dynamic</span> and yields a value of type <span style="font-family:courier;">Dynamic</span> as well. The first <span style="font-family:courier;">Dynamic</span> has to contain a function unifiable with type <span style="font-family:courier;">(a -&gt; b)</span>, the second argument has to be <i>unifiable</i> with the argument type <span style="font-family:courier;">a</span> the function is expecting. In this way we can ensure that it is type technically safe to apply the function to the argument, without exactly knowing what the actual types are. The result will have the statically unknown type <span style="font-family:courier;">b</span>, but, by packing this result into a Dynamic again, the static type system is happy: it is a <span style="font-family:courier;">Dynamic</span>. If the dynamics types cannot be unified, it is not type safe to apply the function to the argument, and the next alternative of <span style="font-family:courier;">dynApply</span> is chosen. It yields an error message stored into a dynamic.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
dynApply&nbsp;::&nbsp;Dynamic&nbsp;Dynamic&nbsp;-&gt;&nbsp;Dynamic<br>
dynApply&nbsp;(f&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;b)&nbsp;(x&nbsp;::&nbsp;a)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(f&nbsp;x&nbsp;::&nbsp;b)<br>
dynApply&nbsp;&nbsp;df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;("cannot&nbsp;apply&nbsp;",df,"&nbsp;to&nbsp;",dx)<br>
<br>
Start&nbsp;=&nbsp;dynApply&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(map&nbsp;((+)&nbsp;1))&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;[1..10])<br></div>
</p><p style="text-align:justify;">Type pattern variables behave similar as existentially quantified type variables (<span style="color:blue;"><a href="#_5.1.3">see 5.1.3</a></span>). It is statically impossible to determine what the actual type of a type pattern variable is. So, in the static type system one cannot define an expression which type is depending on the value of a type pattern variable. The static type system cannot deal with it, since it does no know its value. However, an expression which type is depending on the type assigned to a type pattern variable can be packed into a dynamic again, because this is done at run-time. See the <span style="font-family:courier;">dynAppy</span> example above.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">	It is not allowed to create an expression which static type is depending on the value of a type pattern variable.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Counter Example: It is not possible to let a static type depend on the value of a type pattern variable. The actual value of the type <span style="font-family:courier;">b</span> in <span style="font-family:courier;">WrongDynApply</span> is unknown at run-time. This example will result into a type error. See <span style="color:blue;"><a href="#_8.2.5">8.2.5</a></span> for a legal variant of this function.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
WrongDynApply&nbsp;::&nbsp;Dynamic&nbsp;Dynamic&nbsp;-&gt;&nbsp;???<br>
WrongDynApply&nbsp;(f&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;b)&nbsp;(x&nbsp;::&nbsp;a)&nbsp;&nbsp;=&nbsp;f&nbsp;x<br>
WrongDynApply&nbsp;df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"cannot&nbsp;perform&nbsp;the&nbsp;dyanmic&nbsp;application"<br>
<br>
Start&nbsp;=&nbsp;WrongDynApply&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(map&nbsp;((+)&nbsp;1))&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;[1..10])&nbsp;++&nbsp;[11..99]<br></div>
</p><p style="text-align:justify;">Note: don't confuse type pattern variables with the other variables that can appear in a dynamic type to indicate polymorphic or overloaded functions or constructors. The latter are introduced via a quantifier in the type. <span style="color:blue;"><a href="#_8.2.5">See also 8.2.5</a></span>.</p>
<h3 style="background-color:#9999FF;"><a id="_8.2.5">8.2.5 Checking and Unifying Unknown Types using Overloaded Type Variables</a></h3>
<p style="text-align:justify;">In a dynamic pattern match one can explicitly state what type of a <span style="font-family:courier;">Dynamic</span> is demanded. But it is also possible to let the static context in which a function is used impose restrictions on the Dynamic to be accepted. This can be realized by using <i>overloaded type variables</i> in a dynamic pattern. Such an overloaded type variable has to be introduced in the type of the function itself and the variable should have the predefined type class <span style="font-family:courier;">TC</span> (<span style="color:blue;"><a href="#_8.1.1">see 8.1.1</a></span>) as context restriction. This makes it possible to let the overloading mechanism determine what the demanded type of a Dynamic has to be (the "type dependent functions" as introduced by Marco Pil, 1999). By using such an overloaded type variable in a dynamic pattern, the type assigned by the static overloading mechanism to this variable is used as specification of the required type in the dynamic pattern match. The caret symbol (<span style="font-family:courier;">^</span>) is used as suffix of a type pattern variable in a dynamic pattern match to indicate that an overloaded type variable is used, instead of a type pattern variable. Overloaded type variables have the whole function definition as scope, including the type of the function itself.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">OverloadedTypeVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Variable<span style="font-family:courier;color:#FF0000;"><b>^</b></span></td></tr>
</table><p></p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">An overloaded type pattern variable has to be introduced in the type definition of the function.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The predefined type class <span style="font-family:courier;">TC</span> (<span style="color:blue;"><a href="#_8.1.1">see 8.1.1</a></span>) has to be specified as context restriction on the global type pattern variable.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">As is usual with overloading (<span style="color:blue;"><a href="#_6.6">see 6.6</a></span>), in some cases the compiler is not able to resolve overloading, e.g. due to internally ambiguously overloading.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>Example: The function <span style="font-family:courier;">Start</span> appends <span style="font-family:courier;">[11..99]</span>to the result of <span style="font-family:courier;">FlexDynApply</span>. So, it is clear that <span style="font-family:courier;">FlexDynApply</span> will have to deliver a <span style="font-family:courier;">[Int]</span> to the function <span style="font-family:courier;">Start</span>. The additional context restriction <span style="font-family:courier;">TC b</span> turns <span style="font-family:courier;">FlexDynApply into an overloaded function in </span><span style="font-family:courier;">b</span>. The function <span style="font-family:courier;">FlexDynApply</span> will not deliver <i>some</i> dynamic type <span style="font-family:courier;">b</span>, but <i>the</i> static type <span style="font-family:courier;">b</span> that is demanded by the context applying <span style="font-family:courier;">FlexDynApply</span>. The overloading mechanism will automatically pass as additional parameter information about the static type <span style="font-family:courier;">b</span> that is required by the context. This type is then used to check the actual type of the dynamic in the dynamic pattern match</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
FlexDynApply&nbsp;::&nbsp;Dynamic&nbsp;Dynamic&nbsp;-&gt;&nbsp;b&nbsp;|&nbsp;TC&nbsp;b<br>
FlexDynApply&nbsp;(f&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;b^)&nbsp;(x&nbsp;::&nbsp;a)&nbsp;&nbsp;&nbsp;=&nbsp;f&nbsp;x<br>
FlexDynApply&nbsp;df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"cannot&nbsp;perform&nbsp;the&nbsp;dyanmic&nbsp;application"<br>
<br>
Start&nbsp;=&nbsp;FlexDynApply&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(map&nbsp;((+)&nbsp;1))&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;[1..10])&nbsp;++&nbsp;[11..99]<br></div>
</p><p><div style="background-color:#FFFF45";>Example: The function <span style="font-family:courier;">lookup</span> will look up a value of a certain type <span style="font-family:courier;">a</span> in its lists of <span style="font-family:courier;">Dynamic</span>s. The type it will search for  depends on the context in which the function <span style="font-family:courier;">lookup</span> is used. In Start the lookup function is used twice. In the first case an integer value is demanded (due to <span style="font-family:courier;">+ 5</span>), in the second case a real value (due to <span style="font-family:courier;">+ 2.5</span>) is required. The program will be aborted if a value of the required type cannot be found in the list.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
lookup&nbsp;::&nbsp;[Dynamic]&nbsp;-&gt;&nbsp;a&nbsp;&nbsp;|&nbsp;TC&nbsp;a<br>
lookup&nbsp;[(x&nbsp;::&nbsp;a^):xs]&nbsp;=&nbsp;x<br>
lookup&nbsp;[x:xs]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;lookup&nbsp;xs<br>
lookup&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"dynamic&nbsp;type&nbsp;error"<br>
<br>
Start&nbsp;=&nbsp;(lookup&nbsp;DynamicList&nbsp;+&nbsp;5,&nbsp;lookup&nbsp;DynamicList&nbsp;+&nbsp;2.5)&nbsp;&nbsp;//&nbsp;result&nbsp;will&nbsp;be&nbsp;(6,5.64)<br>
<br>
DynamicList&nbsp;=&nbsp;[<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;1,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;3.14,&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;'a']<br></div>
</p><p style="text-align:justify;">Note: don't confuse overloaded type variables with type pattern variables or the other variables that can appear in a dynamic type to indicate polymorphic or overloaded functions or constructors. The latter are introduced via a quantifier in the type.</p>
<p><div style="background-color:#FFFF45";>Example: the following artificial example the kinds of type variables that can be used in a dynamic pattern are shown. In the first alternative a type variable <span style="font-family:courier;">a</span> is used (introduced by the forall quantifier). This alternative only matches on a polymorphic function. In the second alternative an overloaded type variable is used (indicated by <span style="font-family:courier;">a^</span>) referring to the overloaded type variable <span style="font-family:courier;">a | TC a</span> introduced in the function body. It will match on a function of the same type as the actual type of the second argument of AllSortsOfVariables. The last alternative uses type pattern variables <span style="font-family:courier;">a</span> and <span style="font-family:courier;">b</span>. It matches on any function type, although this function is not used.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
AllSortsOfVariables&nbsp;::&nbsp;Dynamic&nbsp;&nbsp;a&nbsp;-&gt;&nbsp;a&nbsp;|&nbsp;TC&nbsp;a<br>
AllSortsOfVariables&nbsp;(id::A.a&nbsp;:&nbsp;(a&nbsp;-&gt;&nbsp;a))&nbsp;x&nbsp;&nbsp;=&nbsp;id&nbsp;x<br>
AllSortsOfVariables&nbsp;(f::a^&nbsp;-&gt;&nbsp;a^)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;=&nbsp;f&nbsp;x<br>
AllSortsOfVariables&nbsp;(f::a&nbsp;-&gt;&nbsp;b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;=&nbsp;x<br></div>
</p><h2 style="background-color:#9999FF;"><a id="_8.3">8.3 Type Safe Communication using Dynamics</a></h2>
<p style="text-align:justify;">As explained in the introduction of this Chapter, the most important practical use of <span style="font-family:courier;">Dynamic</span>s is enabling type safe communication of data and code between different (distributed) CLEAN applications. When a <span style="font-family:courier;">Dynamic</span> is stored or communicated it will be encoded (serialized) to a string. So, in principle almost any communication media can be used to communicate <span style="font-family:courier;">Dynamic</span>s. In this section we only explain how to store and retrieve a <span style="font-family:courier;">Dynamic</span> from a <span style="font-family:courier;">File</span>. It is also possible to communicate a <span style="font-family:courier;">Dynamic</span> directly via a channel or via send / receive communication primitives. The actual possibilities are depending on the facilities offered by CLEAN libraries. This is outside the scope of this CLEAN language report.</p>
<p style="text-align:justify;">If a CLEAN application stores a <span style="font-family:courier;">Dynamic</span> into a <span style="font-family:courier;">File</span> <i>any</i> other (totally different) CLEAN application can read the <span style="font-family:courier;">Dynamic</span> from it. Since a <span style="font-family:courier;">Dynamic</span> can contain data as well as code (unevaluated function applications), this means that any part of one CLEAN program can be plugged into another. Since CLEAN is using compiled code, this has a high impact on the run-time system (<span style="color:blue;"><a href="#_8.4">see 8.4</a></span>).</p>
<p style="text-align:justify;">One can read and write a <span style="font-family:courier;">Dynamic</span> with just <i>one</i> function call. In the CLEAN library <span style="font-family:courier;">StdDynamic</span> the functions <span style="font-family:courier;">readDynamic</span> and <span style="font-family:courier;">writeDynamic</span> are predefined. As usual in CLEAN, uniqueness typing is used for performing I/O (<span style="color:blue;"><a href="#_9.1">see 9.1</a></span>). When a <span style="font-family:courier;">Dynamic</span>is written, the whole expression (the graph expression and its static type) is encoded symbolically to a <span style="font-family:courier;">String</span> and stored on disk. When a <span style="font-family:courier;">Dynamic</span> is read, it is read in lazily. Only when the evaluation of the <span style="font-family:courier;">Dynamic</span> is demanded (which can only happen after a successful pattern match), the String is decoded back to a <span style="font-family:courier;">Dynamic</span>. If new function definitions have to be plugged in, this will be done automatically (<span style="color:blue;"><a href="#_8.4">see 8.4</a></span>). This lazy reading is also done for <span style="font-family:courier;">Dynamics</span> stored into a <span style="font-family:courier;">Dynamic</span>. So, a <span style="font-family:courier;">Dynamic</span> can only be plugged in if its type is approved in a <span style="font-family:courier;">Dynamic</span> pattern match.</p>
<p><div style="background-color:#FFFF45";>Standard functions for reading and writing of a Dynamic.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>definition</b></span>&nbsp;<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;StdDynamic<br>
<br>
...<br>
<br>
writeDynamic&nbsp;::&nbsp;Dynamic&nbsp;String&nbsp;*World&nbsp;-&gt;&nbsp;*(Bool,*World)<br>
<br>
readDynamic&nbsp;::&nbsp;String&nbsp;*World&nbsp;-&gt;&nbsp;*(Bool,&nbsp;Dynamic,&nbsp;*World)<br></div>
</p><p style="text-align:justify;">The use of <span style="font-family:courier;">Dynamics</span> is shown in the examples below. Each example is a complete CLEAN application.</p>
<p><div style="background-color:#FFFF45";>Example of a CLEAN application writing a <span style="font-family:courier;">Dynamic</span> containing a value of type <span style="font-family:courier;">Tree Int</span> to a <span style="font-family:courier;">File</span> named <span style="font-family:courier;">DynTreeValue</span>. This example shows that data can be stored to disk using the CLEAN function <span style="font-family:courier;">writeDynamic</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;TreeValue<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdDynamic,&nbsp;StdEnv<br>
<br>
::&nbsp;Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;|&nbsp;Leaf<br>
<br>
Start&nbsp;world<br>
#&nbsp;(ok,world)&nbsp;=&nbsp;writeDynamic&nbsp;"DynTreeValue"&nbsp;MyTree&nbsp;world<br>
|&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"could&nbsp;not&nbsp;write&nbsp;MyTree&nbsp;to&nbsp;file&nbsp;named&nbsp;DynTreeValue"<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;world<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;MyTree::Dynamic<br>
&nbsp;&nbsp;&nbsp;&nbsp;MyTree&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(Node&nbsp;1&nbsp;mytree&nbsp;mytree)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mytree&nbsp;=&nbsp;(Node&nbsp;2&nbsp;(Node&nbsp;3&nbsp;Leaf&nbsp;Leaf)&nbsp;Leaf)<br></div>
</p><p><div style="background-color:#FFFF45";>Example of another CLEAN application writing a <span style="font-family:courier;">Dynamic</span> containing the function countleafs to a File named CountsLeafsinTrees. This function can count the numbers of leafs in a <span style="font-family:courier;">Tree</span> and is of type <span style="font-family:courier;">(Tree Int) -&gt; Int</span>. This examples shows that code (in this case the function <span style="font-family:courier;">CountLeafs</span>) can be stored on disk as well, just using <span style="font-family:courier;">WriteDynamic</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;CountLeafs<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdDynamic,&nbsp;StdEnv<br>
<br>
::&nbsp;Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;|&nbsp;Leaf<br>
<br>
Start&nbsp;world<br>
#&nbsp;(ok,world)&nbsp;=&nbsp;writeDynamic&nbsp;"CountsLeafsinTrees"&nbsp;CountLeafs&nbsp;world<br>
|&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"could&nbsp;not&nbsp;write&nbsp;dynamic"<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;world<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;CountLeafs&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;countleafs<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;countleafs::&nbsp;(Tree&nbsp;Int)&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;countleafs&nbsp;&nbsp;tree&nbsp;=&nbsp;count&nbsp;tree&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count::&nbsp;(Tree&nbsp;a)&nbsp;Int&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;Leaf&nbsp;nleafs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;nleafs&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;(Node&nbsp;left&nbsp;right)&nbsp;nleafs&nbsp;&nbsp;=&nbsp;count&nbsp;left&nbsp;(count&nbsp;right&nbsp;nleafs)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;"count&nbsp;does&nbsp;not&nbsp;match"<br></div>
</p><p><div style="background-color:#FFFF45";>The third CLEAN application reads in the file TreeValue containing a <span style="font-family:courier;">Tree Int</span> and the function <span style="font-family:courier;">countleafs</span> (a plugin) that can counts the number of <span style="font-family:courier;">Leaf</span>s in a <span style="font-family:courier;">Tree</span>. So, new functionality is added to the running application Apply. By using the function <span style="font-family:courier;">dynapply</span> the new plugged in function countleafs is applied to the tree that has been read in as well. The application <span style="font-family:courier;">Apply</span> itself has a function to count the number of nodes and applies this function on the tree read in. <br>Note that this application will only work if all the type <span style="font-family:courier;">Tree</span>s defined in the different applications are exactly the same (module the names for the type variables used).<br></div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>module</b></span>&nbsp;Apply<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;StdDynamic,&nbsp;StdEnv<br>
<br>
::&nbsp;Tree&nbsp;a&nbsp;=&nbsp;Node&nbsp;a&nbsp;(Tree&nbsp;a)&nbsp;(Tree&nbsp;a)&nbsp;|&nbsp;Leaf<br>
<br>
Start&nbsp;world<br>
#&nbsp;(ok,countleafs,world)&nbsp;&nbsp;&nbsp;=&nbsp;read&nbsp;"CountsLeafsinTrees"&nbsp;world<br>
|&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;("could&nbsp;not&nbsp;read&nbsp;CountsLeafsinTrees")<br>
#&nbsp;(ok,treevalue,world)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;read&nbsp;"TreeValue"&nbsp;world<br>
|&nbsp;not&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;abort&nbsp;("could&nbsp;not&nbsp;read&nbsp;TreeValue")<br>
|&nbsp;<span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span>&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;countnodes&nbsp;(<span style="font-family:courier;color:#FF0000;"><b>case</b></span>&nbsp;treevalue&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span>&nbsp;(v::(Tree&nbsp;Int))=&nbsp;v)&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;dynapply&nbsp;countleafs&nbsp;treevalue<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;dynapply&nbsp;::&nbsp;Dynamic&nbsp;Dynamic&nbsp;-&gt;&nbsp;Dynamic<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynapply&nbsp;(f::a&nbsp;-&gt;&nbsp;b)&nbsp;(v::a)&nbsp;&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;(f&nbsp;v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynapply&nbsp;df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span>&nbsp;"incorrectly&nbsp;typed&nbsp;dynamic&nbsp;application"<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;countnodes&nbsp;Leaf&nbsp;nnodes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;nnodes<br>
&nbsp;&nbsp;&nbsp;&nbsp;countnodes&nbsp;(Node&nbsp;left&nbsp;right)&nbsp;nnodes&nbsp;=&nbsp;countnodes&nbsp;left&nbsp;(countnodes&nbsp;right&nbsp;(nnodes+1))<br></div>
</p>
<h2 style="background-color:#9999FF;"><a id="_8.4">8.4 Architecture of the implementation</a></h2>
<p style="text-align:justify;">From the examples above we learn that a <span style="font-family:courier;">Dynamic</span> stored on disk can contain data as well as code (unevaluated functions and function applications). How is this information stored into a file and how is a running CLEAN application extended with new data and new functionality? To understand this one has to know a little bit more about how a CLEAN application is generated.</p>
<h3 style="background-color:#9999FF;">&nbsp&nbsp&nbsp&nbsp&nbsp&nbspImplementation of Dynamics</h3>
<p style="text-align:justify;">CLEAN applications are not interpreted via an interpreter. Executables are generated using compiled machine code. Storing a <span style="font-family:courier;">Dynamic</span> into disk and retrieving it again from disk cannot simply be done by (re) interpretation of CLEAN source code.</p>
<svg width="888.888888888889" height="180">
<path d="M373.333333333333 63C373.333333333333 67.9705627482,379.224370664533 72,384 72L533.333333333333 72C539.224370664533 72,544 67.0294372518,544 63L544 42C544 37.0294372518,538.1089626688 33,533.333333333333 33L384 33C378.1089626688 33,373.333333333333 37.9705627482,373.333333333333 42L373.333333333333 63 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="46.5" fill="#000000">Clean Compiler</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="70.5" fill="#FF0000">Clean</text>
<path d="M373.333333333333 111C373.333333333333 115.9705627482,379.224370664533 120,384 120L533.333333333333 120C539.224370664533 120,544 115.0294372518,544 111L544 90C544 85.0294372518,538.1089626688 81,533.333333333333 81L384 81C378.1089626688 81,373.333333333333 85.9705627482,373.333333333333 90L373.333333333333 111 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="94.5" fill="#000000">Code Generator</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="118.5" fill="#FF0000">C</text>
<path d="M160 159C160 163.9705627482,165.8910373312 168,170.666666666667 168L320 168C325.8910373312 168,330.666666666667 163.0294372518,330.666666666667 159L330.666666666667 138C330.666666666667 133.0294372518,324.775629335467 129,320 129L170.666666666667 129C164.775629335467 129,160 133.9705627482,160 138L160 159 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="177.777777777778" y="142.5" fill="#000000">Your Application</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="177.777777777778" y="166.5" fill="#FF0000">Clean</text>
<path d="M373.333333333333 159C373.333333333333 163.9705627482,379.224370664533 168,384 168L533.333333333333 168C539.224370664533 168,544 163.0294372518,544 159L544 138C544 133.0294372518,538.1089626688 129,533.333333333333 129L384 129C378.1089626688 129,373.333333333333 133.9705627482,373.333333333333 138L373.333333333333 159 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="142.5" fill="#000000">Static Linker</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="166.5" fill="#FF0000">Clean</text>
<path d="M229.333333333333 39 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<path d="M231.111111111111 34.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M270.222222222222 34.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<path d="M236.444444444444 30 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M275.555555555556 30 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="234.666666666667" y="57" fill="#000000">.icl</text>
<path d="M592 60 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<path d="M593.777777777778 55.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M632.888888888889 55.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<path d="M599.111111111111 51 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M638.222222222222 51 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="597.333333333333" y="78" fill="#000000">.abc</text>
<path d="M592 108 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<path d="M593.777777777778 103.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M632.888888888889 103.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<path d="M599.111111111111 99 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M638.222222222222 99 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="597.333333333333" y="126" fill="#000000">.obj</text>
<path d="M282.666666666667 39 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#99FF99" stroke="none"/>
<path d="M284.444444444444 34.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#99FF99" stroke="none"/>
<path d="M323.555555555556 34.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#99FF99" stroke="none"/>
<path d="M289.777777777778 30 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#99FF99" stroke="none"/>
<path d="M328.888888888889 30 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#99FF99" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="288" y="57" fill="#000000">.dcl</text>
<path d="M348.444444444444 144 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M348.444444444444 156L341.333333333333 148.5L348.444444444444 141 Z" fill="#FF00FF" stroke="none"/>
<path d="M341.333333333333 48 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M362.666666666667 60L369.777777777778 52.5L362.666666666667 45 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 129 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 141L554.666666666667 133.5L561.777777777778 126 Z" fill="#FF00FF" stroke="none"/>
<path d="M554.666666666667 111 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M576 123L583.111111111111 115.5L576 108 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 81 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 93L554.666666666667 85.5L561.777777777778 78 Z" fill="#FF00FF" stroke="none"/>
<path d="M554.666666666667 63 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M576 75L583.111111111111 67.5L576 60 Z" fill="#FF00FF" stroke="none"/>
</svg>
<p style="text-align:justify;">The CLEAN compiler (written in CLEAN) compiles CLEAN implementation modules (.icl and .dcl files) to machine independent abc-code (.abc files). The CLEAN definition modules are used to check the type consistency between the separately programmed CLEAN modules. The abc-code contains machine instructions for a virtual abstract machine, the abc-machine (see <span style="color:#0000FF;">Plasmeijer and van van Eekelen</span>, 1993). The abc-code is a kind of platform independent byte code specially designed for CLEAN. The Code Generator (the one and only application in the Clean system which is written in C) translates the abc-code into platform dependent symbolic machine code (.obj files under Windows). The code generator can generate code for different platforms such as for Intel (Windows, Linux), Motorola (Mac) and Sparc (Unix) processors. The Static Linker (written in CLEAN) links all the object modules of one CLEAN program together into a click able executable application (.exe file under Windows). The compilation scheme described above can be used even if Dynamics are internally used in an application. But, as soon as <span style="font-family:courier;">Dynamic</span>s are communicated to <span style="font-family:courier;">File</span> or communicated to another program, a different run-time support is needed and the traditional compilation scheme is changed to prepare this.</p>
<svg width="888.888888888889" height="255">
<path d="M373.333333333333 63C373.333333333333 67.9705627482,379.224370664533 72,384 72L533.333333333333 72C539.224370664533 72,544 67.0294372518,544 63L544 42C544 37.0294372518,538.1089626688 33,533.333333333333 33L384 33C378.1089626688 33,373.333333333333 37.9705627482,373.333333333333 42L373.333333333333 63 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="46.5" fill="#000000">Clean Compiler</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="70.5" fill="#FF0000">Clean</text>
<path d="M373.333333333333 111C373.333333333333 115.9705627482,379.224370664533 120,384 120L533.333333333333 120C539.224370664533 120,544 115.0294372518,544 111L544 90C544 85.0294372518,538.1089626688 81,533.333333333333 81L384 81C378.1089626688 81,373.333333333333 85.9705627482,373.333333333333 90L373.333333333333 111 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="94.5" fill="#000000">Code Generator</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="118.5" fill="#FF0000">C</text>
<path d="M373.333333333333 159C373.333333333333 163.9705627482,379.224370664533 168,384 168L533.333333333333 168C539.224370664533 168,544 163.0294372518,544 159L544 138C544 133.0294372518,538.1089626688 129,533.333333333333 129L384 129C378.1089626688 129,373.333333333333 133.9705627482,373.333333333333 138L373.333333333333 159 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="142.5" fill="#000000">Static Linker</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="391.111111111111" y="166.5" fill="#FF0000">Clean</text>
<path d="M302.222222222222 234C302.222222222222 238.9705627482,308.113259553422 243,312.888888888889 243L462.222222222222 243C468.113259553422 243,472.888888888889 238.0294372518,472.888888888889 234L472.888888888889 213C472.888888888889 208.0294372518,466.997851557689 204,462.222222222222 204L312.888888888889 204C306.997851557689 204,302.222222222222 208.9705627482,302.222222222222 213L302.222222222222 234 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="320" y="217.5" fill="#000000">Your Application</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="320" y="241.5" fill="#FF0000">Clean</text>
<path d="M480 234C480 238.9705627482,485.8910373312 243,490.666666666667 243L533.333333333333 243C539.224370664533 243,544 238.0294372518,544 234L544 213C544 208.0294372518,538.1089626688 204,533.333333333333 204L490.666666666667 204C484.775629335467 204,480 208.9705627482,480 213L480 234 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="494.222222222222" y="216" fill="#000000">Plug</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="494.222222222222" y="240" fill="#000000">In</text>
<path d="M590.222222222222 234C590.222222222222 238.9705627482,596.113259553422 243,600.888888888889 243L750.222222222222 243C756.113259553422 243,760.888888888889 238.0294372518,760.888888888889 234L760.888888888889 213C760.888888888889 208.0294372518,754.997851557689 204,750.222222222222 204L600.888888888889 204C594.997851557689 204,590.222222222222 208.9705627482,590.222222222222 213L590.222222222222 234 Z" fill="#3366FF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="608" y="217.5" fill="#000000">Dynamic Linker</text>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="608" y="241.5" fill="#FF0000">Clean</text>
<path d="M229.333333333333 39 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<path d="M231.111111111111 34.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M270.222222222222 34.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<path d="M236.444444444444 30 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M275.555555555556 30 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="234.666666666667" y="57" fill="#000000">.icl</text>
<path d="M592 60 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<path d="M593.777777777778 55.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M632.888888888889 55.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<path d="M599.111111111111 51 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M638.222222222222 51 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="597.333333333333" y="78" fill="#000000">.abc</text>
<path d="M592 109.5 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<path d="M593.777777777778 105 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M632.888888888889 105 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<path d="M599.111111111111 100.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#FF9900" stroke="none"/>
<path d="M638.222222222222 100.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="597.333333333333" y="127.5" fill="#000000">.obj</text>
<path d="M592 147 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="597.333333333333" y="165" fill="#000000">.lib</text>
<path d="M645.333333333333 147 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#FF9900" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="650.666666666667" y="165" fill="#000000">.typ</text>
<path d="M225.777777777778 207 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#99CCFF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="231.111111111111" y="225" fill="#000000">.dyn</text>
<path d="M698.666666666667 147 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#99CCFF" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="704" y="165" fill="#000000">.sysdyn</text>
<path d="M282.666666666667 39 h39.1111111111111 v33 h-39.1111111111111 Z" fill="#99FF99" stroke="none"/>
<path d="M284.444444444444 34.5 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#99FF99" stroke="none"/>
<path d="M323.555555555556 34.5 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#99FF99" stroke="none"/>
<path d="M289.777777777778 30 h42.6666666666667 v3 h-42.6666666666667 Z" fill="#99FF99" stroke="none"/>
<path d="M328.888888888889 30 h3.55555555555556 v36 h-3.55555555555556 Z" fill="#99FF99" stroke="none"/>
<text font-family="Helvetica" font-weight="bold" font-size="16px" x="288" y="57" fill="#000000">.dcl</text>
<path d="M341.333333333333 48 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M362.666666666667 60L369.777777777778 52.5L362.666666666667 45 Z" fill="#FF00FF" stroke="none"/>
<path d="M554.666666666667 159 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M576 171L583.111111111111 163.5L576 156 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 129 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 141L554.666666666667 133.5L561.777777777778 126 Z" fill="#FF00FF" stroke="none"/>
<path d="M554.666666666667 111 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M576 123L583.111111111111 115.5L576 108 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 81 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M561.777777777778 93L554.666666666667 85.5L561.777777777778 78 Z" fill="#FF00FF" stroke="none"/>
<path d="M554.666666666667 63 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#FF00FF" stroke="none"/>
<path d="M576 75L583.111111111111 67.5L576 60 Z" fill="#FF00FF" stroke="none"/>
<path d="M444.444444444444 174 h10.6666666666667 v18 h-10.6666666666667 Z" fill="#FF00FF" stroke="none"/>
<path d="M458.666666666667 192L449.777777777778 198L440.888888888889 192 Z" fill="#FF00FF" stroke="none"/>
<path d="M721.777777777778 49.5 h14.2222222222222 v12 h-14.2222222222222 Z" fill="#FF00FF" stroke="none"/>
<path d="M721.777777777778 79.5 h14.2222222222222 v12 h-14.2222222222222 Z" fill="#99CCFF" stroke="none"/>
<path d="M561.777777777778 219 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#99CCFF" stroke="none"/>
<path d="M561.777777777778 231L554.666666666667 223.5L561.777777777778 216 Z" fill="#99CCFF" stroke="none"/>
<path d="M275.555555555556 228 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#99CCFF" stroke="none"/>
<path d="M275.555555555556 240L268.444444444444 232.5L275.555555555556 225 Z" fill="#99CCFF" stroke="none"/>
<path d="M268.444444444444 210 h21.3333333333333 v9 h-21.3333333333333 Z" fill="#99CCFF" stroke="none"/>
<path d="M289.777777777778 222L296.888888888889 214.5L289.777777777778 207 Z" fill="#99CCFF" stroke="none"/>
<path d="M608 180 h10.6666666666667 v18 h-10.6666666666667 Z" fill="#99CCFF" stroke="none"/>
<path d="M622.222222222222 198L613.333333333333 204L604.444444444444 198 Z" fill="#99CCFF" stroke="none"/>
<path d="M661.333333333333 180 h10.6666666666667 v18 h-10.6666666666667 Z" fill="#99CCFF" stroke="none"/>
<path d="M675.555555555556 198L666.666666666667 204L657.777777777778 198 Z" fill="#99CCFF" stroke="none"/>
<path d="M714.666666666667 186 h10.6666666666667 v18 h-10.6666666666667 Z" fill="#99CCFF" stroke="none"/>
<path d="M728.888888888889 186L720 180L711.111111111111 186 Z" fill="#99CCFF" stroke="none"/>
<path d="M711.111111111111 45 h142.222222222222 v21 h-142.222222222222 Z" fill="none" stroke="#000000"/>
<path d="M711.111111111111 75 h142.222222222222 v21 h-142.222222222222 Z" fill="none" stroke="#000000"/>
<text font-family="Helvetica" font-size="16px" x="746.666666666667" y="60" fill="#000000">Compile Time</text>
<text font-family="Helvetica" font-size="16px" x="746.666666666667" y="90" fill="#000000">Run Time</text>
</svg>
<p style="text-align:justify;">In the changed compilation scheme, the static linker not only generates an application (actually, currently it is a .bat file), but it also generates two additional files. One is called the code repository (.lib file). All object codes of your application are collected here. The other file (.typ file) is a repository that contains all type definitions. The repositories serve as a database which is accessed by the Dynamic Linker. Whenever an (other) running application needs code for a plug in or a type that has to be checked, the Dynamic Linker will look it up in the appropriate repository. Each time a CLEAN program is recompiled, new repositories are created. Repositories should not be removed by hand because it might make the <span style="font-family:courier;">Dynamic</span>s stored on disk unreadable. A special garbage collector is provided that can remove unused repositories.</p>
<p style="text-align:justify;">When a CLEAN application doing dynamic I/O is started, a special linker (the Dynamic Linker, written in CLEAN) is started with it as well (if it is not already running). The Dynamic Linker is a server application on the computer. It will serve all running CLEAN programs that read or write <span style="font-family:courier;">Dynamic</span>s. The Dynamic Linker will construct the application or plug-in at run-time in the same way as the Static Linker would do at compile-time for a conventional CLEAN program. There is no efficiency penalty once the code is linked in.</p>
<p style="text-align:justify;">When a <span style="font-family:courier;">Dynamic</span> is written to disk using the function <span style="font-family:courier;">writeDynamic</span>, two (!) files are created: a .dyn file and a .sysdyn file. The .sysdyn file contains the actual information: a String encoding of the dynamic. This sysdyn file is used by the Dynamic Linker and should not be touched by the user because it might make the <span style="font-family:courier;">Dynamic</span>s stored on disk unreadable. The special garbage collector provided will also remove unused .sysdyn files.</p>
<p style="text-align:justify;">The user may only touch and use the .dyn file that contains references to the actual dynamic stored in the .sysdyn file. The .dyn file can be seen as a "typed" file. It can be handled like any other user file. It can be renamed, moved or deleted without any danger.</p>
<p style="text-align:justify;">When a <span style="font-family:courier;">Dynamic</span>is written to a file, an encoding of the graph and its type are written to disk. The graph is encoded in such a way that sharing will be maintained when the graph is read in again. The stored graph may contain unevaluated functions. In a <span style="font-family:courier;">Dynamic</span> on disk, functions are represented by symbolic pointers to the corresponding code repositories. The types stored in a Dynamic on disk point to the corresponding type definitions stored in the type repositories.</p>
<p style="text-align:justify;"><i>No plug-in will be plugged in unless its type is approved.</i> When a <span style="font-family:courier;">Dynamic</span> stored on disk is read in by an (other) application, first only a pointer to the stored <span style="font-family:courier;">Dynamic</span>is used in the CLEAN program. To use a Dynamic in an application one first has to examine it in a pattern match. In the pattern match the type of the <span style="font-family:courier;">Dynamic</span> is unified with a specified type or with the type of another <span style="font-family:courier;">Dynamic</span>s. If the run-time type unification is successful, the Dynamic Linker will check whether all type definitions of the types involved are identical as well. This type information is fetched from the corresponding type repository when needed. If the types are identical and the conventional pattern match succeeds as well, the corresponding function body can be evaluated. Only when the evaluation of the stored Dynamic is demanded, the graph encoded in the Dynamic on disk is reconstructed as far as needed (<span style="font-family:courier;">Dynamic</span>s nested in a <span style="font-family:courier;">Dynamic</span> are reconstructed lazily). The Dynamic Linker links in the code corresponding to the unevaluated functions stored in the <span style="font-family:courier;">Dynamic</span>. It is fetched from the code repository and plugged in the running (!) application. In some cases the Dynamic Linker will ask the Code Generator to generate new code (just-in-time code generation) to construct the required image. The Dynamic Linker has to ensure that identical data types defined in different applications are linked in such a way that they are indeed considered to be of the same type at run-time.</p>
<h2 style="background-color:#9999FF;"><a id="_8.5">8.5 Semantic Restrictions on Dynamics</a></h2>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The following types cannot be packed/unpacked: abstract data types, uniqueness types, overloaded types. We are working on it.</td></tr>
</table>
<!-- chapter:Chapter 9-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_9"><br>Chapter 9<br><br>Uniqueness Typing</a></h1></div>
<p style="text-align:justify;">Although CLEAN is purely functional, operations with side-effects (I/O operations, for instance) are permitted. To achieve this without violating the semantics, the classical types are supplied with so called uniqueness attributes. If an argument of a function is indicated as unique, it is guaranteed that at run-time the corresponding actual object is local, i.e. there are no other references to it. Clearly, a destructive update of such a "unique object" can be performed safely.</p>
<p style="text-align:justify;">The uniqueness type system makes it possible to define direct interfaces with an operating system, a file system (updating persistent data), with GUI's libraries, it allows to create arrays, records or user defined data structures that can be updated destructively. The time and space behavior of a functional program therefore greatly benefits from the uniqueness typing.</p>
<p style="text-align:justify;">Uniqueness types are deduced automatically. Type attributes are polymorphic: attribute variables and inequalities on these variables can be used to indicate relations between and restrictions on the corresponding concrete attribute values.</p>
<p style="text-align:justify;">Sometimes the inferred type attributes give some extra information on the run-time behavior of a function. The uniqueness type system is a transparent extension of classical typing that means that if one is not interested in the uniqueness information one can simply ignore it.</p>
<p style="text-align:justify;">Since the uniqueness typing is a rather complex matter we explain this type system and the motivation behind it in more detail. The first <span style="color:blue;"><a href="#_9.1">Section (9.1)</a></span> explains the basic motivation for and ideas behind uniqueness typing. <span style="color:blue;"><a href="#_9.2">Section 9.2</a></span> focuses on the so-called uniqueness propagation property of (algebraic) type constructors. Then we show how new data structures can be defined containing unique objects (<span style="color:blue;"><a href="#_9.3">Section 9.3)</a></span>. Sharing may destroy locality properties of objects. In <span style="color:blue;"><a href="#_9.4">Section 9.4</a></span> we describe the effect of sharing on uniqueness types. In order to maintain referential transparency, it appears that function types have to be treated specially. The last <span style="color:blue;"><a href="#_9.5">Section (9.5)</a></span> describes the combination of uniqueness typing and overloading. Especially, the subsections on constructor classes and higher-oder type definitions are very complex: we suggest that the reader skips these sections at first instance.</p>
<h2 style="background-color:#9999FF;"><a id="_9.1">9.1 Basic Ideas behind Uniqueness Typing</a></h2>
<p style="text-align:justify;">The <i>uniqueness typing</i> is an extension of classical Milner/Mycroft typing. In the uniqueness type system <i>uniqueness type attributes</i>  are attached to the classical types. Uniqueness type attributes appear in the <i>type specifications of functions</i> <span style="color:blue;"><a href="#_9.4">see 9.4</a></span>) but are also permitted in the definitions of <i>new data types </i>(<span style="color:blue;"><a href="#_9.3">see 9.3</a></span>). A classical type can be prefixed by one of the following uniqueness type attributes:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Type</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{BrackType}+</td></tr>
<tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;">UnqTypeAttrib</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>*</b></span></td><td style="width:48.84%;">// type attribute "unique"</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">UniqueTypeVariable<span style="font-family:courier;color:#993300;"><b>:</b></span></td><td style="width:48.84%;">// a type attribute variable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span></td><td style="width:48.84%;">// an anonymous type attribute variable</td></tr>
</table><p></p>
<p style="text-align:justify;">The basic idea behind uniqueness typing is the following. Suppose a function, say <span style="font-family:courier;">F</span>, has a unique argument (an argument with type <span style="font-family:courier;">*&sigma;</span>, for some <span style="font-family:courier;">&sigma;</span>). This attribute imposes an additional restriction on applications of <span style="font-family:courier;">F</span>.</p>
<p style="text-align:justify;">It is <i>guaranteed</i> that <span style="font-family:courier;">F</span> will have private ("unique") access to this particular argument (see Barendsen and Smetsers, 1993; Plasmeijer and Van Eekelen, 1993): the object will have a reference count of 1 <i>at the moment </i>it is inspected by the function. It is important to know that there can be more than 1 reference to the object before this specific access takes place. If a uniquely typed argument is not used to construct the function result it will become garbage (the reference has dropped to zero). Due to the fact that this analysis is performed statically the object can be garbage collected (<span style="color:blue;"><a href="#_1">see Chapter 1</a></span>) at compile-time. It is harmless to reuse the space occupied by the argument to create the function result. In other words: <i>it is allowed to update the unique object destructively without any consequences for referential transparency</i>.</p>
<p><div style="background-color:#FFFF45";>Example: the I/O library function <span style="font-family:courier;">fwritec</span>is used to write a character to a file yielding a new file as result. In general it is semantically not allowed to overwrite the argument file with the given character to construct the resulting file. However, by demanding the argument file to be unique by specifying </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
fwritec::&nbsp;Char&nbsp;*File&nbsp;-&gt;&nbsp;*File<br></div>
</p><p style="text-align:justify;">It is guaranteed by the type system that <span style="font-family:courier;">fwritec</span> has private access to the file such that overwriting the file can be done without violating the functional semantics of the program. The resulting file is unique as well and can therefore be passed as continuation to another call of e.g. <span style="font-family:courier;">fwritec</span> to make further writing possible.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">WriteABC::&nbsp;*File&nbsp;-&gt;&nbsp;*File<br>
WriteABC&nbsp;file&nbsp;=&nbsp;fwritec&nbsp;'c'&nbsp;(fwritec&nbsp;'b'&nbsp;(fwritec&nbsp;'a'&nbsp;file))<br></p>
</p>
<p style="text-align:justify;">Observe that a unique file is passed in a single threaded way (as a kind of unique token) from one function to another where each function can safely modify the file knowing that is has private access to that file.</p>
<p><div style="background-color:#FFFF45";>One can make these intermediate files more vissible by by writing the <span style="font-family:courier;">WriteABC</span> as follows.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
WriteABC&nbsp;file&nbsp;=&nbsp;file3<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;file1&nbsp;=&nbsp;fwritec&nbsp;'a'&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;file2&nbsp;=&nbsp;fwritec&nbsp;'b'&nbsp;file1<br>
&nbsp;&nbsp;&nbsp;&nbsp;file3&nbsp;=&nbsp;fwritec&nbsp;'c'&nbsp;file2<br>
<br></div>
<div style="background-color:#FFFF45";>or, alternatively (to avoid the explicit numbering of the files),</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
WriteABC&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;file&nbsp;=&nbsp;fwritec&nbsp;'a'&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;=&nbsp;fwritec&nbsp;'b'&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;fwritec&nbsp;'c'&nbsp;file<br></div>
</p><p style="text-align:justify;">The type system makes it possible to make no distinction between a CLEAN file and a physical file of the real world: file I/O can be treated as efficiently as in imperative languages. The uniqueness typing prevents writing while other readers/writers are active. E.g. one cannot apply <span style="font-family:courier;">fwritec</span> to a file being used elsewhere.</p>
<p><div style="background-color:#FFFF45";>For instance, the following expression is <i>not</i> approved by the type system:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(file,&nbsp;fwritec&nbsp;'a'&nbsp;file)<br></div>
</p><p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Function arguments with no uniqueness attributes added to the classical type are considered as "non-unique": there are no reference requirements for these arguments. The function is only allowed to have <i>read access</i> (as usual in a functional language) even if in some of the function applications the actual argument appears to have reference count 1.</td></tr>
</table>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">freadc::&nbsp;File&nbsp;-&gt;&nbsp;(Char,&nbsp;File)<br></p>
<p style="text-align:justify;">The function <span style="font-family:courier;">freadc</span> can be applied to both a unique as well as non-unique file. This is fine since the function only wants read access on the file. The type indicates that the result is always a non-unique file. Such a file can be passed for further reading, but not for further writing.</p>
<p style="text-align:justify;">To indicate that functions don't change uniqueness properties of arguments, one can use <span style="font-family:courier;">attribute variables</span>.</p>
<p><div style="background-color:#FFFF45";>The simplest example is the identity functions that can be typed as follows:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
id::&nbsp;u:a&nbsp;-&gt;&nbsp;u:a<br>
id&nbsp;x&nbsp;=&nbsp;x<br>
<br></div>
<div style="background-color:#FFFF45";>Here <span style="font-family:courier;">a</span> is an ordinary type variable, whereas <span style="font-family:courier;">u</span> is an attribute variable. If <span style="font-family:courier;">id</span> is applied to an unique object the result is also unique (in that case <span style="font-family:courier;">u</span> is instantiated with the concrete attribute <span style="font-family:courier;">*</span>). Of course, if id is applied to a non-unique object, the result remains non-unique. As with ordinary type variables, attribute variables should be instantiated uniformly.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><p><div style="background-color:#FFFF45";>A more interesting example is the function <span style="font-family:courier;">freadc</span> that is typed as</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
freadc::&nbsp;u:File&nbsp;-&gt;&nbsp;u:(Char,&nbsp;u:File)<br>
<br></div>
<div style="background-color:#FFFF45";>Again <span style="font-family:courier;">freadc</span> can be applied to both unique and non-unique files. In the first case the resulting file is also unique and can, for example, be used for further reading or writing. Moreover, observe that not only the resulting file is attributed, but also the tuple containing that file and the character that has been read. This is due to the so called <i>uniqueness propagation rule</i>; see below.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><p style="text-align:justify;">To summarize, uniqueness typing makes it possible to update objects destructively within a purely functional language. For the development of real world applications (which manipulate files, windows, arrays, databases, states etc.) this is an indispensable property.</p>
<h2 style="background-color:#9999FF;"><a id="_9.2">9.2 Attribute Propagation</a></h2>
<p style="text-align:justify;">Having explained the general ideas of uniqueness typing, we can now focus on some details of this typing system.</p>
<p style="text-align:justify;">If a unique object is stored in a data structure, the data structure itself becomes unique as well. This <i>uniqueness propagation rule</i> prevents that unique objects are shared indirectly via the data structure in which these objects are stored. To explain this form of hidden sharing, consider the following definition of the function head</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">head::&nbsp;[*a]&nbsp;-&gt;&nbsp;*a<br>
head&nbsp;[hd:tl]&nbsp;=&nbsp;hd<br></p>
</p>
<p style="text-align:justify;">The pattern causes head to have access to the  eeper" arguments <span style="font-family:courier;">hd</span> and <span style="font-family:courier;">tl</span>. Note that head does not have any uniqueness requirements on its direct list argument. This means that in an application of head the list might be shared, as can be seen in the following function heads</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">heads&nbsp;list&nbsp;=&nbsp;(head&nbsp;list,&nbsp;head&nbsp;list)<br></p>
</p>
<p style="text-align:justify;">If one wants to formulate uniqueness requirements on, for instance, the <span style="font-family:courier;">hd</span> argument of <span style="font-family:courier;">head</span>, it is <i>not</i> sufficient to attribute the corresponding type variable <span style="font-family:courier;">a</span> with <span style="font-family:courier;">*</span>; the surrounding list itself should also become unique. One can easily see that, without this additional requirement the <span style="font-family:courier;">heads</span> example with type</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">heads::&nbsp;[*a]&nbsp;-&gt;&nbsp;(*a,*a)<br>
heads&nbsp;list&nbsp;=&nbsp;(head&nbsp;list,&nbsp;head&nbsp;list)<br></p>
</p>
<p style="text-align:justify;">would still be valid although it delivers the same object twice. By demanding that the surrounding list becomes unique as well, (so the type of <span style="font-family:courier;">head</span> becomes <span style="font-family:courier;">head:: *[*a] -&gt; *a</span>) the function <span style="font-family:courier;">heads</span> is rejected. In general one could say that uniqueness <i>propagates outwards</i>.</p>
<p style="text-align:justify;">Some of the readers will have noticed that, by using attribute variables, one can assign a more general uniqueness type to head:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">head::&nbsp;u:[u:a]&nbsp;-&gt;&nbsp;u:a<br></p>
</p>
<p style="text-align:justify;">The above propagation rule imposes additional (implicit) restrictions on the attributes appearing in type specifications of functions.</p>
<p style="text-align:justify;">Another explicit way of indicating restrictions on attributes is by using <i>coercion statements</i>. These statements consist of attribute variable inequalities of the form <span style="font-family:courier;">u &lt;= v</span>. The idea is that attribute substitutions are only allowed if the resulting attribute inequalities are valid, i.e. not resulting in an equality of the form</p>
<p style="text-align:justify;">'non-unique &le; unique'.</p>
<p style="text-align:justify;">The use of coercion statements is illustrated by the next example in which the uniqueness type of the well-known append function is shown.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">append::&nbsp;v:[u:a]&nbsp;w:[u:a]&nbsp;-&gt;&nbsp;x:[u:a],&nbsp;&nbsp;&nbsp;&nbsp;[v&lt;=u,&nbsp;w&lt;=u,&nbsp;x&lt;=u,w&lt;=x]<br></p>
</p>
<p style="text-align:justify;">The first three coercion statements express the uniqueness propagation for lists: if the elements <span style="font-family:courier;">a</span> are unique (by choosing <span style="font-family:courier;">*</span> for <span style="font-family:courier;">u</span>) these statements force <span style="font-family:courier;">v</span>,<span style="font-family:courier;">w</span> and <span style="font-family:courier;">x</span> to be instantiated with <span style="font-family:courier;">*</span> also. (Note that <span style="font-family:courier;">u &lt;= *</span><span style="font-family:courier;"> iff </span><span style="font-family:courier;">u = *</span>.) The statement <span style="font-family:courier;">w &lt;= x</span> expresses that the spine uniqueness of <span style="font-family:courier;">append</span>'s result depends only on the spine attribute <span style="font-family:courier;">w</span> of the second argument.</p>
<p style="text-align:justify;">In CLEAN it is permitted to omit attribute variables and attribute inequalities that arise from propagation properties; these will be added automatically by the type system. As a consequence, the following type for <span style="font-family:courier;">append</span> is also valid.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">append::&nbsp;[u:a]&nbsp;w:[u:a]&nbsp;-&gt;&nbsp;x:[u:a],&nbsp;&nbsp;&nbsp;&nbsp;[w&lt;=x]<br></p>
</p>
<p style="text-align:justify;">Of course, it is always allowed to specify a more specific type (by instantiating type or attribute variables). All types given below are valid types for <span style="font-family:courier;">append</span>.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">append::&nbsp;[u:a]&nbsp;x:[u:a]&nbsp;-&gt;&nbsp;x:[u:a],<br>
append::&nbsp;*[*Int]&nbsp;*[*Int]&nbsp;-&gt;&nbsp;*[*Int],<br>
append::&nbsp;[a]&nbsp;*[a]&nbsp;-&gt;&nbsp;*[a].<br></p>
</p>
<p style="text-align:justify;">To make types more readable, CLEAN offers the possibility to use <i>anonymous</i> attribute variables. These can be used as a shorthand for indicating attribute variables of which the actual names are not essential. This allows us to specify the type for <span style="font-family:courier;">append</span> as follows.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">append::&nbsp;[.a]&nbsp;w:[.a]&nbsp;-&gt;&nbsp;x:[.a],&nbsp;&nbsp;&nbsp;[w&lt;=x]<br></p>
</p>
<p style="text-align:justify;">The type system of CLEAN will substitute real attribute variables for the anonymous ones. Each dot gives rise to a new attribute variable except for the dots attached to type variables: type variables are attributed uniformly in the sense that all occurrences of the same type variable will obtain the same attribute. In the above example this means that all dots are replaced by one and the same new attribute variable.</p>
<h2 style="background-color:#9999FF;"><a id="_9.3">9.3 Defining New Types with Uniqueness Attributes</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:9.05454545454545%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs</td><td style="width:66.8545454545455%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>=</b></span> ConstructorDef</td></tr>
<tr><td style="width:33.1454545454545%px'" colspan="3"></td><td style="width:66.8545454545455%px'" colspan="7">{<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] <span style="font-family:courier;">ConstructorName</span> {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] (<span style="font-family:courier;">ConstructorName</span>) [Fix][Prec] {ArgType}</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeLhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#993300;"><b>*</b></span>]TypeConstructor {TypeVariable}</td></tr>
<tr><td style="width:23.0290909090909%;">TypeConstructor</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeName</span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ExistentalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>E.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">UniversalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{TypeVariable }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
<tr><td style="width:23.0290909090909%;">ArgType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
<tr><td style="width:23.0290909090909%;">UnqTypeAttrib</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>*</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">UniqueTypeVariable<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">As can be inferred from the syntax, the attributes that are actually allowed in data type definitions are '<span style="font-family:courier;">*</span>' and '<span style="font-family:courier;">.</span>'; attribute variables are not permitted. The (unique) <span style="font-family:courier;">*</span> attribute can be used at any subtype whereas the (anonymous). attribute is restricted to non-variable positions.</p>
<p style="text-align:justify;">If no uniqueness attributes are specified, this does not mean that one can only build non-unique instances of such a data type. Attributes not explicitly specified by the programmer are added automatically by the type system. To explain this standard uniqueness attribution mechanism, first remember that the types of data constructors are not specified by the programmer but derived from their corresponding data type definition.</p>
<p><div style="background-color:#FFFF45";>For example, the (classical) definition of the <span style="font-family:courier;">List</span> type</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;List&nbsp;a&nbsp;=&nbsp;Cons&nbsp;a&nbsp;(List&nbsp;a)&nbsp;|&nbsp;Nil<br>
<br></div>
<div style="background-color:#FFFF45";>leads to the following types for its data constructors:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Cons::&nbsp;a&nbsp;(List&nbsp;a)&nbsp;-&gt;&nbsp;List&nbsp;a<br>
Nil::&nbsp;List&nbsp;a<br></div>
</p><p style="text-align:justify;">To be able to create unique instances of data types, the standard attribution of CLEAN will automatically derive appropriate uniqueness variants for the types of the corresponding data constructors. Such a uniqueness variant is obtained via a consistent attribution of all types and subtypes appearing in a data type definition. Here, consistency means that such an attribution obeys the following rules (assume that we have a type definition for some type <span style="font-family:courier;">T</span>).</p>
<table style="width:100%;"><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">1)</td><td style="text-align:justify;">Attributes that are explicitly specified are adopted.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">2)</td><td style="text-align:justify;">Each (unattributed) type variable and each occurrence of <span style="font-family:courier;">T</span> will receive an attribute variable. This is done in a uniform way: equal type variables will receive equal attributes, and all occurrence of <span style="font-family:courier;">T</span> are also equally attributed.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">3)</td><td style="text-align:justify;">Attribute variables are added at non-variable positions if they are required by the propagation properties of the corresponding type constructor. The attribute variable that is chosen depends on the argument types of this constructor: the attribution scheme takes the attribute variable of first argument appearing on a propagating position (see example below).</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">4)</td><td style="text-align:justify;">All occurrences of the <span style="font-family:courier;">.</span>attribute are replaced by the attribute variable assigned to the occurrences of <span style="font-family:courier;">T</span>.</td></tr></table>
</td></table>
<p><div style="background-color:#FFFF45";>Example of standard attribution for data constructors. For <span style="font-family:courier;">Cons</span> the standard attribution leads to the type</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Cons::&nbsp;u:a&nbsp;v:(List&nbsp;u:a)&nbsp;-&gt;&nbsp;v:List&nbsp;u:a,&nbsp;[v&lt;=u]<br>
<br></div>
<div style="background-color:#FFFF45";>The type of <span style="font-family:courier;">Nil</span> becomes</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Nil::&nbsp;v:List&nbsp;u:a,&nbsp;[v&lt;=u]<br></div>
</p><p><div style="background-color:#FFFF45";>Consider the following <span style="font-family:courier;">Tree</span> definition</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Tree&nbsp;a&nbsp;&nbsp;=&nbsp;&nbsp;Node&nbsp;a&nbsp;[Tree&nbsp;a]<br>
<br></div>
<div style="background-color:#FFFF45";>The type of the data constructor <span style="font-family:courier;">Node</span> is</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Node::&nbsp;u:a&nbsp;v:[v:Tree&nbsp;u:a]&nbsp;-&gt;&nbsp;v:Tree&nbsp;u:a,&nbsp;[v&lt;=u]<br></div>
</p><p><div style="background-color:#FFFF45";>Another <span style="font-family:courier;">Tree</span> variant.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;Tree&nbsp;*a&nbsp;&nbsp;=&nbsp;&nbsp;Node&nbsp;*a&nbsp;[Tree&nbsp;*a]<br>
<br></div>
<div style="background-color:#FFFF45";>leading to</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Node::&nbsp;*a&nbsp;*[*Tree&nbsp;*a]&nbsp;-&gt;&nbsp;*Tree&nbsp;*a<br>
<br></div>
<div style="background-color:#FFFF45";>Note that, due to propagation, all subtypes have become unique.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><p style="text-align:justify;">Next, we will formalize the notion of uniqueness propagation. We say that an argument of a type constructor, say <span style="font-family:courier;">T</span>, is propagating if the corresponding type variable appears on a propagating position in one of the types used in the right-hand side of <span style="font-family:courier;">T</span>'s definition. A propagating position is characterized by the fact that it is not surrounded by an arrow type or by a type constructor with non-propagating arguments. Observe that the definition of propagation is cyclic: a general way to solve this problem is via a fixed-point construction.</p>
<p><div style="background-color:#FFFF45";>Example of the propagation rule. Consider the (record) type definition for <span style="font-family:courier;">Object</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Object&nbsp;a&nbsp;b::&nbsp;&nbsp;{state::&nbsp;a,&nbsp;fun::&nbsp;b&nbsp;-&gt;&nbsp;a}<br>
<br></div>
<div style="background-color:#FFFF45";>The argument <span style="font-family:courier;">a</span> is propagating. Since <span style="font-family:courier;">b</span> does not appear on a propagating position inside this definition, <span style="font-family:courier;">Object</span> is not propagating in its second argument.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><h2 style="background-color:#9999FF;"><a id="_9.4">9.4 Uniqueness and Sharing</a></h2>
<p style="text-align:justify;">The type inference system of CLEAN will derive uniqueness information <i>after</i> the classical Milner/Mycroft types of functions have been inferred (<span style="color:blue;"><a href="#_4.3">see 4.3</a></span>). As explained in <span style="color:blue;"><a href="#_9.1">Section 9.1</a></span>, a function may require a <i>non-unique</i> object, a <i>unique</i> object or a <i>possibly unique</i> object. Uniqueness of the result of a function will depend on the attributes of its arguments and how the result is constructed. Until now, we distinguished objects with reference count 1 from objects with a larger reference count: only the former might be unique (depending on the uniqueness type of the object itself). In practice, however, one can be more liberal if one takes the evaluation order into account. The idea is that multiple reference to an (unique) object are harmless if one knows that only one of the references will be present at the moment it is accessed destructively. This has been used in the following function.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">AppendAorB::&nbsp;*File&nbsp;-&gt;&nbsp;*File<br>
AppendAorB&nbsp;file<br>
|&nbsp;&nbsp;&nbsp;fc&nbsp;==&nbsp;'a'&nbsp;=&nbsp;fwritec&nbsp;'a'&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;fwritec&nbsp;'b'&nbsp;file<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(fc,nf)&nbsp;&nbsp;&nbsp;=&nbsp;freadc&nbsp;file<br></p>
</p>
<p style="text-align:justify;">When the right-hand side of <span style="font-family:courier;">AppendAorB</span> is evaluated, the guard is determined first (so access from <span style="font-family:courier;">freadc</span> to <span style="font-family:courier;">file</span> is not unique), and subsequently one of the alternatives is chosen and evaluated. Depending on <span style="font-family:courier;">cond</span>, either the reference from the first <span style="font-family:courier;">fwritec</span> application to function file or that of the second application is left and therefore unique.</p>
<p style="text-align:justify;">For this reason, the uniqueness type system uses a kind of <i>sharing analysis</i>.  This sharing analysis is input for the uniqueness type system itself to check uniqueness type consistency (<span style="color:blue;"><a href="#_9.3">see 9.3</a></span>). The analysis will label each <i>reference</i> in the right-hand side of a function definition as <i>read-only</i> (if destructive access might be dangerous) or <i>write-permitted</i> (otherwise). Objects  accessed via a read-only reference are always non-unique. On the other hand, uniqueness of objects accessed via a reference labeled with <i>write-permitted</i> solely depends on the types of the objects themselves.</p>
<p style="text-align:justify;">Beforecg describing the labeling mechanism of CLEAN we mention that the "lifetime" of references is determined on a syntactical basis. For this reason we classify references to the same expression in a function definition (say for <span style="font-family:courier;">f</span>) according to their estimated run-time use, as <i>alternative</i>, <i>observing</i> and <i>parallel</i>.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Two references are <i>alternative</i> if they belong to different alternatives of <span style="font-family:courier;">f</span>. Note that alternatives are distinguished by patterns (including <span style="font-family:courier;">case</span> expressions) or by guards.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">A reference <span style="font-family:courier;">r</span> is <i>observing</i> w.r.t. a reference <span style="font-family:courier;">r'</span> if the expression containing <span style="font-family:courier;">r'</span> is either (1) guarded by an expression or (2) preceded by a strict let before expression containing <span style="font-family:courier;">r</span>.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Otherwise, references are in <i>parallel</i>.</td></tr></table>
<p style="text-align:justify;">The rules used by the sharing analysis to label each reference are the following.</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">A reference, say <span style="font-family:courier;">r</span>, to a certain object is labeled with read-only if there exist another reference, say <span style="font-family:courier;">r'</span>, to the same object such that either <span style="font-family:courier;">r</span> is observing w.r.t <span style="font-family:courier;">r'</span> or <span style="font-family:courier;">r</span> and <span style="font-family:courier;">r'</span>are in parallel.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Multiple references to <i>cyclic structures</i> are always labeled as read-only.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">All other references are labeled with write-permitted.</td></tr></table>
<p style="text-align:justify;">Unfortunately, there is still a subtlety that has to be dealt with. Observing references belonging in a strict context do not always vanish totally after the expression containing the reference has been evaluated: further analysis appears to be necessary to ensure their disappearance. More concretely, suppose <span style="font-family:courier;">e[r]</span> denotes the expression containing <span style="font-family:courier;">r</span>. If the type of <span style="font-family:courier;">e[r]</span> is a basic type then, after evaluation, <span style="font-family:courier;">e[r]</span> will be reference-free. In particular, it does not contain the reference <span style="font-family:courier;">r</span> anymore. However, If the type of <span style="font-family:courier;">e[r]</span> is not a basic type it is assumed that, after evaluation, <span style="font-family:courier;">e[r]</span> might still refer to r. But even in the latter case a further refinement is possible. The idea is, depending on <span style="font-family:courier;">e[r]</span>, to correct the type of the object to which <span style="font-family:courier;">r</span> refers partially in such way that only the parts of this object that are still shared lose their uniqueness.</p>
<p><div style="background-color:#FFFF45";>Consider, for example, the following rule</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f&nbsp;l&nbsp;=<br>
<span style="font-family:courier;color:#FF0000;"><b>#!</b></span>&nbsp;x&nbsp;=&nbsp;hd&nbsp;(hd&nbsp;l)<br>
=&nbsp;(x,&nbsp;l)<br>
<br></div>
<div style="background-color:#FFFF45";>Clearly, x and l share a common substructure; <span style="font-family:courier;">x</span> is even part of <span style="font-family:courier;">l</span>. But the whole "spine" of <span style="font-family:courier;">l</span> (of type <span style="font-family:courier;">[[...]]</span>) does not contain any new external references. Thus, if <span style="font-family:courier;">l</span> was spine-unique originally, it remains spine unique in the result of <span style="font-family:courier;">f</span>. Apparently, the access to <span style="font-family:courier;">l</span> only affected part of <span style="font-family:courier;">l</span>'s structure. More technically, the type of <span style="font-family:courier;">l</span> itself is corrected to take the partial access on <span style="font-family:courier;">l</span> into account. In the previous example, <span style="font-family:courier;">x</span>, regarded as a function on <span style="font-family:courier;">l</span> has type <span style="font-family:courier;">[[a]] -&gt; a</span>. In <span style="font-family:courier;">f</span>'s definition the part of <span style="font-family:courier;">l</span>'s type corresponding to the variable a is made non-unique. This is clearly reflected in the derived type for <span style="font-family:courier;">f</span>, being </div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f::&nbsp;u:[w:[a]]&nbsp;-&gt;&nbsp;(a,v:[x:[a]]),&nbsp;[w&nbsp;&lt;=&nbsp;x,&nbsp;u&nbsp;&lt;=&nbsp;v]<br></div>
</p><p style="text-align:justify;">In CLEAN this principle has been generalized: If the strict let expression <span style="font-family:courier;">e[r]</span> regarded as a function on r has type</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">T&nbsp;(...&nbsp;a...)&nbsp;-&gt;&nbsp;a<br></p>
<p style="text-align:justify;">Then the a-part of the type of the object to which r refers becomes non-unique; the rest of the type remains unaffected. If the type of <span style="font-family:courier;">e[r]</span> is not of the indicated form, <span style="font-family:courier;">r</span> is not considered as an observing reference (w.r.t. some reference <span style="font-family:courier;">r'</span>), but, instead, as in parallel with <span style="font-family:courier;">r'</span>.</p>
<h3 style="background-color:#9999FF;"><a id="_9.4.1">9.4.1 Higher Order Uniqueness Typing</a></h3>
<p style="text-align:justify;">Higher-order functions give rise to partial (often called <i>curried</i>) applications, i.e. applications in which the actual number of arguments is less than the arity of the corresponding symbol. If these partial applications contain unique sub-expressions one has to be careful.</p>
<p><div style="background-color:#FFFF45";>Consider, for example the following the function <span style="font-family:courier;">fwritec</span> with type</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
fwritec::&nbsp;*File&nbsp;Char&nbsp;-&gt;&nbsp;*File<br>
<br></div>
<div style="background-color:#FFFF45";>in the application</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
fwritec&nbsp;unifile<br>
<br></div>
<div style="background-color:#FFFF45";>(assuming that unifile returns a unique file). Clearly, the type of this application is of the form <span style="font-family:courier;">o:(Char -&gt; *File)</span>. The question is: what kind of attribute is <span style="font-family:courier;">o</span>? Is it a variable, is it *, or, is it not unique? Before making a decision, one should notice that it is dangerous to allow the above application to be shared. For example, if the expression <span style="font-family:courier;">fwritec unifile</span> is passed to a function</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
WriteAB&nbsp;write_fun&nbsp;=&nbsp;(write_fun&nbsp;'a',&nbsp;write_fun&nbsp;'b')<br></div>
</p><p style="text-align:justify;">Then the argument of <span style="font-family:courier;">fwritec</span> is no longer unique at the moment one of the two write operations take place. Apparently, the <span style="font-family:courier;">fwritec unifile</span> expression is <i>essentially</i> unique: its reference count should never become greater than 1. To prevent such an essentially unique expression from being copied, CLEAN considers the <span style="font-family:courier;">-&gt;</span> type constructor in combination with the <span style="font-family:courier;">*</span> attribute as special: it is not permitted to discard its uniqueness. Now, the question about the attribute <span style="font-family:courier;">o</span> can be answered: it is set to <span style="font-family:courier;">*</span>. If <span style="font-family:courier;">WriteAB</span> is typed as follows</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">WriteAB::&nbsp;(Char&nbsp;-&gt;&nbsp;u:File)&nbsp;-&gt;&nbsp;(u:File,&nbsp;u:File)<br>
WriteAB&nbsp;write_fun&nbsp;=&nbsp;(write_fun&nbsp;'a',&nbsp;write_fun&nbsp;'b')<br></p>
</p>
<p style="text-align:justify;">the expression <span style="font-family:courier;">WriteAB (fwritec unifile)</span> is rejected by the type system because it does not allow the argument of type <span style="font-family:courier;">*(Char -&gt; *File)</span> to be coerced to <span style="font-family:courier;">(Char -&gt; u:File)</span>. One can easily see that it is impossible to type <span style="font-family:courier;">WriteAB</span> in such a way that the expression becomes typable.</p>
<p style="text-align:justify;">To define data structures containing Curried applications it is often convenient to use the (anonymous) <span style="font-family:courier;">.</span> attribute. Example</p>
<p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;Object&nbsp;a&nbsp;b&nbsp;=&nbsp;{&nbsp;state::&nbsp;a,&nbsp;fun::.(b&nbsp;-&gt;&nbsp;a)&nbsp;}<br>
new::&nbsp;*&nbsp;Object&nbsp;*File&nbsp;Char<br>
new&nbsp;=&nbsp;{&nbsp;state&nbsp;=&nbsp;unifile,&nbsp;fun&nbsp;=&nbsp;fwritec&nbsp;unifile&nbsp;}<br></p>
<p style="text-align:justify;">By adding an attribute variable to the function type in the definition of <span style="font-family:courier;">Object</span>, it is possible to store unique functions in this data structure. This is shown by the function <span style="font-family:courier;">new</span> . Since <span style="font-family:courier;">new</span> contains an essentially unique expression it becomes essentially unique itself. So, <span style="font-family:courier;">new</span> can never lose its uniqueness, and hence, it can only be used in a context in which a unique object is demanded.</p>
<p style="text-align:justify;">Determining the type of a curried application of a function (or data constructor) is somewhat more involved if the type of that function contains attribute variables instead of concrete attributes. Mostly, these variables will result in additional coercion statements. as can be seen in the example below.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">Prepend::&nbsp;u:[.a]&nbsp;[.a]&nbsp;-&gt;&nbsp;v:[.a],&nbsp;&nbsp;[u&lt;=v]<br>
Prepend&nbsp;a&nbsp;b&nbsp;=&nbsp;Append&nbsp;b&nbsp;a<br>
<br>
PrependList::&nbsp;u:[.a]&nbsp;-&gt;&nbsp;w:([.a]&nbsp;-&gt;&nbsp;v:[.a]),&nbsp;&nbsp;&nbsp;&nbsp;[u&lt;=v,&nbsp;w&lt;=u]<br>
PrependList&nbsp;a&nbsp;=&nbsp;Prepend&nbsp;a<br></p>
</p>
<p style="text-align:justify;">Some explanation is in place. The expression <span style="font-family:courier;">(PrependList some_list)</span> yields a function that, when applied to another list, say <span style="font-family:courier;">other_list</span>, delivers a new list extended consisting of the concatenation of <span style="font-family:courier;">other_list</span> and <span style="font-family:courier;">some_list</span>. Let's call this final result new_list. If <span style="font-family:courier;">new_list</span> should be unique (i.e. v becomes <span style="font-family:courier;">*</span>) then, because of the coercion statement <span style="font-family:courier;">u&lt;=v</span> the attribute u also becomes <span style="font-family:courier;">*</span>. But, if <span style="font-family:courier;">u = *</span> then also <span style="font-family:courier;">w = *</span>, for, <span style="font-family:courier;">w&lt;=u</span>. This implies that (arrow) type of the original expression <span style="font-family:courier;">(PrependList some_list)</span> becomes unique, and hence this expression cannot be shared.</p>
<h3 style="background-color:#9999FF;"><a id="_9.4.2">9.4.2 Uniqueness Type Coercions</a></h3>
<p style="text-align:justify;">As said before, offering a unique object to a function that requires a non-unique argument is safe (unless we are dealing with unique arrow types; see above). The technical tool to express this is via a coercion (subtype) relation based on the ordering</p>
<p style="text-align:justify;">'unique' &le; 'non-unique'</p>
<p style="text-align:justify;">on attributes. Roughly, the validity of &sigma; &le; &sigma;' depends subtype-wise on the validity of <span style="font-family:courier;">u</span> &le; <span style="font-family:courier;">u'</span> with <span style="font-family:courier;">u</span>,<span style="font-family:courier;">u'</span> attributes in &sigma;,&sigma;`. One has, for example</p>
<p style="text-align:justify;"><span style="font-family:courier;">u:[v:[w:Int]]</span> &le; <span style="font-family:courier;">u':[v':[w':Int]]</span> iff <span style="font-family:courier;">u</span> &le; <span style="font-family:courier;">u'</span>, <span style="font-family:courier;">v</span> &le; <span style="font-family:courier;">v'</span>, <span style="font-family:courier;">w</span> &le; <span style="font-family:courier;">w'</span>.</p>
<p style="text-align:justify;">However, a few refinements are necessary. Firstly, the uniqueness constraints expressed in terms of coercion statements (on attribute variables) have to be taken into account. Secondly, the coercion restriction on arrow types should be handled correctly. And thirdly, due to the so-called <i>contravariance</i> of <span style="font-family:courier;">-&gt;</span> in its first argument we have that</p>
<p style="text-align:justify;"><span style="font-family:courier;">u</span>:(&sigma; <span style="font-family:courier;">-&gt;</span> &sigma;') &le; <span style="font-family:courier;">u</span>:(&tau; <span style="font-family:courier;">-&gt;</span> &tau;') iff &tau; &le; &sigma;, &sigma;' &le; &tau;'</p>
<p style="text-align:justify;">Since <span style="font-family:courier;">-&gt;</span> may appear in the definitions of algebraic type constructors, these constructors may inherit the co- and contravariant subtyping behavior with respect to their arguments. We can classify the 'sign' of the arguments of each type constructor as + (positive, covariant), - (negative, contravariant) or top (both positive and negative). In general this is done by analysing the (possible mutually recursive) algebraic type definitions by a fixed-point construction, with basis sign(<span style="font-family:courier;">-&gt;</span>) = (<span style="font-family:courier;">-</span>,<span style="font-family:courier;">+</span>).</p>
<p><div style="background-color:#FFFF45";>Example: <span style="font-family:courier;">a</span> has sign <span style="font-family:courier;">T</span>, <span style="font-family:courier;">b</span> has sign <span style="font-family:courier;">+</span> in</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::FunList&nbsp;a&nbsp;b&nbsp;=&nbsp;FunCons&nbsp;(a,&nbsp;a&nbsp;-&gt;&nbsp;b)&nbsp;(FunList&nbsp;a&nbsp;b)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;FunNil<br></div>
</p><p style="text-align:justify;">This leads to the following coercion rules</p>
<table style="width:100%;"><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">5)</td><td style="text-align:justify;">Attributes of two corresponding type variables as well as of two corresponding arrow types must be equal.</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">6)</td><td style="text-align:justify;">The sign classification of each type constructor is obeyed. If, for instance, the sign of &Tau;'s argument is negative, then &Tau; &sigma; &le; &Tau; &sigma;' iff &sigma;' &le; &sigma;</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">7)</td><td style="text-align:justify;">In all other cases, the validity of a coercion relation depends on the validity of <span style="font-family:courier;">u</span> &le; <span style="font-family:courier;">u'</span>, where <span style="font-family:courier;">u</span>,<span style="font-family:courier;">u'</span> are attributes of the two corresponding subtypes.</td></tr></table>
</td></table>
<p style="text-align:justify;">The presence of sharing inherently causes a (possibly unique) object to become non-unique, if it is accessed via a read-only reference. In CLEAN this is achieved by a type correction operation that converts each unique type S to its smallest non-unique supertype, simply by making the outermost attribute of S non-unique. Note that this operation fails if S is a function type.</p>
<h2 style="background-color:#9999FF;"><a id="_9.5">9.5 Combining Uniqueness Typing and Overloading</a></h2>
<p style="text-align:justify;">An overloaded function actually stands for a collection of real functions. The types of these real functions are obtained from the type of the overloaded function by substituting the corresponding instance type for the class variable. These instance types may contain uniqueness information, and, due to the propagation requirement, the above-mentioned substitution might give rise to uniqueness attributes overloaded type specification.</p>
<p style="text-align:justify;">Consider, for instance, the identity class</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;id&nbsp;a::&nbsp;a&nbsp;-&gt;&nbsp;a<br></p>
</p>
<p style="text-align:justify;">If we want to define an instance of <span style="font-family:courier;">id</span> for lists, say <span style="font-family:courier;">id L</span>, which leaves uniqueness of the list elements intact, the (fully expanded) type of <span style="font-family:courier;">idL</span> becomes</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;id&nbsp;L&nbsp;v:[u:a]&nbsp;-&gt;&nbsp;v:[u:a]<br></p>
</p>
<p style="text-align:justify;">However, as said before, the type specification of such an instance is not specified completely: it is derived from the overloaded type in combination with the instance type (i.e. <span style="font-family:courier;">[...]</span> in this particular example).</p>
<p style="text-align:justify;">In CLEAN we require that the type specification of an overloaded operator anticipates on attributes arising from uniqueness propagation, that is, the uniqueness attribute of the class variable should be chosen in such a way that for any instance type this 'class attribute' does not conflict with the corresponding uniqueness attribute(s) in the fully expanded type of this instance. In the above example this means that the type of <span style="font-family:courier;">id</span> becomes</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;id&nbsp;a::&nbsp;a&nbsp;-&gt;&nbsp;a<br></p>
</p>
<p style="text-align:justify;">Another possibility is</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;id&nbsp;a::&nbsp;*a&nbsp;-&gt;&nbsp;*a<br></p>
</p>
<p style="text-align:justify;">However, the latter version of <span style="font-family:courier;">id</span> will be more restrictive in its use, since it will always require that its argument is unique.</p>
<h3 style="background-color:#9999FF;"><a id="_9.5.1">9.5.1 Constructor Classes</a></h3>
<p style="text-align:justify;">The combination of uniqueness typing and constructor classes (with their higher-order class variables) introduces another difficulty. Consider, for example, the overloaded map function.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;map&nbsp;m::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;(m&nbsp;a)&nbsp;-&gt;&nbsp;m&nbsp;b<br></p>
</p>
<p style="text-align:justify;">Suppose we would add (distinct) attribute variables to the type variables <span style="font-family:courier;">a</span> and <span style="font-family:courier;">b</span> (to allow 'unique instances' of map)</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;map&nbsp;m::&nbsp;(.a&nbsp;-&gt;.b)&nbsp;(m&nbsp;.a)&nbsp;-&gt;&nbsp;m&nbsp;.b<br></p>
</p>
<p style="text-align:justify;">The question that arises is: Which attributes should be added to the two applications of the class variable <span style="font-family:courier;">m</span>? Clearly, this depends on the actual instance type filled in for <span style="font-family:courier;">m</span>. E.g., if <span style="font-family:courier;">m</span> is instantiated with a propagating type constructor (like <span style="font-family:courier;">[]</span>), the attributes of the applications of <span style="font-family:courier;">m</span> are either attribute variables or the concrete attribute 'unique'. Otherwise, one can choose anything.</p>
<p><div style="background-color:#FFFF45";>Example</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;map&nbsp;[]<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;f&nbsp;l&nbsp;=&nbsp;[&nbsp;f&nbsp;x&nbsp;//&nbsp;x&nbsp;&lt;-&nbsp;l&nbsp;]<br>
<br>
::&nbsp;&nbsp;T&nbsp;a&nbsp;=&nbsp;C&nbsp;(Int&nbsp;-&gt;&nbsp;a)<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;map&nbsp;T<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;f&nbsp;(C&nbsp;g)&nbsp;=&nbsp;C&nbsp;(f&nbsp;o&nbsp;g)<br>
<br></div>
<div style="background-color:#FFFF45";>In this example, the respective expanded types of the instances are</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
map::&nbsp;(u:a&nbsp;-&gt;&nbsp;v:b)&nbsp;w:[u:a]&nbsp;-&gt;&nbsp;x:[v:b],&nbsp;w&nbsp;&lt;=&nbsp;u,&nbsp;x&nbsp;&lt;=&nbsp;v<br>
map::&nbsp;(u:a&nbsp;-&gt;&nbsp;v:b)&nbsp;(T&nbsp;u:a)&nbsp;-&gt;&nbsp;T&nbsp;v:b<br></div>
</p><p style="text-align:justify;">The type system of CLEAN requires that a possible propagation attribute is explicitly indicated in the type specification of the overloaded function. In order to obtain versions of <span style="font-family:courier;">map</span> producing spine unique data structures, its overloaded type should be specified as follows:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;map&nbsp;m::&nbsp;(.a&nbsp;-&gt;.b).(m.&nbsp;a)&nbsp;-&gt;.(m.&nbsp;b)<br></p>
</p>
<p style="text-align:justify;">This type will provide that for an application like</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">map&nbsp;inc&nbsp;[1,2,3]<br></p>
</p>
<p style="text-align:justify;">indeed yields a spine unique list.</p>
<p style="text-align:justify;">Observe that if you would omit the (anonymous) attribute variable of the second argument, the input data structure cannot contain unique data on propagating positions, e.g. one could not use such a version of <span style="font-family:courier;">map</span> for mapping a destructive write operator on a list of unique files.</p>
<p style="text-align:justify;">In fact, the propagation rule is used to translate uniqueness properties of objects into uniqueness properties of the data structures in which these objects are stored. As said before, in some cases the actual data structures are unknown.</p>
<p style="text-align:justify;">Consider the following function</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">DoubleMap&nbsp;f&nbsp;l&nbsp;=&nbsp;(map&nbsp;f&nbsp;l,&nbsp;map&nbsp;f&nbsp;l)<br></p>
</p>
<p style="text-align:justify;">The type of this function is something like</p>
<p style="text-align:justify;">Clearly, <span style="font-family:courier;">l</span> is duplicated. However, this does not necessarily mean that a cannot be unique anymore. If, for instance, <span style="font-family:courier;">m</span> is instantiated with a non-propagating type constructor (like &Tau; as defined on the previous page) then uniqueness of a is still permitted. On the other hand, if <span style="font-family:courier;">m</span> is instantiated with a propagating type constructor, a unique instantiation of a should be disapproved. In CLEAN, the type system 'remembers' sharing of objects (like <span style="font-family:courier;">l</span> in the above example) by making the corresponding type attribute non-unique. Thus, the given type for <span style="font-family:courier;">DoubleMap</span> is exactly the type inferred by CLEAN?s type system. If one tries to instantiate <span style="font-family:courier;">m</span> with a propagating type constructor, and, at the same type, a with some unique type, this will fail.</p>
<p style="text-align:justify;">The presence of higher-order class variables, not only influences propagation properties of types, but also the coercion relation between types. These type coercions depend on the sign classification of type constructors. The problem with higher-order polymorphism is that in some cases the actual type constructors substituted for the higher order type variables are unknown, and therefore one cannot decide whether coercions in which higher-order type variable are involved, are valid.</p>
<p style="text-align:justify;">Consider the functions</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">double&nbsp;x&nbsp;=&nbsp;(x,x)<br>
dm&nbsp;f&nbsp;l&nbsp;=&nbsp;double&nbsp;(map&nbsp;f&nbsp;l)<br></p>
</p>
<p style="text-align:justify;">Here, <span style="font-family:courier;">map</span>'s result (of type <span style="font-family:courier;">.(m .a)</span>) is coerced to the non-unique supertype <span style="font-family:courier;">(m .a)</span>. However, this is only allowed if <span style="font-family:courier;">m</span> is instantiated with type constructors that have no coercion restrictions. E.g., if one tries to substitute <span style="font-family:courier;">*WriteFun</span> for <span style="font-family:courier;">m</span>, where</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">WriteFun&nbsp;a&nbsp;=&nbsp;C.(a&nbsp;-&gt;&nbsp;*File)<br></p>
</p>
<p style="text-align:justify;">this should fail, for, <span style="font-family:courier;">*WriteFun</span> is <i>essentially</i> unique. The to solve this problem is to restrict coercion properties of type variable applications (m &sigma;) to</p>
<p style="text-align:justify;"><span style="font-family:courier;">u:</span>(<span style="font-family:courier;">m</span> &sigma;) = <span style="font-family:courier;">u:</span>(<span style="font-family:courier;">m</span> &tau;) iff &sigma; &le; &tau; &amp;&amp; &tau; &le; &sigma;</p>
<p style="text-align:justify;">A slightly modified version of this solution has been adopted in CLEAN. For convenience, we have added the following refinement. The instances of type constructors classes are restricted to type constructors with no coercion restrictions. Moreover, it is assumed that these type constructors are uniqueness propagating. This means that the <span style="font-family:courier;">WriteFun</span> cannot be used as an instance for <span style="font-family:courier;">map</span>. Consequently, our coercion relation we can be more liberal if it involves such class variable applications.</p>
<p style="text-align:justify;">Overruling this requirement can be done adding the anonymous attribute. the class variable. E.g.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;map.m::&nbsp;(.a&nbsp;-&gt;.b).(m.&nbsp;a)&nbsp;-&gt;.(m.&nbsp;b)<br></p>
</p>
<p style="text-align:justify;">Now</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;map&nbsp;WriteFun&nbsp;<br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;map...<br></p>
</p>
<p style="text-align:justify;">is valid, but the coercions in which (parts of) <span style="font-family:courier;">map</span>'s type are involved are now restricted as explained above. To see the difference between the two indicated variants of constructor variables, we slightly modify map?s type.</p>
<p style="text-align:justify;">To see the difference between the two indicated variants of constructor variables, we slightly modify <span style="font-family:courier;">map</span>'s type.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;map&nbsp;m::&nbsp;(.a&nbsp;-&gt;.b)&nbsp;*(m.&nbsp;a)&nbsp;-&gt;.(m.&nbsp;b)<br></p>
</p>
<p style="text-align:justify;">Without overruling the instance requirement for <span style="font-family:courier;">m</span> the type of <span style="font-family:courier;">dm</span> (<span style="font-family:courier;">dm</span> as given on the previous page) becomes.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">dm::&nbsp;(.a&nbsp;-&gt;.b)&nbsp;*(m.a)&nbsp;-&gt;.(m&nbsp;b,&nbsp;m&nbsp;b)<br></p>
</p>
<p style="text-align:justify;">Observe that the attribute of disappeared due to the fact that each type constructor substituted for <span style="font-family:courier;">m</span> is assumed to be propagating.</p>
<p style="text-align:justify;">If one explicitly indicates that there are no instance restriction for the class variable <span style="font-family:courier;">m</span> (by attributing <span style="font-family:courier;">m</span> with.), the function <span style="font-family:courier;">dm</span> becomes untypable.</p>
<h2 style="background-color:#9999FF;"><a id="_9.6">9.6 Higher-Order Type Definitions</a></h2>
<p style="text-align:justify;">We will describe the effect of uniqueness typing on type definitions containing higher-order type variables. At it turns out, this combination introduces a number of difficulties which would make a full description very complex. But even after skipping a lot of details we have to warn the reader that some of the remaining parts are still hard to understand.</p>
<p style="text-align:justify;">As mentioned earlier, two properties of newly defined type constructor concerning uniqueness typing are important, namely, propagation and sign classification. One can probably image that, when dealing with higher-order types the determination on these properties becomes more involved. Consider, for example, the following type definition.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;&nbsp;T&nbsp;m&nbsp;a&nbsp;=&nbsp;C&nbsp;(m&nbsp;a)<br></p>
</p>
<p style="text-align:justify;">The question whether <span style="font-family:courier;">T</span> is propagating in its second argument cannot be decided by examining this definition only; it depends on the actual instantiation of the (higher-order) type variable <span style="font-family:courier;">m</span>. If <span style="font-family:courier;">m</span> is instantiated with a propagating type constructor, like <span style="font-family:courier;">[]</span>, then <span style="font-family:courier;">T</span> becomes propagating in its second argument as well. Actually, propagation is not only a property of type constructors, but also of types themselves, particularly of 'partial types' For example, the partial type [] is propagating in its (only) argument (Note that the number of arguments a partial type expects, directly follows from the kinds of the type constructors that have been used). The type <span style="font-family:courier;">T []</span> is also propagating in its argument, so is the type <span style="font-family:courier;">T ((,) Int)</span>).</p>
<p style="text-align:justify;">The analysis in CLEAN that determines propagation properties of (partial) types has been split into two phases. During the first phase, new type definitions are examined in order to determine the propagation dependencies between the arguments of each new type constructor. To explain the idea, we return to our previous example.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;&nbsp;T&nbsp;m&nbsp;a&nbsp;=&nbsp;C&nbsp;(m&nbsp;a)<br></p>
</p>
<p style="text-align:justify;">First observe that the propagation of the type variable <span style="font-family:courier;">m</span> is not interesting because <span style="font-family:courier;">m</span> does not stand for 'real data' (which is always of kind <span style="font-family:courier;">*</span>). We associate the propagation of <span style="font-family:courier;">m</span> in <span style="font-family:courier;">T</span> with the position(s) of the occurrence(s) of <span style="font-family:courier;">m</span>'s applications. So in general, <span style="font-family:courier;">T</span> is propagating in a higher-order variable <span style="font-family:courier;">m</span> if one of <span style="font-family:courier;">m</span>'s applications appears on a propagating position in the definition of T. Moreover, for each higher order type variable, we determine the propagation properties of all first order type variables in the following way: <span style="font-family:courier;">m</span> is propagating in <span style="font-family:courier;">a</span>, where <span style="font-family:courier;">m</span> and <span style="font-family:courier;">a</span> are higher-order respectively first-order type variables of <span style="font-family:courier;">T</span>, if <span style="font-family:courier;">a</span> appears on a propagating position in one of <span style="font-family:courier;">m</span>'s applications. In the above example, <span style="font-family:courier;">m</span> is propagating in <span style="font-family:courier;">a</span>, since <span style="font-family:courier;">a</span> is on a propagating position in the application <span style="font-family:courier;">(m</span> <span style="font-family:courier;">a)</span>. During the second phase, the propagation properties of (partial) types are determined using the results of the first phase. This (roughly) proceeds as follows. Consider the type <span style="font-family:courier;">T</span> &sigma; for some (partial) type &sigma;, and <span style="font-family:courier;">T</span> as defined earlier. First, determine (recursively) the propagation of &sigma;. Then the type <span style="font-family:courier;">T</span> &sigma; is propagating if (1) &sigma; is propagating, (2) <span style="font-family:courier;">T</span> is propagating in <span style="font-family:courier;">m</span>, and moreover (3) <span style="font-family:courier;">m</span> is propagating in <span style="font-family:courier;">a</span> (the second argument of the type constructor). With <span style="font-family:courier;">T</span> as defined above, (2) and (3) are fulfilled. Thus, for example <span style="font-family:courier;">T</span> <span style="font-family:courier;">[]</span> is propagating and therefore also <span style="font-family:courier;">T</span> <span style="font-family:courier;">(T</span> <span style="font-family:courier;">[])</span>. Now define</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;&nbsp;T2&nbsp;a&nbsp;=&nbsp;C2&nbsp;(a&nbsp;-&gt;&nbsp;Int)<br></p>
</p>
<p style="text-align:justify;">Then <span style="font-family:courier;">T</span> <span style="font-family:courier;">T2</span> is not propagating.</p>
<p style="text-align:justify;">The adjusted uniqueness propagation rule (see also...) becomes:</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Let &sigma;,&tau; be two uniqueness types. Suppose &sigma; has attribute <span style="font-family:courier;">u</span>. Then, if &tau; is propagating the application (&tau; &sigma;) should have an attribute <span style="font-family:courier;">v</span> such that <span style="font-family:courier;">v</span> &le; <span style="font-family:courier;">u</span>.</td></tr></table>
<p style="text-align:justify;">Some of the readers might have inferred that this propagation rule is a 'higher-order' generalization of the old 'first-order' propagation rule.</p>
<p style="text-align:justify;">As to the sign classification, we restrict ourselves to the remark that that sign analysis used in CLEAN is adjusted in a similar way as described above for the propagation case.</p>
<p style="text-align:justify;">Example</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;&nbsp;T&nbsp;m&nbsp;a&nbsp;=&nbsp;C&nbsp;((m&nbsp;a)&nbsp;-&gt;&nbsp;Int)<br></p>
</p>
<p style="text-align:justify;">The sign classification of <span style="font-family:courier;">T</span> if (-,<span style="font-family:courier;">&#x27c2;</span>). Here <span style="font-family:courier;">&#x27c2;</span> denotes the fact the <span style="font-family:courier;">a</span> is neither directly used on a positive nor on a negative position. The sign classification of m w.r.t. <span style="font-family:courier;">a</span> is +. The partial type <span style="font-family:courier;">T</span> <span style="font-family:courier;">[]</span> has sign -, which e.g. implies that</p>
<p style="text-align:justify;"><span style="font-family:courier;">T [] Int &le; T [] *Int</span></p>
<p style="text-align:justify;">The type <span style="font-family:courier;">T T2</span> (with <span style="font-family:courier;">T2</span> as defined on the previous page) has sign +, so</p>
<p style="text-align:justify;"><span style="font-family:courier;">T T2 Int &ge; T T2 *Int</span></p>
<p style="text-align:justify;">It will be clear that combining uniqueness typing with higher-order types is far from trivial: the description given above is complex and moreover incomplete. However explaining all the details of this combination is far beyond the scope of the reference manual.</p>
<h2 style="background-color:#9999FF;"><a id="_9.7">9.7 Destructive Updates using Uniqueness Typing</a></h2>
<p style="text-align:justify;">So, it is <i>allowed</i> to update a uniquely typed function argument (<span style="font-family:courier;">*</span>) destructively when the argument does not reappear in the function result. The question is: when does the compiler indeed make use of this possibility.</p>
<p style="text-align:justify;">Destructive updates takes place in some predefined functions and operators which work on predefined data structures such arrays (&amp;-operator) and files (writing to a file). Arrays and files are intended to be updated destructively and their use can have a big influence on the space and time behavior of your application (a new node does not have to be claimed and filled, the garbage collector is invoked less often and the locality of memory references is increased).</p>
<p style="text-align:justify;">Performing destructive updates is only sensible when information is stored in nodes. Arguments of basic type (<span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Real</span>, <span style="font-family:courier;">Char</span> or <span style="font-family:courier;">Bool</span>) are stored on the B-stack or in registers and it therefore does not make sense to make them unique.</p>
<p style="text-align:justify;">The CLEAN compiler also has an option to re-use user-defined unique data structures: the space being occupied by a function argument of unique type will under certain conditions be reused destructively to construct the function result when (part of) this result is of the same type. So, a more space and time efficient program can be obtained by turning heavily used data structures into unique data structures. This is not just a matter of changing the uniqueness type attributes (like turning a lazy data structure into a strict one). A unique data structure also has to be used in a 'single threaded' way (see Chapter 4). This means that one might have to restructure parts of the program to maintain the unicity of objects.</p>
<p style="text-align:justify;">The compiler will do compile-time garbage collection for user defined unique data-structures only in certain cases. In that case run-time garbage collection time is reduced. It might even drop to zero. It is also possible that you gain even more than just garbage collection time due to better cache behavior.</p>
<!-- chapter:Chapter 10-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_10"><br>Chapter 10<br><br>Strictness, Macros and Efficiency</a></h1></div>
<p style="text-align:justify;">Programming in a functional language means that one should focus on algorithms and without worrying about all kinds of efficiency details. However, when large applications are being written it may happen that this attitude results in a program that is unacceptably inefficient in time and/or space.</p>
<p style="text-align:justify;">In this Chapter we explain several kinds of annotations and directives that can be defined in CLEAN. These annotations and directives are designed to give the programmer some means to influence the time and space behavior of CLEAN applications.</p>
<p style="text-align:justify;">CLEAN is by default a <i>lazy</i> language: applications will only be evaluated when their results are needed for the final outcome of the program. However, lazy evaluation is in general not very efficient. It is much more efficient to compute function arguments in advance (<i>strict</i> evaluation) when it is known that the arguments will be used in the function body. By using strictness annotations in type definitions the evaluation order of data structures and functions can be changed from lazy to strict. This is explained in <span style="color:blue;"><a href="#_10.1">Section 10.1</a></span>.</p>
<p style="text-align:justify;">One can define constant graphs on the global level also known as <span style="font-family:courier;">Constant Applicative Forms</span> (<span style="color:blue;"><a href="#_10.2">see Section 10.2</a></span>). Unlike constant functions, these constant graphs are shared such that they are computed only one. This generally reduces execution time possibly at the cost of some heap space needed to remember the shared graph constants.</p>
<p style="text-align:justify;">Macro's (<span style="color:blue;"><a href="#_10.3">Section 10.3</a></span>) are special functions that will already be substituted (evaluated) at <i>compile-time</i>. This generally reduces execution time (the work has already been done by the compiler) but it will lead to an increase of object code.</p>
<h2 style="background-color:#9999FF;"><a id="_10.1">10.1 Annotations to Change Lazy Evaluation into Strict Evaluation</a></h2>
<p style="text-align:justify;">CLEAN uses by default a <i>lazy evaluation strategy</i>: a redex is only evaluated when it is needed to compute the final result. Some functional languages (e.g. ML, Harper <i>et al.</i>) use an <i>eager</i>  (<i>strict</i>) evaluation strategy and always evaluate all function arguments in advance.</p>
<h3 style="background-color:#9999FF;"><a id="_10.1.1">10.1.1 Advantages and Disadvantages of Lazy versus Strict Evaluation</a></h3>
<p style="text-align:justify;">Lazy evaluation has the following advantages (+) / disadvantages (-) over eager (strict) evaluation:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">only those computations which contribute to the final result are computed (for some algorithms this is a clear advantage while it generally gives a greater expressive freedom);</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">one can work with infinite data structures (e.g. [1..])</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">it is unknown when a lazy expression will be computed (disadvantage for debugging, for controlling evaluation order);</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">strict evaluation is in general much more efficient, in particular for objects of basic types, non-recursive types and tuples and records which are composed of such types;</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">+/-</td><td style="text-align:justify;">in general a strict expression (e.g. <span style="font-family:courier;">2</span> <span style="font-family:courier;">+</span> <span style="font-family:courier;">3</span> <span style="font-family:courier;">+</span> <span style="font-family:courier;">4</span>) takes less space than a lazy one, however, sometimes the other way around (e.g. <span style="font-family:courier;">[1..1000]</span>);</td></tr></table>
<h3 style="background-color:#9999FF;"><a id="_10.1.2">10.1.2 Strict and Lazy Context</a></h3>
<p style="text-align:justify;">Each expression in a function definition is considered to be either strict (appearing in a <i>strict context</i>: it has to be evaluated to strong root normal form) or lazy (appearing in a <i>lazy context</i> : not yet to be evaluated to strong root normal form)  The following rules specify whether or not a particular expression is lazy or strict:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">a non-variable pattern is strict;</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">an expression in a guard is strict;</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the expressions specified in a strict let-before expression are strict;</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the <b>root expression</b> is strict;</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">the arguments of a function or data constructor in a strict context are strict when these arguments are being annotated as strict in the type definition of that function (manually or automatically) or in the type definition of the data constructor;</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">all the other expressions are lazy.</td></tr></table>
<p style="text-align:justify;">Evaluation of a function will happen in the following order: patterns, guard, expressions in a strict let before expression, root expression (<span style="color:blue;"><a href="#_3.1">see also 3.1</a></span>).</p>
<h3 style="background-color:#9999FF;"><a id="_10.1.3">10.1.3 Space Consumption in Strict and Lazy Context</a></h3>
<p style="text-align:justify;">The space occupied by CLEAN structures depend on the kind of structures one is using, but also depends on whether these data structures appear in a strict or in a lazy context. To understand this one has to have some knowledge about the basic implementation of CLEAN (see Plasmeijer and Van Eekelen, 1993).</p>
<p style="text-align:justify;">Graphs (<span style="color:blue;"><a href="#_1">see Chapter 1</a></span>) are stored in a piece of memory called the heap. The amount of heap space needed highly depends on the kind of data structures that are in use. Graph structures that are created in a lazy context can occupy more space than graphs created in a strict context. The garbage collector in the run-time system of CLEAN automatically collects graphs that are not being used. The arguments of functions being evaluated are stored on a stack. There are two stacks: the A-stack, which contains references to graph nodes stored in the heap and the BC-stack which contains arguments of basic type and return addresses. Data structures in a <i>lazy context</i> are passed via references on the A-stack. Data structures of the <i>basic types</i> (<span style="font-family:courier;">Int</span>, <span style="font-family:courier;">Real</span>, <span style="font-family:courier;">Char</span> or <span style="font-family:courier;">Bool</span>) in a <i>strict context</i> are stored on the B-stack or in registers. This is also the case for these strict basic types when they are part of a <i>record</i> or <i>tuple</i> in a strict context.</p>
<p style="text-align:justify;">Data structures living on the B-stack are passed <i>unboxed</i>. They consume less space (because they are not part of a node) and can be treated much more efficiently. When a function is called in a lazy context its data structures are passed in a graph node (<i>boxed</i>). The amount of space occupied is also depending on the arity of the function.</p>
<p style="text-align:justify;">In the table below the amount of space consumed in the different situations is summarised (for the lazy as well as for the strict context). For the size of the elements one can take the size consumed in a strict context.</p>
<p></p><table style="border-collapse:collapse;width:100%;background-color:#FFFF99;"><tr style="border-bottom:1px solid #969696"><td style="width:21.8181818181818%;"><i>Type</i></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><i>Arity</i></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><i>Lazy context (bytes)</i></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><i>Strict context (bytes)</i></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"><i>Comment</i></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Int,Bool</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">8</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Int (0&le;n&le;32), Char  </span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;">node is shared</td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Real</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">8</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Small Record</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4 + &Sigma; size elements</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">&Sigma; size elements</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;">total length&le;12</td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Large Record</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">8 + &Sigma; size elements</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">&Sigma; size elements</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Tuple</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">2</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">&Sigma; size elements</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">&gt;2</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">8  + 4*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">&Sigma; size elements</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">{a}</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">20 + 4*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12 + 4*n</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;"> !Int</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">20 + 4*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12 + 4*n</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;"> !Bool,!Char</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">20 + 4*ceil(n/4)</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12 + 4*ceil(n/4)</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;"> !Real</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">20 + 8*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12 + 8*n</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;"> !Tuple, !Record</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">20 + size rec/tup*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12 + size rec/tup*n</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Hnf</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">0</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4 + size node</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;">node is shared </td></tr>
<tr><td style="width:21.8181818181818%;"></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">1</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">8</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4 + size node</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">2</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4 + size node</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;">also for <span style="font-family:courier;">[a]</span></td></tr>
<tr><td style="width:21.8181818181818%;"></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">&gt;2</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">8  + 4*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4 + size node</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Pointer to node</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"><span style="font-family:courier;">Function</span></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">0,1,2</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">12</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
<tr><td style="width:21.8181818181818%;"></td><td style="border-left:1px solid #969696;width:5.45454545454545%;"><span style="font-family:courier;">&gt;2</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">4  + 4*n</span></td><td style="border-left:1px solid #969696;width:20.7272727272727%;"><span style="font-family:courier;">-</span></td><td style="border-left:1px solid #969696;width:12.4309090909091%;"></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_10.1.4">10.1.4 Time Consumption in Strict and Lazy Context</a></h3>
<p style="text-align:justify;">Strict arguments of functions can sometimes be handled much more efficiently than lazy arguments, in particular when the arguments are of basic type.</p>
<p><div style="background-color:#FFFF45";>Example: functions with strict arguments of basic type are more efficient.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Ackerman::&nbsp;!Int&nbsp;!Int&nbsp;-&gt;&nbsp;Int<br>
Ackerman&nbsp;0&nbsp;j&nbsp;=&nbsp;j+1<br>
Ackerman&nbsp;i&nbsp;0&nbsp;=&nbsp;Ackerman&nbsp;(i-1)&nbsp;1<br>
Ackerman&nbsp;i&nbsp;j&nbsp;=&nbsp;Ackerman&nbsp;(i-1)&nbsp;(Ackerman&nbsp;i&nbsp;(j-1))<br>
<br></div>
<div style="background-color:#FFFF45";>The computation of a lazy version of <span style="font-family:courier;">Ackerman 3 7</span> takes 14.8 seconds + 0.1 seconds for garbage collection on an old fashion MacII (5Mb heap). When both arguments are annotated as strict (which in this case will be done automatically by the compiler) the computation will only take 1.5 seconds + 0.0 seconds garbage collection. The gain is one order of magnitude. Instead of rewriting graphs the calculation is performed using stacks and registers where possible. The speed is comparable with a recursive call in highly optimised C or with the speed obtainable when the function was programmed directly in assembly.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"></div>
</p><h3 style="background-color:#9999FF;"><a id="_10.1.5">10.1.5 Changing Lazy into Strict Evaluation</a></h3>
<p style="text-align:justify;">So, lazy evaluation gives a notational freedom (no worrying about what is computed when) but it might cost space as well as time. In CLEAN the default lazy evaluation can therefore be turned into eager evaluation by adding strictness annotations to types.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Strict</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">This can be done in several ways:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">The CLEAN compiler has a built-in strictness analyzer based on <i>abstract reduction</i> Nöcker, 1993) (it can be optionally turned off). The analyzer searches for strict arguments of a function and annotate them internally as strict (<span style="color:blue;"><a href="#_10.1.1">see 10.1.1</a></span>). In this way lazy arguments are <i>automatically</i> turned into strict ones. This optimization does not influence the termination behavior of the program. It appears that the analyzer can find much information. The analysis itself is quite fast.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">The strictness analyzer cannot find all strict arguments. Therefore one can also <i>manually</i> annotate a function as being strict in a certain argument or in its result (<span style="color:blue;"><a href="#_10.1.1">see 10.1.1</a></span>).</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">By using strictness annotations, a programmer can define (partially) strict data structures Nöcker and Smetsers, 1993; <span style="color:blue;"><a href="#_10.1.3">see 10.1.3</a></span>). Whenever such a data structure occurs in a strict context (<span style="color:blue;"><a href="#_10.1.1">see 10.1.1</a></span>), its strict components will be evaluated.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;"> The order of evaluation of expressions in a function body can also be changed from lazy to strict by using a strict let-before expression <span style="color:blue;"><a href="#_3.5.4">see 3.5.4</a></span>).</td></tr></table>
<p style="text-align:justify;"><i>One has to be careful though. When a programmer manually changes lazy evaluation into strict evaluation, the termination behavior of the program might change. It is only safe to put strictness annotations in the case that the function or data constructor is known to be strict in the corresponding argument which means that the evaluation of that argument in advance does not change the termination behavior of the program. The compiler is not able to check this.</i></p>
<h2 style="background-color:#9999FF;"><a id="_10.2">10.2 Defining Graphs on the Global Level</a></h2>
<p style="text-align:justify;">Constant graphs can also be defined on a global level (for local constant graphs see <span style="color:blue;"><a href="#_3.6">3.6</a></span>).</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Selector <span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>:</b></span>] GraphExpr <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">A <i>global graph definition</i> defines a global constant (closed) graph, i.e. a graph which has the same scope as a global function definition (<span style="color:blue;"><a href="#_2.1">see 2.1</a></span>). The selector variables that occur in the selectors of a global graph definition have a global scope just as globally defined functions.</p>
<p style="text-align:justify;">Special about <i>global</i> graphs (in contrast with <i>local</i> graphs) is that they are <i>not</i> garbage collected during the evaluation of the program  A global graph can be compared with a <i>CAF</i> (<i>Constant Applicative Form</i>): its value is computed at most once and remembered at run-time. A global graph can save execution-time at the cost of permanent space consumption.</p>
<p style="text-align:justify;">Syntactically the definition of a graph is distinguished from the definition of a function by the symbol which separates the left-hand side from the right-hand side: "<span style="font-family:courier;">=</span>" or "<span style="font-family:courier;">=&gt;</span>" is used for functions, while "<span style="font-family:courier;">=</span>" is used for local graphs and "<span style="font-family:courier;">=:</span>" for global graphs. However, in general "<span style="font-family:courier;">=</span>" is used both for functions and local graphs. Generally it is clear from the context which is meant (functions have parameters, selectors are also easy recognisible). However, when a simple constant is defined the syntax is ambiguous (it can be a constant function definition as well as a constant graph definition).</p>
<p style="text-align:justify;">To allow the use of the "<span style="font-family:courier;">=</span>" whenever possible, the following rule is followed. Locally constant definitions are <i>by default</i> taken to be <i>graph</i> definitions and therefore shared, globally they are <i>by default</i> taken to be <i>function</i> definitions (<span style="color:blue;"><a href="#_3.1">see 3.1</a></span>) and therefore recomputed. If one wants to obtain a different behavior one has to explicit state the nature of the constant definition (has it to be shared or has it to be recomputed) by using "<span style="font-family:courier;">=:</span>" (on the global level, meaning it is a constant graph which is shared) or "<span style="font-family:courier;">=&gt;</span>" (on the local level, meaning it is a constant function and has to be recomputed).</p>
<p><div style="background-color:#FFFF45";> Global constant graph versus global constant function definition: <span style="font-family:courier;">biglist1</span> is a <i>graph</i> which is computed only once, <span style="font-family:courier;">biglist3</span> and <span style="font-family:courier;">biglist2</span> is a constant <i>function</i> which is computed every time it is applied.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
biglist1&nbsp;=&nbsp;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;constant&nbsp;function&nbsp;(if&nbsp;defined&nbsp;globally)</span><br>
biglist2&nbsp;=:&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;graph&nbsp;(if&nbsp;defined&nbsp;globally)</span><br>
biglist3&nbsp;=&gt;&nbsp;&nbsp;[1..10000]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;a&nbsp;constant&nbsp;function</span><br></div>
</p><p style="text-align:justify;">A graph saves execution-time at the cost of space consumption. A constant function saves space at the cost of execution time. So, use graphs when the computation is time-consuming while the space consumption is small and constant functions in the other case.</p>
<h2 style="background-color:#9999FF;"><a id="_10.3">10.3 Defining Macros</a></h2>
<p style="text-align:justify;">Macros are functions (rewrite rules) which are applied at <i>compile-time</i> instead of at <i>run-time</i>. Macro's can be used to define constants, create in-line substitutions, rename functions, do conditional compilation etc. With a macro definition one can, for instance, assign a name to a constant such that it can be used as pattern on the left-hand side of a function definition.</p>
<p style="text-align:justify;">At compile-time the right-hand side of the <i>macro definition</i> will be substituted for every application of the macro in the scope of the macro definition. This saves a function call and makes basic blocks larger (see Plasmeijer and Van Eekelen, 1993) such that <i>better</i> code can be generated. A disadvantage is that also <i>more</i> code will be generated. Inline substitution is also one of the regular optimisations performed by the CLEAN compiler. To avoid code explosion a compiler will generally not substitute big functions. Macros give the programmer a possibility to control the substitution process manually to get an optimal trade-off between the efficiency of code and the size of the code.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">MacroDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[MacroFixityDef]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">DefOfMacro</td></tr>
<tr><td style="width:23.0290909090909%;">MacroFixityDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span> [Fix][Prec] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">DefOfMacro</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Function {Variable} <span style="font-family:courier;color:#993300;"><b>:==</b></span> FunctionBody <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[LocalFunctionAltDefs]</td></tr>
</table><p></p>
<p style="text-align:justify;">The compile-time substitution process is guaranteed to terminate. To ensure this some restrictions are imposed on Macro's (compared to common functions). Only variables are allowed as formal argument. A macro rule always consists of a single alternative. Furthermore,</p>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;">8)</td><td style="text-align:justify;">Macro definitions are not allowed to be cyclic to ensure that the substitution process terminates.</td></tr></table>
<p><div style="background-color:#FFFF45";>Example of a macro definition.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
Black&nbsp;&nbsp;&nbsp;&nbsp;:==&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Macro&nbsp;definition</span><br>
White&nbsp;&nbsp;&nbsp;&nbsp;:==&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Macro&nbsp;definition</span><br>
<br>
::&nbsp;Color&nbsp;:==&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Type&nbsp;synonym&nbsp;definition</span><br>
<br>
Invert::&nbsp;Color&nbsp;-&gt;&nbsp;Color&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Function&nbsp;definition</span><br>
Invert&nbsp;Black&nbsp;=&nbsp;White<br>
Invert&nbsp;White&nbsp;=&nbsp;Black<br></div>
</p><p><div style="background-color:#FFFF45";>Example: macro to write (a?b) for lists instead of [a:b] and its use in the function map.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
(?)&nbsp;<span style="font-family:courier;color:#FF0000;"><b>infixr</b></span>&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Fixity&nbsp;of&nbsp;Macro</span><br>
(?)&nbsp;h&nbsp;t&nbsp;:==&nbsp;[h:t]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Macro&nbsp;definition&nbsp;of&nbsp;operator</span><br>
<br>
map::&nbsp;(a&nbsp;-&gt;&nbsp;b)&nbsp;[a]&nbsp;-&gt;&nbsp;[b]<br>
map&nbsp;f&nbsp;(x?xs)&nbsp;=&nbsp;f&nbsp;x&nbsp;?&nbsp;map&nbsp;f&nbsp;xs<br>
map&nbsp;f&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[]<br></div>
</p><p style="text-align:justify;">Notice that macros can contain local function definitions. These local definitions (which can be recursive) will also be substituted inline. In this way complicated substitutions can be achieved resulting in efficient code.</p>
<p><div style="background-color:#FFFF45";>Example: macros can be used to speed up frequently used functions. See for instance the definition of the function <span style="font-family:courier;">foldl</span> in <span style="font-family:courier;">StdList</span>.</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
foldl&nbsp;op&nbsp;r&nbsp;l&nbsp;:==&nbsp;foldl&nbsp;r&nbsp;l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">//&nbsp;Macro&nbsp;definition</span><br>
<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;foldl&nbsp;r&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;foldl&nbsp;r&nbsp;[a:x]&nbsp;=&nbsp;foldl&nbsp;(op&nbsp;r&nbsp;a)&nbsp;x<br>
<br>
sum&nbsp;list&nbsp;=&nbsp;foldl&nbsp;(+)&nbsp;0&nbsp;list<br>
<br></div>
<div style="background-color:#FFFF45";>After substitution of the macro <span style="font-family:courier;">foldl</span> a very efficient function <span style="font-family:courier;">sum</span> will be generated by the compiler:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
sum&nbsp;list&nbsp;=&nbsp;foldl&nbsp;0&nbsp;list<br>
where<br>
&nbsp;&nbsp;&nbsp;&nbsp;foldl&nbsp;r&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r<br>
&nbsp;&nbsp;&nbsp;&nbsp;foldl&nbsp;r&nbsp;[a:x]&nbsp;=&nbsp;foldl&nbsp;((+)&nbsp;r&nbsp;a)&nbsp;x<br></div>
</p><p style="text-align:justify;">The expansion of the macros takes place before type checking. Type specifications of macro rules are not possible. When operators are defined as macros, fixity and associativity can be defined.</p>
<h2 style="background-color:#9999FF;"><a id="_10.4">10.4 Efficiency Tips</a></h2>
<p style="text-align:justify;">Here are some additional suggestions how to make your program more efficient:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Use the CLEAN profiler to find out which frequently called functions are consuming a lot of space and/or time. If you modify your program, these functions are the ones to have a good look at.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Transform a recursive function to a tail-recursive function.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">It is better to accumulate results in parameters instead of in the right-hand side results.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">It is better to use records instead of tuples.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Arrays can be more efficient than lists since they allow constant access time on their elements and can be destructive updated.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">When functions return multiple ad-hoc results in a tuple put these results in a strict tuple instead (can be indicated in the type).</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Use strict data structures whenever possible.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Export the strictness information to other modules (the compiler will warn you if you don't).</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Make function strict in its arguments whenever possible.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Use macros for simple constant expressions or frequently used functions.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Use CAF's and local graphs to avoid recalculation of expressions.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Selections in a lazy context can better be transformed to functions which do a pattern match.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Higher order functions are nice but inefficient (the compiler will try to convert higher order function into first order functions).</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Constructors of high arity are inefficient.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Increase the heap space in the case that the garbage collector takes place too often.</td></tr></table>
<!-- chapter:Chapter 11-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_11"><br>Chapter 11<br><br>Foreign Language Interface</a></h1></div>
<p style="text-align:justify;">The tool htoclean can be used to generate interfaces to C functions. This is not discussed in this manual.</p>
<p style="text-align:justify;">How to call Clean functions from C is discussed in <span style="color:blue;"><a href="#_11.1">section 11.1</a></span>.</p>
<p style="text-align:justify;">ABC instructions of the virtual machine for Clean can be used. This is explained in <span style="color:blue;"><a href="#_11.2">section 11.2</a></span>.</p>
<h2 style="background-color:#9999FF;"><a id="_11.1">11.1 Foreign Export</a></h2>
<p style="text-align:justify;">Some Clean functions can be called from C using foreign export. This is possible if:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">The function is exported.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">All arguments are annotated as being strict (<span style="color:blue;"><a href="#_3.7.5">see 3.7.5</a></span>).</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">The arguments and result type is either of the following:</td></tr></table>
<table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Int</td></tr>
<tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Real</td></tr>
<tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">{#Char}</td></tr>
<tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">{#Int}</td></tr>
<tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">{#Real}</td></tr>
<tr><td style="vertical-align:top;width:30px;"></td><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">A tuple of these strictly annotated types (including tuples).</td></tr>
</table><p style="text-align:justify;">The following syntax is used in an implementation module to export a function to a foreign language:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ForeignExportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>foreign export</b></span> [ <span style="font-family:courier;color:#FF0000;"><b>ccall</b></span> | <span style="font-family:courier;color:#FF0000;"><b>stdcall</b></span> ] <span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">The calling convention may be specified by prefixing the function name with ccall or stdcall. The default is ccall.</p>
<p style="text-align:justify;">To pass an argument from C of type:</p>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Int, use a C integer type that has the same size as an Int in Clean. On 32 bit platforms this is 4 bytes, on 64 bit platforms 8 bytes. Usually long has the right size, except on 64 bit Windows __int64 can be used instead.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Real, use type double.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">{#Char}, pass the address of the string. The first 4 (on 32 bit platforms) or 8 (on 64 bit platforms) bytes should contain the number of characters. The characters of the string are stored in the following bytes. The string is copied to the heap of Clean, and this copy is used in Clean.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">{#Int}, pass the address of the array. The elements of the array have the same size as an Int in Clean. The number of elements should be stored in 4 bytes at offset -8 (32 bit) or 8 bytes at offset -16 (64 bit). The array is copied to the heap of Clean, and this copy is used in Clean.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">{#Real}, pass the address of the array. The elements of the array have the same size as a Real in Clean (8 bytes) and a double in C. The number of elements should be stored in the same way as for {#Int}. The array is copied to the heap of Clean, and this copy is used in Clean.</td></tr><tr><td style="vertical-align:top;width:30px;">&bull;</td><td style="text-align:justify;">Tuple. The elements are passed as separate arguments as described above, in the same order as in the tuple.</td></tr></table>
<p style="text-align:justify;">Preferably, the macros in the file Clean.h (part of the tool htoclean) should be used to access strings and arrays.</p>
<p style="text-align:justify;">If result of the function is not a tuple, the result is passed in the same way as an argument, except that strings and arrays are not copied. The address of the string or array in the heap of Clean is passed to C. This string or array may only be used until the next call or return to Clean, because the Clean runtime system may deallocate or move the array.</p>
<p style="text-align:justify;">If multiple values are yielded, because the result is a tuple, the result type in C is void. To return the values, for each value an additional argument with the address where the result should be stored is added (at the end, in the same order as in the tuple). For example, if the result has type (Real, Int), an additional double * and long * (__int64 * for 64 bit Windows) is added.</p>
<h2 style="background-color:#9999FF;"><a id="_11.2">11.2 Using ABC instructions</a></h2>
<p style="text-align:justify;">Function can be implemented using ABC instructions from the virtual machine used by Clean:</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ABCCodeFunctionDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Function {Pattern} <span style="font-family:courier;color:#993300;"><b>=</b></span> <span style="font-family:courier;color:#FF0000;"><b>code</b></span> [<span style="font-family:courier;color:#FF0000;"><b>inline</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> ABCInstructions <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<p style="text-align:justify;">By adding <span style="font-family:courier;color:#FF0000;"><b>inline</b></span> the ABC instructions will be inlined if the function is called in a strict context.</p>
<p style="text-align:justify;">This is used to define primitive functions of the StdEnv, for example integer addition. htoclean generates calls to C functions using the ABC instruction ccall.</p>
<!-- chapter:Appendix A-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_A"><br>Appendix A<br><br>Context-Free Syntax Description</a></h1></div>
<p style="text-align:justify;">In this appendix the context-free syntax of CLEAN is given. Notice that the layout rule (<span style="color:blue;"><a href="#_2.3.3">see 2.3.3</a></span>) permits the omission of the semi-colon (';') which ends a definition and of the braces ('{' and '}') which are used to group a list of definitions.</p>
<p style="text-align:justify;">The following notational conventions are used in the context-free syntax descriptions:</p>
<p></p><table style="width:100%;"><tr><td style="width:9.81818181818182%;">[notion]</td><td style="width:64.0018181818182%;">means that the presence of notion is optional</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}</td><td style="width:64.0018181818182%;">means that notion can occur zero or more times</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}+</td><td style="width:64.0018181818182%;">means that notion occurs at least once</td></tr>
<tr><td style="width:9.81818181818182%;">{notion}-<i>list</i></td><td style="width:64.0018181818182%;">means one or more occurrences of notion separated by commas</td></tr>
<tr><td style="width:9.81818181818182%;"><span style="font-family:courier;color:#993300;"><b>terminals</b></span></td><td style="width:64.0018181818182%;">are printed in <span style="font-family:courier;color:#993300;"><b>9 pts courier bold brown</b></span></td></tr>
<tr><td style="width:9.81818181818182%;"><span style="font-family:courier;color:#FF0000;"><b>keywords</b></span></td><td style="width:64.0018181818182%;">are printed in <span style="font-family:courier;color:#FF0000;"><b>9 pts courier bold red</b></span></td></tr>
<tr><td style="width:9.81818181818182%;"><span style="font-family:courier;color:#0000FF;"><b>terminals</b></span></td><td style="width:64.0018181818182%;">that can be left out in layout mode are printed in <span style="font-family:courier;color:#0000FF;"><b>9 pts courier bold blue</b></span></td></tr>
<tr><td style="width:9.81818181818182%;">{notion}/ str</td><td style="width:64.0018181818182%;">means the longest expression not containing the string str</td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.1">A.1 Clean Program</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CleanProgram</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{Module}+</td></tr>
<tr><td style="width:23.0290909090909%;">Module</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">DefinitionModule</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ImplementationModule</td></tr>
<tr><td style="width:23.0290909090909%;">DefinitionModule</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>definition module</b></span> <span style="font-family:courier;">ModuleName</span> ;</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{DefDefinition}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>system module</b></span> <span style="font-family:courier;">ModuleName</span> ;</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{DefDefinition}</td></tr>
<tr><td style="width:23.0290909090909%;">ImplementationModule</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#FF0000;"><b>implementation</b></span>] <span style="font-family:courier;color:#FF0000;"><b>module</b></span> <span style="font-family:courier;">ModuleName</span> ;</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{ImplDefinition}</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ImplDefinition</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">ImportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.2">see A.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">FunctionDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.3">see A.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">GraphDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.3">see A.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">MacroDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.4">see A.4</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.5">see A.5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ClassDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.6">see A.6</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">GenericsDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.7">see A.7</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ForeignExportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.7">see A.7</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DefDefinition</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">ImportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.2">see A.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">FunctionExportTypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.3">see A.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">MacroDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.4">see A.4</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">TypeDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.5">see A.5</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ClassDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.6">see A.6</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">GenericExportDef</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.6">see A.6</a></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.2">A.2 Import Definition</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ImportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">ImplicitImportDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ExplicitImportDef</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ImplicitImportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>import</b></span> [<span style="font-family:courier;color:#993300;"><b>qualified</b></span>] {<span style="font-family:courier;">ModuleName</span>}-list <span style="font-family:courier;color:#0000FF;">;</span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ExplicitImportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>from</b></span><span style="font-family:courier;"> ModuleName </span><span style="font-family:courier;color:#FF0000;"><b>import</b></span> [<span style="font-family:courier;color:#993300;"><b>qualified</b></span>] {Imports}-list <span style="font-family:courier;color:#0000FF;">;</span></td></tr>
<tr><td style="width:23.0290909090909%;">Imports</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span><span style="font-family:courier;">TypeName</span> [ConstructorsOrFields]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> <span style="font-family:courier;">ClassName</span> [Members]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span> <span style="font-family:courier;">ClassName</span> {SimpleType}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>generic</b></span> <span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorsOrFields</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(..)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>{<span style="font-family:courier;">ConstructorName</span>}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{..}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>{<span style="font-family:courier;">FieldName</span>}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Members</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(..)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>{<span style="font-family:courier;">MemberName</span>}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.3">A.3 Function Definition</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[FunctionTypeDef]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">DefOfFunction</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DefOfFunction</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{FunctionAltDef <span style="color:#0000FF;">;</span>}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ABCCodeFunctionDef</td></tr>
<tr><td style="width:23.0290909090909%;">FunctionAltDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Function {Pattern}</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{GuardAlt} {LetBeforeExpression} FunctionResult</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[LocalFunctionAltDefs]</td></tr>
<tr><td style="width:23.0290909090909%;">FunctionResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard GuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">GuardAlt</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr GuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">GuardRhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{GuardAlt} {LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">{GuardAlt} {LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> GuardRhs</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Function</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LetBeforeExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b># </b></span>{GraphDefOrUpdate}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>#!</b></span>{GraphDefOrUpdate}+</td></tr>
<tr><td style="width:23.0290909090909%;">GraphDefOrUpdate</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span> <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {<span style="font-family:courier;">FieldName</span> {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span> <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {ArrayIndex {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Selector <span style="font-family:courier;color:#993300;"><b>=</b></span>[<span style="font-family:courier;color:#993300;"><b>:</b></span>] GraphExpr <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Selector</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BrackPattern</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Guard</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BooleanExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">BooleanExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionBody</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">RootExpression <span style="color:#0000FF;">;</span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[LocalFunctionDefs]</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RootExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LocalFunctionAltDefs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">LocalDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">FunctionDef</td></tr>
<tr><td style="width:23.0290909090909%;">LocalFunctionDefs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;color:#FF0000;"><b>with</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ABCCodeFunctionDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Function {Pattern} <span style="font-family:courier;color:#993300;"><b>=</b></span> <span style="font-family:courier;color:#FF0000;"><b>code</b></span> [<span style="font-family:courier;color:#FF0000;"><b>inline</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> ABCInstructions <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_A.3.1">A.3.1 Types of Functions</a></h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span> [Fix][Prec] [<span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">FunctionType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[{ArgType}+ <span style="font-family:courier;color:#993300;"><b>-&gt;</b></span>] Type [ClassContext] [UnqTypeUnEqualities]</td></tr>
<tr><td style="width:23.0290909090909%;">ClassContext</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> ClassOrGenericName-list {SimpleType}+ {<span style="font-family:courier;color:#993300;"><b>&amp;</b></span> <span style="font-family:courier;">ClassName</span>-list {SimpleType}+ }</td></tr>
<tr><td style="width:23.0290909090909%;">UnqTypeUnEqualities</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{{<span style="font-family:courier;">UniqueTypeVariable</span>}+ <span style="font-family:courier;color:#993300;"><b>&lt;=</b></span> <span style="font-family:courier;">UniqueTypeVariable</span>}-list</td></tr>
<tr><td style="width:23.0290909090909%;">ClassOrGenericName</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">ClassName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> TypeKind</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">FunctionExportTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType [Special] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span> [Fix][Prec] <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType [Special] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_A.3.2">A.3.2 Patterns</a></h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Pattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[<span style="font-family:courier;">Variable</span> <span style="font-family:courier;color:#993300;"><b>=:</b></span>] BrackPattern</td></tr>
<tr><td style="width:23.0290909090909%;">BrackPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">PatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphPattern<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">SpecialPattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">DynamicPattern</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PatternVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>_</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Constructor</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">ConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">ConstructorName</span><span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Constructor {Pattern}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GraphPattern <span style="font-family:courier;">ConstructorName</span> GraphPattern </td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Pattern </td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SpecialPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BasicValuePattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ListPattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">TuplePattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ArrayPattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordPattern</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BasicValuePattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">BasicValue</td></tr>
<tr><td style="width:23.0290909090909%;">BasicValue</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">IntDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">RealDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">BoolDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">CharDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ListPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind][{LGraphPattern}-list [<span style="font-family:courier;color:#993300;"><b>:</b></span> GraphPattern]] [SpineStrictness]<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">LGraphPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphPattern</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">CharsDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TuplePattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">(GraphPattern,{GraphPattern}-list)</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[TypeName <span style="font-family:courier;color:#993300;"><b>|</b></span>] {<span style="font-family:courier;">FieldName</span> [<span style="font-family:courier;color:#993300;"><b>=</b></span> GraphPattern]}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrayPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>{GraphPattern}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>{ArrayIndex <span style="font-family:courier;color:#993300;"><b>=</b></span> <span style="font-family:courier;">Variable</span>}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">StringDenotation</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DynamicPattern</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphPattern <span style="font-family:courier;color:#993300;"><b>::</b></span> DynamicType<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">DynamicType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[UniversalQuantVariables] {DynPatternType}+ [ClassContext]</td></tr>
<tr><td style="width:23.0290909090909%;">DynPatternType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">TypePatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">OverloadedTypePatternVariable</td></tr>
<tr><td style="width:23.0290909090909%;">TypePatternVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span></td></tr>
<tr><td style="width:23.0290909090909%;">OverloadedTypeVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span><span style="font-family:courier;color:#FF0000;"><b>^</b></span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_A.3.3">A.3.3 Graph Expressions</a></h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Application</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Application</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{BrackGraph}+</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr Operator GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">GenericAppExpr</td></tr>
<tr><td style="width:23.0290909090909%;">Operator</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;">FunctionName</span></td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;">ConstructorName</span></td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BrackGraph</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GraphVariable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Function</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">(GraphExpr)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">LambdaAbstr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">CaseExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">LetExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">SpecialExpression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">DynamicExpression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">MatchesPatternExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GraphVariable</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;">Variable</span></td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;">SelectorVariable</span></td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LambdaAbstr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>\</b></span> {Pattern}+ {LambdaGuardAlt} {LetBeforeExpression} LambdaResult</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>= </b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard LambdaGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaGuardAlt</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr LambdaGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaGuardRhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LambdaGuardAlt} {LetBeforeExpression} LambdaGuardResult</td></tr>
<tr><td style="width:23.0290909090909%;">LambdaGuardResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>= </b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> LambdaGuardRhs</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CaseExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>case</b></span> GraphExpr <span style="font-family:courier;color:#FF0000;"><b>of</b></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#0000FF;"><b>{</b></span> {CaseAltDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>if</b></span> BrackGraph BrackGraph BrackGraph</td></tr>
<tr><td style="width:23.0290909090909%;">CaseAltDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{Pattern}</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">{CaseGuardAlt} {LetBeforeExpression} CaseResult</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[LocalFunctionAltDefs]</td></tr>
<tr><td style="width:23.0290909090909%;">CaseResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> Guard CaseGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">CaseGuardAlt</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{LetBeforeExpression} <span style="font-family:courier;color:#993300;"><b>|</b></span> BooleanExpr CaseGuardRhs</td></tr>
<tr><td style="width:23.0290909090909%;">CaseGuardRhs</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{CaseGuardAlt} {LetBeforeExpression} CaseGuardResult</td></tr>
<tr><td style="width:23.0290909090909%;">CaseGuardResult</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>=</b></span> [<span style="font-family:courier;color:#993300;"><b>&gt;</b></span>] FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span> <span style="font-family:courier;color:#FF0000;"><b>otherwise</b></span> CaseGuardRhs</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LetExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>let</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span> <span style="font-family:courier;color:#FF0000;"><b>in</b></span> GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SpecialExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BasicValue</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">List</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Tuple</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Array</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ArraySelection</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">Record</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordSelection</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">List</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">ListDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">DotDotExpression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">ZF-expression</td></tr>
<tr><td style="width:23.0290909090909%;">ListDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] [{LGraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>:</b></span> GraphExpr]] [SpineStrictness] <span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">LGraphExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.4854545454545%;">CharsDenotation</td><td style="width:48.4236363636364%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">DotDotExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] GraphExpr [<span style="font-family:courier;color:#993300;"><b>,</b></span>GraphExpr]<span style="font-family:courier;color:#993300;"><b>..</b></span>[GraphExpr] [SpineStrictness] <span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ZF-expression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] GraphExpr <span style="font-family:courier;color:#993300;"><b>\</b></span>{Qualifier}-list [SpineStrictness]<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">Qualifier</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">Generators { <span style="font-family:courier;color:#993300;"><b>,</b></span> <span style="font-family:courier;color:#FF0000;"><b>let</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {LocalDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span> } {<span style="font-family:courier;color:#993300;"><b>|</b></span>Guard}</td></tr>
<tr><td style="width:23.0290909090909%;">Generators</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{Generator}-list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Generator {<span style="font-family:courier;color:#993300;"><b>&amp;</b></span> Generator}</td></tr>
<tr><td style="width:23.0290909090909%;">Generator</td><td style="width:1.06181818181818%;">=</td><td style="width:27.4854545454545%;">Selector <span style="font-family:courier;color:#993300;"><b>&lt;-</b></span> ListExpr</td><td style="width:48.4236363636364%;">// select from a lazy list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.4854545454545%;">Selector <span style="font-family:courier;color:#993300;"><b>&lt;|-</b></span> ListExpr</td><td style="width:48.4236363636364%;">// select from an overloaded list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.4854545454545%;">Selector <span style="font-family:courier;color:#993300;"><b>&lt;-:</b></span> ArrayExpr</td><td style="width:48.4236363636364%;">// select from an array</td></tr>
<tr><td style="width:23.0290909090909%;">Selector</td><td style="width:1.06181818181818%;">=</td><td style="width:27.4854545454545%;">BrackPattern</td><td style="width:48.4236363636364%;">// for brack patterns <span style="color:blue;"><a href="#_3.2">see 3.2</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">ListExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Tuple</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>GraphExpr<span style="font-family:courier;color:#993300;"><b>,</b></span>{GraphExpr}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Array</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">ArrayDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">ArrayUpdate</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">ArrayComprehension</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">ArraySelection</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>{</b></span>[ArrayKind] {GraphExpr}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:29.3436363636364%;">StringDenotation</td><td style="width:46.5654545454545%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">ArrayUpdate</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>{</b></span> ArrayExpr <span style="font-family:courier;color:#993300;"><b>&amp;</b></span> {ArrayIndex {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list [<span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ArrayComprehension</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>{</b></span>[ArrayKind] GraphExpr <span style="font-family:courier;color:#993300;"><b>\\</b></span> {Qualifier}-list<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ArraySelection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"> ArrayExpr<span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2"> ArrayExpr<span style="font-family:courier;color:#993300;"><b>!</b></span>ArrayIndex {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;">Selection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>.</b></span>ArrayIndex</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">ArrayIndex</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>{IntegerExpr}-list<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">IntegerExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">GraphExpr</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Record</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">RecordDenotation</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordUpdate</td></tr>
<tr><td style="width:23.0290909090909%;">RecordDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[TypeName<span style="font-family:courier;color:#993300;"><b>|</b></span>] {<span style="font-family:courier;">FieldName</span> <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">RecordUpdate</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[TypeName<span style="font-family:courier;color:#993300;"><b>|</b></span>][RecordExpr <span style="font-family:courier;color:#993300;"><b>&amp;</b></span>][{<span style="font-family:courier;">FieldName</span> {Selection} <span style="font-family:courier;color:#993300;"><b>=</b></span> GraphExpr}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">RecordExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">RecordSelection</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">RecordExpr [<span style="font-family:courier;color:#993300;"><b>.</b></span>TypeName]<span style="font-family:courier;color:#993300;"><b>.</b></span><span style="font-family:courier;">FieldName</span> {Selection}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordExpr [<span style="font-family:courier;color:#993300;"><b>.</b></span>TypeName]<span style="font-family:courier;color:#993300;"><b>!</b></span><span style="font-family:courier;">FieldName</span> {Selection}</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DynamicExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>dynamic</b></span> GraphExpr [<span style="font-family:courier;color:#993300;"><b>::</b></span> [UniversalQuantVariables] Type [ClassContext]]</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">MatchesPatternExpr</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GraphExpr <span style="font-family:courier;color:#993300;"><b>=:</b></span> <span style="font-family:courier;">ConstructorName</span> { <span style="font-family:courier;color:#993300;"><b>_</b></span> }</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GraphExpr <span style="font-family:courier;color:#993300;"><b>=:</b></span> BrackPattern</td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.4">A.4 Macro Definition</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">MacroDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[MacroFixityDef]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">DefOfMacro</td></tr>
<tr><td style="width:23.0290909090909%;">MacroFixityDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span><span style="font-family:courier;">FunctionName</span><span style="font-family:courier;color:#993300;"><b>)</b></span> [Fix][Prec] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">DefOfMacro</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">Function {<span style="font-family:courier;">Variable</span>} <span style="font-family:courier;color:#993300;"><b>:==</b></span> FunctionBody <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[LocalFunctionAltDefs]</td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.5">A.5 Type Definition</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">AlgebraicTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">RecordTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">SynonymTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">AbstractTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">AbstractSynonymTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ExtensibleAlgebraicTypeDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">AlgebraicTypeDefExtension</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:9.05454545454545%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs</td><td style="width:66.8545454545455%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>=</b></span> ConstructorDef</td></tr>
<tr><td style="width:33.1454545454545%px'" colspan="3"></td><td style="width:66.8545454545455%px'" colspan="7">{<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ConstructorDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] <span style="font-family:courier;">ConstructorName</span> {ArgType}</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="8">[ExistentalQuantVariables] (<span style="font-family:courier;">ConstructorName</span>) [Fix][Prec] {ArgType}</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeLhs</td><td style="width:1.06181818181818%;">=</td><td style="width:15.9127272727273%;">[<span style="font-family:courier;color:#993300;"><b>*</b></span>] TypeConstructor</td><td style="width:59.9963636363636%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%px'" colspan="2">{<span style="font-family:courier;">TypeVariable</span>}</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ExistentalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>E.</b></span>{<span style="font-family:courier;">TypeVariable</span> }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Fix</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixl</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixr</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infix</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Prec</td><td style="width:1.06181818181818%;">=</td><td style="width:3.63636363636364%;">Digit</td><td style="width:72.2727272727273%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BrackType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] SimpleType</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Strict</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">UnqTypeAttrib</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>*</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:20.7272727272727%;"><span style="font-family:courier;">UniqueTypeVariable</span><span style="font-family:courier;color:#993300;"><b>:</b></span></td><td style="width:55.1818181818182%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>.</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Type</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{BrackType}+</td></tr>
<tr><td style="width:23.0290909090909%;">ArgType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BrackType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">UniversalQuantVariables</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>A.</b></span>{<span style="font-family:courier;">TypeVariable</span> }+<span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">RecordTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>=</b></span> [ExistentalQuantVariables] [Strict] <span style="font-family:courier;color:#993300;"><b>{</b></span>{<span style="font-family:courier;">FieldName</span> <span style="font-family:courier;color:#993300;"><b>::</b></span> FieldType}-list<span style="font-family:courier;color:#993300;"><b>}</b></span> <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">FieldType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">[Strict] Type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">UniversalQuantVariables [Strict] Type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">[Strict] [UnqTypeAttrib] <span style="font-family:courier;color:#993300;"><b>(</b></span>UniversalQuantVariables Type)</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SynonymTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>:==</b></span> Type <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AbstractTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AbstractSynonymTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>(:==</b></span> Type <span style="font-family:courier;color:#993300;"><b>)</b></span> <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ExtensibleAlgebraicTypeDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>=</b></span> {ConstructorDef <span style="font-family:courier;color:#993300;"><b>|</b></span>} <span style="font-family:courier;color:#993300;"><b>..</b></span><span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AlgebraicTypeDefExtension</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span>TypeLhs <span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef  {<span style="font-family:courier;color:#993300;"><b>|</b></span> ConstructorDef} <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<h3 style="background-color:#9999FF;"><a id="_A.5.1">A.5.1 Types Expression</a></h3>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">SimpleType</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;">TypeVariable</span></td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;">TypeConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>(</b></span>Type<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">PredefinedType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">PredefinedTypeConstructor</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PredefinedType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">BasicType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ListType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">TupleType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ArrayType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">ArrowType</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">PredefType</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">BasicType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>Int</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>Real</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>Char</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>Bool</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ListType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>[</b></span>[ListKind] Type [SpineStrictness]<span style="font-family:courier;color:#993300;"><b>]</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ListKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// head strict list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// head strict, unboxed list</td></tr>
<tr><td style="width:23.0290909090909%;">SpineStrictness</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// tail (spine) strict list</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TupleType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>[Strict] Type<span style="font-family:courier;color:#993300;"><b>,</b></span>{[Strict] Type}-list<span style="font-family:courier;color:#993300;"><b>)</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ArrayType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#993300;"><b>{</b></span>[ArrayKind] Type<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">ArrayKind</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:48.84%;">// strict array</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:48.84%;">// unboxed array</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PredefType</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>World</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdWorld.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>File</b></span></td><td style="width:48.84%;">// see <span style="font-family:courier;">StdFileIO.dcl</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>String</b></span></td><td style="width:48.84%;">// synonym for {#Char}</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">PredefinedTypeConstructor</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[]</b></span></td><td style="width:48.84%;">// list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[! ]</b></span></td><td style="width:48.84%;">// head strict list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[ !]</b></span></td><td style="width:48.84%;">// tail strict list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[!!]</b></span></td><td style="width:48.84%;">// strict list type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[#]</b></span></td><td style="width:48.84%;">// unboxed head strict list type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[#!]</b></span></td><td style="width:48.84%;">// unboxed strict list type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>(</b></span>{<span style="font-family:courier;color:#993300;"><b>,</b></span>}+<span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:48.84%;">// tuple type constructor (arity &gt;= 2)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{}</b></span></td><td style="width:48.84%;">// lazy array type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{!}</b></span></td><td style="width:48.84%;">// strict array type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{#}</b></span></td><td style="width:48.84%;">// unboxed array type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>(-&gt;)</b></span></td><td style="width:48.84%;">// arrow type constructor</td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.6">A.6 Class and Generic Definitions</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ClassDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">TypeClassDef</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">TypeClassInstanceDef</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeClassDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> <span style="font-family:courier;">ClassName</span> <span style="font-family:courier;">TypeVariable</span>+ [ClassContext]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span> {ClassMemberDef}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span>] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> <span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;">TypeVariable</span>+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType<span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span> (<span style="font-family:courier;">FunctionName</span>) [Fix][Prec] <span style="font-family:courier;">TypeVariable</span>+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType<span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ClassMemberDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">FunctionTypeDef</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%;">[MacroDef]</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">TypeClassInstanceDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span> <span style="font-family:courier;">ClassName</span> Type+ [ClassContext]</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:29.4581818181818%;">[[<span style="font-family:courier;color:#FF0000;"><b>where</b></span>] <span style="font-family:courier;color:#0000FF;"><b>{</b></span>{DefOfFunction}+ <span style="font-family:courier;color:#0000FF;"><b>}</b></span>]</td><td style="width:46.4509090909091%;">// in implementation modules</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:29.4581818181818%;">[Special] <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td><td style="width:46.4509090909091%;">// in definition modules</td></tr>
<tr><td style="width:23.0290909090909%;">Special</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2"><span style="font-family:courier;color:#FF0000;"><b>special</b></span> <span style="font-family:courier;color:#0000FF;"><b>{</b></span>{<span style="font-family:courier;">TypeVariable</span> <span style="font-family:courier;color:#993300;"><b>=</b></span> Type}-list { <span style="font-family:courier;color:#0000FF;"><b>;</b></span> {<span style="font-family:courier;">TypeVariable</span> <span style="font-family:courier;color:#993300;"><b>=</b></span> Type}-list }<span style="font-family:courier;color:#0000FF;"><b>}</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericsDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericDef ;</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GenericCase;</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">DeriveDef ;</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>generic</b></span> <span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;">TypeVariable</span>+ <span style="font-family:courier;color:#993300;"><b>::</b></span> FunctionType</td></tr>
<tr><td style="width:23.0290909090909%;">GenericCase</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#993300;"><b>{|</b></span>GenericTypeArg<span style="font-family:courier;color:#993300;"><b>|}</b></span> {Pattern}+ <span style="font-family:courier;color:#993300;"><b>=</b></span> FunctionBody</td></tr>
<tr><td style="width:23.0290909090909%;">GenericTypeArg</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericMarkerType [<span style="font-family:courier;color:#FF0000;"><b>of</b></span> Pattern]</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeVariable</span></td></tr>
<tr><td style="width:23.0290909090909%;">GenericMarkerType</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>CONS</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>OBJECT</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>RECORD</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>FIELD</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">DeriveDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>derive</b></span> <span style="font-family:courier;">FunctionName</span> {<span style="font-family:courier;">TypeConstructorName</span>}-list</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericAppExpression</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">FunctionName</span>TypeKind GraphExpr</td></tr>
<tr><td style="width:23.0290909090909%;">TypeKind</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{|* </b></span>{<span style="font-family:courier;color:#993300;"><b>-&gt; *</b></span>} <span style="font-family:courier;color:#993300;"><b>|}</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">GenericExportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">GenericDef <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>derive</b></span> <span style="font-family:courier;">FunctionName</span> {DeriveExportTypeArg}-list <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">DeriveExportTypeArg</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">TypeConstructorName</span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;">GenericMarkerType [<span style="font-family:courier;color:#FF0000;"><b>of</b></span> UsedGenericInfoFields]</td></tr>
<tr><td style="width:23.0290909090909%;">UsedGenericInfoFields</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span>[{<span style="font-family:courier;">FieldName</span>}-list]<span style="font-family:courier;color:#993300;"><b>}</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%;"><span style="font-family:courier;">Variable</span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.7">A.7 Foreign Export Definition</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ForeignExportDef</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#FF0000;"><b>foreign export</b></span> [ <span style="font-family:courier;color:#FF0000;"><b>ccall</b></span> | <span style="font-family:courier;color:#FF0000;"><b>stdcall</b></span> ] <span style="font-family:courier;">FunctionName</span> <span style="font-family:courier;color:#0000FF;"><b>;</b></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.8">A.8 Names</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ModuleName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">ModuleDirectoryName <span style="font-family:courier;color:#993300;"><b>.</b></span> ModuleName</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ModuleDirectoryName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:64.7254545454546%px'" colspan="3">UpperCaseId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">FunctionName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ConstructorName</span></td><td style="width:12.2454545454545%px'" colspan="3">=</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">SelectorVariable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">Variable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">MacroName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">FieldName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">TypeConstructorName</span></td><td style="width:12.2454545454545%px'" colspan="3">=</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">TypeVariable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">UniqueTypeVariable</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:65.1981818181818%px'" colspan="4"></td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">ClassName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
<tr><td style="width:23.0290909090909%;"><span style="font-family:courier;">MemberName</span></td><td style="width:1.06181818181818%;">=</td><td style="width:10.7109090909091%;">LowerCaseId</td><td style="width:0.472727272727273%;">|</td><td style="width:10.7109090909091%;">UpperCaseId</td><td style="width:2.22363636363636%;">|</td><td style="width:51.7909090909091%;">SymbolId</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LowerCaseId</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">LowerCaseChar~{IdChar}</td></tr>
<tr><td style="width:23.0290909090909%;">UpperCaseId</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">UpperCaseChar~{IdChar}</td></tr>
<tr><td style="width:23.0290909090909%;">SymbolId</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;">{SymbolChar}+</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LowerCaseChar</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>a</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>b</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>c</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>d</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>e</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>f</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>g</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>h</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>i</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>j</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>k</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>l</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>m</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>n</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>o</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>p</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>q</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>r</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>s</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>t</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>u</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>v</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>w</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>x</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>y</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>z</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">UpperCaseChar</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>A</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>B</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>C</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>D</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>E</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>F</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>G</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>H</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>I</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>J</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>K</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>L</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>M</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>N</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>O</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>P</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>Q</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>R</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>S</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>T</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>U</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>V</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>W</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>X</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>Y</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>Z</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">SymbolChar</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>~</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>@</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>$</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>%</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>^</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>?</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:64.9636363636364%px'" colspan="5"><span style="font-family:courier;color:#993300;"><b>!</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>+</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>-</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>*</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>&lt;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>&gt;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>\</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>/</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>|</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>&amp;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>=</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="19"><span style="font-family:courier;color:#993300;"><b>:</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">IdChar</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="19">LowerCaseChar</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="19">UpperCaseChar</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:10.4727272727273%px'" colspan="13">Digit</td><td style="width:65.4363636363636%px'" colspan="6"><span style="font-family:courier;color:#993300;"><b>// </b></span><span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>_</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:74.3454545454545%px'" colspan="17"><span style="font-family:courier;color:#993300;"><b>`</b></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_A.9">A.9 Denotations</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">IntDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:29.7654545454545%;">[Sign]{Digit}+</td><td style="width:46.1436363636364%;">// decimal number</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:29.7654545454545%;">[Sign]0{OctDigit}+</td><td style="width:46.1436363636364%;">// octal number</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:29.7654545454545%;">[Sign]0x{HexDigit}+</td><td style="width:46.1436363636364%;">// hexadecimal number</td></tr>
<tr><td style="width:23.0290909090909%;">Sign</td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">+ | -</td></tr>
<tr><td style="width:23.0290909090909%;">RealDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:29.7654545454545%;">[Sign]{Digit}+.{Digit}+[E[Sign]{Digit}+]</td><td style="width:46.1436363636364%;"></td></tr>
<tr><td style="width:23.0290909090909%;">BoolDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">True | False</td></tr>
<tr><td style="width:23.0290909090909%;">CharDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">CharDel AnyChar/CharDel CharDel</td></tr>
<tr><td style="width:23.0290909090909%;">CharsDenotation</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">CharDel {AnyChar/CharDel}+ CharDel</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">AnyChar</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="23">IdChar | ReservedChar | SpecialChar</td></tr>
<tr><td style="width:23.0290909090909%;">ReservedChar</td><td style="width:1.06181818181818%;">=</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>(</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>)</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>{</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>}</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>[</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>]</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>;</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>,</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:60.1272727272727%px'" colspan="7"><span style="font-family:courier;color:#993300;"><b>.</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">SpecialChar</td><td style="width:1.06181818181818%;">=</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\n</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\r</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\f</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:3.12727272727273%px'" colspan="4"><span style="font-family:courier;color:#993300;"><b>\b</b></span></td><td style="width:64.8181818181818%px'" colspan="13">// newline,return,formf,backspace</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\t</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:2.18181818181818%;"><span style="font-family:courier;color:#993300;"><b>\\</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:5.78181818181818%px'" colspan="6"><span style="font-family:courier;color:#993300;"><b>\</b></span>CharDel</td><td style="width:64.8181818181818%px'" colspan="13">// tab,backslash,character delimiter</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\</b></span>StringDel</td><td style="width:64.8181818181818%px'" colspan="13">// string delimiter</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\</b></span>{OctDigit}+</td><td style="width:64.8181818181818%px'" colspan="13">// octal number </td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\x</b></span>{HexDigit}+</td><td style="width:64.8181818181818%px'" colspan="13">// hexadecimal number </td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:11.0909090909091%px'" colspan="10"><span style="font-family:courier;color:#993300;"><b>\</b></span>IdChar</td><td style="width:64.8181818181818%px'" colspan="13">// escape any other character </td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Digit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>7</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>8</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>9</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">OctDigit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:64.9636363636364%px'" colspan="5"><span style="font-family:courier;color:#993300;"><b>7</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">HexDigit</td><td style="width:1.06181818181818%;">=</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>0</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>1</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>2</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>3</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>4</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>5</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>6</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>7</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>8</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:61.8363636363636%;"><span style="font-family:courier;color:#993300;"><b>9</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>A</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>B</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>C</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>D</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>E</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>F</b></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>a</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>b</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>c</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>d</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:1.09090909090909%;"><span style="font-family:courier;color:#993300;"><b>e</b></span></td><td style="width:0.472727272727273%;">|</td><td style="width:68.0909090909091%px'" colspan="9"><span style="font-family:courier;color:#993300;"><b>f</b></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">CharDel</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>'</b></span></td></tr>
<tr><td style="width:23.0290909090909%;">StringDel</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%;"><span style="font-family:courier;color:#993300;"><b>"</b></span></td></tr>
</table><p></p>
<!-- chapter:Appendix B-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_B"><br>Appendix B<br><br>Lexical Structure</a></h1></div>
<p style="text-align:justify;">In this appendix the lexical structure of CLEAN is given. It describes the kind of tokens recognised by the scanner/parser. In particular it summarizes the keywords, symbols and characters which have a special meaning in the language.</p>
<h2 style="background-color:#9999FF;"><a id="_B.1">B.1 Lexical Program Structure</a></h2>
<p style="text-align:justify;">In this Section the lexical structure of CLEAN is given. It describes the kind of tokens recognised by the scanner/parser. In particular it summarizes the keywords, symbols and characters which have a special meaning in the language.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">LexProgram</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">{ Lexeme | {Whitespace}+ }</td></tr>
<tr><td style="width:23.0290909090909%;">Lexeme</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">ReservedKeywordOrSymbol</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_B.3">see Section B.3</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">ReservedChar</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see Section A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Literal</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">Identifier</td></tr>
<tr><td style="width:23.0290909090909%;">Identifier</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">LowerCaseId</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">UpperCaseId</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">SymbolId</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;">Literal</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">IntDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">RealDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">BoolDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">CharDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">CharsDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">StringDenotation</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.9">see A.9</a></span></td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Whitespace</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">space</td><td style="width:48.84%;">// a space character</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">tab</td><td style="width:48.84%;">// a horizontal tab</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">newline</td><td style="width:48.84%;">// a newline char</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">formfeed</td><td style="width:48.84%;">// a formfeed</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">verttab</td><td style="width:48.84%;">// a vertical tab</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">Comment</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_B.2">see Section B.2</a></span></td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_B.2">B.2 Comments</a></h2>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">Comment</td><td style="width:1.06181818181818%;">=</td><td style="width:75.9090909090909%px'" colspan="2">// AnythingTillNL newline</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:27.0690909090909%;">/* AnythingTill/* Comment</td><td style="width:48.84%;">// comments may be nested</td></tr>
<tr><td style="width:24.0909090909091%px'" colspan="2"></td><td style="width:75.9090909090909%px'" colspan="2">AnythingTill*/ */</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">/* AnythingTill*/ */</td></tr>
<tr><td style="width:23.0290909090909%;">AnythingTillNL</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">{AnyChar/ newline}</td><td style="width:48.84%;">// no newline</td></tr>
<tr><td style="width:23.0290909090909%;">AnythingTill/*</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">{AnyChar/ /*}</td><td style="width:48.84%;">// no "/*"</td></tr>
<tr><td style="width:23.0290909090909%;">AnythingTill*/</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">{AnyChar/ */}</td><td style="width:48.84%;">// no "*/"</td></tr>
<tr><td style="width:23.0290909090909%;">AnyChar</td><td style="width:1.06181818181818%;">=</td><td style="width:27.0690909090909%;">IdChar</td><td style="width:48.84%;">// <span style="color:blue;"><a href="#_A.8">see A.8</a></span></td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">ReservedChar</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:1.06181818181818%;">|</td><td style="width:75.9090909090909%px'" colspan="2">SpecialChar</td></tr>
</table><p></p>
<h2 style="background-color:#9999FF;"><a id="_B.3">B.3 Reserved Keywords and Symbols </a></h2>
<p style="text-align:justify;">Below the keywords and symbols are listed which have a special meaning in the language. Some symbols only have a special meaning in a certain context. Outside this context they can be freely used if they are not a reserved character (<span style="color:blue;"><a href="#_A.9">see A.9</a></span>). In the comment it is indicated for which context (name space) the symbol is predefined.</p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">ReservedKeywordOrSymbol</td><td style="width:76.9709090909091%px'" colspan="3">=</td></tr>
<tr><td style="width:23.0290909090909%;">// in all contexts:</td><td style="width:0.472727272727273%;"></td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>/*</b></span></td><td style="width:49.4290909090909%;">// begin of comment block</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>*/</b></span></td><td style="width:49.4290909090909%;">// end of comment block</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>//</b></span></td><td style="width:49.4290909090909%;">// rest of line is comment</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>::</b></span></td><td style="width:49.4290909090909%;">// begin of a type definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>:==</b></span></td><td style="width:49.4290909090909%;">// in a type synonym or macro definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>=</b></span></td><td style="width:49.4290909090909%;">// in a function, graph, alg type, rec field, case, lambda</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>=:</b></span></td><td style="width:49.4290909090909%;">// labeling a graph definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>=&gt;</b></span></td><td style="width:49.4290909090909%;">// in a function definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>;</b></span></td><td style="width:49.4290909090909%;">// end of a definition (if no layout rule)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>foreign</b></span></td><td style="width:49.4290909090909%;">// begin of foreign export</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">// in global definitions:</td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>from</b></span></td><td style="width:49.4290909090909%;">// begin of symbol list for imports</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>definition</b></span></td><td style="width:49.4290909090909%;">// begin of definition module,</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>implementation</b></span></td><td style="width:49.4290909090909%;">// begin of implementation module</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>import</b></span></td><td style="width:49.4290909090909%;">// begin of import list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>module</b></span></td><td style="width:49.4290909090909%;">// in module header</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>system</b></span></td><td style="width:49.4290909090909%;">// begin of system module</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">// in function definitions:</td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span></td><td style="width:49.4290909090909%;">// in a case expression, lambda abstraction</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[</b></span></td><td style="width:49.4290909090909%;">// begin of a list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>:</b></span></td><td style="width:49.4290909090909%;">// cons node</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>]</b></span></td><td style="width:49.4290909090909%;">// end of a list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>\\</b></span></td><td style="width:49.4290909090909%;">// begin of list or array comprehension</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>&lt;-</b></span></td><td style="width:49.4290909090909%;">// list gen. in list or array comprehension</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>&lt;-:</b></span></td><td style="width:49.4290909090909%;">// array gen. in list or array comprehension</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{</b></span></td><td style="width:49.4290909090909%;">// begin of a record or array, begin of a scope</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>}</b></span></td><td style="width:49.4290909090909%;">// end of a record or array, end of a scope</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span></td><td style="width:49.4290909090909%;">// a record or array selector</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:49.4290909090909%;">// a record or array selector (for unique objects)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>&amp;</b></span></td><td style="width:49.4290909090909%;">// an update of a record or array, zipping gener.</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>case</b></span></td><td style="width:49.4290909090909%;">// begin of case expression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>code</b></span></td><td style="width:49.4290909090909%;">// begin code block in a syst impl. module</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>if</b></span></td><td style="width:49.4290909090909%;">// begin of a conditional expression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>in</b></span></td><td style="width:49.4290909090909%;">// end of (strict) let expression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>let</b></span></td><td style="width:49.4290909090909%;">// begin of let expression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:49.4290909090909%;">// begin of let expression (for a guard)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#!</b></span></td><td style="width:49.4290909090909%;">// begin of strict let expression (for a guard)</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>of</b></span></td><td style="width:49.4290909090909%;">// in case expression</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>where</b></span></td><td style="width:49.4290909090909%;">// begin of local def of a function alternative</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>with</b></span></td><td style="width:49.4290909090909%;">// begin of local def in a rule alternative</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">// in type specifications:</td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>!</b></span></td><td style="width:49.4290909090909%;">// strict type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>.</b></span></td><td style="width:49.4290909090909%;">// uniqueness type variable</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>#</b></span></td><td style="width:49.4290909090909%;">// unboxed type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>*</b></span></td><td style="width:49.4290909090909%;">// unique type</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>:</b></span></td><td style="width:49.4290909090909%;">// in a uniqueness type variable definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>-&gt;</b></span></td><td style="width:49.4290909090909%;">// function type constructor</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[],[!],[!!],[#],[#!]</b></span></td><td style="width:49.4290909090909%;">// lazy list, head strict, strict, unboxed, unboxed strict</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>[|]</b></span></td><td style="width:49.4290909090909%;">// overloaded list</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>(,),(,,),(,,,),...</b></span></td><td style="width:49.4290909090909%;">// tuple type constructors</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>{},{!},{#}</b></span></td><td style="width:49.4290909090909%;">// lazy, strict, unboxed array type constr.</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infix</b></span></td><td style="width:49.4290909090909%;">// infix indication in operator definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixl</b></span></td><td style="width:49.4290909090909%;">// infix left indication in operator definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>infixr</b></span></td><td style="width:49.4290909090909%;">// infix right indication in operator definition</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Bool</b></span></td><td style="width:49.4290909090909%;">// type Boolean</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Char</b></span></td><td style="width:49.4290909090909%;">// type character</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>File</b></span></td><td style="width:49.4290909090909%;">// type file</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Int</b></span></td><td style="width:49.4290909090909%;">// type integer</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>Real</b></span></td><td style="width:49.4290909090909%;">// type real</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#993300;"><b>World</b></span></td><td style="width:49.4290909090909%;">// type world</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;">// in class  definitions:</td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span></td><td style="width:49.4290909090909%;">// begin of type class definition</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>derive</b></span></td><td style="width:49.4290909090909%;">// derive instance of generic function</td></tr>
</table><p></p>
<table style="background-color:#FFCC99;"><tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>special</b></span></td><td style="width:49.4290909090909%;">// to create a specialized instance</td></tr>
<tr><td style="width:23.0290909090909%;"></td><td style="width:0.472727272727273%;">|</td><td style="width:27.0690909090909%;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span></td><td style="width:49.4290909090909%;">// def of instance of a type class</td></tr>
</table><p></p>
<!-- chapter:Appendix C-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_C"><br>Appendix C<br><br>Bibliography</a></h1></div>
<p style="text-align:justify;">You can find all our papers on our site: <span style="color:#0000FF;">http://wiki.clean.cs.ru.nl/Publications</span></p>
<p style="text-align:justify;">Peter Achten, John van Groningen and Rinus Plasmeijer (1992). "High-level specification of I/O in functional languages". <i>In: Proc. of the Glasgow workshop on Functional programming</i>, ed. J. Launchbury and P. Sansom, Ayr, Scotland, Springer-Verlag, Workshops in Computing, pp. 1-17.</p>
<p style="text-align:justify;">Peter Achten and Rinus Plasmeijer (1995). "The Ins and Outs of CONCURRENT CLEAN I/O". <i>Journal of Functional Programming,</i> 5, 1, pp. 81-110.</p>
<p style="text-align:justify;">Peter Achten and Rinus Plasmeijer (1997). "Interactive Functional Objects in CLEAN". In: <i>Proc. of the 1997 Workshop on the Implementation of Functional Languages (IFL'97)</i>, ed. K. Hammond Davie, T., and Clack, C., St.Andrews, Scotland, pp. 387-406.</p>
<p style="text-align:justify;">Artem Alimarine and Rinus Plasmeijer. A Generic Programming Extension for Clean. In: Arts, Th., Mohnen, M. eds. Proceedings of the 13th International workshop on the Implementation of Functional Languages, IFL'01, Älvsjö, Sweden, September 24-26, 2001, Ericsson Computer Science Laboratory, pp.257-278.</p>
<p style="text-align:justify;">Tom Brus, Marko van Eekelen, Maarten van Leer, Rinus Plasmeijer (1987). 'CLEAN - A Language for Functional Graph Rewriting'. <i>Proc. of the Third International Conference on Functional Programming Languages and Computer Architecture (FPCA '87)</i>, Portland, Oregon, USA, LNCS 274, Springer Verlag, 364-384.</p>
<p style="text-align:justify;">Barendregt, H.P. (1984). The Lambda-Calculus, its Syntax and Semantics. North-Holland.</p>
<p style="text-align:justify;">Henk Barendregt, Marko van Eekelen, John Glauert, Richard Kennaway, Rinus Plasmeijer, Ronan Sleep (1987). 'Term Graph Rewriting'. <i>Proceedings of Parallel Architectures and Languages Europe (PARLE)</i>, part II, Eindhoven, The Netherlands. LNCS 259, Springer Verlag, 141-158.</p>
<p style="text-align:justify;">Erik Barendsen and Sjaak Smetsers (1993a). 'Extending Graph Rewriting with Copying'. In: <i>Proc. of the Seminar on Graph Transformations in Computer Science</i>, ed. B. Courcelle, H. Ehrig, G. Rozenberg and H.J. Schneider, Dagstuhl, Wadern, Springer-Verlag, Berlin, LNCS 776, Springer Verlag, pp 51-70.</p>
<p style="text-align:justify;">Erik Barendsen and Sjaak Smetsers (1993b). 'Conventional and Uniqueness Typing in Graph Rewrite Systems (extended abstract)'. In: <i>Proc. of the 13th Conference on the Foundations of Software Technology &amp; Theoretical Computer Science</i>, ed. R.K. Shyamasundar, Bombay, India, LNCS 761, Springer Verlag, pp. 41-51.</p>
<p style="text-align:justify;">Bird, R.S. and P. Wadler (1988). <i>Introduction to Functional Programming</i>. Prentice Hall.</p>
<p style="text-align:justify;">Marko van Eekelen, Rinus Plasmeijer, Sjaak Smetsers (1991). 'Parallel Graph Rewriting on Loosely Coupled Machine Architectures'. In Kaplan, S. and M. Okada (Eds.) <i>Proc. of the 2nd Int. Worksh. on Conditional and Typed Rewriting Systems (CTRS'90)</i>, 1990. Montreal, Canada, LNCS 516, Springer Verlag, 354-370.</p>
<p style="text-align:justify;">Eekelen, M.C.J.D. van, J.W.M. Smetsers, M.J. Plasmeijer (1997). "Graph Rewriting Semantics for Functional Programming Languages". In: <i>Proc. of the CSL '96, Fifth Annual conference of the European Association for Computer Science Logic (EACSL)</i>, ed. Marc Bezem Dirk van Dalen, Utrecht, Springer-Verlag, LNCS, 1258, pp. 106-128.</p>
<p style="text-align:justify;">Harper, R., D. MacQueen and R. Milner (1986). 'Standard ML'. Edinburgh University, Internal report ECS-LFCS-86-2.</p>
<p style="text-align:justify;">Hindley R. (1969). The principle type scheme of an object in combinatory logic. <i>Trans. of the American Math. Soc.</i>, <b>146</b>, 29-60.</p>
<p style="text-align:justify;"> Hudak, P. , S. Peyton Jones, Ph. Wadler, B. Boutel, J. Fairbairn, J. Fasel, K. Hammond, J. Hughes, Th. Johnsson, D. Kieburtz, R. Nikhil, W. Partain and J. Peterson (1992). 'Report on the programming language Haskell'. <i>ACM SigPlan notices,</i> 27, 5, pp. 1-164.</p>
<p style="text-align:justify;">John van Groningen and Rinus Plasmeijer. Strict and unboxed lists using type constructor classes in a lazy functional language. Presented at the 13th International Workshop on the Implementation of Functional Languages, IFL 2001, Älvsjö, Sweden, September 24-26, 2001, Ericsson Computer Science Laboratory.</p>
<p style="text-align:justify;">Jones, M.P. (1993). <i>Gofer - Gofer 2.21 release notes</i>. Yale University.</p>
<p style="text-align:justify;">Marko Kesseler (1991). 'Implementing the ABC machine on transputers'. In: <i>Proc. of the 3rd International Workshop on Implementation of Functional Languages on Parallel Architectures</i>, ed. H. Glaser and P. Hartel, Southampton, University of Southampton, Technical Report 91-07, pp. 147-192.</p>
<p style="text-align:justify;">Kesseler, M.H.G. (1996). The Implementation of Functional Languages on Parallel Machines with Distributed Memory. Ph.D., University of Nijmegen.</p>
<p style="text-align:justify;">Milner, R.A. (1978). 'Theory of type polymorphism in programming'. <i>Journal of Computer and System Sciences,</i> 17, 3, 348-375.</p>
<p style="text-align:justify;">Mycroft A. (1984). Polymorphic type schemes and recursive definitions. In <i>Proc. International Conference on Programming,</i> Toulouse (Paul M. and Robinet B., eds.), LNCS 167, Springer Verlag, 217239.</p>
<p style="text-align:justify;">Eric Nöcker, Sjaak Smetsers, Marko van Eekelen, Rinus Plasmeijer (1991). 'CONCURRENT CLEAN'. In Aarts, E.H.L., J. van Leeuwen, M. Rem (Eds.), <i>Proceedings of the Conference on Parallel Architectures and Languages Europe (PARLE'91)</i>, Vol II, Eindhoven, The Netherlands, LNCS 505, Springer Verlag, June 1991, 202-219.</p>
<p style="text-align:justify;">Eric Nöcker (1993). 'Strictness analysis using abstract reduction'. In: <i>Proc. of the 6th Conference on Functional Programming Languages and Computer Architectures</i>, ed. Arvind, Copenhagen, ACM Press, pp. 255-265.</p>
<p style="text-align:justify;">Eric Nöcker and Sjaak Smetsers (1993). 'Partially strict non-recursive data types'. <i>Journal of Functional Programming,</i> <b>3</b>, 2, pp. 191-215.</p>
<p style="text-align:justify;">Pil, M.R.C. (1999), Dynamic types and type dependent functions , In Proc. of Implementation of Functional Languages (IFL '98), London, U.K., Hammond, Davie and Clack Eds., Springer-Verlag, Berlin, Lecture Notes in Computer Science 1595, pp 169-185.</p>
<p style="text-align:justify;">Rinus Plasmeijer and Marko van Eekelen (1993). <i>Functional Programming and Parallel Graph Rewriting</i>. Addison Wesley, ISBN 0-201-41663-8.</p>
<p style="text-align:justify;">Sjaak Smetsers, Eric Nöcker, John van Groningen, Rinus Plasmeijer (1991). 'Generating Efficient Code for Lazy Functional Languages'. In Hughes, J. (Ed.), <i>Proc. of the Fifth International Conference on Functional Programming Languages and Computer Architecture (FPCA '91)</i>, USA, LNCS 523, Springer Verlag, 592-618.</p>
<p style="text-align:justify;">Ronan Sleep, Rinus Plasmeijer and Marko van Eekelen (1993). <i>Term Graph Rewriting - Theory and Practice</i>. John Wiley &amp; Sons.</p>
<p style="text-align:justify;">Yoshihito Toyama, Sjaak Smetsers, Marko van Eekelen and Rinus Plasmeijer (1993). 'The functional strategy and transitive term rewriting systems'. In: <i>Term Graph Rewriting</i>, ed. Sleep, Plasmeijer and van Eekelen, John Wiley.</p>
<p style="text-align:justify;">Turner, D.A. (1985). 'Miranda: a non-strict functional language with polymorphic types'. In: <i>Proc. of the Conference on Functional Programming Languages and Computer Architecture</i>, ed. J.P. Jouannaud, Nancy, France. LNCS 201, Springer Verlag, 1-16.</p>
<p style="text-align:justify;">Martijn Vervoort and Rinus Plasmeijer (2002). Lazy Dynamic Input/Output in the lazy functional language Clean - early draft -. In: Peña, R. ed. Proceedings of the 14th International Workshop on the Implementation of Functional Languages, IFL 2002, Madrid, Spain, September 16-18, 2002, Technical Report 127-02, Departamento de Sistemas Informáticos y Programació n, Universidad Complutense de Madrid, pages 404-408.</p>
<p style="text-align:justify;">Arjen van Weelden and Rinus Plasmeijer (2002). Towards a Strongly Typed Functional Operating System. In: Peña, R. ed. Proceedings of the 14th International Workshop on the Implementation of Functional Languages, IFL 2002, Madrid, Spain, September 16-18, 2002, Technical Report 127-02, Departamento de Sistemas Informáticos y Programación, Universidad Complutense de Madrid, pages 301-319.</p>
<!-- chapter:Appendix D-->
<div><div style="position: absolute;"><svg width="355.555555555556" height="177.777777777778">
<path d="M49.7777777777778 7.32929319639176 h280.888888888889 v141.785858051661 h-280.888888888889 Z M64 33.9959598630584 h252.444444444444 v88.4525247183276 h-252.444444444444 Z" stroke="none" fill="#3F87AF" fill-rule="evenodd"/>
<path d="M64 111.781817914719 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 33.9959598630584 h252.444444444444 v10.6666666666667 h-252.444444444444 Z" stroke="none" fill="#8C96A0"/>
<path d="M64 44.6626265297251 h252.444444444444 v67.1191913849942 h-252.444444444444 Z" stroke="none" fill="#FFFFFF"/>
<path d="M99.1179703874409 137.550135143052 C93.2711853763986 133.302197180425,88.084448516421 128.213312506961,83.725936053644 122.448484581386 L110.089961763567 122.448484581386 Z" stroke="none" fill="#8C96A0"/>
<path d="M99.1179703874409 18.8943093013927 C93.2711853763986 23.1422472640192,88.084448516421 28.2311319374834,83.725936053644 33.9959598630584 L110.089961763567 33.9959598630584 Z" stroke="none" fill="#8C96A0"/>
<path d="M126.968649704419 100.555210486665 C109.380820468897 87.7769045717629,109.380820468897 61.5564287615705,126.968649704419 48.7781228466684 L116.780371998016 34.7551616108359 C89.6658019265873 54.45504989631,89.6658019265873 94.8782834370233,116.780371998016 114.578171722497 Z" stroke="none" fill="#8C96A0"/>
<path d="M113.645517319123 118.89292902583 C83.5996423751073 97.0633230878727,83.5996423751073 52.2700102454607,113.645517319123 30.4404043075029 L102.673525942996 15.3387537458372 C62.3680839449271 44.6223714674879,62.3680839449271 104.710961865845,102.673525942996 133.994579587496 Z" stroke="none" fill="#8C96A0"/>
<path d="M123.413094148863 104.110766042221 C105.825264913342 91.3324601273184,105.825264913342 65.111984317126,123.413094148863 52.3336784022239 L113.22481644246 38.3107171663915 C86.1102463710318 58.0106054518656,86.1102463710318 98.4338389925788,113.22481644246 118.133727278053  Z" stroke="none" fill="#3F87AF"/>
<path d="M110.089961763567 122.448484581386 C80.0440868195518 100.618878643428,80.0440868195518 55.8255658010162,110.089961763567 33.9959598630584L83.725936053644 33.9959598630584 C63.9432065006372 60.1617750913602,63.9432065006372 96.2826693530842,83.725936053644 122.448484581386" stroke="none" fill="#3F87AF"/>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="145.777777777778" y="103.111111111111" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144.888888888889" y="102.222222222222" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="144" y="101.333333333333" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="143.111111111111" y="100.444444444444" fill="#8C96A0">Clean</text>
<text font-family="Helvetica" font-weight="bold" font-size="56.8888888888889px" x="142.222222222222" y="99.5555555555556" fill="#3F87AF">Clean</text>
</svg>
</div><h1 style="text-align:right;background-color:#9999FF;"><a id="_D"><br>Appendix D<br><br>Compiler Extensions</a></h1></div>
<p style="text-align:justify;">This appendix lists extensions and modifications to Clean that are supported by a compiler. Unfortunately they are not yet described in the previous chapters and appendices of this manual.</p>
<h2 style="background-color:#9999FF;"><a id="_D.1">D.1 Clean 3.0 Compiler Extensions</a></h2>
<h3 style="background-color:#9999FF;"><a id="_D.1.1">D.1.1 New imports</a></h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Identifiers can be imported qualified by adding <span style="font-family:courier;">qualified</span> after <span style="font-family:courier;">import</span> in the import statement. For example:</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;qualified&nbsp;StdList;<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>from</b></span>&nbsp;StdList&nbsp;<span style="font-family:courier;color:#FF0000;"><b>import</b></span>&nbsp;qualified&nbsp;drop,++;<br></p>
</p>
<p style="text-align:justify;">Identifiers imported in this way can be used by prefixing the identifier with the module name between single quotes and a dot. If an identifier consists of special characters (for example <span style="font-family:courier;">++</span>) an additional single space is required between the dot and the identifier.</p>
<p><div style="background-color:#FFFF45";>For example:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
f&nbsp;l&nbsp;=&nbsp;'StdList'.drop&nbsp;1&nbsp;(l&nbsp;'StdList'.&nbsp;++&nbsp;[2]);<br></div>
</p><p style="text-align:justify;">Currently field names of records are not imported by an implicit qualified import, but can be imported with an explicit qualified import.</p>
<p style="text-align:justify;">Qualified names may only be used if a qualified import is used, not if the identifier is only imported by a normal (unqualified) import. An identifier may be imported both unqualified and qualified.</p>
<p style="text-align:justify;">Qualified imports may be used in definition modules, but qualified identifiers cannot be imported from a (definition) module.</p>
<h3 style="background-color:#9999FF;"><a id="_D.1.2">D.1.2 Uniqueness typing additions</a></h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Updates of unique array elements:</td></tr>
</table>
<p style="text-align:justify;">A unique array element of a (unique) array of unique elements can be selected and updated, if the selection (using <span style="font-family:courier;">![ ]</span>) and update (with the same index) occur in the same function and the array is not used in between (only the selected element is used).</p>
<p style="text-align:justify;">For example, below a unique row is selected, updated by <span style="font-family:courier;">inc_a</span> and finally the row of the array is updated.</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">inc_row&nbsp;::&nbsp;!*{#*{#Int}}&nbsp;!Int&nbsp;-&gt;&nbsp;*{#*{#Int}};<br>
inc_row&nbsp;a&nbsp;row_i<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(row,a)&nbsp;=&nbsp;a![row_i];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;=&nbsp;inc_a&nbsp;0&nbsp;row;<br>
&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;{a&nbsp;&amp;&nbsp;[row_i]=row};<br>
<br>
inc_a&nbsp;::&nbsp;!Int&nbsp;!*{#Int}&nbsp;-&gt;&nbsp;*{#Int};<br>
inc_a&nbsp;i&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;i&lt;size&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(n,a)&nbsp;=&nbsp;a![i];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&amp;&nbsp;[i]=n+1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;inc_a&nbsp;(i+1)&nbsp;a;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;a;<br></p>
</p>
<h3 style="background-color:#9999FF;"><a id="_D.1.3">D.1.3 New strictness annotations</a></h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Strictness annotations in types of class instance members</td></tr>
</table>
<p style="text-align:justify;">Types of class instance members may contain additional strictness annotations. For example:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>class</b></span>&nbsp;next&nbsp;a&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;a<br>
<br>
<span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;next&nbsp;Int&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;::&nbsp;!Int&nbsp;-&gt;&nbsp;Int<br>
&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;x&nbsp;=&nbsp;x+1<br></p>
</p>
<p style="text-align:justify;">If such an instance is exported, the type of the instance member must be included in the definition module:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;next&nbsp;Int&nbsp;<span style="font-family:courier;color:#FF0000;"><b>where</b></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;::&nbsp;!Int&nbsp;-&gt;&nbsp;Int<br></p>
</p>
<p style="text-align:justify;">If no additional strictness annotations are specified, it can still be exported without the type by:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>instance</b></span>&nbsp;next&nbsp;Int<br></p>
</p>
<h3 style="background-color:#9999FF;"><a id="_D.1.4">D.1.4 Hierarchical modules</a></h3>
<p style="text-align:justify;">The module name can be used to specify the directory containing the module. In that case the module name is the list of folder names of the directory, separated by <span style="font-family:courier;">.</span>'s, followed by a <span style="font-family:courier;">.</span> and the file name. For example the implementation module <span style="font-family:courier;">X.Y.Z</span> is stored in file <span style="font-family:courier;">X/Y/Z.icl</span> (file <span style="font-family:courier;">Z.icl</span> in subfolder <span style="font-family:courier;">Y</span> of folder <span style="font-family:courier;">Z</span>). The path containing the first folder (<span style="font-family:courier;">X</span> in this case) should be a module search path for the compiler.</p>
<h3 style="background-color:#9999FF;"><a id="_D.1.5">D.1.5 New types</a></h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">The predefined unit type.</td></tr>
</table>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">::&nbsp;()&nbsp;=&nbsp;()<br></p>
</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Extensible algebraic types can be defined by adding <span style="font-family:courier;">| ..</span> to the algebraic type definition (or just <span style="font-family:courier;">..</span> without constructors). In other modules additional constructors may be added (once per module) by using <span style="font-family:courier;">|</span> in the definition instead of <span style="font-family:courier;">=</span>.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>For example, to define extensible type <span style="font-family:courier;">T</span> with constructor <span style="font-family:courier;">A</span>:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;T&nbsp;=&nbsp;A&nbsp;Int&nbsp;|&nbsp;..<br></div>
</p><p><div style="background-color:#FFFF45";>To extended <span style="font-family:courier;">T</span> with constructor <span style="font-family:courier;">B</span> in another module:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
::&nbsp;T&nbsp;|&nbsp;B&nbsp;Int&nbsp;Int<br></div>
</p><h3 style="background-color:#9999FF;"><a id="_D.1.6">D.1.6 Generics additions</a></h3>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Instances of generic functions for the generic representation types (<span style="font-family:courier;">UNIT</span>,<span style="font-family:courier;">PAIR</span>,<span style="font-family:courier;">EITHER</span>,<span style="font-family:courier;">OBJECT</span>,<span style="font-family:courier;">CONS</span>,<span style="font-family:courier;">RECORD</span>,<span style="font-family:courier;">FIELD</span>) may be defined in definition modules (instead of a derive) using the same syntax as used in implementation modules. This makes it possible for the compiler to optimise derived generic functions in other modules.</td></tr>
</table>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In definition modules the used generic info fields for generic instances of <span style="font-family:courier;">OBJECT</span>, <span style="font-family:courier;">CONS</span>, <span style="font-family:courier;">RECORD</span> and <span style="font-family:courier;">FIELD</span> can be specified by adding: <span style="font-family:courier;">of</span> and the pattern, at the end of the derive statement. The compiler uses this to optimize the generated code.</td></tr>
</table>
<p><div style="background-color:#FFFF45";>For example if <span style="font-family:courier;">g2</span> is defined as:</div>
<div style="font-family:courier;margin:0px;background-color:#FFFF99;"><br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;g2&nbsp;a&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;Int;<br>
g2{|CONS&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span>&nbsp;{gcd_name}|}&nbsp;_&nbsp;_&nbsp;=&nbsp;size&nbsp;gcd_name;<br></div>
</p><p style="text-align:justify;">add: <span style="font-family:courier;">of {gcd_name}</span> in the definition module:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;">derive&nbsp;g2&nbsp;CONS&nbsp;of&nbsp;{gcd_name};<br></p>
</p>
<p style="text-align:justify;"><span style="font-family:courier;">g2</span> for <span style="font-family:courier;">CONS</span> will be called with just a <span style="font-family:courier;">gcd_name</span>, instead of a <span style="font-family:courier;">GenericConsDescriptor</span> record.</p>
<p></p><table style="width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">In definition modules unused generic function dependencies for generic instances can be specified by adding: <span style="font-family:courier;">with</span> followed by the list of dependencies, but an <span style="font-family:courier;">_</span> for unused dependencies. The compiler uses this to optimize the generated code.</td></tr>
</table>
<p style="text-align:justify;">For example if the implementation module defines:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;g1&nbsp;a&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;Int;<br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;g2&nbsp;a&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;Int;<br>
<span style="font-family:courier;color:#FF0000;"><b>generic</b></span>&nbsp;h&nbsp;a&nbsp;|&nbsp;g1&nbsp;a,&nbsp;g2&nbsp;a&nbsp;::&nbsp;a&nbsp;-&gt;&nbsp;Int;<br>
<br>
h{|OBJECT&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span>&nbsp;{gtd_name}|}&nbsp;_&nbsp;g1&nbsp;_&nbsp;(OBJECT&nbsp;a)<br>
&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;g1&nbsp;a+size&nbsp;(gtd_name);<br></p>
</p>
<p style="text-align:justify;">add: <span style="font-family:courier;">with _ g1 _</span> in the definition module:</p>
<p><p style="font-family:courier;margin:0px;background-color:#FFFF99;line-height:1.125;"><span style="font-family:courier;color:#FF0000;"><b>derive</b></span>&nbsp;h&nbsp;OBJECT&nbsp;<span style="font-family:courier;color:#FF0000;"><b>of</b></span>&nbsp;{gtd_name}&nbsp;<span style="font-family:courier;color:#FF0000;"><b>with</b></span>&nbsp;_&nbsp;g1&nbsp;_;<br></p>
</p>
<p style="text-align:justify;"><span style="font-family:courier;">h</span> for <span style="font-family:courier;">OBJECT</span> will be called without a function argument for <span style="font-family:courier;">h</span> (for a of <span style="font-family:courier;">OBJECT</span>), with <span style="font-family:courier;">g1</span> and without <span style="font-family:courier;">g2</span>, because <span style="font-family:courier;">h</span> and <span style="font-family:courier;">g2</span> are not used by the implementation.</p>
<h2 style="background-color:#9999FF;"><a id="_D.2">D.2 Clean Development Compiler Extensions</a></h2>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">types of instance members in definition modules.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">generic functions can have dependent generic functions (also in Clean 3.0).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">type GenericInfo (in module StdGeneric) changed.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">generic instances of generic representation types (e.g. CONS) may occur in definition modules.</td></tr>
</table>
<h2 style="background-color:#9999FF;"><a id="_D.3">D.3 Clean ITask Compiler Extensions</a></h2>
<table style="border-spacing:0;width:100%;"><tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Function arguments may have contexts with universally quantified type variables.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">Constructors may have contexts (for normal and universally quantified type variables).</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">dynamic types may have contexts.</td></tr>
<tr><td style="vertical-align:top;width:30px;"><table style="border-top:7px solid white;border-bottom:1px solid white;border-left:0px solid white;border-right:8px solid white;width:16px;height:16px;background:#FFCC99;float:left"></table>
</td><td style="text-align:justify;">derive class.</td></tr>
</table>
</body>
</html>
